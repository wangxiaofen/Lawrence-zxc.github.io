<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>sed和awk学习总结 | Jeck_Zhang</title>
  <meta name="author" content="Jeck Zhang">
  
  <meta name="description" content="zxc&#39;s blog | java | ruby | perl | linux">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="sed和awk学习总结"/>
  <meta property="og:site_name" content="Jeck_Zhang"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link type="image/x-icon" href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Jeck_Zhang" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script src="/js/jquery.min.js"></script>
  
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-45019001-1', 'topdna.org');
  ga('send', 'pageview');

</script>


</head>


<body>
  <!--[if lte IE 8]> <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'> <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode"><img src="http://storage.ie6countdown.com/assets/100/images/banners/warning_bar_0027_Simplified Chinese.jpg" border="0" height="42" width="820" alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today." style='margin-left:auto;margin-right:auto;display: block;'/></a></div> <![endif]-->
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">Jeck_Zhang</a></h1>
  <h2><a href="/">Write the Code. Change the World.</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">首页</a></li>
    
      <li><a href="http://weibo.com/zxc337">weibo</a></li>
    
      <li><a href="/2014/10/01/aboutMe/">关于</a></li>
    
      <li><a href="/tags/随感/">随感</a></li>
    
      <li><a href="/tags/技术/">技术</a></li>
    
      <li><a href="/tags/理财/">理财</a></li>
    
      <li><a href="/tags/生活/">生活</a></li>
    
      <li><a href="/archives">归档</a></li>
    
    <li><a href="/atom.xml">RSS</a></li>
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <time datetime="2011-07-10T08:53:58.000Z"><a href="/2011/07/10/sed-awk/">7月 10 2011</a></time>
      
      
  
    <h1 class="title">sed和awk学习总结</h1>
  

    </header>
    <div class="entry">
      
        <h3 id="一些说明">一些说明</h3>
<p>我测试例子都是在mac os x下,freebsd的sed和awk和gnu的都略有不同,甚至osx下得版本都不能使用,我会在注释中说明;</p>
<ul>
<li><p>sed<br>   sed 通用<br>  /usr/local/bin/sed osx下编译的gnu sed</p>
</li>
<li><p>awk<br>  awk 通用<br>  gawk osx编译的gnu awk</p>
</li>
</ul>
<h2 id="SED基础">SED基础</h2>
<h3 id="常用语法">常用语法</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 语法1</span></div><div class="line">sed [options] {sed-commands} {input-file}</div></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 例子</span></div><div class="line"><span class="comment"># -n表示取消默认输出,p表示打印行</span></div><div class="line"><span class="variable">$sed</span> -n <span class="string">'p'</span> /etc/passwd</div><div class="line"><span class="comment"># 只打印第三行</span></div><div class="line"><span class="variable">$sed</span> -n <span class="string">'3p'</span> /etc/passwd</div><div class="line"><span class="comment"># 打印1，3行</span></div><div class="line"><span class="variable">$sed</span> -n <span class="string">'1,3p'</span> /etc/passwd</div></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 语法2</span></div><div class="line">sed [options] <span class="operator">-f</span> {sed-commands-in<span class="operator">-a</span>-file} {input-file}</div></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 例子</span></div><div class="line"><span class="comment"># 打印以root开头或者nobody开头的行</span></div><div class="line">cat sed_example_1.sed</div><div class="line">/^root/ p</div><div class="line">/^nobody/ p</div><div class="line"><span class="comment">#</span></div><div class="line">sed -n <span class="operator">-f</span> sed_example_1.sed /etc/passwd</div></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 语法3</span></div><div class="line">sed [options] <span class="operator">-e</span> {sed-command-<span class="number">1</span>} <span class="operator">-e</span> {sed-command-<span class="number">2</span>} {input-file}</div></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 例子</span></div><div class="line"><span class="comment"># 打印以root开头或者nobody开头的行</span></div><div class="line"><span class="variable">$sed</span> -n <span class="operator">-e</span> <span class="string">'/^root/ p'</span> <span class="operator">-e</span> <span class="string">'/^nobody/ p'</span> /etc/passwd</div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># 或者</span></div><div class="line"><span class="variable">$sed</span> -n \</div><div class="line"><span class="operator">-e</span> <span class="string">'/^root/ p'</span> \</div><div class="line"><span class="operator">-e</span> <span class="string">'/^nobody/ p'</span> \</div><div class="line">/etc/passwd</div></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 语法4</span></div><div class="line">sed [options] <span class="string">'{</span></div><div class="line">sed-command-1</div><div class="line">sed-command-2</div><div class="line">}' input-file</div></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 例子</span></div><div class="line"><span class="comment"># 打印以root开头或者nobody结尾的行</span></div><div class="line">sed -n <span class="string">'{</span></div><div class="line">/^root/ p</div><div class="line">/nobody$/ p</div><div class="line">}' /etc/passwd</div></pre></td></tr></table></figure>



<h3 id="SED流">SED流</h3>
<ul>
<li>1.读</li>
<li>2.执行</li>
<li>3.打印</li>
<li>4.重复</li>
</ul>
<p>源文件</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">101,Ian Bicking,Mozilla</div><div class="line">102,Hakim El Hattab,Whim</div><div class="line">103,Paul Irish,Google</div><div class="line">104,Addy Osmani,Google</div><div class="line">105,Chris Wanstrath,Github</div><div class="line">106,Mattt Thompson,Heroku</div><div class="line">107,Ask Solem Hoel,VMware</div></pre></td></tr></table></figure>



<p>范围</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 在freebsd版sed不能用</span></div><div class="line">$/usr/local/bin/sed -n <span class="string">'1~2 p'</span> source.txt </div><div class="line"><span class="number">101</span>,Ian Bicking,Mozilla</div><div class="line"><span class="number">103</span>,Paul Irish,Google</div><div class="line"><span class="number">105</span>,Chris Wanstrath,Github</div><div class="line"><span class="number">107</span>,Ask Solem Hoel,VMware</div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># 在freebsd版sed不能用</span></div><div class="line">$/usr/local/bin/sed -n <span class="string">'2~3 p'</span> source.txt </div><div class="line"><span class="number">102</span>,Hakim El Hattab,Whim</div><div class="line"><span class="number">105</span>,Chris Wanstrath,Github</div></pre></td></tr></table></figure>

<p>模式匹配</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 寻找包含Paul的行</span></div><div class="line"><span class="variable">$sed</span> -n <span class="string">'/Paul/ p'</span> source.txt</div><div class="line"><span class="number">103</span>,Paul Irish,Google</div><div class="line"><span class="comment"># 从第一行开始到第五行, 从找到开始打印到第五行</span></div><div class="line"><span class="variable">$sed</span> -n <span class="string">'/Paul/,5 p'</span> source.txt</div><div class="line"><span class="number">103</span>,Paul Irish,Google</div><div class="line"><span class="number">104</span>,Addy Osmani,Google</div><div class="line"><span class="number">105</span>,Chris Wanstrath,Github</div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># 从匹配Paul行打印达匹配Addy的行</span></div><div class="line"><span class="variable">$sed</span> -n <span class="string">'/Paul/,/Addy/ p'</span> source.txt</div><div class="line"><span class="number">103</span>,Paul Irish,Google</div><div class="line"><span class="number">104</span>,Addy Osmani,Google</div><div class="line"><span class="comment"># 在freebsd版sed不能用 匹配Paul行再多输出2行</span></div><div class="line">$/usr/local/bin/sed -n <span class="string">'/Paul/,+2 p'</span> source.txt</div><div class="line"><span class="number">103</span>,Paul Irish,Google</div><div class="line"><span class="number">104</span>,Addy Osmani,Google</div><div class="line"><span class="number">105</span>,Chris Wanstrath,Github</div></pre></td></tr></table></figure>

<p>删除行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 删除所有行</span></div><div class="line"><span class="variable">$sed</span> <span class="string">'d'</span> source.txt </div><div class="line"><span class="comment"># 只删除第二行</span></div><div class="line"><span class="variable">$sed</span> <span class="string">'2 d'</span> source.txt </div><div class="line">...</div><div class="line"><span class="comment"># 删除第一到第四行</span></div><div class="line"><span class="variable">$sed</span> <span class="string">'1,4 d'</span> source.txt</div><div class="line"><span class="number">105</span>,Chris Wanstrath,Github</div><div class="line"><span class="number">106</span>,Mattt Thompson,Heroku</div><div class="line"><span class="number">107</span>,Ask Solem Hoel,VMware</div><div class="line"><span class="comment"># 删除奇数行</span></div><div class="line">$/usr/local/bin/sed <span class="string">'1~2 d'</span> source.txt</div><div class="line"><span class="number">102</span>,Hakim El Hattab,Whim</div><div class="line"><span class="number">104</span>,Addy Osmani,Google</div><div class="line"><span class="number">106</span>,Mattt Thompson,Heroku</div><div class="line"><span class="comment"># 删除符合Paul到Addy的行</span></div><div class="line"><span class="variable">$sed</span> <span class="string">'/Paul/,/Addy/d'</span> source.txt</div><div class="line"><span class="number">101</span>,Ian Bicking,Mozilla</div><div class="line"><span class="number">102</span>,Hakim El Hattab,Whim</div><div class="line"><span class="number">105</span>,Chris Wanstrath,Github</div><div class="line"><span class="number">106</span>,Mattt Thompson,Heroku</div><div class="line"><span class="number">107</span>,Ask Solem Hoel,VMware</div><div class="line"><span class="comment"># 删除空行</span></div><div class="line"><span class="variable">$sed</span> <span class="string">'/^$/ d'</span> source.txt</div><div class="line"><span class="comment"># 删除评论行</span></div><div class="line"><span class="variable">$sed</span> <span class="string">'/^#/ d'</span> source.txt</div></pre></td></tr></table></figure>

<p>重定向</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 将source.txt内容重定向写到output.txt</span></div><div class="line"><span class="variable">$sed</span> <span class="string">'w output.txt'</span> source.txt</div><div class="line"><span class="comment"># 和上面一样,但是没有在终端显示</span></div><div class="line"><span class="variable">$sed</span> -n <span class="string">'w output.txt'</span> source.txt</div><div class="line"><span class="comment"># 只写第二行</span></div><div class="line">$ sed -n <span class="string">'2 w output.txt'</span> source.txt</div><div class="line"><span class="comment"># 写一到四行到output.txt</span></div><div class="line"><span class="variable">$sed</span> -n <span class="string">'1,4 w output.txt'</span></div><div class="line"><span class="comment"># 写匹配Ask的行到结尾行到output.txt</span></div><div class="line"><span class="variable">$sed</span> -n <span class="string">'/Ask/,$ w output.txt'</span></div></pre></td></tr></table></figure>

<p>替换语法</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sed <span class="string">'[address-range|pattern-range] s/original-</span></div><div class="line">string/replacement-string/[substitute-flags]' inputfile</div></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#例子</span></div><div class="line"><span class="comment"># 替换Google为Github</span></div><div class="line"><span class="variable">$sed</span> <span class="string">'s/Google/Github/'</span> source.txt</div><div class="line"><span class="number">101</span>,Ian Bicking,Mozilla</div><div class="line"><span class="number">102</span>,Hakim El Hattab,Whim</div><div class="line"><span class="number">103</span>,Paul Irish,Github</div><div class="line"><span class="number">104</span>,Addy Osmani,Github</div><div class="line"><span class="number">105</span>,Chris Wanstrath,Github</div><div class="line"><span class="number">106</span>,Mattt Thompson,Heroku</div><div class="line"><span class="number">107</span>,Ask Solem Hoel,VMware</div><div class="line"><span class="comment"># 替换匹配Addy的行里面的Google为Github</span></div><div class="line"><span class="variable">$sed</span> <span class="string">'/Addy/s/Google/Github/'</span> source.txt</div><div class="line"><span class="number">101</span>,Ian Bicking,Mozilla</div><div class="line"><span class="number">102</span>,Hakim El Hattab,Whim</div><div class="line"><span class="number">103</span>,Paul Irish,Google</div><div class="line"><span class="number">104</span>,Addy Osmani,Github</div><div class="line"><span class="number">105</span>,Chris Wanstrath,Github</div><div class="line"><span class="number">106</span>,Mattt Thompson,Heroku</div><div class="line"><span class="number">107</span>,Ask Solem Hoel,VMware</div><div class="line"><span class="comment"># 默认s只会替换一行中的第一个匹配项</span></div><div class="line"><span class="variable">$sed</span> <span class="string">'1s/a/A/'</span>  source.txt|head -<span class="number">1</span></div><div class="line"><span class="number">101</span>,IAn Bicking,Mozilla</div><div class="line"><span class="comment"># g可以替换每行的全部符合</span></div><div class="line"><span class="variable">$sed</span> <span class="string">'1s/a/A/g'</span>  source.txt|head -<span class="number">1</span></div><div class="line"><span class="number">101</span>,IAn Bicking,MozillA</div><div class="line"><span class="comment"># 可以直接指定想要替换的第N个匹配项,这里是第二个</span></div><div class="line"><span class="variable">$sed</span> <span class="string">'1s/a/A/2'</span>  source.txt|head -<span class="number">1</span></div><div class="line"><span class="number">101</span>,Ian Bicking,MozillA</div><div class="line"><span class="comment"># 使用w将能够替换的行重定向写到output.txt</span></div><div class="line"><span class="variable">$sed</span> -n <span class="string">'s/Mozilla/Github/w output.txt'</span> source.txt</div><div class="line"><span class="variable">$cat</span> output.txt </div><div class="line"><span class="number">101</span>,Ian Bicking,Github</div><div class="line"><span class="comment"># 还可以使用i忽略匹配的大小写,看来freebsd的不能用</span></div><div class="line">$/usr/local/bin/sed <span class="string">'1s/ian/IAN/i'</span>  source.txt|head -<span class="number">1</span></div><div class="line"><span class="number">101</span>,IAN Bicking,Mozilla</div><div class="line"><span class="comment"># 这里有个新的文件</span></div><div class="line"><span class="variable">$cat</span> files.txt </div><div class="line">/etc/passwd</div><div class="line">/etc/group</div><div class="line"><span class="comment"># 给每行前和后都添加点字符</span></div><div class="line"><span class="variable">$sed</span> <span class="string">'s/\(.*\)/ls -l \1|head -1/'</span> files.txt</div><div class="line">ls <span class="operator">-l</span> /etc/passwd|head -<span class="number">1</span></div><div class="line">ls <span class="operator">-l</span> /etc/group|head -<span class="number">1</span></div><div class="line"><span class="comment"># 我要用sed执行这个字符串命令了 无奈..mac上得sed都不行</span></div><div class="line">dongwm@bj-<span class="number">1</span>:~$ sed <span class="string">'s/^/ls -l /e'</span> files.txt</div><div class="line">-rw-r--r-- <span class="number">1</span> root root <span class="number">1627</span> Oct <span class="number">14</span> <span class="number">14</span>:<span class="number">30</span> /etc/passwd</div><div class="line">-rw-r--r-- <span class="number">1</span> root root <span class="number">807</span> Oct <span class="number">14</span> <span class="number">14</span>:<span class="number">30</span> /etc/group</div><div class="line"><span class="comment"># sed分隔符不只可以使用'/'</span></div><div class="line"><span class="variable">$sed</span> <span class="string">'s|/usr/local/bin|/usr/bin|'</span> path.txt</div><div class="line"><span class="variable">$sed</span> <span class="string">'s^/usr/local/bin^/usr/bin^'</span> path.txt</div><div class="line"><span class="variable">$sed</span> <span class="string">'s@/usr/local/bin@/usr/bin@'</span> path.txt</div><div class="line"><span class="variable">$sed</span> <span class="string">'s!/usr/local/bin!/usr/bin!'</span> path.txt</div></pre></td></tr></table></figure>

<p>替换覆盖</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">sed <span class="string">'{</span></div><div class="line">s/Google/Github/</div><div class="line">s/Git/git/ </div><div class="line">}' source.txt </div><div class="line"><span class="number">101</span>,Ian Bicking,Mozilla</div><div class="line"><span class="number">102</span>,Hakim El Hattab,Whim</div><div class="line"><span class="number">103</span>,Paul Irish,github</div><div class="line"><span class="number">104</span>,Addy Osmani,github</div><div class="line"><span class="number">105</span>,Chris Wanstrath,github</div><div class="line"><span class="number">106</span>,Mattt Thompson,Heroku</div><div class="line"><span class="number">107</span>,Ask Solem Hoel,VMware</div></pre></td></tr></table></figure>

<p>神奇的&amp;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$sed</span> <span class="string">'s/^[0-9][0-9][0-9]/[&]/g'</span></div><div class="line">[<span class="number">101</span>],Ian Bicking,Mozilla</div><div class="line">[<span class="number">102</span>],Hakim El Hattab,Whim</div><div class="line">[<span class="number">103</span>],Paul Irish,Google</div><div class="line">[<span class="number">104</span>],Addy Osmani,Google</div><div class="line">[<span class="number">105</span>],Chris Wanstrath,Github</div><div class="line">[<span class="number">106</span>],Mattt Thompson,Heroku</div><div class="line">[<span class="number">107</span>],Ask Solem Hoel,VMware</div><div class="line"><span class="comment">#</span></div><div class="line"><span class="variable">$sed</span> <span class="string">'s/^.*/&lt;\&&gt;/'</span> source.txt </div><div class="line">&lt;<span class="number">101</span>,Ian Bicking,Mozilla&gt;</div><div class="line">&lt;<span class="number">102</span>,Hakim El Hattab,Whim&gt;</div><div class="line">&lt;<span class="number">103</span>,Paul Irish,Google&gt;</div><div class="line">&lt;<span class="number">104</span>,Addy Osmani,Google&gt;</div><div class="line">&lt;<span class="number">105</span>,Chris Wanstrath,Github&gt;</div><div class="line">&lt;<span class="number">106</span>,Mattt Thompson,Heroku&gt;</div><div class="line">&lt;<span class="number">107</span>,Ask Solem Hoel,VMware&gt;</div></pre></td></tr></table></figure>



<p>正则</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># ^表示匹配以什么开头</span></div><div class="line"><span class="variable">$sed</span> -n <span class="string">'/^101/ p'</span> source.txt      </div><div class="line"><span class="number">101</span>,Ian Bicking,Mozilla</div><div class="line"><span class="comment"># $表示匹配以什么结尾</span></div><div class="line"><span class="variable">$sed</span> -n <span class="string">'/Github$/ p'</span> source.txt </div><div class="line"><span class="number">105</span>,Chris Wanstrath,Github</div><div class="line"><span class="comment"># .表示单个字符,下面的匹配一个逗号然后I然后2个单字符</span></div><div class="line"><span class="variable">$sed</span> -n <span class="string">'/,I../ p'</span> source.txt</div><div class="line"><span class="number">101</span>,Ian Bicking,Mozilla</div><div class="line"><span class="comment"># *表示匹配0个或者多个, \+表示匹配一个或者多个, \?表示匹配0个或者1个</span></div><div class="line"><span class="comment"># [0-9]表示匹配数字,下面匹配包含3或者4的行</span></div><div class="line"><span class="variable">$sed</span> -n <span class="string">'/[34]/ p '</span> source.txt      </div><div class="line"><span class="number">103</span>,Paul Irish,Google</div><div class="line"><span class="number">104</span>,Addy Osmani,Google</div><div class="line"><span class="comment"># -表示范围,这里匹配3,4,5</span></div><div class="line"><span class="variable">$sed</span> -n <span class="string">'/[3-5]/ p '</span> source.txt</div><div class="line"><span class="number">103</span>,Paul Irish,Google</div><div class="line"><span class="number">104</span>,Addy Osmani,Google</div><div class="line"><span class="number">105</span>,Chris Wanstrath,Github</div><div class="line"><span class="comment"># |表示或者的关系</span></div><div class="line">$/usr/local/bin/sed -n <span class="string">'/102\|103/ p '</span> source.txt</div><div class="line"><span class="number">102</span>,Hakim El Hattab,Whim</div><div class="line"><span class="number">103</span>,Paul Irish,Google</div><div class="line"><span class="comment"># 看一个文件</span></div><div class="line"><span class="variable">$cat</span> numbers.txt </div><div class="line"><span class="number">1</span></div><div class="line"><span class="number">12</span></div><div class="line"><span class="number">123</span></div><div class="line"><span class="number">1234</span></div><div class="line"><span class="number">12345</span></div><div class="line"><span class="number">123456</span></div><div class="line"><span class="comment"># {m} 表示前面的匹配的重复次数</span></div><div class="line"><span class="variable">$sed</span> -n <span class="string">'/^[0-9]\{5\}$/ p'</span> numbers.txt</div><div class="line"><span class="number">12345</span></div><div class="line"><span class="comment">#{m,n } 表示匹配m-n的次数都算</span></div><div class="line">sed -n <span class="string">'/^[0-9]\{3,5\}$/ p'</span> numbers.txt</div><div class="line"><span class="number">123</span></div><div class="line"><span class="number">1234</span></div><div class="line"><span class="number">12345</span></div><div class="line"><span class="comment"># 删除所有注释行和空行</span></div><div class="line"><span class="variable">$sed</span> <span class="operator">-e</span> <span class="string">'s/#.*//'</span> <span class="operator">-e</span> <span class="string">'/^$/ d'</span> /etc/profile							</div><div class="line"><span class="comment"># 转化windows文件到unix格式</span></div><div class="line"><span class="variable">$sed</span> <span class="string">'s/.$//'</span> filename								</div><div class="line"><span class="comment">#							</span></div><div class="line"><span class="comment">#\1表示第一个正则匹配到的数据</span></div><div class="line"><span class="variable">$sed</span> <span class="string">'s/\([^,]*\).*/\1/g'</span> source.txt |head -<span class="number">1</span></div><div class="line"><span class="number">101</span></div><div class="line"><span class="comment">#给每个单词第一个字母加括号</span></div><div class="line"><span class="variable">$echo</span> <span class="string">"Dong Wei Ming"</span> | /usr/local/bin/sed <span class="string">'s/\(\b[A-Z]\)/\(\1\)/g'</span></div><div class="line">(D)ong (W)ei (M)ing</div><div class="line">$/usr/local/bin/sed <span class="string">'s/\(^\|[^0-9.]\)\([0-9]\+\)\([0-9]\{3\}\)/\1\2,\3/g'</span> numbers.txt</div><div class="line"><span class="number">1</span></div><div class="line"><span class="number">12</span></div><div class="line"><span class="number">123</span></div><div class="line"><span class="number">1</span>,<span class="number">234</span></div><div class="line"><span class="number">12</span>,<span class="number">345</span></div><div class="line"><span class="number">123</span>,<span class="number">456</span></div><div class="line"><span class="comment"># 只取第一和第三列,并且换了他们的位置</span></div><div class="line"><span class="variable">$sed</span> <span class="string">'s/\([^,]*\),\([^,]*\),\([^,]*\).*/\3,\1/g'</span> source.txt</div><div class="line">Mozilla,<span class="number">101</span></div><div class="line">Whim,<span class="number">102</span></div><div class="line">Google,<span class="number">103</span></div><div class="line">Google,<span class="number">104</span></div><div class="line">Github,<span class="number">105</span></div><div class="line">Heroku,<span class="number">106</span></div><div class="line">VMware,<span class="number">107</span></div></pre></td></tr></table></figure>

<h3 id="GNU_SED">GNU SED</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># \l能将后面的一个字符变成小写</span></div><div class="line"><span class="variable">$sed</span> <span class="string">'s/Ian/IAN/'</span> source.txt|head -<span class="number">1</span>               </div><div class="line"><span class="number">101</span>,IAN Bicking,Mozilla</div><div class="line">$/usr/local/bin/sed <span class="string">'s/Ian/IA\lN/'</span> source.txt|head -<span class="number">1</span> </div><div class="line"><span class="number">101</span>,IAn Bicking,Mozilla</div><div class="line"><span class="comment"># \L能将后面的字符都变成小写</span></div><div class="line">$/usr/local/bin/sed <span class="string">'s/Ian/I\LAN/'</span> source.txt|head -<span class="number">1</span></div><div class="line"><span class="number">101</span>,Ian Bicking,Mozilla</div><div class="line"><span class="comment"># \u能将后面的一个字符变成大写</span></div><div class="line">$/usr/local/bin/sed <span class="string">'s/Ian/IA\un/'</span> source.txt|head -<span class="number">1</span></div><div class="line"><span class="number">101</span>,IAN Bicking,Mozilla</div><div class="line"><span class="comment"># \U能将后面的字都变成大写</span></div><div class="line">$/usr/local/bin/sed <span class="string">'s/Ian/\Uian/'</span> source.txt|head -<span class="number">1</span> </div><div class="line"><span class="number">101</span>,IAN Bicking,Mozilla</div><div class="line"><span class="comment"># \E能打断\L或者\U改变大小写</span></div><div class="line">$/usr/local/bin/sed <span class="string">'s/Ian/\Uia\En/'</span> source.txt|head -<span class="number">1</span></div><div class="line"><span class="number">101</span>,IAn Bicking,Mozilla</div><div class="line"><span class="comment"># 使用以上功能:调换前2列,把名字列全部大写,公司列全部小写</span></div><div class="line">$/usr/local/bin/sed <span class="string">'s/\([^,]*\),\([^,]*\),\(.*\).*/\U\2\E,\1,\L\3/g'</span> source.txt</div><div class="line">IAN BICKING,<span class="number">101</span>,mozilla</div><div class="line">HAKIM EL HATTAB,<span class="number">102</span>,whim</div><div class="line">PAUL IRISH,<span class="number">103</span>,google</div><div class="line">ADDY OSMANI,<span class="number">104</span>,google</div><div class="line">CHRIS WANSTRATH,<span class="number">105</span>,github</div><div class="line">MATTT THOMPSON,<span class="number">106</span>,heroku</div><div class="line">ASK SOLEM HOEL,<span class="number">107</span>,vmware</div></pre></td></tr></table></figure>

<h3 id="sed使用示例">sed使用示例</h3>
<p>SED可执行脚本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$cat</span> testscript.sed</div><div class="line"><span class="comment">#!/usr/bin/sed -nf</span></div><div class="line">/root/ p</div><div class="line">/nobody/ p</div><div class="line"><span class="variable">$chmod</span> u+x testscript.sed</div><div class="line">$./testscript.sed /etc/passwd </div><div class="line">nobody:*:-<span class="number">2</span>:-<span class="number">2</span>:Unprivileged User:/var/empty:/usr/bin/<span class="literal">false</span></div><div class="line">root:*:<span class="number">0</span>:<span class="number">0</span>:System Administrator:/var/root:/bin/sh</div><div class="line">daemon:*:<span class="number">1</span>:<span class="number">1</span>:System Services:/var/root:/usr/bin/<span class="literal">false</span></div><div class="line">_cvmsroot:*:<span class="number">212</span>:<span class="number">212</span>:CVMS Root:/var/empty:/usr/bin/<span class="literal">false</span></div></pre></td></tr></table></figure>



<p>SED修改源文件和备份</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#-i会修改源文件,但是可以同时使用bak备份</span></div><div class="line"><span class="variable">$sed</span> -ibak <span class="string">'s/Ian/IAN/'</span> source.txt </div><div class="line"><span class="comment"># or</span></div><div class="line">sed --in-place=bak <span class="string">'s/Ian/IAN/'</span> source.txt </div><div class="line"><span class="comment"># 这样会存在一个文件source.txtbak</span></div></pre></td></tr></table></figure>

<p>行后增加语法</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sed <span class="string">'[address] a the-line-to-append'</span> input-file</div></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#例子</span></div><div class="line">$/usr/local/bin/sed <span class="string">'2 a 108,Donald Stufft, Nebula'</span> source.txt</div><div class="line"><span class="number">101</span>,IAN Bicking,Mozilla</div><div class="line"><span class="number">102</span>,Hakim El Hattab,Whim</div><div class="line"><span class="number">108</span>,Donald Stufft, Nebula</div><div class="line"><span class="number">103</span>,Paul Irish,Google</div><div class="line"><span class="number">104</span>,Addy Osmani,Google</div><div class="line"><span class="number">105</span>,Chris Wanstrath,Github</div><div class="line"><span class="number">106</span>,Mattt Thompson,Heroku</div><div class="line"><span class="number">107</span>,Ask Solem Hoel,VMware</div></pre></td></tr></table></figure>

<p>行前插入语法</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sed <span class="string">'[address] i the-line-to-insert'</span> input-file</div></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#例子</span></div><div class="line">$/usr/local/bin/sed <span class="string">'2 i 108,Donald Stufft, Nebula'</span> source.txt</div><div class="line"><span class="number">101</span>,IAN Bicking,Mozilla</div><div class="line"><span class="number">108</span>,Donald Stufft, Nebula</div><div class="line"><span class="number">102</span>,Hakim El Hattab,Whim</div><div class="line"><span class="number">103</span>,Paul Irish,Google</div><div class="line"><span class="number">104</span>,Addy Osmani,Google</div><div class="line"><span class="number">105</span>,Chris Wanstrath,Github</div><div class="line"><span class="number">106</span>,Mattt Thompson,Heroku</div><div class="line"><span class="number">107</span>,Ask Solem Hoel,VMware</div></pre></td></tr></table></figure>


<p>修改行语法</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sed <span class="string">'[address] c the-line-to-insert'</span> input-file</div></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#例子</span></div><div class="line"><span class="comment"># 修改符合Paul行为...</span></div><div class="line">$/usr/local/bin/sed <span class="string">'/Paul/ c 108,Donald Stufft, Nebula'</span> source.txt</div><div class="line"><span class="number">101</span>,IAN Bicking,Mozilla</div><div class="line"><span class="number">102</span>,Hakim El Hattab,Whim</div><div class="line"><span class="number">108</span>,Donald Stufft, Nebula</div><div class="line"><span class="number">104</span>,Addy Osmani,Google</div><div class="line"><span class="number">105</span>,Chris Wanstrath,Github</div><div class="line"><span class="number">106</span>,Mattt Thompson,Heroku</div><div class="line"><span class="number">107</span>,Ask Solem Hoel,VMware</div></pre></td></tr></table></figure>

<p>SED其他</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -l会显示隐藏字符比如'\t', = 可以显示行号</span></div><div class="line"><span class="variable">$sed</span> <span class="operator">-l</span> = source.txt</div><div class="line"><span class="comment"># y或翻译你要转换的字符,这里I会转化成i，B转换成b</span></div><div class="line"><span class="variable">$sed</span> <span class="string">'y/IB/ib/'</span> source.txt |head -<span class="number">1</span></div><div class="line"><span class="number">101</span>,iAN bicking,Mozilla</div></pre></td></tr></table></figure>

<h3 id="sed练习">sed练习</h3>
<ul>
<li>1.把123变成[123](不要sed “s/([0-9]{3})/[\1]/“)</li>
<li>2.这是什么意思: echo “1\n2\n3\n4”|sed -n “/2/, +2p”(gnu sed)</li>
<li>3.这是什么意思: echo “1\n2\n3”|sed ‘2 c 4’ (gnu sed)</li>
<li>4.把This is UPPER变成IS,This,upper(gnu sed)</li>
<li>5.这是什么意思: sed ‘H;x;s/^(.<em>)\n(.</em>)/\2\1/‘</li>
<li>6.实现tac命令的功能</li>
</ul>
<h2 id="SED高级话题(保持空间和模式空间)">SED高级话题(保持空间和模式空间)</h2>
<p>源码</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#先看一个文件</span></div><div class="line"><span class="variable">$cat</span> <span class="built_in">source</span>2.txt </div><div class="line">Ian Bicking</div><div class="line">Mozilla</div><div class="line">Hakim El Hattab</div><div class="line">Whim</div><div class="line">Paul Irish</div><div class="line">Google</div><div class="line">Chris Wanstrath</div><div class="line">Github</div><div class="line">Mattt Thompson</div><div class="line">Heroku</div></pre></td></tr></table></figure>


<p>交换模式空间</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 通过公司找到这个人, x命令交换当前行到保持空间,</span></div><div class="line"><span class="comment"># n读取下一行到模式空间; 匹配这个模式空间, 假如符合,再交换模式空间，打印</span></div><div class="line">$/usr/local/bin/sed  -n <span class="operator">-e</span> <span class="string">'x;n'</span> <span class="operator">-e</span> <span class="string">'/Whim/{x;p}'</span> <span class="built_in">source</span>2.txt  </div><div class="line">Hakim El Hattab</div></pre></td></tr></table></figure>

<p>拷贝模式空间到保持空间</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 还是前面的需求.h拷贝模式空间到保持空间, </span></div><div class="line"><span class="comment"># 如果当前模式空间不匹配, 就拷贝空间到保持空间. 他们会一样</span></div><div class="line"><span class="comment"># 但是当Whim匹配保持空间还是上面一行关于名字的缓存</span></div><div class="line">$/usr/local/bin/sed  -n <span class="operator">-e</span> <span class="string">'/Whim/!h'</span> <span class="operator">-e</span> <span class="string">'/Whim/{x;p}'</span> <span class="built_in">source</span>2.txt  </div><div class="line">Hakim El Hattab</div></pre></td></tr></table></figure>



<p>增加模式空间到保持空间</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 当我根据Whim想显示他的名字和公司名字呢？ - 给保持空间多加一个</span></div><div class="line"><span class="comment"># H表示增加模式空间到保持空间</span></div><div class="line">$/usr/local/bin/sed -n <span class="operator">-e</span> <span class="string">'/Whim/!h'</span> <span class="operator">-e</span> <span class="string">'/Whim/{H;x;p}'</span> <span class="built_in">source</span>2.txt </div><div class="line">Hakim El Hattab</div><div class="line">Whim</div><div class="line"><span class="comment"># 显示的好看一点</span></div><div class="line">$/usr/local/bin/sed -n <span class="operator">-e</span> <span class="string">'/Whim/!h'</span> <span class="operator">-e</span> <span class="string">'/Whim/{H;x;s/\n/:/;p}'</span> <span class="built_in">source</span>2.txt </div><div class="line">Hakim El Hattab:Whim</div></pre></td></tr></table></figure>

<p>拷贝保持空间到模式空间</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 还是前面的需求.g拷贝保持空间到模式空间</span></div><div class="line">$/usr/local/bin/sed  -n <span class="operator">-e</span> <span class="string">'/Whim/!h'</span> <span class="operator">-e</span> <span class="string">'/Whim/{g;p}'</span> <span class="built_in">source</span>2.txt   </div><div class="line">Hakim El Hattab</div></pre></td></tr></table></figure>

<p>增加保持空间到模式空间</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 前面的前面, 输出是Hakim El Hattab:Whim 怎么样翻转呢？</span></div><div class="line"><span class="comment"># G就是反向的</span></div><div class="line">$/usr/local/bin/sed -n <span class="operator">-e</span> <span class="string">'/Whim/!h'</span> <span class="operator">-e</span> <span class="string">'/Whim/{G;s/\n/:/;p}'</span> <span class="built_in">source</span>2.txt  </div><div class="line">Whim:Hakim El Hattab</div></pre></td></tr></table></figure>

<p>增加下一行到模式空间</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$/</span>usr/local/bin/sed -e <span class="string">'{N;s/\n/:/}'</span> source2.txt</div><div class="line"><span class="constant">Ian</span> <span class="constant">Bicking</span><span class="symbol">:Mozilla</span></div><div class="line"><span class="constant">Hakim</span> <span class="constant">El</span> <span class="constant">Hattab</span><span class="symbol">:Whim</span></div><div class="line"><span class="constant">Paul</span> <span class="constant">Irish</span><span class="symbol">:Google</span></div><div class="line"><span class="constant">Chris</span> <span class="constant">Wanstrath</span><span class="symbol">:Github</span></div><div class="line"><span class="constant">Mattt</span> <span class="constant">Thompson</span><span class="symbol">:Heroku</span></div></pre></td></tr></table></figure>

<p>LABEL</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 给匹配Github的行,在使用名字:公司的前面加一个*, </span></div><div class="line"><span class="comment">#只有匹配Github的模式空间和保持空间才会执行s/^/*/</span></div><div class="line"><span class="variable">$cat</span> label.sed </div><div class="line"><span class="comment">#!/usr/local/bin/sed -nf</span></div><div class="line">h;n;H;x</div><div class="line">s/\n/:/</div><div class="line">/Github/!b end</div><div class="line">s/^/*/</div><div class="line">:end p</div><div class="line"><span class="variable">$chmod</span> u+x label.sed</div><div class="line">./label.sed <span class="built_in">source</span>2.txt</div><div class="line">Ian Bicking:Mozilla</div><div class="line">Hakim El Hattab:Whim</div><div class="line">Paul Irish:Google</div><div class="line">*Chris Wanstrath:Github</div><div class="line">Mattt Thompson:Heroku</div></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#例子</span></div><div class="line"><span class="comment"># 把mac地址的冒号替换掉</span></div><div class="line"><span class="string">"130531170341903612"</span>,<span class="string">"259594"</span>,<span class="number">2013</span>-<span class="number">05</span>-<span class="number">31</span>T09:<span class="number">04</span>:<span class="number">25</span>Z,<span class="string">"1c:b0:94:b2:85:bd"</span></div><div class="line"><span class="comment">#						</span></div><div class="line"><span class="number">1</span>. sed <span class="string">"s/\([0-9a-zA-Z]\{2\}\):\([0-9a-zA-Z]\{2\}\):\([0-9a-zA-Z]\{2\}\):\([0-9a-zA-Z]\{2\}\):\([0-9a-zA-Z]\{2\}\):\([0-9a-zA-Z]\{2\}\)/\1\2\3\4\5\6/"</span></div><div class="line"><span class="number">2</span>. sed <span class="string">"s/\(.*\):\(.*\):\(.*\):\(.*\):\(.*\):\(.*\)/\1\2\3\4\5\6/"</span></div><div class="line"><span class="number">3</span>. sed <span class="operator">-e</span> <span class="string">"s/T\(.*\):\(.*\):\(.*\)Z/\1#\2#\3/"</span> <span class="operator">-e</span> <span class="string">"s/://g"</span> <span class="operator">-e</span> <span class="string">"s/#/:/g"</span></div></pre></td></tr></table></figure>

<h2 id="AWK">AWK</h2>
<h3 id="AWK基本语法">AWK基本语法</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#语法1</span></div><div class="line">awk -Fs <span class="string">'/pattern/ {action}'</span> input-file</div><div class="line"><span class="comment">#or</span></div><div class="line">awk -Fs <span class="string">'{action}'</span> intput-file</div><div class="line"><span class="comment"># -F表示设置分隔符,不指定就是默认为空字符</span></div></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#例子</span></div><div class="line"><span class="comment"># 用:分割，查找匹配mail的行并且打印冒号分割后的第一部分</span></div><div class="line">awk -F: <span class="string">'/mail/ {print $1}'</span> /etc/passwd</div><div class="line">_mailman</div><div class="line">_clamav</div><div class="line">_amavisd</div></pre></td></tr></table></figure>

<h3 id="AWK数据结构">AWK数据结构</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 1 BEGIN { awk-commands } 在执行awk body之前执行这个awk-commands,而且只一次</span></div><div class="line"><span class="comment"># 2 /pattern/ {action} body部分，也就是awk要执行的主体,比如十行,那么这个主体就调用10次</span></div><div class="line"><span class="comment"># 3 END { awk-commands } 在执行完body之后执行,也是只一次</span></div><div class="line"><span class="variable">$awk</span> <span class="string">'BEGIN { FS=":";print "---header---" } /mail/ {print $1} \</span></div><div class="line">END { print "---footer---"}' /etc/passwd</div><div class="line">---header---</div><div class="line">_mailman</div><div class="line">_clamav</div><div class="line">_amavisd</div><div class="line">---footer---</div><div class="line"><span class="comment"># 当然可以只有其中一种或者集中数据结构</span></div><div class="line">awk -F: <span class="string">'BEGIN { print "UID"} { print $3 }'</span> /etc/passwd |\</div><div class="line">sed <span class="operator">-e</span> <span class="string">'/^$/ d'</span>|head -<span class="number">2</span></div><div class="line">UID</div><div class="line">-<span class="number">2</span></div><div class="line">$ awk <span class="string">'BEGIN { print "Hello World!" }'</span></div><div class="line">Hello World!</div></pre></td></tr></table></figure>



<p>源码2</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 这是一个文件,分别是id, 描述, 价钱和库存</span></div><div class="line"><span class="variable">$cat</span> items.txt </div><div class="line"><span class="number">101</span>,HD Camcorder,Video,<span class="number">210</span>,<span class="number">10</span></div><div class="line"><span class="number">102</span>,Refrigerator,Appliance,<span class="number">850</span>,<span class="number">2</span></div><div class="line"><span class="number">103</span>,MP3 Player,Audio,<span class="number">270</span>,<span class="number">15</span></div><div class="line"><span class="number">104</span>,Tennis Racket,Sports,<span class="number">190</span>,<span class="number">20</span></div><div class="line"><span class="number">105</span>,Laser Printer,Office,<span class="number">475</span>,<span class="number">5</span></div></pre></td></tr></table></figure>

<p>源码3</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 这是一个销售数据,分别是id和1-6月的销售情况</span></div><div class="line"><span class="variable">$cat</span> items-sold.txt</div><div class="line"><span class="number">101</span> <span class="number">2</span> <span class="number">10</span> <span class="number">5</span> <span class="number">8</span> <span class="number">10</span> <span class="number">12</span></div><div class="line"><span class="number">102</span> <span class="number">0</span> <span class="number">1</span> <span class="number">4</span> <span class="number">3</span> <span class="number">0</span> <span class="number">2</span></div><div class="line"><span class="number">103</span> <span class="number">10</span> <span class="number">6</span> <span class="number">11</span> <span class="number">20</span> <span class="number">5</span> <span class="number">13</span></div><div class="line"><span class="number">104</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">0</span> <span class="number">6</span> <span class="number">5</span></div><div class="line"><span class="number">105</span> <span class="number">10</span> <span class="number">2</span> <span class="number">5</span> <span class="number">7</span> <span class="number">12</span> <span class="number">6</span></div></pre></td></tr></table></figure>

<p>PRINT</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 默认print就是打印文件全文到终端</span></div><div class="line"><span class="variable">$awk</span> <span class="string">'{print}'</span> source.txt</div><div class="line"><span class="comment"># 下面是通过,分割,输出第二段。$0表示全行,类似shell用法</span></div><div class="line"><span class="variable">$awk</span> -F <span class="string">','</span> <span class="string">'{print $2}'</span> source.txt</div><div class="line">Ian Bicking</div><div class="line">Hakim El Hattab</div><div class="line">Paul Irish</div><div class="line">Addy Osmani</div><div class="line">Chris Wanstrath</div><div class="line">Mattt Thompson</div><div class="line">Ask Solem Hoel</div><div class="line"><span class="comment"># or</span></div><div class="line"><span class="variable">$awk</span> -F <span class="string">","</span> <span class="string">'{print $2}'</span> source.txt</div><div class="line"><span class="variable">$awk</span> -F, <span class="string">'{print $2}'</span> source.txt</div><div class="line"><span class="comment"># 一个格式化更好看些的效果</span></div><div class="line">awk -F <span class="string">','</span> <span class="string">'BEGIN \                         </span></div><div class="line">{ print "-------------\nName\tComp\n-------------"} \</div><div class="line">{ print $2,"\t",$3;} \  </div><div class="line">END { print "-------------"; }' source.txt </div><div class="line">-------------</div><div class="line">Name	Comp</div><div class="line">-------------</div><div class="line">Ian Bicking 	 Mozilla</div><div class="line">Hakim El Hattab 	 Whim</div><div class="line">Paul Irish 	 Google</div><div class="line">Addy Osmani 	 Google</div><div class="line">Chris Wanstrath 	 Github</div><div class="line">Mattt Thompson 	 Heroku</div><div class="line">Ask Solem Hoel 	 VMware</div><div class="line">-------------</div></pre></td></tr></table></figure>

<p>模式匹配</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 用逗号做分隔符, 打印第二和第三列</span></div><div class="line"><span class="variable">$awk</span> -F <span class="string">','</span> <span class="string">'/Whim/ {print $2, $3}'</span> source.txt</div><div class="line">Hakim El Hattab Whim</div><div class="line"><span class="comment"># 可以加点格式化语句</span></div><div class="line"><span class="variable">$awk</span> -F <span class="string">','</span> <span class="string">'/Whim/ {print "Whim\"s name:", $2}'</span> source.txt</div><div class="line">Whim<span class="string">"s name: Hakim El Hattab</span></div></pre></td></tr></table></figure>



<p>AWK内置变量 - FS</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$awk</span> -F <span class="string">','</span> <span class="string">'{print $2, $3}'</span> source.txt  </div><div class="line">Ian Bicking Mozilla</div><div class="line">Hakim El Hattab Whim</div><div class="line">Paul Irish Google</div><div class="line">Addy Osmani Google</div><div class="line">Chris Wanstrath Github</div><div class="line">Mattt Thompson Heroku</div><div class="line">Ask Solem Hoel VMware</div><div class="line"><span class="comment"># 可以使用内置的FS - 输入字段分隔符 实现相同的功能</span></div><div class="line"><span class="variable">$awk</span> <span class="string">'BEGIN {FS=","} {print $2, $3}'</span> source.txt</div><div class="line"><span class="comment"># 先看一个文件</span></div><div class="line"><span class="variable">$cat</span> <span class="built_in">source</span>-multiple-fs.txt </div><div class="line"><span class="number">101</span>,Ian Bicking:Mozilla%</div><div class="line"><span class="number">102</span>,Hakim El Hattab:Whim%</div><div class="line"><span class="number">103</span>,Paul Irish:Google%</div><div class="line"><span class="number">104</span>,Addy Osmani:Google%</div><div class="line"><span class="number">105</span>,Chris Wanstrath:Github%</div><div class="line"><span class="number">106</span>,Mattt Thompson:Heroku%</div><div class="line"><span class="number">107</span>,Ask Solem Hoel:VMware%</div><div class="line"><span class="comment"># 发现上面的分隔符有三种:逗号分号和百分号,这样就可以这样使用</span></div><div class="line"><span class="comment"># awk 'BEGIN {FS="[,:%]"} {print $2, $3}' source-multiple-fs.txt</span></div></pre></td></tr></table></figure>

<p>AWK内置变量 - OFS</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$awk</span> -F <span class="string">','</span> <span class="string">'{print $2, ":", $3}'</span> source.txt </div><div class="line">Ian Bicking : Mozilla</div><div class="line">Hakim El Hattab : Whim</div><div class="line">Paul Irish : Google</div><div class="line">Addy Osmani : Google</div><div class="line">Chris Wanstrath : Github</div><div class="line">Mattt Thompson : Heroku</div><div class="line">Ask Solem Hoel : VMware</div><div class="line"><span class="comment"># 其实可以用内置的OFS - 输出字段分隔符</span></div><div class="line"><span class="variable">$awk</span> -F <span class="string">','</span> <span class="string">'BEGIN { OFS=":" } { print $2, $3 }'</span> source.txt</div></pre></td></tr></table></figure>

<p>AWK内置变量 - RS</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$cat</span> <span class="built_in">source</span>-one-line.txt </div><div class="line"><span class="number">1</span>,one:<span class="number">2</span>,two:<span class="number">3</span>,three:<span class="number">4</span>,four</div><div class="line"><span class="comment"># 现在我想分割成(1，one),(2, two)这样的效果</span></div><div class="line"><span class="variable">$awk</span> -F, <span class="string">'{print $2}'</span> <span class="built_in">source</span>-one-line.txt </div><div class="line">one:<span class="number">2</span></div><div class="line"><span class="comment"># 这个没有实现我想要的效果</span></div><div class="line"><span class="comment"># 使用RS - 记录分隔符, 他能帮你把单行内容先分割然后再按-F分割</span></div><div class="line"><span class="variable">$awk</span> -F, <span class="string">'BEGIN { RS=":" } { print $2 }'</span> <span class="built_in">source</span>-one-line.txt</div><div class="line">one</div><div class="line">two</div><div class="line">three</div><div class="line">four</div></pre></td></tr></table></figure>

<p>AWK内置变量 - ORS</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># RS是输入, ORS就是输出</span></div><div class="line"><span class="variable">$awk</span> <span class="string">'BEGIN { FS=","; OFS="\n";ORS="\n---\n" } \</span></div><div class="line">{print $1,$2,$3}' source.txt|head -<span class="number">8</span></div><div class="line"><span class="number">101</span></div><div class="line">Ian Bicking</div><div class="line">Mozilla</div><div class="line">---</div><div class="line"><span class="number">102</span></div><div class="line">Hakim El Hattab</div><div class="line">Whim</div><div class="line">---</div></pre></td></tr></table></figure>



<p>AWK内置变量 - NR</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># NR是记录的数目</span></div><div class="line"><span class="variable">$awk</span> <span class="string">'BEGIN {FS=","} \</span></div><div class="line">{print "Emp Id of record number",NR,"is",$1;} \</div><div class="line">END {print "Total number of records:",NR}' source.txt</div><div class="line">Emp Id of record number <span class="number">1</span> is <span class="number">101</span></div><div class="line">Emp Id of record number <span class="number">2</span> is <span class="number">102</span></div><div class="line">Emp Id of record number <span class="number">3</span> is <span class="number">103</span></div><div class="line">Emp Id of record number <span class="number">4</span> is <span class="number">104</span></div><div class="line">Emp Id of record number <span class="number">5</span> is <span class="number">105</span></div><div class="line">Emp Id of record number <span class="number">6</span> is <span class="number">106</span></div><div class="line">Emp Id of record number <span class="number">7</span> is <span class="number">107</span></div><div class="line">Total number of records: <span class="number">7</span></div></pre></td></tr></table></figure>



<p>AWK内置变量 - FILENAME,FNR</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># FILENAME显示了当前文件, FNR关联到当前文件的记录数</span></div><div class="line">awk <span class="string">'BEGIN {FS=","} \</span></div><div class="line">{print FILENAME ": record number",FNR,"is",$1;} \</div><div class="line">END {print "Total number of records:",NR}' \</div><div class="line">source.txt <span class="built_in">source</span>-multiple-fs.txt</div><div class="line">source.txt: record number <span class="number">1</span> is <span class="number">101</span></div><div class="line">source.txt: record number <span class="number">2</span> is <span class="number">102</span></div><div class="line">source.txt: record number <span class="number">3</span> is <span class="number">103</span></div><div class="line">source.txt: record number <span class="number">4</span> is <span class="number">104</span></div><div class="line">source.txt: record number <span class="number">5</span> is <span class="number">105</span></div><div class="line">source.txt: record number <span class="number">6</span> is <span class="number">106</span></div><div class="line">source.txt: record number <span class="number">7</span> is <span class="number">107</span></div><div class="line"><span class="built_in">source</span>-multiple-fs.txt: record number <span class="number">1</span> is <span class="number">101</span></div><div class="line"><span class="built_in">source</span>-multiple-fs.txt: record number <span class="number">2</span> is <span class="number">102</span></div><div class="line"><span class="built_in">source</span>-multiple-fs.txt: record number <span class="number">3</span> is <span class="number">103</span></div><div class="line"><span class="built_in">source</span>-multiple-fs.txt: record number <span class="number">4</span> is <span class="number">104</span></div><div class="line"><span class="built_in">source</span>-multiple-fs.txt: record number <span class="number">5</span> is <span class="number">105</span></div><div class="line"><span class="built_in">source</span>-multiple-fs.txt: record number <span class="number">6</span> is <span class="number">106</span></div><div class="line"><span class="built_in">source</span>-multiple-fs.txt: record number <span class="number">7</span> is <span class="number">107</span></div><div class="line">Total number of records: <span class="number">14</span></div></pre></td></tr></table></figure>


<p>AWK变量</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 变量支持数字,字符和下划线</span></div><div class="line"><span class="comment"># 这个文件多加了一列star数, 现在我想统计整个文件的star</span></div><div class="line"><span class="variable">$cat</span> <span class="built_in">source</span>-star.txt</div><div class="line"><span class="number">101</span>,Ian Bicking,Mozilla,<span class="number">1204</span></div><div class="line"><span class="number">102</span>,Hakim El Hattab,Whim,<span class="number">4029</span></div><div class="line"><span class="number">103</span>,Paul Irish,Google,<span class="number">7200</span></div><div class="line"><span class="number">104</span>,Addy Osmani,Google,<span class="number">2201</span></div><div class="line"><span class="number">105</span>,Chris Wanstrath,Github,<span class="number">1002</span></div><div class="line"><span class="number">106</span>,Mattt Thompson,Heroku,<span class="number">890</span></div><div class="line"><span class="number">107</span>,Ask Solem Hoel,VMware,<span class="number">2109</span></div><div class="line"><span class="comment"># 使用awk的变量,在begin的时候声明total,在body体里面</span></div><div class="line"><span class="comment"># 累加total值，在end里面打印</span></div><div class="line"><span class="variable">$cat</span> total-star.awk </div><div class="line">BEGIN {</div><div class="line">    FS=<span class="string">","</span>;</div><div class="line">    total=<span class="number">0</span>; }</div><div class="line">{</div><div class="line"> print <span class="variable">$2</span> <span class="string">"'s star is: "</span> <span class="variable">$4</span>;</div><div class="line"> total=total+<span class="variable">$4</span></div><div class="line">} END {</div><div class="line">    print <span class="string">"---\nTotal star = *"</span>total;</div><div class="line">}</div><div class="line">awk <span class="operator">-f</span> total-star.awk <span class="built_in">source</span>-star.txt</div><div class="line">Ian Bicking<span class="string">'s star is: 1204</span></div><div class="line">Hakim El Hattab's star is: <span class="number">4029</span></div><div class="line">Paul Irish<span class="string">'s star is: 7200</span></div><div class="line">Addy Osmani's star is: <span class="number">2201</span></div><div class="line">Chris Wanstrath<span class="string">'s star is: 1002</span></div><div class="line">Mattt Thompson's star is: <span class="number">890</span></div><div class="line">Ask Solem Hoel<span class="string">'s star is: 2109</span></div><div class="line">---</div><div class="line">Total star = *18635</div></pre></td></tr></table></figure>



<p>自增长/减少</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 可以使用++或者--,但是注意前后</span></div><div class="line"><span class="variable">$awk</span> -F, <span class="string">'{print --$4}'</span> <span class="built_in">source</span>-star.txt</div><div class="line"><span class="number">1203</span></div><div class="line"><span class="number">4028</span></div><div class="line"><span class="number">7199</span></div><div class="line"><span class="number">2200</span></div><div class="line"><span class="number">1001</span></div><div class="line"><span class="number">889</span></div><div class="line"><span class="number">2108</span></div><div class="line"><span class="variable">$awk</span> -F, <span class="string">'{print $4--}'</span> <span class="built_in">source</span>-star.txt </div><div class="line"><span class="comment"># 咦 竟然没有变</span></div><div class="line"><span class="number">1204</span></div><div class="line"><span class="number">4029</span></div><div class="line"><span class="number">7200</span></div><div class="line"><span class="number">2201</span></div><div class="line"><span class="number">1002</span></div><div class="line"><span class="number">890</span></div><div class="line"><span class="number">2109</span></div><div class="line"><span class="comment"># 想达到--$4的目的就得这样</span></div><div class="line"><span class="variable">$awk</span> -F <span class="string">','</span> <span class="string">'{$4--; print $4}'</span> <span class="built_in">source</span>-star.txt</div><div class="line"><span class="number">1203</span></div><div class="line"><span class="number">4028</span></div><div class="line"><span class="number">7199</span></div><div class="line"><span class="number">2200</span></div><div class="line"><span class="number">1001</span></div><div class="line"><span class="number">889</span></div><div class="line"><span class="number">2108</span></div></pre></td></tr></table></figure>



<p>字符串操作</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$cat</span> string.awk</div><div class="line">BEGIN {</div><div class="line">    FS=<span class="string">","</span>;</div><div class="line">    OFS=<span class="string">","</span>;</div><div class="line">    string1=<span class="string">"GO"</span>;</div><div class="line">    string2=<span class="string">"OGLE"</span>;</div><div class="line">    numberstring=<span class="string">"100"</span>;</div><div class="line">    string3=string1 string2;</div><div class="line">    print <span class="string">"Concatenate string is:"</span> string3;</div><div class="line">    numberstring=numberstring+<span class="number">1</span>;</div><div class="line">    print <span class="string">"String to number:"</span> numberstring;</div><div class="line">}</div><div class="line"><span class="comment"># 字符串会直接相连, 字符串相加会自动转化成数字相加</span></div><div class="line"><span class="variable">$awk</span> <span class="operator">-f</span> string.awk </div><div class="line">Concatenate string is:GOOGLE</div><div class="line">String to number:<span class="number">101</span></div></pre></td></tr></table></figure>



<p>复合运算</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$cat</span> assignment.awk</div><div class="line">BEGIN {</div><div class="line"> FS=<span class="string">","</span>;</div><div class="line"> OFS=<span class="string">","</span>;</div><div class="line"> total1 = total2 = total3 = total4 = total5 = <span class="number">10</span>;</div><div class="line"> total1 += <span class="number">5</span>; print total1;</div><div class="line"> total2 -= <span class="number">5</span>; print total2;</div><div class="line"> total3 *= <span class="number">5</span>; print total3;</div><div class="line"> total4 /= <span class="number">5</span>; print total4;</div><div class="line"> total5 %= <span class="number">5</span>; print total5;</div><div class="line">}</div><div class="line"><span class="variable">$awk</span> <span class="operator">-f</span> assignment.awk</div><div class="line"><span class="number">15</span></div><div class="line"><span class="number">5</span></div><div class="line"><span class="number">50</span></div><div class="line"><span class="number">2</span></div><div class="line"><span class="number">0</span></div></pre></td></tr></table></figure>



<p>比较操作</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 只会显示小于1005的行</span></div><div class="line"><span class="variable">$awk</span> -F <span class="string">","</span> <span class="string">'$4 &lt;= 1005'</span> <span class="built_in">source</span>-star.txt</div><div class="line"><span class="number">105</span>,Chris Wanstrath,Github,<span class="number">1002</span></div><div class="line"><span class="number">106</span>,Mattt Thompson,Heroku,<span class="number">890</span></div><div class="line"><span class="variable">$awk</span> -F <span class="string">","</span> <span class="string">'$1 == 103 {print $2}'</span> <span class="built_in">source</span>-star.txt </div><div class="line">Paul Irish</div><div class="line"><span class="comment"># 你也可以加多个条件 这里||表示或者  && 表示和</span></div><div class="line"><span class="variable">$awk</span> -F <span class="string">","</span> <span class="string">'$4 &gt; 3000 || $4 &lt;= 880 {print $2}'</span> <span class="built_in">source</span>-star.txt</div><div class="line">Hakim El Hattab</div><div class="line">Paul Irish</div></pre></td></tr></table></figure>



<p>正则</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># ~ 表示匹配, ！~ 表示不匹配</span></div><div class="line"><span class="variable">$awk</span> -F <span class="string">","</span> <span class="string">'$3 ~ "Github"'</span> source.txt</div><div class="line"><span class="number">105</span>,Chris Wanstrath,Github</div><div class="line"><span class="variable">$awk</span> -F <span class="string">","</span> <span class="string">'$3 !~ "Google"'</span> source.txt</div><div class="line"><span class="number">101</span>,Ian Bicking,Mozilla</div><div class="line"><span class="number">102</span>,Hakim El Hattab,Whim</div><div class="line"><span class="number">105</span>,Chris Wanstrath,Github</div><div class="line"><span class="number">106</span>,Mattt Thompson,Heroku</div><div class="line"><span class="number">107</span>,Ask Solem Hoel,VMware</div><div class="line"><span class="comment"># NF是分割项数目, $NF表示最后一个分割项, 这里是找最后一个分割项是/bin/sh的就会累加n</span></div><div class="line"><span class="variable">$awk</span> -F <span class="string">':'</span> <span class="string">'$NF ~ /\/bin\/sh/ { n++ }; END { print n \</span></div><div class="line">}' /etc/passwd</div></pre></td></tr></table></figure>



<p>IF语法</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (conditional-expression)</div><div class="line">    action</div><div class="line">	</div><div class="line"><span class="keyword">if</span> (conditional-expression)</div><div class="line">{</div><div class="line">    action1;</div><div class="line">    action2; </div><div class="line">}</div></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#例子</span></div><div class="line"><span class="comment"># 和上面的一个例子一样</span></div><div class="line"><span class="variable">$awk</span> -F <span class="string">","</span> <span class="string">'{ if ($3 ~ "Github") print $0}'</span> source.txt</div><div class="line"><span class="number">105</span>,Chris Wanstrath,Github</div></pre></td></tr></table></figure>



<p>IF ELSE语法</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (conditional-expression)</div><div class="line">    action1</div><div class="line"><span class="keyword">else</span></div><div class="line">    action2</div><div class="line"><span class="comment"># or</span></div><div class="line">conditional-expression ? action1 : action2 ;</div></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#例子</span></div><div class="line"><span class="comment"># 打印单行因为%2,奇数取余</span></div><div class="line"><span class="variable">$awk</span> <span class="string">'ORS=NR%2?",":"\n"'</span> source.txt                    </div><div class="line"><span class="number">101</span>,Ian Bicking,Mozilla,<span class="number">102</span>,Hakim El Hattab,Whim</div><div class="line"><span class="number">103</span>,Paul Irish,Google,<span class="number">104</span>,Addy Osmani,Google</div><div class="line"><span class="number">105</span>,Chris Wanstrath,Github,<span class="number">106</span>,Mattt Thompson,Heroku</div><div class="line"><span class="number">107</span>,Ask Solem Hoel,VMware,</div></pre></td></tr></table></figure>


<p>WHILE语法</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">while</span>(condition)</div><div class="line">    actions</div></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#例子</span></div><div class="line"><span class="comment"># 把第二列和其之后的每列加起来</span></div><div class="line"><span class="variable">$cat</span> while.awk </div><div class="line">{</div><div class="line">    i=<span class="number">2</span>; total=<span class="number">0</span>;</div><div class="line">    <span class="keyword">while</span> (i &lt;= NF) {</div><div class="line">        total = total + <span class="variable">$i</span>;</div><div class="line">        i++;</div><div class="line"> }</div><div class="line">    print <span class="string">"Item"</span>, <span class="variable">$1</span>, <span class="string">":"</span>, total, <span class="string">"quantities sold"</span>;</div><div class="line">}</div><div class="line"><span class="variable">$awk</span> <span class="operator">-f</span> while.awk items-sold.txt</div><div class="line">Item <span class="number">101</span> : <span class="number">47</span> quantities sold</div><div class="line">Item <span class="number">102</span> : <span class="number">10</span> quantities sold</div><div class="line">Item <span class="number">103</span> : <span class="number">65</span> quantities sold</div><div class="line">Item <span class="number">104</span> : <span class="number">20</span> quantities sold</div><div class="line">Item <span class="number">105</span> : <span class="number">42</span> quantities sold</div></pre></td></tr></table></figure>



<p>DO WHILE语法</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># do while至少会执行一次</span></div><div class="line"><span class="keyword">do</span></div><div class="line">action</div><div class="line"><span class="keyword">while</span>(condition)</div></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#例子</span></div><div class="line"><span class="comment"># 用do-while方法实现上一次的例子</span></div><div class="line"><span class="variable">$cat</span> dowhile.awk </div><div class="line">{</div><div class="line">    i=<span class="number">2</span>; total=<span class="number">0</span>;</div><div class="line"> <span class="keyword">do</span></div><div class="line"> {</div><div class="line">     total = total + <span class="variable">$i</span>;</div><div class="line">     i++;</div><div class="line"> } <span class="keyword">while</span> (i &lt;= NF)</div><div class="line"> print <span class="string">"Item"</span>, <span class="variable">$1</span>, <span class="string">":"</span>, total, <span class="string">"quantities sold"</span>;</div><div class="line">}</div><div class="line"><span class="variable">$awk</span> <span class="operator">-f</span> dowhile.awk items-sold.txt</div><div class="line">Item <span class="number">101</span> : <span class="number">47</span> quantities sold</div><div class="line">Item <span class="number">102</span> : <span class="number">10</span> quantities sold</div><div class="line">Item <span class="number">103</span> : <span class="number">65</span> quantities sold</div><div class="line">Item <span class="number">104</span> : <span class="number">20</span> quantities sold</div><div class="line">Item <span class="number">105</span> : <span class="number">42</span> quantities sold</div></pre></td></tr></table></figure>



<p>FOR语法</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span>(initialization;condition;increment/decrement)</div><div class="line">actions</div></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#例子</span></div><div class="line"><span class="variable">$echo</span> <span class="string">"1 2 3 4"</span> | awk <span class="string">'{ for (i = 1; i &lt;= NF; i++) total = total+$i }; \</span></div><div class="line">END { print total }'  </div><div class="line"><span class="number">10</span></div><div class="line"><span class="comment"># 再来个for版本的例子</span></div><div class="line"><span class="variable">$cat</span> for.awk </div><div class="line">{</div><div class="line">    total=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> (i=<span class="number">2</span>; i &lt;= NF; i++)</div><div class="line">        total = total + <span class="variable">$i</span>;</div><div class="line">    print <span class="string">"Item"</span>, <span class="variable">$1</span>, <span class="string">":"</span>, total, <span class="string">"quantities sold"</span>;</div><div class="line">}</div><div class="line"><span class="variable">$awk</span> <span class="operator">-f</span> for.awk items-sold.txt</div><div class="line">Item <span class="number">101</span> : <span class="number">47</span> quantities sold</div><div class="line">Item <span class="number">102</span> : <span class="number">10</span> quantities sold</div><div class="line">Item <span class="number">103</span> : <span class="number">65</span> quantities sold</div><div class="line">Item <span class="number">104</span> : <span class="number">20</span> quantities sold</div><div class="line">Item <span class="number">105</span> : <span class="number">42</span> quantities sold</div></pre></td></tr></table></figure>


<p>BREAK,CONTINUE,EXIT</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 程序一直运行打印Iteration,并且累加x,直到x等于10停止程序-break</span></div><div class="line">$ awk <span class="string">'BEGIN{</span></div><div class="line">x=1;</div><div class="line">while(1)</div><div class="line">{</div><div class="line">print "Iteration";</div><div class="line">if ( x==10 )</div><div class="line">break;</div><div class="line">x++;</div><div class="line">}}'</div><div class="line"><span class="comment"># x从1到10, 如果x等于5 直接直接累加x而不打印</span></div><div class="line"><span class="variable">$awk</span> <span class="string">'BEGIN{</span></div><div class="line">x=1;</div><div class="line">while(x&lt;=10)</div><div class="line">{</div><div class="line">if(x==5){</div><div class="line">x++;</div><div class="line">continue;</div><div class="line">}</div><div class="line">print "Value of x",x;x++;</div><div class="line">}</div><div class="line">}'</div><div class="line"><span class="comment"># x从1到10,当x等于5的时候程序直接退出</span></div><div class="line"><span class="variable">$awk</span> <span class="string">'BEGIN{</span></div><div class="line">x=1;</div><div class="line">while(x&lt;=10)</div><div class="line">{</div><div class="line">if(x==5){</div><div class="line">exit;}</div><div class="line">print "Value of x",x;x++;</div><div class="line">}</div><div class="line">}'</div></pre></td></tr></table></figure>

<p>关联数组</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># awk 的关联数组中item[101]和item["101"]意义一样</span></div><div class="line"><span class="variable">$awk</span> <span class="string">'BEGIN { item[101]="Github"; print item["101"]}'</span> </div><div class="line">Github</div><div class="line"><span class="comment"># 可以用in检验是否包含本项</span></div><div class="line"><span class="variable">$awk</span> <span class="string">'BEGIN { item[101]="a"; if ( 101 in item ) print "Has 101"}'</span></div><div class="line">Has <span class="number">101</span></div><div class="line"><span class="comment"># 还可以使用for循环读取列表</span></div><div class="line"><span class="variable">$cat</span> array-for-loop.awk</div><div class="line">BEGIN {</div><div class="line">    item[<span class="number">101</span>]=<span class="string">"Github"</span>;</div><div class="line">    item[<span class="number">21</span>]=<span class="string">"Google"</span>;</div><div class="line">    <span class="keyword">for</span> (x <span class="keyword">in</span> item)</div><div class="line">        print item[x];</div><div class="line">}</div><div class="line"><span class="variable">$awk</span> <span class="operator">-f</span> array-for-loop.awk</div><div class="line">Github</div><div class="line">Google</div><div class="line"><span class="comment"># 多维数组, delete可以删除元素.PS item[2,1]这样的格式有问题</span></div><div class="line"><span class="comment"># 因为会被翻译成2#2("2\0342"),假设要设置分隔符可以使用SUBSEP=",";</span></div><div class="line"><span class="variable">$awk</span> <span class="string">'BEGIN { item["1,1"]="Github"; item["1,2"]="Google"; \</span></div><div class="line">item["2,1"]="Whim"; delete item["2,1"];</div><div class="line">for (x in item)</div><div class="line">print "Index",x,"contains",item[x];}'</div><div class="line">Index <span class="number">1</span>,<span class="number">1</span> contains Github</div><div class="line">Index <span class="number">1</span>,<span class="number">2</span> contains Google</div></pre></td></tr></table></figure>


<p>数组排序</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 这里需要gnu awk了 使用了asort排序</span></div><div class="line"><span class="variable">$cat</span> asort.awk </div><div class="line">BEGIN {</div><div class="line"> item[<span class="number">101</span>]=<span class="string">"Github"</span>;</div><div class="line"> item[<span class="number">22</span>]=<span class="string">"Whim"</span>;</div><div class="line"> item[<span class="number">50</span>]=<span class="string">"Google"</span>;</div><div class="line"> print <span class="string">"------Before asort------"</span></div><div class="line"> <span class="keyword">for</span> (x <span class="keyword">in</span> item)</div><div class="line">     print <span class="string">"Index"</span>,x,<span class="string">"contains"</span>,item[x];</div><div class="line"> total = asort(item);</div><div class="line"> print <span class="string">"------After asort------"</span></div><div class="line"> <span class="keyword">for</span> (x <span class="keyword">in</span> item)</div><div class="line">     print <span class="string">"Index"</span>,x,<span class="string">"contains"</span>,item[x];</div><div class="line">}</div><div class="line"><span class="comment">#</span></div><div class="line"><span class="variable">$gawk</span> <span class="operator">-f</span> asort.awk</div><div class="line">------Before asort------</div><div class="line">Index <span class="number">22</span> contains Whim</div><div class="line">Index <span class="number">50</span> contains Google</div><div class="line">Index <span class="number">101</span> contains Github</div><div class="line">------After asort------</div><div class="line">Index <span class="number">1</span> contains Github</div><div class="line">Index <span class="number">2</span> contains Google</div><div class="line">Index <span class="number">3</span> contains Whim</div><div class="line"><span class="comment"># 大家请注意上面的例子,排序后已经忘记了原来item的index位置</span></div><div class="line"><span class="comment"># 而asorti可以帮助你记录这个位置</span></div><div class="line"><span class="variable">$cat</span> asorti.awk</div><div class="line">BEGIN {</div><div class="line"> item[<span class="number">101</span>]=<span class="string">"Github"</span>;</div><div class="line"> item[<span class="number">22</span>]=<span class="string">"Whim"</span>;</div><div class="line"> item[<span class="number">50</span>]=<span class="string">"Google"</span>;</div><div class="line"> print <span class="string">"----- Function: asort -----"</span></div><div class="line"> total = asort(item,itemdesc);</div><div class="line"> <span class="keyword">for</span> (i=<span class="number">1</span>; i&lt;= total; i++)</div><div class="line">    print <span class="string">"Index"</span>,i,<span class="string">"contains"</span>,itemdesc[i];</div><div class="line"> print <span class="string">"----- Function: asorti -----"</span></div><div class="line"> total = asorti(item,itemabbr);</div><div class="line"> <span class="keyword">for</span> (i=<span class="number">1</span>; i&lt;= total; i++)</div><div class="line">     print <span class="string">"Index"</span>,i,<span class="string">"contains"</span>,itemabbr[i];</div><div class="line">}</div><div class="line"><span class="variable">$gawk</span> <span class="operator">-f</span> asorti.awk</div><div class="line">----- Function: asort -----</div><div class="line">Index <span class="number">1</span> contains Github</div><div class="line">Index <span class="number">2</span> contains Google</div><div class="line">Index <span class="number">3</span> contains Whim</div><div class="line">----- Function: asorti -----</div><div class="line">Index <span class="number">1</span> contains <span class="number">101</span></div><div class="line">Index <span class="number">2</span> contains <span class="number">22</span></div><div class="line">Index <span class="number">3</span> contains <span class="number">50</span></div></pre></td></tr></table></figure>



<p>格式化打印</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># \n是换行</span></div><div class="line"><span class="variable">$awk</span> <span class="string">'BEGIN { printf "Line 1\nLine 2\n" }'</span></div><div class="line">Line <span class="number">1</span></div><div class="line">Line <span class="number">2</span></div><div class="line"><span class="comment"># \t是tab</span></div><div class="line"><span class="variable">$awk</span> <span class="string">'BEGIN \</span></div><div class="line">{ printf "Field 1\t\tField 2\tField 3\tField 4\n" }'</div><div class="line">Field <span class="number">1</span>		Field <span class="number">2</span>	Field <span class="number">3</span>	Field <span class="number">4</span></div><div class="line"><span class="comment"># \v是垂直tab</span></div><div class="line"><span class="variable">$awk</span> <span class="string">'BEGIN \</span></div><div class="line">{ printf "Field 1\vField 2\vField 3\vField 4\n" }'</div><div class="line">Field <span class="number">1</span></div><div class="line">    Field <span class="number">2</span></div><div class="line">       Field <span class="number">3</span></div><div class="line">	  Field <span class="number">4</span></div><div class="line"><span class="comment"># %s字符串; %c单个字符; %d数字; %f浮点数......</span></div><div class="line"><span class="variable">$cat</span> <span class="built_in">printf</span>-width.awk </div><div class="line">BEGIN {</div><div class="line">FS=<span class="string">","</span></div><div class="line"><span class="built_in">printf</span> <span class="string">"%3s\t%10s\t%10s\t%5s\t%3s\n"</span>,</div><div class="line">    <span class="string">"Num"</span>,<span class="string">"Description"</span>,<span class="string">"Type"</span>,<span class="string">"Price"</span>,<span class="string">"Qty"</span></div><div class="line"><span class="built_in">printf</span> <span class="string">"-----------------------------------------------------\n"</span></div><div class="line">}</div><div class="line">{</div><div class="line">    <span class="built_in">printf</span> <span class="string">"%3d\t%10s\t%10s\t%g\t%d\n"</span>, <span class="variable">$1</span>,<span class="variable">$2</span>,<span class="variable">$3</span>,<span class="variable">$4</span>,<span class="variable">$5</span></div><div class="line">}</div><div class="line">awk <span class="operator">-f</span> <span class="built_in">printf</span>-width.awk items.txt </div><div class="line">Num	Description	      Type	Price	Qty</div><div class="line">-----------------------------------------------------</div><div class="line"><span class="number">101</span>	HD Camcorder	     Video	<span class="number">210</span>	<span class="number">10</span></div><div class="line"><span class="number">102</span>	Refrigerator	 Appliance	<span class="number">850</span>	<span class="number">2</span></div><div class="line"><span class="number">103</span>	MP3 Player	     Audio	<span class="number">270</span>	<span class="number">15</span></div><div class="line"><span class="number">104</span>	Tennis Racket	    Sports	<span class="number">190</span>	<span class="number">20</span></div><div class="line"><span class="number">105</span>	Laser Printer	    Office	<span class="number">475</span>	<span class="number">5</span></div></pre></td></tr></table></figure>



<p>内置函数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># int - 将数字转换成整形, 类似的函数还有sqrt, sin, cos...</span></div><div class="line"><span class="variable">$awk</span> <span class="string">'BEGIN {print int(4.1);print int(-6.22);print int(strings)}'</span></div><div class="line"><span class="number">4</span></div><div class="line">-<span class="number">6</span></div><div class="line"><span class="number">0</span></div><div class="line"><span class="comment"># rand - 随机0-1的数字; srand -初始化随机数的初始值</span></div><div class="line"><span class="variable">$cat</span> srand.awk </div><div class="line">BEGIN {</div><div class="line">    srand(<span class="number">5</span>);</div><div class="line">    count=<span class="number">0</span>;</div><div class="line">    max=<span class="number">30</span>;</div><div class="line">    <span class="keyword">while</span> (count &lt; <span class="number">5</span>) {</div><div class="line">        <span class="comment"># 随机数范围为5-30</span></div><div class="line">        rnd = int(rand() * max);</div><div class="line">        print rnd;</div><div class="line">        count++;</div><div class="line">    }</div><div class="line">}</div><div class="line"><span class="comment"># 使用osx的awk随机范围不对</span></div><div class="line"><span class="variable">$gawk</span> <span class="operator">-f</span> srand.awk</div><div class="line"><span class="number">19</span></div><div class="line"><span class="number">9</span></div><div class="line"><span class="number">21</span></div><div class="line"><span class="number">8</span></div><div class="line"><span class="number">13</span></div><div class="line"><span class="comment"># index - 所查字符在字符串中的位置,没找到会返回0</span></div><div class="line">awk <span class="string">'BEGIN{str="This is a test"; print index(str, "a"); print index(str, "y")}'</span></div><div class="line"><span class="number">9</span></div><div class="line"><span class="number">0</span></div><div class="line"><span class="comment"># length - 字符串的长度</span></div><div class="line"><span class="variable">$awk</span> -F, <span class="string">'{print length($0)}'</span> source.txt</div><div class="line"><span class="number">23</span></div><div class="line"><span class="number">24</span></div><div class="line"><span class="number">21</span></div><div class="line"><span class="number">22</span></div><div class="line"><span class="number">26</span></div><div class="line"><span class="number">25</span></div><div class="line"><span class="number">25</span></div><div class="line"><span class="comment"># split - 分片 PS:使用awk分片的顺序有问题;</span></div><div class="line"><span class="comment"># split第一个参数是要分割的内容,第二个是分割后的结果保存的数组,第三个是使用的分隔符</span></div><div class="line"><span class="variable">$echo</span> <span class="string">"101 arg1:arg2:arg3"</span>|gawk <span class="string">'{split($2,out,":"); for (x in out) print out[x];}'</span></div><div class="line">arg1</div><div class="line">arg2</div><div class="line">arg3</div><div class="line"><span class="comment"># substr - 取字符串范围内容;</span></div><div class="line"><span class="comment"># 第一个参数是要取的内容, 第二个是开始位置(从1开始),第三个是要取的长度</span></div><div class="line"><span class="variable">$echo</span> <span class="string">"This is test"</span>|awk <span class="string">'{print substr($3,2,2);}'</span></div><div class="line">es</div><div class="line"><span class="comment"># sub - 替换原来的字符串,但是只替换第一个符合项; gsub - 替换全部选择项</span></div><div class="line"><span class="variable">$awk</span> <span class="string">'BEGIN{str="ThIs is test"; sub("[Ii]s","e", str); print str;}'</span></div><div class="line">The is test</div><div class="line"><span class="variable">$awk</span> <span class="string">'BEGIN{str="ThIs is test"; gsub("[Ii]s","e", str); print str;}'</span></div><div class="line">The e test</div><div class="line"><span class="comment"># match - 返回某子字符串是否匹配了某字符串;</span></div><div class="line"><span class="comment"># RSTART - awk 自带变量返回匹配的开始位置</span></div><div class="line"><span class="comment"># RLENGTH - awk 自带变量返回匹配串的长度</span></div><div class="line"><span class="variable">$awk</span> <span class="string">'BEGIN{str="This is test"; if (match(str, "test")) {print substr(str,RSTART,RLENGTH)}}'</span>  </div><div class="line"><span class="comment"># tolower/toupper - 把字符串都变成小写/大写</span></div><div class="line"><span class="variable">$awk</span> <span class="string">'BEGIN{str="This is test"; print tolower(str); print toupper(str);}'</span></div><div class="line">this is test</div><div class="line">THIS IS TEST</div><div class="line"><span class="comment"># ARGC - 参数的数量; ARGV参数的数组</span></div><div class="line"><span class="variable">$cat</span> arguments.awk</div><div class="line">BEGIN {</div><div class="line">    print <span class="string">"ARGC="</span>,ARGC</div><div class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; ARGC; i++)</div><div class="line">  print ARGV[i]</div><div class="line">}</div></pre></td></tr></table></figure>



<p>内置变量</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># ENVIRON - 系统环境变量</span></div><div class="line"><span class="variable">$cat</span> environ.awk</div><div class="line">BEGIN {</div><div class="line"> OFS=<span class="string">"="</span></div><div class="line"> <span class="keyword">for</span>(x <span class="keyword">in</span> ENVIRON)</div><div class="line">     print x,ENVIRON[x];</div><div class="line">}</div><div class="line"><span class="comment"># IGNORECASE - 设置为1 忽略大小写</span></div><div class="line"><span class="variable">$gawk</span> <span class="string">'BEGIN{IGNORECASE=1} /github/{print}'</span> source.txt</div><div class="line"><span class="number">105</span>,Chris Wanstrath,Github</div></pre></td></tr></table></figure>



<p>位运算</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$cat</span> bits.awk</div><div class="line">BEGIN {</div><div class="line"> number1=<span class="number">15</span></div><div class="line"> number2=<span class="number">25</span></div><div class="line"> print <span class="string">"AND: "</span> and(number1,number2);</div><div class="line"> print <span class="string">"OR: "</span> or(number1,number2)</div><div class="line"> print <span class="string">"XOR: "</span> xor(number1,number2)</div><div class="line"> print <span class="string">"LSHIFT: "</span> lshift(number1,<span class="number">2</span>)</div><div class="line"> print <span class="string">"RSHIFT: "</span> rshift(number1,<span class="number">2</span>)</div><div class="line">}</div><div class="line"><span class="variable">$gawk</span> <span class="operator">-f</span> bits.awk</div><div class="line">AND: <span class="number">9</span></div><div class="line">OR: <span class="number">31</span></div><div class="line">XOR: <span class="number">22</span></div><div class="line">LSHIFT: <span class="number">60</span></div><div class="line">RSHIFT: <span class="number">3</span></div></pre></td></tr></table></figure>



<p>自定义函数语法</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">function fn-name(parameters)</div><div class="line">{</div><div class="line"> function-body</div><div class="line">}</div></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#例子</span></div><div class="line"><span class="comment"># 函数的位置不重要</span></div><div class="line"><span class="variable">$cat</span> function-debug.awk </div><div class="line">function mydebug (message) {</div><div class="line">    print (<span class="string">"Debug Time:"</span> strftime(<span class="string">"%a %b %d %H:%M:%S %Z %Y"</span>, systime()))</div><div class="line">    print (message)</div><div class="line">}</div><div class="line">{</div><div class="line">    mydebug(<span class="variable">$NF</span>)</div><div class="line">}</div><div class="line"><span class="variable">$gawk</span> <span class="operator">-f</span> function-debug.awk source.txt</div><div class="line">Debug Time:Wed Dec <span class="number">11</span> <span class="number">22</span>:<span class="number">14</span>:<span class="number">43</span> CST <span class="number">2013</span></div><div class="line">Bicking,Mozilla</div><div class="line">Debug Time:Wed Dec <span class="number">11</span> <span class="number">22</span>:<span class="number">14</span>:<span class="number">43</span> CST <span class="number">2013</span></div><div class="line">Hattab,Whim</div><div class="line">Debug Time:Wed Dec <span class="number">11</span> <span class="number">22</span>:<span class="number">14</span>:<span class="number">43</span> CST <span class="number">2013</span></div><div class="line">Irish,Google</div><div class="line">Debug Time:Wed Dec <span class="number">11</span> <span class="number">22</span>:<span class="number">14</span>:<span class="number">43</span> CST <span class="number">2013</span></div><div class="line">Osmani,Google</div><div class="line">Debug Time:Wed Dec <span class="number">11</span> <span class="number">22</span>:<span class="number">14</span>:<span class="number">43</span> CST <span class="number">2013</span></div><div class="line">Wanstrath,Github</div><div class="line">Debug Time:Wed Dec <span class="number">11</span> <span class="number">22</span>:<span class="number">14</span>:<span class="number">43</span> CST <span class="number">2013</span></div><div class="line">Thompson,Heroku</div><div class="line">Debug Time:Wed Dec <span class="number">11</span> <span class="number">22</span>:<span class="number">14</span>:<span class="number">43</span> CST <span class="number">2013</span></div><div class="line">Hoel,VMware</div></pre></td></tr></table></figure>



<p>系统调用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 使用system函数可以调用shell命令</span></div><div class="line"><span class="variable">$awk</span> <span class="string">'BEGIN { system("date") }'</span></div><div class="line">Wed Dec <span class="number">11</span> <span class="number">22</span>:<span class="number">24</span>:<span class="number">27</span> CST <span class="number">2013</span></div><div class="line"><span class="comment"># systime 和 strftime上面见过了.处理时间和格式化时间</span></div><div class="line"><span class="variable">$gawk</span> <span class="string">'BEGIN { print strftime("%c",systime()) }'</span></div><div class="line">Wed Dec <span class="number">11</span> <span class="number">22</span>:<span class="number">25</span>:<span class="number">32</span> <span class="number">2013</span></div></pre></td></tr></table></figure>

<h3 id="学完本章的练习">学完本章的练习</h3>
<ul>
<li>1.获取来连接mongodb的各服务器产生的连接数</li>
<li>2.获取nginx日志ip访问数在一个小时里面,从多到少的总次数排行(排行用到了sort)</li>
<li>3.打印question_awk3.txt包含Addy和Mattt之间的行</li>
<li>4.不使用sort过滤重复行</li>
<li>5.将2个文件合并成一行,但username不一定在2个文件同一行</li>
<li>6.输出2个文件1中有,2中没有的行</li>
<li>7.这是什么意思: gawk -vcmd=’ls -l’ ‘BEGIN{while ( (cmd | getline var) &gt; 0) {print var} close(cmd)}’                        </li>
</ul>
<h2 id="AWK高级话题">AWK高级话题</h2>
<p>GETLINE</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># awk首先读入一行，接着处理getline函数再获得一行....下面显示的就是奇数行</span></div><div class="line"><span class="variable">$awk</span> -F<span class="string">","</span> <span class="string">'{print $0;getline;}'</span> source.txt </div><div class="line"><span class="number">101</span>,Ian Bicking,Mozilla</div><div class="line"><span class="number">103</span>,Paul Irish,Google</div><div class="line"><span class="number">105</span>,Chris Wanstrath,Github</div><div class="line"><span class="number">107</span>,Ask Solem Hoel,VMware</div><div class="line"><span class="comment"># 我们使用getline 并把这行变量赋值给tmp</span></div><div class="line"><span class="variable">$awk</span> -F, <span class="string">'{getline tmp; print "$0-&gt;", $0; print "tmp-&gt;", tmp;}'</span> source.txt</div><div class="line"><span class="variable">$0</span>-&gt; <span class="number">101</span>,Ian Bicking,Mozilla</div><div class="line">tmp-&gt; <span class="number">102</span>,Hakim El Hattab,Whim</div><div class="line"><span class="variable">$0</span>-&gt; <span class="number">103</span>,Paul Irish,Google</div><div class="line">tmp-&gt; <span class="number">104</span>,Addy Osmani,Google</div><div class="line"><span class="variable">$0</span>-&gt; <span class="number">105</span>,Chris Wanstrath,Github</div><div class="line">tmp-&gt; <span class="number">106</span>,Mattt Thompson,Heroku</div><div class="line"><span class="variable">$0</span>-&gt; <span class="number">107</span>,Ask Solem Hoel,VMware</div><div class="line">tmp-&gt; <span class="number">106</span>,Mattt Thompson,Heroku</div><div class="line"><span class="comment"># 执行外部程序, close可关闭管道,比如这里必须是`|getline`之前的命令</span></div><div class="line"><span class="variable">$awk</span> <span class="string">'BEGIN{"date"| getline;close("date");print "Timestamp:" $0}'</span></div><div class="line">Timestamp:Wed Dec <span class="number">11</span> <span class="number">22</span>:<span class="number">41</span>:<span class="number">52</span> CST <span class="number">2013</span></div><div class="line"><span class="comment"># or</span></div><div class="line"><span class="variable">$awk</span> <span class="string">'BEGIN{"date"| getline timestamp;close("date");print "Timestamp:" timestamp}'</span></div><div class="line">Timestamp:Wed Dec <span class="number">11</span> <span class="number">22</span>:<span class="number">44</span>:<span class="number">08</span> CST <span class="number">2013</span></div></pre></td></tr></table></figure>


      
    </div>
    <footer>
      

        
          <div class="alignleft post-nav">
            <em>上一篇: </em><a href="/2011/11/10/my-java-dev-tools/">我的Java程序员开发常用工具集</a>
          </div>
        
        
          <div class="alignright post-nav">
            <em>下一篇: </em><a href="/2011/06/22/mongodb-commond/">MongoDB常见操作命令整理</a>
          </div>
          <div class="clearfix"></div>
        

        
          <div class="copyright">
            
              <span class="claim">版权声明：自由转载-非商用-无演绎-保持署名 @ Lawrence-zxc</span>
            
            
              <span class="from-link">
                <em>本文链接地址:</em>
                <a href="/2011/07/10/sed-awk/">
                  http://lawrence-zxc.github.io/2011/07/10/sed-awk/
                </a>
              </span>
            
          </div>
        
        
  
  <div class="categories">
    <a href="/categories/日志/">日志</a>
  </div>

        
  
  <div class="tags">
    <a href="/tags/Linux/">Linux</a>
  </div>

        
  <div class="addthis addthis_toolbox addthis_default_style">
    
      <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
    
    
      <a class="addthis_button_tweet"></a>
    
    
      <a class="addthis_button_sinaweibo_like"></a>
    
    
      <a class="addthis_button_linkedin"></a>
    
    
    
    <a class="addthis_counter addthis_pill_style"></a>
  </div>
  <!--<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js"></script>-->

      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




<nav id="pagination" >
    
    <a href="/2011/11/10/my-java-dev-tools/" class="alignleft prev" >上一页</a>
    
    
    <a href="/2011/06/22/mongodb-commond/" class="alignright next" >下一页</a>
    
    <div class="clearfix"></div>
</nav>

<section id="comment">
    <h1 class="title">留言</h1>
    <div id="disqus_thread">
    	<noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="2011/07/10/sed-awk/" data-title="sed和awk学习总结" data-url="http://lawrence-zxc.github.io/2011/07/10/sed-awk/"></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"zxc337"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
<!-- 多说公共JS代码 end -->
</section>


</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="text" name="q" results="0" placeholder="搜一下">
    <i class="icon-search"></i>
    <input type="hidden" name="q" value="site:lawrence-zxc.github.io">
  </form>
</div>

  
<div class="widget tag">
  <h3 class="title">标签</h3>
  <ul class="entry">
  
    <li><a href="/tags/Git/">Git</a><small>2</small></li>
  
    <li><a href="/tags/Java/">Java</a><small>27</small></li>
  
    <li><a href="/tags/JavaScript/">JavaScript</a><small>4</small></li>
  
    <li><a href="/tags/LeetCode/">LeetCode</a><small>2</small></li>
  
    <li><a href="/tags/Linux/">Linux</a><small>21</small></li>
  
    <li><a href="/tags/Mac-Unix/">Mac/Unix</a><small>1</small></li>
  
    <li><a href="/tags/Maven/">Maven</a><small>2</small></li>
  
    <li><a href="/tags/Mysql/">Mysql</a><small>2</small></li>
  
    <li><a href="/tags/Nginx/">Nginx</a><small>5</small></li>
  
    <li><a href="/tags/Oracle/">Oracle</a><small>4</small></li>
  
    <li><a href="/tags/Python/">Python</a><small>3</small></li>
  
    <li><a href="/tags/XMPP/">XMPP</a><small>2</small></li>
  
    <li><a href="/tags/其他/">其他</a><small>0</small></li>
  
    <li><a href="/tags/开始/">开始</a><small>3</small></li>
  
    <li><a href="/tags/技术/">技术</a><small>1</small></li>
  
    <li><a href="/tags/旅行/">旅行</a><small>1</small></li>
  
    <li><a href="/tags/架构/">架构</a><small>3</small></li>
  
    <li><a href="/tags/生活/">生活</a><small>1</small></li>
  
    <li><a href="/tags/读书/">读书</a><small>0</small></li>
  
    <li><a href="/tags/随感/">随感</a><small>7</small></li>
  
  </ul>
</div>


  <div class="trace-invest">
    <span>
        <a href="https://github.com/Lawrence-zxc" target="_blank">欢迎光临我的技术Blog网站 </br>Fork me on Github</a>
    </span>
</div>


  
<div class="widget tag">
  <h3 class="title">最新文章</h3>
  <ul class="entry">
    
      <li>
        <a href="/2015/04/04/jishu-hehuoren/">技术合伙人为什么喜欢谈钱胜过情怀？</a>
      </li>
    
      <li>
        <a href="/2015/04/01/reverse-o2o/">分享一个用户自发需求的反向O2O设想</a>
      </li>
    
      <li>
        <a href="/2015/03/08/shujiawang/">面向企业和个人O2O图书租赁服务设想</a>
      </li>
    
      <li>
        <a href="/2015/03/05/pingjiaapp/">关于电商商品评价评论独立第三方平台构想</a>
      </li>
    
      <li>
        <a href="/2015/01/23/suishoupai/">关于随手拍图片人脸识别APP需求的想法</a>
      </li>
    
      <li>
        <a href="/2014/11/25/xushen/">徐神的诗</a>
      </li>
    
      <li>
        <a href="/2014/11/20/openfire/">Openfire服务端错误解决</a>
      </li>
    
      <li>
        <a href="/2014/11/16/xmpp/">xmpp通信过程分析</a>
      </li>
    
      <li>
        <a href="/2014/11/10/oracle-index/">Oracle大批量高效地更新大数据表索引字段</a>
      </li>
    
      <li>
        <a href="/2014/11/10/oracle-partition/">Oracle Partition Common Usage</a>
      </li>
    
      <li>
        <a href="/2014/10/28/jvm-strace/">jvm退出的原因,使用strace定位</a>
      </li>
    
      <li>
        <a href="/2014/10/28/load-balancing/">负载均衡和过载保护</a>
      </li>
    
  </ul>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <div id="go-pg-top"><i class="icon-arrow-up"></i></div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2015 Jeck Zhang
  
</div>
<div class="clearfix"></div></footer>
  <script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript" charset="utf-8" src="/js/page.js"></script>


<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?a5eb19e532c0b101d72226b1325e6a78";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

</body>

</html>