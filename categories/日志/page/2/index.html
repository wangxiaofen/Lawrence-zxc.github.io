<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>第 2 页 | 日志 | Jeck_Zhang</title>
  <meta name="author" content="Jeck Zhang">
  
  <meta name="description" content="zxc&#39;s blog">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="Jeck_Zhang"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Jeck_Zhang" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script src="/js/jquery.min.js"></script>
  
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-45019001-1', 'topdna.org');
  ga('send', 'pageview');

</script>


</head>


<body>
  <!--[if lte IE 8]> <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'> <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode"><img src="http://storage.ie6countdown.com/assets/100/images/banners/warning_bar_0027_Simplified Chinese.jpg" border="0" height="42" width="820" alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today." style='margin-left:auto;margin-right:auto;display: block;'/></a></div> <![endif]-->
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">Jeck_Zhang</a></h1>
  <h2><a href="/">Write the Code. Change the World.</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">首页</a></li>
    
      <li><a href="http://weibo.com/zxc337">weibo</a></li>
    
      <li><a href="/2014/10/01/aboutMe/">关于</a></li>
    
      <li><a href="/tags/随感/">随感</a></li>
    
      <li><a href="/tags/技术/">技术</a></li>
    
      <li><a href="/tags/理财/">理财</a></li>
    
      <li><a href="/tags/生活/">生活</a></li>
    
      <li><a href="/archives">归档</a></li>
    
    <li><a href="/atom.xml">RSS</a></li>
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper">
<h2 class="archive-title category">日志</h2>


  
    <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <time datetime="2014-09-18T07:12:39.000Z"><a href="/2014/09/18/blog3/">9月 18 2014</a></time>
      
      
  
    <h1 class="title"><a href="/2014/09/18/blog3/">Nginx+Lua+GraphicsMagick实现动态生成指定尺寸的图片</a></h1>
  

    </header>
    <div class="entry">
      
        <p>面临的问题<br>网站需求变更，需要更多不同尺寸的缩略图</p>
<p>有些图片的缩略图很少使用到，但还是存在了硬盘上，造成空间浪费</p>
<p>解决方法<br>Nginx搭配Lua模块，如果访问的图片不存在，则调用GraphicsMagick的命令行实时生成指定尺寸的图片。</p>
<p>-集成了Lua模块的Nginx项目OpenResty</p>
<p>-GraphicsMagick的安装和使用</p>
<p>-具体使用方法</p>
<p>原始图片地址：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/images/f47aa98b47b4b7bd.jpg</div></pre></td></tr></table></figure>

<p>自定义图片尺寸：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/images/f47aa98b47b4b7bd_40x40.jpg</div></pre></td></tr></table></figure>

<p>配置文件中可以写成这样</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">location ~ <span class="string">'/images/([0-9a-z]+)_([0-9]+)x([0-9]+).jpg$'</span> {</div><div class="line">    root /home/images;</div><div class="line">    <span class="keyword">set</span> <span class="variable">$image_root</span> =  <span class="string">'/home/images'</span>;</div><div class="line">    <span class="keyword">set</span> <span class="variable">$fileName</span> = ngx.arg[<span class="number">1</span>];</div><div class="line">    <span class="keyword">set</span> <span class="variable">$width</span> = ngx.arg[<span class="number">2</span>];</div><div class="line">    <span class="keyword">set</span> <span class="variable">$height</span> = ngx.arg[<span class="number">3</span>];</div><div class="line">    <span class="keyword">set</span> <span class="variable">$origin</span> = <span class="variable">$image_root</span>/<span class="variable">$fileName</span>.jpg</div><div class="line">    <span class="keyword">set</span> <span class="variable">$file</span> = <span class="variable">$image_root</span>/<span class="variable">$fileName_</span><span class="variable">$widthx</span><span class="variable">$height</span>.jpg</div><div class="line">    <span class="keyword">if</span> (!<span class="operator">-f</span> <span class="variable">$file</span>) {</div><div class="line">        rewrite_by_lua <span class="string">'</span></div><div class="line">            local command = "gm convert "..ngx.var.origin.." -thumbnail "..ngx.var.width.."x"</div><div class="line">                            ..ngx.var.height.." "..ngx.var.file;</div><div class="line">            os.execute(command);</div><div class="line">         ';</div><div class="line"> }</div></pre></td></tr></table></figure>

<p>这样就能简单的生成图片指定尺寸的缩略图了。</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>






  
    <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <time datetime="2014-09-05T06:10:03.000Z"><a href="/2014/09/05/blog1/">9月 5 2014</a></time>
      
      
  
    <h1 class="title"><a href="/2014/09/05/blog1/">REST风格的软件架构</a></h1>
  

    </header>
    <div class="entry">
      
        <p>REST风格的软件架构</p>
<p>作者：侯西阳 时间：June 2, 2013 分类：RESTful<br>REST(REpresentational State Transfer)，表征状态转移，是一种针对分布式架构的软件架构风格，这种软件架构风格已经被广泛的应用在了Web API的设计上面，具有以下几个特点：</p>
<pre><code><span class="title">Resources</span> 一切都是资源
</code></pre><p>分布在整个网络中的内容都是一种资源，并由URI来确定，资源可以是文本、图片、服务等实体的存在，并用URI来提供这种资源，例如， /book/2 可以用来提供id为2的一本书。</p>
<pre><code><span class="title">Representation</span> 表现层
</code></pre><p>资源是一种实体，需要通过一种形式表现出来，这种形式可以是HTML、XML、JSON等文本格式，也可以是图片、音频或视频等多媒体格式，例如，通过访问 /book/2 返回了一下JSON数据：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">{</div><div class="line">    <span class="string">"title"</span>: <span class="string">"Gone with the Wind"</span>,</div><div class="line">    <span class="string">"author"</span>: <span class="string">"Margaret Mitchell"</span> </div><div class="line">}</div></pre></td></tr></table></figure>

<p>JSON数据就这本书的表现层。</p>
<p>State Transfer 显示的使用HTTP方法来转化资源的状态</p>
<p>使用HTTP规范中的GET、POST、PUT、DELETE方法来操作资源，例如</p>
<pre><code>GET <span class="regexp">/book/</span><span class="number">2</span>
</code></pre><p>可以获得id为2的一本书，HTTP方法与操作资源的对应关系如下</p>
<pre><code>POST 创建或更新资源

GET 获取资源

PUT 更新资源

<span class="keyword">DELETE</span> 删除资源
</code></pre><p>举例如下：<br>同样是访问 /book/2，</p>
<pre><code>POST 创建一本书

GET 获取一本的信息

PUT 更新书的信息

<span class="keyword">DELETE</span> 删除id为<span class="number">2</span>的书

Stateless 无状态
</code></pre><p>服务器端不会保存请求之间的上下文状态。</p>
<pre><code>Client-Server 基于<span class="keyword">C</span>/S结构
</code></pre><p>Client端不关心数据如何存储，Server端也不关心怎样展现数据，因此，Client和Server可以分开部署，适用于iOS与Android等移动客户端与Server端的通信。</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>






  
    <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <time datetime="2014-07-18T08:02:20.000Z"><a href="/2014/07/18/java-generics/">7月 18 2014</a></time>
      
      
  
    <h1 class="title"><a href="/2014/07/18/java-generics/">java泛型的理解</a></h1>
  

    </header>
    <div class="entry">
      
        <p>这是自己java泛型的理解,心得体会!</p>
<p>几年前当Java5还未正式发布的时候，看到过一些人写的介绍Tiger中的新特性，当时对我第一感觉冲击最大的就是泛型(generics)和注释(annotation)，因为它们直接影响了我们编码的语法习惯。在后来的使用过程中，对于泛型一直没有特别深入的使用过，没有遇到那样的需求和场景。只需要了解Java中的泛型是编译期的，运行期被“擦拭”掉了；然后还有几种通配符的表示就足够了。</p>
<p>直到一天我在查看Java5中Enum的源代码时，发现它是这么定义的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Enum</span>&lt;<span class="title">E</span> <span class="keyword">extends</span> <span class="title">Enum</span>&lt;<span class="title">E</span>&gt;&gt; </span></div><div class="line">                <span class="keyword">implements</span> <span class="title">Comparable</span>&lt;<span class="title">E</span>&gt;, <span class="title">Serializable</span> {</div></pre></td></tr></table></figure>

<p>这个类似递归结构的 Enum<e extends="" enum<e="">&gt; 究竟表达什么意思？</e></p>
<p>随后我又看到了在Collections工具类中的max 方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T extends Object & Comparable&lt;? <span class="keyword">super</span> T&gt;&gt; </div><div class="line">                T <span class="title">max</span>(Collection&lt;? extends T&gt; coll) {</div></pre></td></tr></table></figure>

<p>怎么TMD还会有这么复杂的泛型表达式!?（幸好的是这种情况在我们实际开发过程中不多见，甚至不应该见到，大概只有像JDK这种为了保留对老版本的兼容才会设计出这么复杂的泛型表达式出来。）</p>
<p>上面的问题，你可以通过：<a href="http://java.sun.com/j2se/1.5/pdf/generics-tutorial.pdf" target="_blank" rel="external">http://java.sun.com/j2se/1.5/pdf/generics-tutorial.pdf</a> 来获取答案，中文版的在：<a href="http://blog.csdn.net/explorers/archive/2005/08/15/454837.aspx" target="_blank" rel="external">http://blog.csdn.net/explorers/archive/2005/08/15/454837.aspx</a><br>这篇泛型指南的文章，非常详细。</p>
<p>或许你看了上面的文章，依然心存疑虑。我下面的内容则是对这篇文档的一些补充（会和这篇文档有点重合）<br>回到我之前抛出的问题上：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">foo</span>(List&lt;? extends Number&gt; l){</div><div class="line">    l.add(<span class="keyword">new</span> Integer(<span class="number">2</span>));  <span class="comment">// 编译通过么？ Why ?</span></div><div class="line">}</div><div class="line"> </div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">bar</span>(List&lt;? <span class="keyword">super</span> Number&gt; l){</div><div class="line">    l.add(<span class="keyword">new</span> Integer(<span class="number">2</span>));  <span class="comment">// 编译通过么？ Why ?</span></div><div class="line">    l.add(<span class="keyword">new</span> Float(<span class="number">2</span>));    <span class="comment">// ok?</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>这里主要说说 &lt;? extends T&gt; 和 &lt;? super T&gt; 这两种通配符对于方法参数的使用原则。<br>即 PECS 原则 (producser-extends, consumer-super) 或者也叫 Get and Put 原则</p>
<p>当没有使用通配符的情况下，我们定义一个方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;E&gt; <span class="keyword">void</span> <span class="title">test</span>(List&lt;E&gt; l){</div><div class="line">    E e = l.get(<span class="number">0</span>);</div><div class="line">    l.set(<span class="number">0</span>, e);</div><div class="line">}</div></pre></td></tr></table></figure>

<p>我们从List中 get和set都没有问题，因为这个E 它的类型是某种明确的类型。</p>
<p>而当使用通配符时来描述参数时，就有些不同了。</p>
<p>我们先定义一下两种通配符： </p>
<p>&lt;? extends E&gt; 是 Upper Bound（上限） 的通配符</p>
<p>&lt;? super E&gt; 是 Lower Bound（下限） 的通配符</p>
<p>1) 当使用 Upper Bound 通配符时：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test</span>(List&lt;?&gt; list){</div><div class="line">    Object e = list.get(<span class="number">0</span>); <span class="comment">// get OK</span></div><div class="line">    list.set(<span class="number">0</span>, e);         <span class="comment">// set 编译报错</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>上面代码中通配符&lt;?&gt; 是 &lt;? extends Object&gt; 的简写。(关于&lt;?&gt;是否和&lt;? extends Object&gt;完全等价，我遇到个小插曲，在结束的时候来描述)</p>
<p>在eclipse里错误提示为：<br><em>The method set(int, capture#2-of ?) in the type List<capture#2-of ?=""> is not applicable for the arguments (int, Object)</capture#2-of></em></p>
<p>注： <capture#2-of ?=""> 是一个占位符，表示编译器对通配符的捕获，更多见：</capture#2-of></p>
<p><a href="http://www.ibm.com/developerworks/cn/java/j-jtp04298.html" target="_blank" rel="external">http://www.ibm.com/developerworks/cn/java/j-jtp04298.html</a></p>
<p>set报错的原因是因为此时方法中的类型是不可具体化的(reified)，你可以传递一个String，Number，Book，等任何继承自Object的类作为List的参数类型给test方法，而list要求集合中的类型必须是一致的，set的时候没有办法保证set进去的数据类型是否和list中原本的类型一致，比如你传给test方法的是 List<book>， 那么在方法中set进去一个Object显然类型就不一致了。这也是通配符带来灵活性的同时所要付出的代价。</book></p>
<p>结论：使用了 &lt;? extends E&gt; 这样的通配符，test方法的参数list变成了只能get不能set（除了null） 或者不严谨的说它变成了只读参数了， 有些类似一个生产者，提供数据。</p>
<p>2) 当使用 Lower Bound 的通配符时：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test</span>(List&lt;? <span class="keyword">super</span> Number&gt; list){</div><div class="line">    Number n = list.get(<span class="number">0</span>);             <span class="comment">// 编译错误</span></div><div class="line">    Object o = list.get(<span class="number">0</span>);             <span class="comment">// OK</span></div><div class="line">    list.set(<span class="number">0</span>, <span class="keyword">new</span> Object());          <span class="comment">// 编译错误</span></div><div class="line">    list.set(<span class="number">0</span>, <span class="keyword">new</span> Long(<span class="number">0</span>));           <span class="comment">// OK</span></div><div class="line">    list.set(<span class="number">0</span>, <span class="keyword">new</span> Integer(<span class="number">0</span>));        <span class="comment">// OK</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>这时get只能get出最宽泛的父类型，即Object。</p>
<p>这时set的时候，必须是Number或Number的子类。</p>
<p>原因和上面的get类似。</p>
<p>结论： 使用了&lt;? super E&gt; 这种通配符，test方法的参数list的get受到了很大的制约，只能最宽泛的方式来获取list中的数据，相当于get只提供了数据最小级别的访问权限（想想，你可能原本是放进去了一个Book，却只能当作Object来访问）。它更多适合于set的使用场景，像是一个消费者，主要用来消费数据。</p>
<p>上面便是对通配符的使用原则的说明，简单的说 PECS原则是指导我们在泛型方法中使用通配符的直接原则。参数作为生产者使用&lt;? extends E&gt;，作为消费者时使用&lt;? super E&gt; 。</p>
<p>那么说完了PECS原则，我们再回过头来分析那两个复杂的泛型表达式是怎么含义</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">class Enum&lt;E extends Enum&lt;E&gt;&gt;</div></pre></td></tr></table></figure>

<p>它确实是一个 “递归类型限制”(recursive type bound)<br>要说明白这个问题，我们要先明白2点：</p>
<p>a) Enum可以理解为一组同一类型的有限的数据集合；</p>
<p>b) Java对Enum中的数据类型要求必须也是枚举类型（即必须是继承Enum类的）</p>
<p>对于 a) 我们先定义一个 Enum<t> 表明定义了T这种类型作为它内部的数据类型，这么看它就像个普通的集合。</t></p>
<p>再来根据 b) 定义类型E，要求E必须是继承自 Enum<t>，便成了 <e extends="" enum<t="">&gt;<br>实际上 E和T是一回事，它们是同一类型， 所以它就是 <e extends="" enum<e="">&gt;</e></e></t></p>
<p>暂停，可能我上面的表达不太合理可能会误人子弟，递归类型限制是有些抽象，它应该有严谨的数学描述，我想不清楚怎么表达，我先用另一个简单些例子来说明吧</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T extends Comparable&lt;T&gt;&gt; T <span class="title">max</span>(List&lt;T&gt; list)</div></pre></td></tr></table></figure>

<p>这个方法用来获取list 中的最大值，它定义了一个 <t extends="" comparable<t="">&gt; 的类型表达式</t></p>
<p>这个递归类型限制的表达式容易理解一些，</p>
<p><t extends="" comparable<t="">&gt; 表示的是：针对可以与自身进行比较的每个类型T。<br>或者说，每个实现了Comparable<t>接口的类型T，比如 String 实现了 Comparable<string> ， Long实现了Comparable<long>等等</long></string></t></t></p>
<p>而Enum因为使用enum关键字的原因，让我们忽略了它底层的实现其实也是</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">class EnumSample extends Enum&lt;EnumSample&gt;</div></pre></td></tr></table></figure>

<p>这一事实，比如我们定义了 BoundKind 这样的一个枚举：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">enum</span> BoundKind{ }</div></pre></td></tr></table></figure>

<p>编译器会转换为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">BoundKind</span> <span class="keyword">extends</span> <span class="title">java</span>.<span class="title">lang</span>.<span class="title">Enum</span>&lt;<span class="title">BoundKind</span>&gt;</span></div></pre></td></tr></table></figure>

<p>看到了，这和 String implements Comparable<string> 类似</string></p>
<p>这样我们套回到<e extends="" enum<e="">&gt; 就是 <boundkind extends="" enum<boundkind="">&gt;</boundkind></e></p>
<p>这下好理解了， <e extends="" enum<e="">&gt; 直接按字面理解：每个继承自Enum<e>的类型E，比如</e></e></p>
<p>BoundKind 继承了 Enum<boundkind></boundkind></p>
<p>通过与<t extends="" comparable<t="">&gt;的对比，我们可以理解 <e extends="" enum<e="">&gt;了。</e></t></p>
<p>那现在我们再回到Collections工具类中的max 方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T extends Object & Comparable&lt;? <span class="keyword">super</span> T&gt;&gt; </div><div class="line">                T <span class="title">max</span>(Collection&lt;? extends T&gt; coll) {</div></pre></td></tr></table></figure>

<p>我们先简化一下这个表达式，看看<t extends="" comparable<?="" super="" t="">&gt; 怎么理解？</t></p>
<p>既然 <t extends="" comparable<t="">&gt; 我们都理解了，把Comparable<t>改为</t></t></p>
<p>Comparable&lt;? super T&gt; 也没什么费解的</p>
<p>在《Java1.5 Generics Tutorial》一文中的解释是：<br>T 精确的(exactly)和自己能比较是不需要的。所需要的 是 T能 够和它的父类中的一个进行比较。</p>
<p>而《Effictive Java》第二版中对此是用 PECS原则来解释的：</p>
<p>下面是修改过的使用通配符类型的声明：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T extends Comparable&lt;? <span class="keyword">super</span> T&gt;&gt; </div><div class="line">               T <span class="title">max</span>(List&lt;? extends T&gt; list)</div></pre></td></tr></table></figure>

<p><em>为了从初始声明中得到修改后的版本，要应用PECS转换两次，最直接的是运用到参数List。它产生T实例，因此将类型从List改为List&lt;? extends T&gt;。（ok好理解）<br>。。。。。。<br>更灵活的是运用到类型参数T。最初T 被指定用来扩展Comparable，但是T的comparable消费T实例（并产生表示顺序关系的整值）。因此，参数化类型Comparable被有限制通配符类型Comparable&lt;? super T&gt;取代。comparable始终是消费者，因此使用时始终应该是Comparable&lt;? super T&gt; 优先于 Comparable。</em></p>
<p>蓝色粗体的那句翻译的不好。还是看一下代码来理解吧：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T extends Comparable&lt;? <span class="keyword">super</span> T&gt;&gt; </div><div class="line">            T <span class="title">max</span>(Collection&lt;? extends T&gt; coll) {</div><div class="line">    Iterator&lt;? extends T&gt; i = coll.iterator();</div><div class="line">    T candidate = i.next();</div><div class="line">    <span class="keyword">while</span> (i.hasNext()) {</div><div class="line">        T next = i.next();</div><div class="line">        <span class="keyword">if</span> (next.compareTo(candidate) &gt; <span class="number">0</span>) <span class="comment">// here comparaTo</span></div><div class="line">            candidate = next;</div><div class="line">    }</div><div class="line">    <span class="keyword">return</span> candidate;</div><div class="line">}</div></pre></td></tr></table></figure>

<p>第5行，Bloch认为 next.compareTo(cand) 是一句消费操作，在消费一个candidate对象时，根据PECS原则，candidate的类型应该使用 &lt;? super T&gt; 来提高它的灵活性。</p>
<p>我觉得Bloch将第5行当作消费操作挺别扭的，我个人偏向《Java1.5 Generics Tutorial》中的解释。<br>但归根到底，都是降低限制，提高比较时的灵活性。</p>
<p>最后，我们再来完整的理解：<t extends="" object="" &="" comparable<?="" super="" t="">&gt;<br>就只是比 &gt; 多了一个限制(bounds)。</t></p>
<p>Object &amp; Comparable&lt;? super T&gt; 是一个多限定(multiple bounds)的用法，</p>
<p>语法为： T1 &amp; T2 … &amp; Tn</p>
<p>一个有多个界限的类型的参数是所有界限中列出来的类型的子类。当多个界限被使用的时候，界限中的第一个类型被用作这个类型参数的erasure。</p>
<p>最终这个方法的返回值，按照第一个限定，擦拭为Object类型了。这是因为在以前版本中此方法就是返回的Object类型，需要兼容。</p>
<p>因为多限定（multiple bounds）的存在，泛型方法中又对应的增加了一个很不优雅的调用方式。下面用一段代码来说明:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericsTest</span> </span>{    </div><div class="line">    <span class="keyword">static</span> class Book {};</div><div class="line">    <span class="keyword">static</span> class StoryBook extends Book implements Comparable&lt;StoryBook&gt; {</div><div class="line">        <span class="annotation">@Override</span></div><div class="line">        <span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span>(StoryBook o) {</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>; <span class="comment">//FIXME</span></div><div class="line">        }};</div><div class="line">    <span class="keyword">static</span> class TechBook extends Book implements Comparable&lt;TechBook&gt; {</div><div class="line">        <span class="annotation">@Override</span></div><div class="line">        <span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span>(TechBook o) {</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>; <span class="comment">//FIXME</span></div><div class="line">        }};</div><div class="line"> </div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;E&gt; Set&lt;E&gt; <span class="title">merge</span>(Set&lt;? extends E&gt; s1, Set&lt;? extends E&gt; s2) {</div><div class="line">        HashSet&lt;E&gt; newSet = <span class="keyword">new</span> HashSet&lt;E&gt;(s1);</div><div class="line">        newSet.addAll(s2);</div><div class="line">        <span class="keyword">return</span> newSet;</div><div class="line">    }</div><div class="line"> </div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(String[] args) {</div><div class="line">        HashSet&lt;StoryBook&gt; s1 = <span class="keyword">new</span> HashSet&lt;StoryBook&gt;();</div><div class="line">        HashSet&lt;TechBook&gt; s2 = <span class="keyword">new</span> HashSet&lt;TechBook&gt;();</div><div class="line">        Set&lt;Book&gt; sb = merge(s1, s2); <span class="comment">// 错误</span></div><div class="line">        <span class="comment">// 需通过显式的类型参数(explicit type parameter)来告诉它要使用哪种类型</span></div><div class="line">        Set&lt;Book&gt; bs = GenericsTest.&lt;Book&gt;merge(s1,s2); <span class="comment">//OK</span></div><div class="line">        <span class="comment">// 或者</span></div><div class="line">        Set&lt;Comparable&lt;?&gt;&gt; s = GenericsTest.&lt;Comparable&lt;?&gt;&gt;merge(s1,s2);</div><div class="line">     }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>上面直接调用merge(s1,s2) 那行代码错误的提示信息：<br>Type mismatch: cannot convert from Set<genericstest.book&comparable<?>&gt; to Set<genericstest.book><br>这归于泛型的类型推导(type inference)，当无法推导出明确的类型时，就需要显式的描述，如上面代码中红色粗体字。</genericstest.book></genericstest.book&comparable<?></p>
<p>后注：<br>有关于 &lt;?&gt; 与 &lt;? extends Object&gt;是否是一回事<br>今天中午发现同事桌上有本《Java编程思想》第四版，随手翻了一下，发现泛型一章的介绍中，有句描述：“UnboundedWildcards.java 展示了编译器处理List&lt;?&gt;和List&lt;? Extends Object&gt;时是不同的。”<br>这让我奇怪，查看了一下它的代码，主要因为是对于Raw类型的造型为泛型时的警告信息不同。<br>将一个Raw的ArrayList造型给 List&lt;?&gt; 没有问题，而给List&lt;? Extends Object&gt;却会有警告。</p>
<p>在网上查了一下，发现对于&lt;?&gt;与&lt;? extends Object&gt;是否等同，是有些不同意见的。</p>
<p><a href="http://mail.openjdk.java.net/pipermail/compiler-dev/2008-April/000316.html" target="_blank" rel="external">http://mail.openjdk.java.net/pipermail/compiler-dev/2008-April/000316.html</a></p>
<p><a href="http://bugs.sun.com/view_bug.do?bug_id=6559175" target="_blank" rel="external">http://bugs.sun.com/view_bug.do?bug_id=6559175</a></p>
<p>这个报告里，有两段代码反映了两者的不同：<br>（1）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(String[] args)  {</div><div class="line">    Object  customer  = <span class="keyword">null</span>;</div><div class="line">    foo((List&lt;? extends String&gt;) customer ); <span class="comment">//[1]</span></div><div class="line">    foo((List&lt;? extends Object&gt;) customer ); <span class="comment">//[2] 编译有警告</span></div><div class="line">    foo((List&lt;?&gt;) customer ); <span class="comment">//[3]  编译没有警告</span></div><div class="line">}</div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">foo</span>(List&lt;?&gt; list) {</div><div class="line">}</div></pre></td></tr></table></figure>

<p>（2）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Object o2 = <span class="keyword">new</span> List&lt;?&gt;[<span class="number">3</span>];   <span class="comment">// 编译居然OK，估计直接当作Raw处理了</span></div><div class="line">Object o3 = <span class="keyword">new</span> List&lt;? extends Object&gt;[<span class="number">3</span>]; <span class="comment">// 报错</span></div></pre></td></tr></table></figure>

<p>上面两段代码，表明了当与Raw类型造型时，&lt;?&gt;在编译器的处理方式的确与&lt;? Extends Object&gt;有所不同，根据场景它可能被编译器忽略掉泛型信息而直接当作Raw类型，而&lt;? Extends Object&gt;则不会。</p>
<p>但这种差异，有些吹毛求疵，除了跟Raw类型转换方面存在差异，在语义上两者可以认为是完全等同的，见：<a href="http://bugs.sun.com/view_bug.do?bug_id=6480391" target="_blank" rel="external">http://bugs.sun.com/view_bug.do?bug_id=6480391</a></p>
<p><em>The introduction of the capture conversion simplified a lot of things. One of the things it did is make “?” equivalent to “? extends Object”. Unfortunately, JLS3 doesn’t say they are equivalent.</em></p>
<p>SUN的开发人员回复说：<br><em>? should be considered equivalent to ? extends Object. I will note this at the end of the text about bounds for wildcards in 4.5.1.<br>……<br>Hence, Foo&lt;?&gt; is semantically equivalent to Foo&lt;? extends Object&gt;</em></p>
<p>但查了一下发现目前 JLS3中还依然没有增加他说要加的那句注释，见：</p>
<p><a href="http://java.sun.com/docs/books/jls/third_edition/html/typesValues.html#4.5.1" target="_blank" rel="external">http://java.sun.com/docs/books/jls/third_edition/html/typesValues.html#4.5.1</a></p>
<p>我们暂从语义上认为两者相等。</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>






  
    <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <time datetime="2014-07-11T02:32:48.000Z"><a href="/2014/07/11/java-http/">7月 11 2014</a></time>
      
      
  
    <h1 class="title"><a href="/2014/07/11/java-http/">java中使HttpDelete可以发送body信息</a></h1>
  

    </header>
    <div class="entry">
      
        <p>RESTful api中用到了DELETE方法，android开发的同事遇到了问题，使用HttpDelete执行DELETE操作的时候，不能携带body信息，研究了很久之后找到了解决方法。 我们查看httpclient-4.2.3的源码可以发现，methods包下面包含HttpGet, HttpPost, HttpPut, HttpDelete等类来实现http的常用操作。 其中，HttpPost继承自HttpEntityEnclosingRequestBase，HttpEntityEnclosingRequestBase类又实现了HttpEntityEnclosingRequest接口，实现了setEntity的方法。 而HttpDelete继承自HttpRequestBase，没有实现setEntity的方法，因此无法设置HttpEntity对象。 这样解决方法就明显了，我们可以自己实现一个MyHttpDelete类，继承自HttpEntityEnclosingRequestBase，覆盖其中的getMethod方法，使其返回“DELETE”。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyHttpDelete</span> <span class="keyword">extends</span> <span class="title">HttpEntityEnclosingRequestBase</span> </span>{</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String METHOD_NAME = <span class="string">"DELETE"</span>;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> String <span class="title">getMethod</span>() {</div><div class="line">        <span class="keyword">return</span> METHOD_NAME;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="title">MyHttpDelete</span>(<span class="keyword">final</span> String uri) {</div><div class="line">        <span class="keyword">super</span>();</div><div class="line">        setURI(URI.create(uri));</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="title">MyHttpDelete</span>(<span class="keyword">final</span> URI uri) {</div><div class="line">        <span class="keyword">super</span>();</div><div class="line">        setURI(uri);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="title">MyHttpDelete</span>() {</div><div class="line">        <span class="keyword">super</span>();</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>使用delete方法时，直接可以按下面方式操作</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">DefaultHttpClient httpClient = <span class="keyword">new</span> DefaultHttpClient(); </div><div class="line"></div><div class="line">MyHttpDelete delete = <span class="keyword">new</span> MyHttpDelete(<span class="string">"http://url.com"</span>); </div><div class="line"></div><div class="line">List&lt;NameValuePair&gt; nameValuePairs = <span class="keyword">new</span> ArrayList&lt;NameValuePair&gt;(); </div><div class="line"></div><div class="line">delete.setEntity(<span class="keyword">new</span> UrlEncodedFormEntity(nameValuePairs)); </div><div class="line"></div><div class="line">HttpResponse response = httpClient.execute(delete);</div></pre></td></tr></table></figure>


      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>






  
    <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <time datetime="2014-06-27T01:52:00.000Z"><a href="/2014/06/27/linux-ps/">6月 27 2014</a></time>
      
      
  
    <h1 class="title"><a href="/2014/06/27/linux-ps/">按进程消耗内存多少排序</a></h1>
  

    </header>
    <div class="entry">
      
        <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ps -eo rss,pmem,pcpu,vsize,args |  sort -k <span class="number">1</span> -r -n | less</div></pre></td></tr></table></figure>

<p>解析一下：<br><code>ps</code> 都知道，是linux,unix显示进程信息的,<br><code>-e</code> 是显示所有进程,<br><code>-o</code>是定制显示信息的格式</p>
<p> <code>rss</code>: resident set size, 表示进程占用RAM(内存)的大小，单位是KB<br> <code>pmem</code>: %M, 占用内存的百分比 </p>
<p> <code>pcpu</code>：%C，占用cpu的百分比<br> <code>vsize</code>: 表示进程占用的虚拟内存的大小，KB</p>
<p> <code>args</code>：进程名（command） </p>
<p> <code>sort</code>命令对ps结果进行排序<br>   <code>-k 1</code>:按第一个参数 rss进行排序</p>
<p>   <code>-r</code>：逆序<br>   <code>-n</code>：numeric，按数字来排序</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>






  
    <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <time datetime="2014-06-18T08:15:01.000Z"><a href="/2014/06/18/hello/">6月 18 2014</a></time>
      
      
  
    <h1 class="title"><a href="/2014/06/18/hello/">tomcat关闭时dubbo consumer导致jvm进程无法退出的问题</a></h1>
  

    </header>
    <div class="entry">
      
        <p>在apache-tomcat托管的应用里如果使用了dubbo的消费端，关闭tomcat时，会无法退出进程，应用会被关闭，connector端口也关闭了，但dubbo相关的一些线程仍存在，导致java进程并不会消失。</p>
<p>这其实是由非daemon线程引起的，jvm里当前main线程在退出时，只要存在非daemon的子线程，就不会退出jvm，哪怕这个非daemon的线程是在一个daemon线程里启动的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DaemonTest</span> </span>{</div><div class="line"></div><div class="line">    <span class="keyword">static</span> class MyThread extends Thread {</div><div class="line">        <span class="keyword">public</span> <span class="title">MyThread</span>(<span class="keyword">boolean</span> isDaemon){</div><div class="line">            <span class="keyword">this</span>.setDaemon(isDaemon);</div><div class="line">        }</div><div class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span>(){</div><div class="line">            <span class="keyword">try</span> {</div><div class="line">                Thread.sleep(<span class="number">1000</span>*<span class="number">10000</span>);;</div><div class="line">            } <span class="keyword">catch</span> (Exception e) {</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(String[] args) <span class="keyword">throws</span> Exception{</div><div class="line">        Thread t1 = <span class="keyword">new</span> MyThread(<span class="keyword">true</span>);</div><div class="line">        Thread t2 = <span class="keyword">new</span> MyThread(<span class="keyword">true</span>);</div><div class="line">        Thread t3 = <span class="keyword">new</span> MyThread(<span class="keyword">true</span>);</div><div class="line">        Thread t4 = <span class="keyword">new</span> MyThread(<span class="keyword">true</span>) {</div><div class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span>() {</div><div class="line">                <span class="keyword">try</span> {</div><div class="line">                    <span class="keyword">new</span> MyThread(<span class="keyword">false</span>).start(); <span class="comment">//非daemon</span></div><div class="line">                    Thread.sleep(<span class="number">1000</span> * <span class="number">10000</span>);</div><div class="line">                } <span class="keyword">catch</span> (Exception e) {</div><div class="line">                }</div><div class="line">            }</div><div class="line">        };</div><div class="line"></div><div class="line"></div><div class="line">        t1.start();</div><div class="line">        t2.start();</div><div class="line">        t3.start();</div><div class="line">        t4.start();</div><div class="line"></div><div class="line">        Thread.sleep(<span class="number">2000</span>);</div><div class="line">        System.out.println(<span class="string">"main thread quit"</span>);</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>上面启动了4个子线程，都是daemon的，其中有一个子线程又启动了一个非daemon线程，结果主线程退出时，jvm进程并不会退出，并且其他daemon线程也继续运行。</p>
<p>Dubbo的线程都是daemon的，不过它使用的netty框架却有一个非daemon的“Hashed wheel timer”线程：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="string">"Hashed wheel timer #1"</span> #<span class="number">1582</span> prio=<span class="number">5</span> os_prio=<span class="number">0</span> tid=<span class="number">0x00002aaac5054800</span> nid=<span class="number">0x7fd3</span> waiting on condition [<span class="number">0x0000000041262000</span>]</div><div class="line">   java.lang.Thread.State: TIMED_WAITING (sleeping)</div><div class="line">    at java.lang.Thread.sleep(Native Method)</div><div class="line">    at org.jboss.netty.util.HashedWheelTimer$Worker.waitForNextTick(HashedWheelTimer.java:<span class="number">459</span>)</div><div class="line">    at org.jboss.netty.util.HashedWheelTimer$Worker.run(HashedWheelTimer.java:<span class="number">376</span>)</div><div class="line">    at org.jboss.netty.util.ThreadRenamingRunnable.run(ThreadRenamingRunnable.java:<span class="number">108</span>)</div><div class="line">    at java.lang.Thread.run(Thread.java:<span class="number">745</span>)</div></pre></td></tr></table></figure>

<p>正是这个非daemon线程，导致tomcat的主线程退出后，jvm进程没能退出。类似的问题以前在HSF2里也存在，后来已经解决了。dubbo的这个问题可以通过kill来结束。</p>
<p>在tomcat的脚本里，先使用正常的方式(viaport)停止tomcat，在不成功之后会尝试”kill”方式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"># stop failed. Shutdown port disabled? Try a normal kill.</div><div class="line"><span class="keyword">if</span> [ $? != <span class="number">0</span> ]; then</div><div class="line">    <span class="keyword">if</span> [ ! -z <span class="string">"$CATALINA_PID"</span> ]; then</div><div class="line">      echo <span class="string">"The stop command failed. Attempting to signal the process to stop through OS signal."</span></div><div class="line">      kill -<span class="number">15</span> `cat <span class="string">"$CATALINA_PID"</span>` &gt;/dev/<span class="keyword">null</span> <span class="number">2</span>&gt;&<span class="number">1</span></div><div class="line">    fi</div><div class="line">fi</div></pre></td></tr></table></figure>

<p>但这里的一个问题是”$CATALINA_PID”默认并没有被记录起来，所以没有执行kill，需要运维人员主意这一点。</p>
<p>// 补充<br>发现这个问题并不是一定发生的，只在dubbo发生了某种异常的情况下会有。正常情况下tomcat关闭(viaport方式)还是可以让jvm进程退出的(估计dubbo或netty有逻辑去处理那个timer线程），但这个异常是怎么回事产生的暂没有精力去跟踪了。</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>






  
    <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <time datetime="2014-06-18T07:38:56.000Z"><a href="/2014/06/18/javaScript-muban/">6月 18 2014</a></time>
      
      
  
    <h1 class="title"><a href="/2014/06/18/javaScript-muban/">javascript中实现简单的模板替换</a></h1>
  

    </header>
    <div class="entry">
      
        <p>最近搞了一下js，最不习惯的就是字符串生成都要用字符串拼装或者join的方式，所以尝试一下看能否实现简单的模板替换，效果还不错。</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">str_format</span><span class="params">(str, obj)</span> </span>{</div><div class="line">    <span class="keyword">return</span> str.replace(<span class="regexp">/\{\s*(\w+)\s*\}/g</span>, <span class="function"><span class="keyword">function</span><span class="params">(_i, _1)</span> </span>{</div><div class="line">        <span class="keyword">return</span> obj[_1] != <span class="literal">null</span> ? obj[_1] : <span class="string">''</span>;</div><div class="line">    });</div><div class="line">};</div></pre></td></tr></table></figure>

<p>很多朋友会说性能差一些，可能确实如此，不过对我来说，相比编写的舒适来说，这点性能差别实在无足轻重了。</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>






  
    <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <time datetime="2014-05-19T06:34:24.000Z"><a href="/2014/05/19/python1/">5月 19 2014</a></time>
      
      
  
    <h1 class="title"><a href="/2014/05/19/python1/">Python常见问题</a></h1>
  

    </header>
    <div class="entry">
      
        <h3 id="is_和_==_的区别_与_列表的赋值问题">is 和 == 的区别 与 列表的赋值问题</h3>
<p>is 与 == 所代表的含义不同，is 表示“是”，说明里那个对象所引用的区域是相同的，而 == 表示“值相等”。两者区别可以通过下面的代码看出来：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="prompt">&gt;&gt;&gt; </span>names= [<span class="string">"Daniel"</span>,<span class="string">"Jackie"</span>]</div><div class="line"><span class="prompt">&gt;&gt;&gt; </span>n = names</div><div class="line"><span class="prompt">&gt;&gt;&gt; </span>n <span class="keyword">is</span> names</div><div class="line"><span class="keyword">True</span></div><div class="line"><span class="prompt">&gt;&gt;&gt; </span>n == names</div><div class="line"><span class="keyword">True</span></div><div class="line"><span class="prompt">&gt;&gt;&gt; </span>m = names[:]</div><div class="line"><span class="prompt">&gt;&gt;&gt; </span>m <span class="keyword">is</span> names</div><div class="line"><span class="keyword">False</span></div><div class="line"><span class="prompt">&gt;&gt;&gt; </span>m == names</div><div class="line"><span class="keyword">True</span></div><div class="line"><span class="prompt">&gt;&gt;&gt; </span>n[<span class="number">0</span>] = <span class="string">'Json'</span></div><div class="line"><span class="prompt">&gt;&gt;&gt; </span>n</div><div class="line">[<span class="string">'Json'</span>, <span class="string">'Jackie'</span>]</div><div class="line"><span class="prompt">&gt;&gt;&gt; </span>names</div><div class="line">[<span class="string">'Json'</span>, <span class="string">'Jackie'</span>]</div><div class="line">&gt;&gt;&gt;</div></pre></td></tr></table></figure>

<p>当用 = 赋值时，names 与 n 引用同一块内存区域，所以names 与 n 是完全相同的，== 和 is 均返回True。所以改变 n[0] 会同时改变 names[0]的值，如代码最后一部分显示的一样。如果既想对列表进行改变值的操作，同时又希望保存旧版本供其他操作，这时候怎么办呢？这就需要复制整个列表的切片。如 m = names[ : ]   这样会产生一个names的副本，但是不是同一块内存区域，用 is 和 == 检查发现， is 返回 False ， == 返回 True 也可以说明这一点。</p>
<h3 id="字符串的格式化">字符串的格式化</h3>
<p>简单的字符串格式化</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; format = "Hello, %s. %s enough for ya?"</div><div class="line">&gt;&gt;&gt; values = ('world', 'Hot')</div><div class="line">&gt;&gt;&gt; print format % values</div><div class="line">Hello, world. Hot enough for ya?</div><div class="line">&gt;&gt;&gt;</div></pre></td></tr></table></figure>

<p>%s 为转换说明符，标记需要在此位置插入字符。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="prompt">&gt;&gt;&gt; </span><span class="string">'%10.8f'</span> % pi</div><div class="line"><span class="string">'3.14159265'</span></div><div class="line"><span class="prompt">&gt;&gt;&gt; </span><span class="string">'%.5s'</span> % <span class="string">'Daniel Hou'</span></div><div class="line"><span class="string">'Danie'</span></div><div class="line"><span class="prompt">&gt;&gt;&gt; </span><span class="string">'%.*s'</span> % (<span class="number">5</span>, <span class="string">'Daniel Hou'</span>)</div><div class="line"><span class="string">'Danie'</span></div><div class="line">&gt;&gt;&gt;</div></pre></td></tr></table></figure>

<p>%10.8f 10为宽度，不足时前面为空格，8为精度。 %.5s 则为从后面取出前5位，%.<em>s 中 </em>代表精度从后面的元组中读取。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="prompt">&gt;&gt;&gt; </span>phonebook = { <span class="string">'Hou'</span> : <span class="number">1234</span>, <span class="string">'Daniel'</span>:<span class="number">5678</span>}</div><div class="line"><span class="prompt">&gt;&gt;&gt; </span><span class="string">"Hou's phone is %(Hou)s."</span> % phonebook</div><div class="line"><span class="string">"Hou's phone is 1234."</span></div><div class="line">&gt;&gt;&gt;</div></pre></td></tr></table></figure>

<p>可以通过以上的方式来访问字典中的对应字段。括号中为字典的key     </p>
<h3 id="Python中的惰性求值">Python中的惰性求值</h3>
<p>在逻辑运算存在。例如， a and b ，当 a 为 False 时，直接返回 False ，不再运算 b； a or b，当为 a 为 True 时，直接返回 a 的值， 否则返回 b 的值。避免了代码的无用计算。运用以上的特性可以实现 java 中的三元运算符的功能。例如：a if b or c当 b 为 真时，返回 a，否则返回 c     </p>
<p>range的边界问题与xrange</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="prompt">&gt;&gt;&gt; </span>range(<span class="number">0</span>,<span class="number">10</span>)</div><div class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]</div><div class="line">&gt;&gt;&gt;</div></pre></td></tr></table></figure>

<p>可以看出，range不包含上界，相当于集合中的 [ a, b )xrang 函数作用类似于 range ，不同的地方在不 range 函数一次创建整个序列，而 xrange 一次只创建一个数，因此，需要迭代一个巨大的序列的时候， xrange 更加高效。</p>
<h3 id="递归">递归</h3>
<p>实现 n 的阶乘，一般实现：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="prompt">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">factorial</span><span class="params">(n)</span>:</span></div><div class="line">	result = n</div><div class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,n):</div><div class="line">		result *= i</div><div class="line">	<span class="keyword">return</span> result</div><div class="line"></div><div class="line"><span class="prompt">&gt;&gt;&gt; </span>factorial(<span class="number">10</span>)</div><div class="line"><span class="number">3628800</span></div><div class="line">&gt;&gt;&gt;</div></pre></td></tr></table></figure>

<p>递归实现：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="prompt">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">factorial</span><span class="params">(n)</span>:</span></div><div class="line">	<span class="keyword">if</span> n == <span class="number">1</span>:</div><div class="line">		<span class="keyword">return</span> <span class="number">1</span></div><div class="line">	<span class="keyword">else</span>:</div><div class="line">		<span class="keyword">return</span> n*factorial(n-<span class="number">1</span>)</div><div class="line"></div><div class="line">	</div><div class="line"><span class="prompt">&gt;&gt;&gt; </span>factorial(<span class="number">10</span>)</div><div class="line"><span class="number">3628800</span></div><div class="line">&gt;&gt;&gt;</div></pre></td></tr></table></figure>

<p>使用递归实现二分法查找（binary search）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">search</span><span class="params">(seq, num, lower=<span class="number">0</span>, upper=None)</span>:</span></div><div class="line">    upper = len(seq) - <span class="number">1</span></div><div class="line">    <span class="keyword">if</span> lower == upper :</div><div class="line">        <span class="keyword">return</span> lower</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        middle = (lower + upper) // <span class="number">2</span></div><div class="line">        <span class="keyword">if</span> num &gt; seq[middle]:</div><div class="line">            <span class="keyword">return</span> search(seq, num, middle + <span class="number">1</span>, upper)</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            <span class="keyword">return</span> search(seq, num, lower, middle)</div><div class="line"></div><div class="line">seq = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>]</div><div class="line"><span class="keyword">print</span> search(seq, <span class="number">7</span>)</div></pre></td></tr></table></figure>


      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>






  
    <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <time datetime="2014-05-17T05:42:35.000Z"><a href="/2014/05/17/javascript/">5月 17 2014</a></time>
      
      
  
    <h1 class="title"><a href="/2014/05/17/javascript/">Java Script 编码规范</a></h1>
  

    </header>
    <div class="entry">
      
        <p>以下文档大多来自:</p>
<ul>
<li><a href="http://wyz.67ge.com/google-js/javascriptguide.xml" target="_blank" rel="external">Google JavaScript 编码规范指南</a></li>
<li><a href="https://github.com/rwldrn/idiomatic.js/tree/master/translations/zh_CN" target="_blank" rel="external">Idiomatic 风格</a></li>
</ul>
<p>参考规范</p>
<ul>
<li><a href="http://es5.github.com/" target="_blank" rel="external">ECMAScript 5.1 注解版</a></li>
<li><a href="http://ecma-international.org/ecma-262/5.1/" target="_blank" rel="external">EcmaScript 语言规范, 5.1 版</a><br>基本原则: 无论有多少人在维护，所有在代码仓库中的代码理应看起来像同一个人写的。</li>
</ul>
<h3 id="前言">前言</h3>
<p>下面的章节描述的是一个 合理 的现代 JavaScript 开发风格指南，并非硬性规定。其想送出的核心理念是高度统一的代码风格（the law of code style consistency）。你为项目所择风格都应为最高准则。作为一个描述放置于你的项目中，并链接到这个文档作为代码风格一致性、可读性和可维护性的保证。</p>
<h3 id="规范概要">规范概要</h3>
<h4 id="1-_JS/CSS_文件编码统一采用_UTF8编码">1. JS/CSS 文件编码统一采用 UTF8编码</h4>
<h4 id="2-_代码缩进使用4个空格缩进替代_tab_缩进">2. 代码缩进使用4个空格缩进替代 tab 缩进</h4>
<h4 id="3-_一行代码长度尽量保持80列左右">3. 一行代码长度尽量保持80列左右</h4>
<h4 id="4-_如果编辑器支持在文件保存的时候自动删除行末和空行中的空格(注意:要么全部采用，要么全不采用，否则会产生过多的diff信息)">4. 如果编辑器支持在文件保存的时候自动删除行末和空行中的空格(注意:要么全部采用，要么全不采用，否则会产生过多的diff信息)</h4>
<h4 id="5-_JS/CSS_最终发布到产品中的时候需要被压缩，以减小静态资源文件大小，提升页面加载速度">5. JS/CSS 最终发布到产品中的时候需要被压缩，以减小静态资源文件大小，提升页面加载速度</h4>
<h4 id="6-_JS里声明变量必须加上_var_关键字，推荐一个_var_同时声明多个变量，或者一组有逻辑关系的变量，避免一个变量一个_var-">6. JS里声明变量必须加上 var 关键字，推荐一个 var 同时声明多个变量，或者一组有逻辑关系的变量，避免一个变量一个 var.</h4>
<h4 id="7-_使用_Array_和_Object_语法直接声明并将其初始化,更易读且性能更好,_而不使用_Array_和_Object_构造器-">7. 使用 Array 和 Object 语法直接声明并将其初始化,更易读且性能更好, 而不使用 Array 和 Object 构造器.</h4>
<h4 id="8-_JS里使用单引号_(‘)_优于双引号_(“)-">8. JS里使用单引号 (‘) 优于双引号 (“).</h4>
<h4 id="9-_JS代码结尾统一约定加’;’">9. JS代码结尾统一约定加’;’</h4>
<h4 id="10-_没有特殊原因避免使用_with/eval">10. 没有特殊原因避免使用 with/eval</h4>
<h4 id="11-_对于if/else等后面的语句即使只有一行代码也需要在该行代码的首尾加上’{}’-">11. 对于if/else等后面的语句即使只有一行代码也需要在该行代码的首尾加上’{}’.</h4>
<h4 id="12-_字符串拼接在少量(次数为个位数)的情况下可以使用’+’,_大量的时候使用数组_join(),_或者尽可能采用模板引擎渲染：比如jsRender等,_如果是Extjs可以采用XTemplate-">12. 字符串拼接在少量(次数为个位数)的情况下可以使用’+’, 大量的时候使用数组 join(), 或者尽可能采用模板引擎渲染：比如jsRender等, 如果是Extjs可以采用XTemplate.</h4>
<h4 id="13-_对于数组赋值操作快于_push()操作,_所以尽量使用赋值操作-">13. 对于数组赋值操作快于 push()操作, 所以尽量使用赋值操作.</h4>
<h4 id="14-_for循环遍历：for(var_i_=_0,_l_=_arr-length;_i_&lt;_l;_i++){//_doSomething_here_}_采用这种方式而不是_i_&lt;_arr-length,_前一种方式只会计算一次_arr_的长度，而后一种方式会计算数组长度_arr-length_+_1_次，效率比较低">14. for循环遍历：for(var i = 0, l = arr.length; i &lt; l; i++){// doSomething here } 采用这种方式而不是 i &lt; arr.length, 前一种方式只会计算一次 arr 的长度，而后一种方式会计算数组长度 arr.length + 1 次，效率比较低</h4>
<h4 id="15-_字符串转换为整数，推荐使用_parseInt(num,_10)_这种方式，+num_写法简单，在操作次数极少的情况下也可以酌情使用。">15. 字符串转换为整数，推荐使用 parseInt(num, 10) 这种方式，+num 写法简单，在操作次数极少的情况下也可以酌情使用。</h4>
<h4 id="16-_变量比较的时候总是判断最好、最精确的值，推荐使用’===’少用’==’(可以参考jQuery代码里面,_可以看到只有在’==_null’的时候才可能使用’==’，其他情况一律使用的是’===’)-">16. 变量比较的时候总是判断最好、最精确的值，推荐使用’===’少用’==’(可以参考jQuery代码里面, 可以看到只有在’== null’的时候才可能使用’==’，其他情况一律使用的是’===’).</h4>
<h4 id="17-_JS里变量命名规范使用_functionNamesLikeThis,_variableNamesLikeThis,_ClassNamesLikeThis,_EnumNamesLikeThis,_methodNamesLikeThis,_和_SYMBOLIC_CONSTANTS_LIKE_THIS,_尤其不要跟python里面的变量命名方式混淆了-">17. JS里变量命名规范使用 functionNamesLikeThis, variableNamesLikeThis, ClassNamesLikeThis, EnumNamesLikeThis, methodNamesLikeThis, 和 SYMBOLIC_CONSTANTS_LIKE_THIS, 尤其不要跟python里面的变量命名方式混淆了.</h4>
<h4 id="18-_JS文件名应该使用小写字符,_以避免在有些系统平台上不识别大小写的命名方式-_文件名以-js结尾,_不要包含除_‘-‘_和_‘‘_外的标点符号(使用_‘-‘_优于_‘‘),_我们约定统一使用js-file-name-js这种类型，对于template文件命名方式为_template_name-html形式-">18. JS文件名应该使用小写字符, 以避免在有些系统平台上不识别大小写的命名方式. 文件名以.js结尾, 不要包含除 ‘-‘ 和 ‘‘ 外的标点符号(使用 ‘-‘ 优于 ‘‘), 我们约定统一使用js-file-name.js这种类型，对于template文件命名方式为 template_name.html形式.</h4>
<h4 id="19-_所有的html_DOM里面的id,_Extjs配置项里面的id_以及所有样式里面的_class命名使用中划线，如’id-name’/‘class-name’-">19. 所有的html DOM里面的id, Extjs配置项里面的id 以及所有样式里面的 class命名使用中划线，如’id-name’/‘class-name’.</h4>
<h4 id="20-公共的js第三方类库放在static/js/common/lib下，jQuery相关类库放在static/js/common/lib/jQplugin下，我们自己开发的公共类库放在static/js/common下">20.公共的js第三方类库放在static/js/common/lib下，jQuery相关类库放在static/js/common/lib/jQplugin下，我们自己开发的公共类库放在static/js/common下</h4>
<h4 id="21-_鉴于有很多代码是复制粘贴过来的，所以大家要保证自己的代码风格良好且易于阅读，不然别人拷过去后不好的风格就蔓延开了，而且会导致其他人效仿。">21. 鉴于有很多代码是复制粘贴过来的，所以大家要保证自己的代码风格良好且易于阅读，不然别人拷过去后不好的风格就蔓延开了，而且会导致其他人效仿。</h4>
<h4 id="22-_对于复制粘贴然后做相应修改以实现功能的代码，请务必清理干净，不要有’忘了删除的不影响逻辑的代码’，同时记得将变量名改成适合当前业务场景的有意义的变量名,_不要因为不影响逻辑就保留原来的不适合当前场景的名字">22. 对于复制粘贴然后做相应修改以实现功能的代码，请务必清理干净，不要有’忘了删除的不影响逻辑的代码’，同时记得将变量名改成适合当前业务场景的有意义的变量名, 不要因为不影响逻辑就保留原来的不适合当前场景的名字</h4>
<h4 id="23-_对于系统中出现的大段注释的、过时的、废弃的代码务必及时清理干净，谁制造谁清理，否则其他人也不敢清理，越积越多">23. 对于系统中出现的大段注释的、过时的、废弃的代码务必及时清理干净，谁制造谁清理，否则其他人也不敢清理，越积越多</h4>
<h4 id="24-_不要使用魔法数字，尽量定义一个常量来表示该数字，并加上相应的注释，否则后期可能出现因为数字变化而导致牵一发而动全身，需要到处修改，增加维护成本">24. 不要使用魔法数字，尽量定义一个常量来表示该数字，并加上相应的注释，否则后期可能出现因为数字变化而导致牵一发而动全身，需要到处修改，增加维护成本</h4>
<h4 id="25-_注释尽量采用jsdoc的代码注释风格，普通业务代码不做要求，不过通用js类库要求尽量详尽以方便其他人阅读使用">25. 注释尽量采用jsdoc的代码注释风格，普通业务代码不做要求，不过通用js类库要求尽量详尽以方便其他人阅读使用</h4>
<h4 id="26-_在开发相应功能的时候尽量抽象化、组件化、通用化：考虑这个东西其他地方会不会用到，能不能做成一个组件？而不是类似的代码到处复制、修改或者让大家都去写一遍">26. 在开发相应功能的时候尽量抽象化、组件化、通用化：考虑这个东西其他地方会不会用到，能不能做成一个组件？而不是类似的代码到处复制、修改或者让大家都去写一遍</h4>
<h4 id="27-_类似地，在解决问题的时候要考虑下其他地方会不会存在同样的问题？能不能统一解决掉？尤其对于类似ExtJs的Bug这种，能不能做最少的改动解决所有同样的问题,类似于全局补丁-">27. 类似地，在解决问题的时候要考虑下其他地方会不会存在同样的问题？能不能统一解决掉？尤其对于类似ExtJs的Bug这种，能不能做最少的改动解决所有同样的问题,类似于全局补丁.</h4>
<h4 id="28-_代码风格跟其他JS文件的代码风格保持一致">28. 代码风格跟其他JS文件的代码风格保持一致</h4>
<h4 id="29-_新增、修改、查看等表单在_popup的时候需要重新初始化清除原来数据">29. 新增、修改、查看等表单在 popup的时候需要重新初始化清除原来数据</h4>
<h4 id="30-_代码提交前用JSHint检查一下">30. 代码提交前用JSHint检查一下</h4>
<h3 id="前端资源Build">前端资源Build</h3>
<p>项目必须总是提供一些通用的方法来检验（can be linted）、测试和压缩源码以为产品阶段使用做准备。对于此类工作 Ben Alman 所写的 <a href="https://github.com/cowboy/grunt" target="_blank" rel="external">grunt</a> 可谓首屈一指。通过简单的配置即可完成自动对CSS进行检查/压缩/合并，对JS进行检查/压缩/合并，对html文件进行压缩，删除创建目录，拷贝文件，压缩打包等，十分方便。</p>
<p>参考的grunt配置文件:</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Grunt file for front end resource check/minify/compress.</div><div class="line"> */</div><div class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span><span class="params">(grunt)</span> </span>{</div><div class="line">  grunt.initConfig({</div><div class="line">    pkg: grunt.file.readJSON(<span class="string">'package.json'</span>),</div><div class="line">    jshint: {</div><div class="line">      options: {</div><div class="line">        asi       : <span class="literal">true</span>,</div><div class="line">        curly     : <span class="literal">false</span>,</div><div class="line">        eqeqeq    : <span class="literal">true</span>,</div><div class="line">        immed     : <span class="literal">false</span>,</div><div class="line">        latedef   : <span class="literal">true</span>,</div><div class="line">        newcap    : <span class="literal">true</span>,</div><div class="line">        noarg     : <span class="literal">true</span>,</div><div class="line">        sub       : <span class="literal">true</span>,</div><div class="line">        undef     : <span class="literal">true</span>,</div><div class="line">        boss      : <span class="literal">true</span>,</div><div class="line">        eqnull    : <span class="literal">true</span>,</div><div class="line">        smarttabs : <span class="literal">true</span>,</div><div class="line">        browser   : <span class="literal">true</span>,</div><div class="line">        jquery    : <span class="literal">true</span>,</div><div class="line">        white     : <span class="literal">false</span>,</div><div class="line">        laxbreak  : <span class="literal">false</span>,</div><div class="line">        laxcomma  : <span class="literal">true</span>,</div><div class="line">        expr      : <span class="literal">true</span>,</div><div class="line">        devel     : <span class="literal">false</span>,</div><div class="line">        globals   : {</div><div class="line">          <span class="built_in">module</span>    : <span class="literal">true</span>,</div><div class="line">          Mousetrap : <span class="literal">true</span>,</div><div class="line">          jQuery    : <span class="literal">true</span></div><div class="line">        }</div><div class="line">      },</div><div class="line">      all: [<span class="string">'Gruntfile.js'</span>, <span class="string">'js/**/*.js'</span>, <span class="string">'!js/**/*.min.js'</span>, <span class="string">'!js/json2.js'</span>, <span class="string">'!js/jquery.simplemodal.js'</span>]</div><div class="line">    },</div><div class="line">    clean: {</div><div class="line">      release: {</div><div class="line">        src: [<span class="string">'release/'</span>]</div><div class="line">      }</div><div class="line">    },</div><div class="line">    uglify: {</div><div class="line">      options: {</div><div class="line">        banner: <span class="string">'/*! &lt;%= pkg.description %&gt;  Ver: &lt;%= pkg.version %&gt;  Date: &lt;%= grunt.template.today("yyyy/mm/dd HH:MM:ss") %&gt; */\n'</span></div><div class="line">      },</div><div class="line">      dist: {</div><div class="line">        <span class="comment">// Grunt will search for "**/?.js" under "js/" when the "uglify" task</span></div><div class="line">        <span class="comment">// runs and build the appropriate src-dest file mappings then, so you</span></div><div class="line">        <span class="comment">// don't need to update the Gruntfile when files are added or removed.</span></div><div class="line">        files: [</div><div class="line">          {</div><div class="line">            expand : <span class="literal">true</span>,                                  <span class="comment">// Enable dynamic expansion.</span></div><div class="line">            cwd    : <span class="string">'js/'</span>,                                 <span class="comment">// Src matches are relative to this path.</span></div><div class="line">            src    : [<span class="string">'jquery.simplemodal.js'</span>,<span class="string">'index.js'</span>],  <span class="comment">// Actual pattern(s) to match.</span></div><div class="line">            dest   : <span class="string">'release/js/'</span>                          <span class="comment">// Destination path prefix.</span></div><div class="line">            <span class="comment">// ext : '.js'                                  // Dest filepaths will have this extension. '.min.js' is recommeded.</span></div><div class="line">          }</div><div class="line">        ]</div><div class="line">      }</div><div class="line">    },</div><div class="line">    cssmin: {</div><div class="line">      minify: {</div><div class="line">        expand : <span class="literal">true</span>,</div><div class="line">        cwd    : <span class="string">'style/'</span>,</div><div class="line">        src    : [<span class="string">'*.css'</span>],</div><div class="line">        dest   : <span class="string">'release/style/'</span>,</div><div class="line">        ext    : <span class="string">'.css'</span></div><div class="line">      }</div><div class="line">    },</div><div class="line">    htmlmin: {                                     <span class="comment">// Task</span></div><div class="line">      dist: {                                      <span class="comment">// Target</span></div><div class="line">        options: {                                 <span class="comment">// Target options</span></div><div class="line">          removeComments: <span class="literal">true</span>,</div><div class="line">          collapseWhitespace: <span class="literal">true</span></div><div class="line">        },</div><div class="line">        files: {                                   <span class="comment">// Dictionary of files</span></div><div class="line">          <span class="string">'release/index.html'</span>: <span class="string">'index.html'</span>       <span class="comment">// 'destination': 'source'</span></div><div class="line">        }</div><div class="line">      }</div><div class="line">    },</div><div class="line">    copy: {</div><div class="line">      main: {</div><div class="line">        files: [</div><div class="line">          {expand: <span class="literal">true</span>, cwd: <span class="string">'.'</span>, src: [<span class="string">'js/*.min.js'</span>, <span class="string">'js/json2.js'</span>, <span class="string">'images/*'</span>], dest: <span class="string">'release/'</span>}</div><div class="line">        ]</div><div class="line">      }</div><div class="line">    },</div><div class="line">    compress: {</div><div class="line">      main: {</div><div class="line">        options: {</div><div class="line">          archive: <span class="string">'release/executable.zip'</span>         <span class="comment">// make a zipfile</span></div><div class="line">        },</div><div class="line">        files: [</div><div class="line">          <span class="comment">// {src: ['release/**'], dest: 'release/'},                        // includes files in path and its subdirs</span></div><div class="line">          {expand: <span class="literal">true</span>, cwd: <span class="string">'release/'</span>, src: [<span class="string">'**'</span>], dest: <span class="string">'executable/'</span>}  <span class="comment">// makes all src relative to cwd</span></div><div class="line">        ]</div><div class="line">      }</div><div class="line">    }</div><div class="line">  });</div><div class="line">  grunt.loadNpmTasks(<span class="string">'grunt-contrib-jshint'</span>);</div><div class="line">  grunt.loadNpmTasks(<span class="string">'grunt-contrib-clean'</span>);</div><div class="line">  grunt.loadNpmTasks(<span class="string">'grunt-contrib-uglify'</span>);</div><div class="line">  grunt.loadNpmTasks(<span class="string">'grunt-contrib-cssmin'</span>);</div><div class="line">  grunt.loadNpmTasks(<span class="string">'grunt-contrib-htmlmin'</span>);</div><div class="line">  grunt.loadNpmTasks(<span class="string">'grunt-contrib-copy'</span>);</div><div class="line">  grunt.loadNpmTasks(<span class="string">'grunt-contrib-compress'</span>);</div><div class="line">  grunt.registerTask(<span class="string">'min'</span>    , [<span class="string">'clean'</span>, <span class="string">'uglify'</span>, <span class="string">'cssmin'</span>, <span class="string">'htmlmin'</span>, <span class="string">'copy'</span>, <span class="string">'compress'</span>]);</div><div class="line">  grunt.registerTask(<span class="string">'check'</span>  , [<span class="string">'jshint'</span>]);</div><div class="line">  grunt.registerTask(<span class="string">'default'</span>, [<span class="string">'jshint'</span>, <span class="string">'clean'</span>, <span class="string">'uglify'</span>, <span class="string">'cssmin'</span>, <span class="string">'htmlmin'</span>, <span class="string">'copy'</span>, <span class="string">'compress'</span>]);</div><div class="line">};</div></pre></td></tr></table></figure>

<h3 id="规范详情">规范详情</h3>
<p>JavaScript 编码风格</p>
<p>空白<br><em>永远都不要混用空格和Tab。
</em>开始一个项目，在写代码之前，选择软缩进（空格）或者 Tab（作为缩进方式），并将其作为最高准则。<br>    <em>为了可读, 我总是推荐在你的编辑中设计4个字母宽度的缩进 — 这等同于四个空格或者四个空格替代一个 Tab。
</em>如果你的编辑器支持，请总是打开 “显示不可见字符” 这个设置。好处是：<br>    <em>保证一致性
    </em>去掉行末的空格<br>    <em>去掉空行的空格
    </em>提交和对比更具可读性</p>
<p>行末和空行<br>留白会破坏 diff 并使diff 结果变得更不可读。考虑包括一个预提交的 hook 自动删除行末和空行中的空格。<br>花括号, 换行</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// if/else/for/while/try 通常都有小括号、花括号和多行</span></div><div class="line"><span class="comment">// 这有助于可读, 以下是很糟糕的写法</span></div><div class="line"><span class="keyword">if</span>(condition) doSomething();</div><div class="line"><span class="keyword">while</span>(condition) iterating++;</div><div class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">100</span>;i++) someIterativeFn();</div></pre></td></tr></table></figure>

<p>命名</p>
<p>通常, 使用 functionNamesLikeThis, variableNamesLikeThis, ClassNamesLikeThis, EnumNamesLikeThis, methodNamesLikeThis, 和 SYMBOLIC_CONSTANTS_LIKE_THIS.</p>
<p>属性和方法</p>
<p>文件或类中的 私有 属性, 变量和方法名应该以下划线 “_” 开头.<br>保护 属性, 变量和方法名不需要下划线开头, 和公共变量名一样.</p>
<p>方法和函数参数</p>
<p>可选参数以 opt_ 开头.<br>函数的参数个数不固定时, 应该添加最后一个参数 var_args 为参数的个数. 你也可以不设置 var_args而取代使用 arguments.<br>可选和可变参数应该在 @param 标记中说明清楚. 虽然这两个规定对编译器没有任何影响, 但还是请尽量遵守<br>Getters 和 Setters<br>Getters 和 setters 并不是必要的. 但只要使用它们了, 就请将 getters 命名成 getFoo() 形式, 将 setters 命名成 setFoo(value) 形式. (对于布尔类型的 getters, 使用 isFoo() 也可.)</p>
<p>命名空间</p>
<p>JavaScript 不支持包和命名空间.<br>不容易发现和调试全局命名的冲突, 多个系统集成时还可能因为命名冲突导致很严重的问题. 为了提高 JavaScript 代码复用率, 我们遵循下面的约定以避免冲突.<br>为全局代码使用命名空间<br>在全局作用域上, 使用一个唯一的, 与工程/库相关的名字作为前缀标识. 比如, 你的工程是 “Project Sloth”, 那么命名空间前缀可取为 sloth.*.</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> sloth = {};</div><div class="line">sloth.sleep = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">  ...</div><div class="line">};</div></pre></td></tr></table></figure>

<p>许多 JavaScript 库, 包括 the Closure Library and Dojo toolkit 为你提供了声明你自己的命名空间的函数. 比如:</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">goog.provide(<span class="string">'sloth'</span>);</div><div class="line">sloth.sleep = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">  ...</div><div class="line">};</div></pre></td></tr></table></figure>

<p>明确命名空间所有权<br>当选择了一个子命名空间, 请确保父命名空间的负责人知道你在用哪个子命名空间, 比如说, 你为工程 ‘sloths’ 创建一个 ‘hats’ 子命名空间, 那确保 Sloth 团队人员知道你在使用 sloth.hats.<br>外部代码和内部代码使用不同的命名空间<br>“外部代码” 是指来自于你代码体系的外部, 可以独立编译. 内外部命名应该严格保持独立. 如果你使用了外部库, 他的所有对象都在 foo.hats. 下, 那么你自己的代码不能在 foo.hats.下命名, 因为很有可能其他团队也在其中命名.</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">foo.require(<span class="string">'foo.hats'</span>);</div><div class="line"><span class="comment">/**</span></div><div class="line"> * WRONG -- Do NOT do this.</div><div class="line"> * @constructor</div><div class="line"> * @extend {foo.hats.RoundHat}</div><div class="line"> */</div><div class="line">foo.hats.BowlerHat = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">};</div></pre></td></tr></table></figure>

<p>重命名那些名字很长的变量, 提高可读性<br>主要是为了提高可读性. 局部空间中的变量别名只需要取原名字的最后部分.</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * @constructor</div><div class="line"> */</div><div class="line">some.long.namespace.MyClass = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">};</div><div class="line"><span class="comment">/**</span></div><div class="line"> * @param {some.long.namespace.MyClass} a</div><div class="line"> */</div><div class="line">some.long.namespace.MyClass.staticHelper = <span class="function"><span class="keyword">function</span><span class="params">(a)</span> </span>{</div><div class="line">  ...</div><div class="line">};</div><div class="line">myapp.main = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">  <span class="keyword">var</span> MyClass = some.long.namespace.MyClass;</div><div class="line">  <span class="keyword">var</span> staticHelper = some.long.namespace.MyClass.staticHelper;</div><div class="line">  staticHelper(<span class="keyword">new</span> MyClass());</div><div class="line">};</div></pre></td></tr></table></figure>

<p>除非是枚举类型, 不然不要访问别名变量的属性.</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/** @enum {string} */</span></div><div class="line">some.long.namespace.Fruit = {</div><div class="line">  APPLE: <span class="string">'a'</span>,</div><div class="line">  BANANA: <span class="string">'b'</span></div><div class="line">};</div><div class="line">myapp.main = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">  <span class="keyword">var</span> Fruit = some.long.namespace.Fruit;</div><div class="line">  <span class="keyword">switch</span> (fruit) {</div><div class="line">    <span class="keyword">case</span> Fruit.APPLE:</div><div class="line">      ...</div><div class="line">    <span class="keyword">case</span> Fruit.BANANA:</div><div class="line">      ...</div><div class="line">  }</div><div class="line">};</div><div class="line">myapp.main = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">  <span class="keyword">var</span> MyClass = some.long.namespace.MyClass;</div><div class="line">  MyClass.staticHelper(<span class="literal">null</span>);</div><div class="line">};</div></pre></td></tr></table></figure>

<p>不要在全局范围内创建别名, 而仅在函数块作用域中使用.<br>文件名<br>文件名应该使用小写字符, 以避免在有些系统平台上不识别大小写的命名方式. 文件名以.js结尾, 不要包含除 - 和 外的标点符号(使用 - 优于 ).<br>自定义 toString() 方法<br>应该总是成功调用且不要抛异常.<br>可自定义 toString() 方法, 但确保你的实现方法满足: (1) 总是成功 (2) 没有其他负面影响. 如果不满足这两个条件, 那么可能会导致严重的问题, 比如, 如果 toString() 调用了包含 assert 的函数, assert 输出导致失败的对象, 这在 toString() 也会被调用.<br>延迟初始化<br>可以<br>没必要在每次声明变量时就将其初始化.<br>明确作用域<br>任何时候都需要<br>任何时候都要明确作用域 - 提高可移植性和清晰度. 例如, 不要依赖于作用域链中的 window 对象. 可能在其他应用中, 你函数中的 window 不是指之前的那个窗口对象.<br>代码格式化<br>大括号<br>分号会被隐式插入到代码中, 所以你务必在同一行上插入大括号. 例如:</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (something) {</div><div class="line">  <span class="comment">// ...</span></div><div class="line">} <span class="keyword">else</span> {</div><div class="line">  <span class="comment">// ...</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>数组和对象的初始化<br>如果初始值不是很长, 就保持写在单行上:</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];  <span class="comment">// No space after [ or before ].</span></div><div class="line"><span class="keyword">var</span> obj = {a: <span class="number">1</span>, b: <span class="number">2</span>, c: <span class="number">3</span>};  <span class="comment">// No space after { or before }.</span></div></pre></td></tr></table></figure>

<p>初始值占用多行时, 缩进2个空格.</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Object initializer.</span></div><div class="line"><span class="keyword">var</span> inset = {</div><div class="line">  top: <span class="number">10</span>,</div><div class="line">  right: <span class="number">20</span>,</div><div class="line">  bottom: <span class="number">15</span>,</div><div class="line">  left: <span class="number">12</span></div><div class="line">};</div><div class="line"><span class="comment">// Array initializer.</span></div><div class="line"><span class="keyword">this</span>.rows_ = [</div><div class="line">  <span class="string">'"Slartibartfast" &lt;fjordmaster@magrathea.com&gt;'</span>,</div><div class="line">  <span class="string">'"Zaphod Beeblebrox" &lt;theprez@universe.gov&gt;'</span>,</div><div class="line">  <span class="string">'"Ford Prefect" &lt;ford@theguide.com&gt;'</span>,</div><div class="line">  <span class="string">'"Arthur Dent" &lt;has.no.tea@gmail.com&gt;'</span>,</div><div class="line">  <span class="string">'"Marvin the Paranoid Android" &lt;marv@googlemail.com&gt;'</span>,</div><div class="line">  <span class="string">'the.mice@magrathea.com'</span></div><div class="line">];</div><div class="line"><span class="comment">// Used in a method call.</span></div><div class="line">goog.dom.createDom(goog.dom.TagName.DIV, {</div><div class="line">  id: <span class="string">'foo'</span>,</div><div class="line">  className: <span class="string">'some-css-class'</span>,</div><div class="line">  style: <span class="string">'display:none'</span></div><div class="line">}, <span class="string">'Hello, world!'</span>);</div></pre></td></tr></table></figure>

<p>函数参数<br>尽量让函数参数在同一行上. 如果一行超过 80 字符, 每个参数独占一行, 并以4个空格缩进, 或者与括号对齐, 以提高可读性. 尽可能不要让每行超过80个字符. 比如下面这样:</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Four-space, wrap at 80.  Works with very long function names, survives</span></div><div class="line"><span class="comment">// renaming without reindenting, low on space.</span></div><div class="line">goog.foo.bar.doThingThatIsVeryDifficultToExplain = <span class="function"><span class="keyword">function</span><span class="params">(</span></span></div><div class="line">    veryDescriptiveArgumentNumberOne, veryDescriptiveArgumentTwo,</div><div class="line">    tableModelEventHandlerProxy, artichokeDescriptorAdapterIterator) {</div><div class="line">  <span class="comment">// ...</span></div><div class="line">};</div><div class="line"><span class="comment">// Four-space, one argument per line.  Works with long function names,</span></div><div class="line"><span class="comment">// survives renaming, and emphasizes each argument.</span></div><div class="line">goog.foo.bar.doThingThatIsVeryDifficultToExplain = <span class="function"><span class="keyword">function</span><span class="params">(</span></span></div><div class="line">    veryDescriptiveArgumentNumberOne,</div><div class="line">    veryDescriptiveArgumentTwo,</div><div class="line">    tableModelEventHandlerProxy,</div><div class="line">    artichokeDescriptorAdapterIterator) {</div><div class="line">  <span class="comment">// ...</span></div><div class="line">};</div><div class="line"><span class="comment">// Parenthesis-aligned indentation, wrap at 80.  Visually groups arguments,</span></div><div class="line"><span class="comment">// low on space.</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span><span class="params">(veryDescriptiveArgumentNumberOne, veryDescriptiveArgumentTwo,</span></span></div><div class="line">             tableModelEventHandlerProxy, artichokeDescriptorAdapterIterator) {</div><div class="line">  <span class="comment">// ...</span></div><div class="line">}</div><div class="line"><span class="comment">// Parenthesis-aligned, one argument per line.  Visually groups and</span></div><div class="line"><span class="comment">// emphasizes each individual argument.</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">bar</span><span class="params">(veryDescriptiveArgumentNumberOne,</span></span></div><div class="line">             veryDescriptiveArgumentTwo,</div><div class="line">             tableModelEventHandlerProxy,</div><div class="line">             artichokeDescriptorAdapterIterator) {</div><div class="line">  <span class="comment">// ...</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>传递匿名函数<br>如果参数中有匿名函数, 函数体从调用该函数的左边开始缩进2个空格, 而不是从 function 这个关键字开始. 这让匿名函数更加易读 (不要增加很多没必要的缩进让函数体显示在屏幕的右侧).</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> names = items.map(<span class="function"><span class="keyword">function</span><span class="params">(item)</span> </span>{</div><div class="line">                        <span class="keyword">return</span> item.name;</div><div class="line">                      });</div><div class="line">prefix.something.reallyLongFunctionName(<span class="string">'whatever'</span>, <span class="function"><span class="keyword">function</span><span class="params">(a1, a2)</span> </span>{</div><div class="line">  <span class="keyword">if</span> (a1.equals(a2)) {</div><div class="line">    someOtherLongFunctionName(a1);</div><div class="line">  } <span class="keyword">else</span> {</div><div class="line">    andNowForSomethingCompletelyDifferent(a2.parrot);</div><div class="line">  }</div><div class="line">});</div></pre></td></tr></table></figure>

<p>更多的缩进<br>事实上, 除了 初始化数组和对象 , 和传递匿名函数外, 所有被拆开的多行文本要么选择与之前的表达式左对齐, 要么以4个(而不是2个)空格作为一缩进层次.</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">someWonderfulHtml = <span class="string">''</span> +</div><div class="line">                    getEvenMoreHtml(someReallyInterestingValues, moreValues,</div><div class="line">                                    evenMoreParams, <span class="string">'a duck'</span>, <span class="literal">true</span>, <span class="number">72</span>,</div><div class="line">                                    slightlyMoreMonkeys(<span class="number">0xfff</span>)) +</div><div class="line">                    <span class="string">''</span>;</div><div class="line">thisIsAVeryLongVariableName =</div><div class="line">    hereIsAnEvenLongerOtherFunctionNameThatWillNotFitOnPrevLine();</div><div class="line">thisIsAVeryLongVariableName = <span class="string">'expressionPartOne'</span> + someMethodThatIsLong() +</div><div class="line">    thisIsAnEvenLongerOtherFunctionNameThatCannotBeIndentedMore();</div><div class="line">someValue = <span class="keyword">this</span>.foo(</div><div class="line">    shortArg,</div><div class="line">    <span class="string">'Some really long string arg - this is a pretty common case, actually.'</span>,</div><div class="line">    shorty2,</div><div class="line">    <span class="keyword">this</span>.bar());</div><div class="line"><span class="keyword">if</span> (searchableCollection(allYourStuff).contains(theStuffYouWant) &&</div><div class="line">    !ambientNotification.isActive() && (client.isAmbientSupported() ||</div><div class="line">                                        client.alwaysTryAmbientAnyways()) {</div><div class="line">  ambientNotification.activate();</div><div class="line">}</div></pre></td></tr></table></figure>

<p>空行<br>使用空行来划分一组逻辑上相关联的代码片段.</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">doSomethingTo(x);</div><div class="line">doSomethingElseTo(x);</div><div class="line">andThen(x);</div><div class="line">nowDoSomethingWith(y);</div><div class="line">andNowWith(z);</div></pre></td></tr></table></figure>

<h3 id="二元和三元操作符">二元和三元操作符</h3>
<p>操作符始终跟随着前行, 这样就不用顾虑分号的隐式插入问题. 如果一行实在放不下, 还是按照上述的缩进风格来换行.</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> x = a ? b : c;  <span class="comment">// All on one line if it will fit.</span></div><div class="line"><span class="comment">// Indentation +4 is OK.</span></div><div class="line"><span class="keyword">var</span> y = a ?</div><div class="line">    longButSimpleOperandB : longButSimpleOperandC;</div><div class="line"><span class="comment">// Indenting to the line position of the first operand is also OK.</span></div><div class="line"><span class="keyword">var</span> z = a ?</div><div class="line">        moreComplicatedB :</div><div class="line">        moreComplicatedC;</div></pre></td></tr></table></figure>

<p>括号<br>只在需要的时候使用<br>不要滥用括号, 只在必要的时候使用它.<br>对于一元操作符(如delete, typeof 和 void ), 或是在某些关键词(如 return, throw, case, new )之后, 不要使用括号.<br>字符串<br>使用 ‘ 优于 “<br>无论你选择单引号还是双引号都无所谓，在 JavaScript 中它们在解析上没有区别。而绝对需要强制的是一致性。 永远不要在同一个项目中混用两种引号，选择一种，并保持一致。<br>单引号 (‘) 优于双引号 (“). 当你创建一个包含 HTML 代码的字符串时就知道它的好处了.</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> msg = <span class="string">'This is some HTML'</span>;</div></pre></td></tr></table></figure>

<p>前置逗号（Comma First）<br>请勿使用。所有使用这个文档作为基本风格指南的项目都不允许前置逗号的代码格式，除非明确指定或者作者要求。<br>注释<br>单行注释放于代码上方为首选<br>多行也可以<br>行末注释应被避免!<br>JSDoc 的方式也不错，但需要比较多的时间<br>使用 JSDoc<br>我们使用 JSDoc 中的注释风格. 行内注释使用 // 变量 的形式. 另外, 我们也遵循 C++ 代码注释风格 . 这也就是说你需要:<br>版权和著作权的信息,<br>文件注释中应该写明该文件的基本信息(如, 这段代码的功能摘要, 如何使用, 与哪些东西相关), 来告诉那些不熟悉代码的读者.<br>类, 函数, 变量和必要的注释,<br>期望在哪些浏览器中执行,<br>正确的大小写, 标点和拼写.<br>为了避免出现句子片段, 请以合适的大/小写单词开头, 并以合适的标点符号结束这个句子.<br>现在假设维护这段代码的是一位初学者. 这可能正好是这样的!<br>目前很多编译器可从 JSDoc 中提取类型信息, 来对代码进行验证, 删除和压缩. 因此, 你很有必要去熟悉正确完整的 JSDoc .<br>顶层/文件注释<br>顶层注释用于告诉不熟悉这段代码的读者这个文件中包含哪些东西. 应该提供文件的大体内容, 它的作者, 依赖关系和兼容性信息. 如下:</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Copyright 2009 Google Inc. All Rights Reserved.</span></div><div class="line"><span class="comment">/**</span></div><div class="line"> * @fileoverview Description of file, its uses and information</div><div class="line"> * about its dependencies.</div><div class="line"> * @author user@google.com (Firstname Lastname)</div><div class="line"> */</div></pre></td></tr></table></figure>

<p>类注释<br>每个类的定义都要附带一份注释, 描述类的功能和用法. 也需要说明构造器参数. 如果该类继承自其它类, 应该使用 @extends 标记. 如果该类是对接口的实现, 应该使用 @implements 标记.</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Class making something fun and easy.</div><div class="line"> * @param {string} arg1 An argument that makes this more interesting.</div><div class="line"> * @param {Array.&lt;number&gt;} arg2 List of numbers to be processed.</div><div class="line"> * @constructor</div><div class="line"> * @extends {goog.Disposable}</div><div class="line"> */</div><div class="line">project.MyClass = <span class="function"><span class="keyword">function</span><span class="params">(arg1, arg2)</span> </span>{</div><div class="line">  <span class="comment">// ...</span></div><div class="line">};</div><div class="line">goog.inherits(project.MyClass, goog.Disposable);</div></pre></td></tr></table></figure>

<p>方法与函数的注释<br>提供参数的说明. 使用完整的句子, 并用第三人称来书写方法说明.</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Converts text to some completely different text.</div><div class="line"> * @param {string} arg1 An argument that makes this more interesting.</div><div class="line"> * @return {string} Some return value.</div><div class="line"> */</div><div class="line">project.MyClass.prototype.someMethod = <span class="function"><span class="keyword">function</span><span class="params">(arg1)</span> </span>{</div><div class="line">  <span class="comment">// ...</span></div><div class="line">};</div><div class="line"><span class="comment">/**</span></div><div class="line"> * Operates on an instance of MyClass and returns something.</div><div class="line"> * @param {project.MyClass} obj Instance of MyClass which leads to a long</div><div class="line"> *     comment that needs to be wrapped to two lines.</div><div class="line"> * @return {boolean} Whether something occured.</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">PR_someMethod</span><span class="params">(obj)</span> </span>{</div><div class="line">  <span class="comment">// ...</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>对于一些简单的, 不带参数的 getters, 说明可以忽略.</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * @return {Element} The element for the component.</div><div class="line"> */</div><div class="line">goog.ui.Component.prototype.getElement = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.element_;</div><div class="line">};</div></pre></td></tr></table></figure>

<p>属性注释<br>也需要对属性进行注释.</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Maximum number of things per pane.</div><div class="line"> * @type {number}</div><div class="line"> */</div><div class="line">project.MyClass.prototype.someProperty = <span class="number">4</span>;</div></pre></td></tr></table></figure>

<p>JSDoc 缩进<br>如果你在 @param, @return, @supported, @this 或 @deprecated 中断行, 需要像在代码中一样, 使用4个空格作为一个缩进层次.</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Illustrates line wrapping for long param/return descriptions.</div><div class="line"> * @param {string} foo This is a param with a description too long to fit in</div><div class="line"> *     one line.</div><div class="line"> * @return {number} This returns something that has a description too long to</div><div class="line"> *     fit in one line.</div><div class="line"> */</div><div class="line">project.MyClass.prototype.method = <span class="function"><span class="keyword">function</span><span class="params">(foo)</span> </span>{</div><div class="line">  <span class="keyword">return</span> <span class="number">5</span>;</div><div class="line">};</div></pre></td></tr></table></figure>

<p>不要在 @fileoverview 标记中进行缩进.<br>虽然不建议, 但也可对说明文字进行适当的排版对齐. 不过, 这样带来一些负面影响, 就是当你每次修改变量名时, 都得重新排版说明文字以保持和变量名对齐.</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * This is NOT the preferred indentation method.</div><div class="line"> * @param {string} foo This is a param with a description too long to fit in</div><div class="line"> *                     one line.</div><div class="line"> * @return {number} This returns something that has a description too long to</div><div class="line"> *                  fit in one line.</div><div class="line"> */</div><div class="line">project.MyClass.prototype.method = <span class="function"><span class="keyword">function</span><span class="params">(foo)</span> </span>{</div><div class="line">  <span class="keyword">return</span> <span class="number">5</span>;</div><div class="line">};</div></pre></td></tr></table></figure>

<p>枚举</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Enum for tri-state values.</div><div class="line"> * @enum {number}</div><div class="line"> */</div><div class="line">project.TriState = {</div><div class="line">  TRUE: <span class="number">1</span>,</div><div class="line">  FALSE: -<span class="number">1</span>,</div><div class="line">  MAYBE: <span class="number">0</span></div><div class="line">};</div></pre></td></tr></table></figure>

<p>注意一下, 枚举也具有有效类型, 所以可以当成参数类型来用.</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Sets project state.</div><div class="line"> * @param {project.TriState} state New project state.</div><div class="line"> */</div><div class="line">project.setState = <span class="function"><span class="keyword">function</span><span class="params">(state)</span> </span>{</div><div class="line">  <span class="comment">// ...</span></div><div class="line">};</div></pre></td></tr></table></figure>

<p>JavaScript 语言规范<br>变量<br>声明变量必须加上 var 关键字.<br>当你没有写 var, 变量就会暴露在全局上下文中, 这样很可能会和现有变量冲突. 另外, 如果没有加上, 很难明确该变量的作用域是什么, 变量也很可能像在局部作用域中, 很轻易地泄漏到 Document 或者 Window 中, 所以务必用 var 去声明变量.</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 变量</span></div><div class="line"><span class="keyword">var</span> foo = <span class="string">"bar"</span>,</div><div class="line">  num = <span class="number">1</span>,</div><div class="line">  undef;</div><div class="line"><span class="comment">// 字面量标识:</span></div><div class="line"><span class="keyword">var</span> array = [],</div><div class="line">  object = {};</div><div class="line"><span class="comment">// 在一个作用域（函数）内只使用一个 `var` 有助于提升可读性</span></div><div class="line"><span class="comment">// 并且让你的声明列表变得有条不紊 (还帮你省了几次键盘敲击)</span></div><div class="line"><span class="comment">// 不好</span></div><div class="line"><span class="keyword">var</span> foo = <span class="string">""</span>;</div><div class="line"><span class="keyword">var</span> bar = <span class="string">""</span>;</div><div class="line"><span class="keyword">var</span> qux;</div><div class="line"><span class="comment">// 好的做法</span></div><div class="line"><span class="keyword">var</span> foo = <span class="string">""</span>,</div><div class="line">  bar = <span class="string">""</span>,</div><div class="line">  quux;</div><div class="line"><span class="comment">// 或者..</span></div><div class="line"><span class="keyword">var</span> <span class="comment">// 对这些变量的注释</span></div><div class="line">foo = <span class="string">""</span>,</div><div class="line">bar = <span class="string">""</span>,</div><div class="line">quux;</div><div class="line"><span class="comment">// `var` 语句必须总是在各自作用域（函数）顶部</span></div><div class="line"><span class="comment">// 同样适应于来自 ECMAScript 6 的常量</span></div><div class="line"><span class="comment">// 不好</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span><span class="params">()</span> </span>{</div><div class="line">  <span class="comment">// 在变量前有语句</span></div><div class="line">  <span class="keyword">var</span> bar = <span class="string">""</span>,</div><div class="line">    qux;</div><div class="line">}</div><div class="line"><span class="comment">// 好</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span><span class="params">()</span> </span>{</div><div class="line">  <span class="keyword">var</span> bar = <span class="string">""</span>,</div><div class="line">    qux;</div><div class="line">  <span class="comment">// 所有语句都在变量之后</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>常量<br>常量的形式如: NAMES_LIKE_THIS, 即使用大写字符, 并用下划线分隔. 你也可用 @const 标记来指明它是一个常量. 但请永远不要使用 const 关键词.<br>Decision:<br>对于基本类型的常量, 只需转换命名.</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * The number of seconds in a minute.</div><div class="line"> * @type {number}</div><div class="line"> */</div><div class="line">goog.example.SECONDS_IN_A_MINUTE = <span class="number">60</span>;</div></pre></td></tr></table></figure>

<p>对于非基本类型, 使用 @const 标记.</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * The number of seconds in each of the given units.</div><div class="line"> * @type {Object.&lt;number&gt;}</div><div class="line"> * @const</div><div class="line"> */</div><div class="line">goog.example.SECONDS_TABLE = {</div><div class="line">  minute: <span class="number">60</span>,</div><div class="line">  hour: <span class="number">60</span> * <span class="number">60</span>,</div><div class="line">  day: <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>这标记告诉编译器它是常量.<br>至于关键词 const, 因为 IE 不能识别, 所以不要使用.<br>分号<br>总是使用分号.<br>如果仅依靠语句间的隐式分隔, 有时会很麻烦. 你自己更能清楚哪里是语句的起止. 而且有些情况下, 漏掉分号会很危险，可能会导致代码合并错误等，又比如:</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 1.</span></div><div class="line">MyClass.prototype.myMethod = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">  <span class="keyword">return</span> <span class="number">42</span>;</div><div class="line">}  <span class="comment">// No semicolon here.</span></div><div class="line">(<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">  <span class="comment">// Some initialization code wrapped in a function to create a scope for locals.</span></div><div class="line">})();</div><div class="line"><span class="keyword">var</span> THINGS_TO_EAT = [apples, oysters, sprayOnCheese]  <span class="comment">// No semicolon here.</span></div><div class="line"><span class="comment">// 2. conditional execution a la bash</span></div><div class="line">-<span class="number">1</span> == resultOfOperation() || die();</div></pre></td></tr></table></figure>

<p>这段代码会发生些什么诡异事呢?<br>报 JavaScript 错误 - 例子1上的语句会解释成, 一个函数带一匿名函数作为参数而被调用, 返回42后, 又一次被”调用”, 这就导致了错误.<br>当 resultOfOperation() 返回非 NaN 时, 就会调用die, 其结果也会赋给 THINGS_TO_EAT.<br>为什么?<br>JavaScript 的语句以分号作为结束符, 除非可以非常准确推断某结束位置才会省略分号. 上面的例子产出错误, 均是在语句中声明了函数/对象/数组直接量, 但 闭括号(‘}’或’]’)并不足以表示该语句的结束. 在 JavaScript 中, 只有当语句后的下一个符号是后缀或括号运算符时, 才会认为该语句的结束. 参考：JS分号自动插入机制<br>遗漏分号有时会出现很奇怪的结果, 所以确保语句以分号结束.<br>块内函数声明<br>不要在块内声明一个函数，不要写成:</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (x) {</div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">foo</span><span class="params">()</span> </span>{}</div><div class="line">}</div></pre></td></tr></table></figure>

<p>虽然很多 JS 引擎都支持块内声明函数, 但它不属于 ECMAScript 规范 (见 ECMA-262, 第13和14条). 各个浏览器糟糕的实现相互不兼容, 有些也与未来 ECMAScript 草案相违背. ECMAScript 只允许在脚本的根语句或函数中声明函数. 如果确实需要在块中定义函数, 建议使用函数表达式来初始化变量:</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (x) {</div><div class="line">  <span class="keyword">var</span> foo = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{}</div><div class="line">}</div></pre></td></tr></table></figure>

<p>标准特性<br>标准特性总是优于非标准特性.<br>最大化可移植性和兼容性, 尽量使用标准方法而不是用非标准方法, (比如, 优先用string.charAt(3) 而不用 string[3] , 通过 DOM 原生函数访问元素, 而不是使用应用封装好的快速接口.<br>不要封装基本类型<br>没有任何理由去封装基本类型, 另外还存在一些风险:</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> x = <span class="keyword">new</span> <span class="built_in">Boolean</span>(<span class="literal">false</span>);</div><div class="line"><span class="keyword">if</span> (x) {</div><div class="line">  alert(<span class="string">'hi'</span>);  <span class="comment">// Shows 'hi'.</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>除非明确用于类型转换, 其他情况请千万不要这样做！</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> x = <span class="built_in">Boolean</span>(<span class="number">0</span>);</div><div class="line"><span class="keyword">if</span> (x) {</div><div class="line">  alert(<span class="string">'hi'</span>);  <span class="comment">// This will never be alerted.</span></div><div class="line">}</div></pre></td></tr></table></figure>



<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typeof</span> <span class="built_in">Boolean</span>(<span class="number">0</span>) == <span class="string">'boolean'</span>;</div><div class="line"><span class="keyword">typeof</span> <span class="keyword">new</span> <span class="built_in">Boolean</span>(<span class="number">0</span>) == <span class="string">'object'</span>;</div></pre></td></tr></table></figure>

<p>有时用作 number, string 或 boolean时, 类型的转换会非常实用.<br>闭包<br>可以, 但小心使用.<br>闭包也许是 JS 中最有用的特性了. 有一份比较好的介绍闭包原理的文档.<br>有一点需要牢记, 闭包保留了一个指向它封闭作用域的指针, 所以, 在给 DOM 元素附加闭包时, 很可能会产生循环引用, 进一步导致内存泄漏. 比如下面的代码:</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span><span class="params">(element, a, b)</span> </span>{</div><div class="line">  element.onclick = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{ <span class="comment">/* uses a and b */</span> };</div><div class="line">}</div></pre></td></tr></table></figure>

<p>这里, 即使没有使用 element, 闭包也保留了 element, a 和 b 的引用, 由于 element 也保留了对闭包的引用, 这就产生了循环引用, 这就不能被 GC 回收. 这种情况下, 可将代码重构为:</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span><span class="params">(element, a, b)</span> </span>{</div><div class="line">  element.onclick = bar(a, b);</div><div class="line">}</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">bar</span><span class="params">(a, b)</span> </span>{</div><div class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{ <span class="comment">/* uses a and b */</span> }</div><div class="line">}</div><div class="line"><span class="built_in">eval</span>()</div></pre></td></tr></table></figure>

<p>只用于解析序列化串 (如: 解析 RPC 响应), 而且解析序列号字符串用JSON.parse()会更好，所以最好放弃使用 eval().<br>eval() 会让程序执行的比较混乱, 当 eval() 里面包含用户输入的话就更加危险. 可以用其他更佳的, 更清晰, 更安全的方式写你的代码, 所以一般情况下请不要使用 eval(). 当碰到一些需要解析序列化串的情况下(如, 计算 RPC 响应), 使用 eval 很容易实现.<br>解析序列化串是指将字节流转换成内存中的数据结构. 比如, 你可能会将一个对象输出成文件形式:</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">users = [</div><div class="line">  {</div><div class="line">    name: <span class="string">'Eric'</span>,</div><div class="line">    id: <span class="number">37824</span>,</div><div class="line">    email: <span class="string">'jellyvore@myway.com'</span></div><div class="line">  },</div><div class="line">  {</div><div class="line">    name: <span class="string">'xtof'</span>,</div><div class="line">    id: <span class="number">31337</span>,</div><div class="line">    email: <span class="string">'b4d455h4x0r@google.com'</span></div><div class="line">  },</div><div class="line">  ...</div><div class="line">];</div></pre></td></tr></table></figure>

<p>很简单地调用 eval 后, 把表示成文件的数据读取回内存中.<br>类似的, eval() 对 RPC 响应值进行解码. 例如, 你在使用 XMLHttpRequest 发出一个 RPC 请求后, 通过 eval () 将服务端的响应文本转成 JavaScript 对象:</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> userOnline = <span class="literal">false</span>;</div><div class="line"><span class="keyword">var</span> user = <span class="string">'nusrat'</span>;</div><div class="line"><span class="keyword">var</span> xmlhttp = <span class="keyword">new</span> XMLHttpRequest();</div><div class="line">xmlhttp.open(<span class="string">'GET'</span>, <span class="string">'http://chat.google.com/isUserOnline?user='</span> + user, <span class="literal">false</span>);</div><div class="line">xmlhttp.send(<span class="string">''</span>);</div><div class="line"><span class="comment">// Server returns:</span></div><div class="line"><span class="comment">// userOnline = true;</span></div><div class="line"><span class="keyword">if</span> (xmlhttp.status == <span class="number">200</span>) {</div><div class="line">  <span class="built_in">eval</span>(xmlhttp.responseText);</div><div class="line">}</div><div class="line"><span class="comment">// userOnline is now true.</span></div><div class="line"><span class="keyword">with</span>() {}</div></pre></td></tr></table></figure>

<p>不要使用<br>使用 with 让你的代码在语义上变得不清晰. 因为 with 的对象, 可能会与局部变量产生冲突, 从而改变你程序原本的用义. 下面的代码是干嘛的?</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">with</span> (foo) {</div><div class="line">  <span class="keyword">var</span> x = <span class="number">3</span>;</div><div class="line">  <span class="keyword">return</span> x;</div><div class="line">}</div></pre></td></tr></table></figure>

<p>答案: 任何事. 局部变量 x 可能被 foo 的属性覆盖, 当它定义一个 setter 时, 在赋值 3 后会执行很多其他代码. 所以不要使用 with 语句.<br>this<br>仅在对象构造器, 方法, 闭包中使用.<br>this 的语义很特别. 有时它引用一个全局对象(大多数情况下), 调用者的作用域(使用 eval时), DOM 树中的节点(添加事件处理函数时), 新创建的对象(使用一个构造器), 或者其他对象(如果函数被 call() 或 apply()).<br>使用时很容易出错, 所以只有在下面两个情况时才能使用:<br>在构造器中<br>对象的方法(包括创建的闭包)中<br>for-in 循环<br>只用于 object/map/hash 的遍历<br>对 Array 用 for-in 循环有时会出错. 因为它并不是从 0 到 length - 1 进行遍历, 而是所有出现在对象及其原型链的键值. 下面就是一些失败的使用案例:</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">printArray</span><span class="params">(arr)</span> </span>{</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> arr) {</div><div class="line">    print(arr[key]);</div><div class="line">  }</div><div class="line">}</div><div class="line">printArray([<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]);  <span class="comment">// This works.</span></div><div class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">10</span>);</div><div class="line">printArray(a);  <span class="comment">// This is wrong.</span></div><div class="line">a = <span class="built_in">document</span>.getElementsByTagName(<span class="string">'*'</span>);</div><div class="line">printArray(a);  <span class="comment">// This is wrong.</span></div><div class="line">a = [<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</div><div class="line">a.buhu = <span class="string">'wine'</span>;</div><div class="line">printArray(a);  <span class="comment">// This is wrong again.</span></div><div class="line">a = <span class="keyword">new</span> <span class="built_in">Array</span>;</div><div class="line">a[<span class="number">3</span>] = <span class="number">3</span>;</div><div class="line">printArray(a);  <span class="comment">// This is wrong again.</span></div><div class="line"><span class="comment">// 而遍历数组通常用最普通的 for 循环.</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">printArray</span><span class="params">(arr)</span> </span>{</div><div class="line">  <span class="keyword">var</span> l = arr.length;</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; l; i++) {</div><div class="line">    print(arr[i]);</div><div class="line">  }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>多行字符串<br>不要使用. 不要这样写长字符串:</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> myString = <span class="string">'A rather long string of English text, an error message \</span></div><div class="line">                actually that just keeps going and going -- an error \</div><div class="line">                message to make the Energizer bunny blush (right through \</div><div class="line">                those Schwarzenegger shades)! Where was I? Oh yes, \</div><div class="line">                you\'ve got an error and all the extraneous whitespace is \</div><div class="line">                just gravy.  Have a nice day.';</div></pre></td></tr></table></figure>

<p>在编译时, 不能忽略行起始位置的空白字符; “\” 后的空白字符会产生奇怪的错误; 虽然大多数脚本引擎支持这种写法, 但它不是 ECMAScript 的标准规范.<br>Array 和 Object 直接量<br>使用 Array 和 Object 语法, 而不使用 Array 和 Object 构造器.<br>使用 Array 构造器很容易因为传参不恰当导致错误.</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Length is 3.</span></div><div class="line"><span class="keyword">var</span> a1 = <span class="keyword">new</span> <span class="built_in">Array</span>(x1, x2, x3);</div><div class="line"><span class="comment">// Length is 2.</span></div><div class="line"><span class="keyword">var</span> a2 = <span class="keyword">new</span> <span class="built_in">Array</span>(x1, x2);</div><div class="line"><span class="comment">// If x1 is a number and it is a natural number the length will be x1.</span></div><div class="line"><span class="comment">// If x1 is a number but not a natural number this will throw an exception.</span></div><div class="line"><span class="comment">// Otherwise the array will have one element with x1 as its value.</span></div><div class="line"><span class="keyword">var</span> a3 = <span class="keyword">new</span> <span class="built_in">Array</span>(x1);</div><div class="line"><span class="comment">// Length is 0.</span></div><div class="line"><span class="keyword">var</span> a4 = <span class="keyword">new</span> <span class="built_in">Array</span>();</div></pre></td></tr></table></figure>

<p>如果传入一个参数而不是2个参数, 数组的长度很有可能就不是你期望的数值了.<br>为了避免这些歧义, 我们应该使用更易读的直接量来声明.</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> a = [x1, x2, x3];</div><div class="line"><span class="keyword">var</span> a2 = [x1, x2];</div><div class="line"><span class="keyword">var</span> a3 = [x1];</div><div class="line"><span class="keyword">var</span> a4 = [];</div></pre></td></tr></table></figure>

<p>虽然 Object 构造器没有上述类似的问题, 但鉴于可读性和一致性考虑, 最好还是在字面上更清晰地指明. 例如：</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> o = <span class="keyword">new</span> <span class="built_in">Object</span>();</div><div class="line"><span class="keyword">var</span> o2 = <span class="keyword">new</span> <span class="built_in">Object</span>();</div><div class="line">o2.a = <span class="number">0</span>;</div><div class="line">o2.b = <span class="number">1</span>;</div><div class="line">o2.c = <span class="number">2</span>;</div><div class="line">o2[<span class="string">'strange key'</span>] = <span class="number">3</span>;</div></pre></td></tr></table></figure>

<p>应该写成:</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> o = {};</div><div class="line"><span class="keyword">var</span> o2 = {</div><div class="line">  a: <span class="number">0</span>,</div><div class="line">  b: <span class="number">1</span>,</div><div class="line">  c: <span class="number">2</span>,</div><div class="line">  <span class="string">'strange key'</span>: <span class="number">3</span></div><div class="line">};</div></pre></td></tr></table></figure>

<p>不要修改内置对象的原型<br>千万不要修改内置对象, 如 Object.prototype 和 Array.prototype 的原型. 而修改内置对象, 如 Function.prototype 的原型, 虽然少危险些, 但仍会导致调试时的诡异现象. 所以也要避免修改其原型.<br>JavaScript 小技巧(Tips and Tricks)<br>True 和 False 布尔表达式<br>下面的布尔表达式都返回 false:</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="literal">null</span></div><div class="line"><span class="literal">undefined</span></div><div class="line"><span class="string">''</span>          <span class="comment">// 空字符串</span></div><div class="line"><span class="number">0</span>           <span class="comment">//数字0</span></div></pre></td></tr></table></figure>

<p>但小心下面的, 可都返回 true:</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="string">'0'</span>   <span class="comment">// 字符串0</span></div><div class="line">[]    <span class="comment">// 空数组</span></div><div class="line">{}    <span class="comment">// 空对象</span></div></pre></td></tr></table></figure>

<p>下面段比较糟糕的代码:</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">while</span> (x != <span class="literal">null</span>) {</div></pre></td></tr></table></figure>

<p>你可以直接写成下面的形式(只要你希望 x 不是 0 和空字符串, 和 false):</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">while</span> (x) {</div></pre></td></tr></table></figure>

<p>如果你想检查字符串是否为 null 或空:</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (y != <span class="literal">null</span> && y != <span class="string">''</span>) {</div></pre></td></tr></table></figure>

<p>但这样会更好:</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (y) {</div></pre></td></tr></table></figure>

<p>注意: 还有很多需要注意的地方, 如:</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">Boolean</span>(<span class="string">'0'</span>) == <span class="literal">true</span></div><div class="line"><span class="string">'0'</span> != <span class="literal">true</span></div><div class="line"><span class="number">0</span> != <span class="literal">null</span></div><div class="line"><span class="number">0</span> == []</div><div class="line"><span class="number">0</span> == <span class="literal">false</span></div><div class="line"><span class="built_in">Boolean</span>(<span class="literal">null</span>) == <span class="literal">false</span></div><div class="line"><span class="literal">null</span> != <span class="literal">true</span></div><div class="line"><span class="literal">null</span> != <span class="literal">false</span></div><div class="line"><span class="built_in">Boolean</span>(<span class="literal">undefined</span>) == <span class="literal">false</span></div><div class="line"><span class="literal">undefined</span> != <span class="literal">true</span></div><div class="line"><span class="literal">undefined</span> != <span class="literal">false</span></div><div class="line"><span class="built_in">Boolean</span>([]) == <span class="literal">true</span></div><div class="line">[] != <span class="literal">true</span></div><div class="line">[] == <span class="literal">false</span></div><div class="line"><span class="built_in">Boolean</span>({}) == <span class="literal">true</span></div><div class="line">{} != <span class="literal">true</span></div><div class="line">{} != <span class="literal">false</span></div><div class="line">条件(三元)操作符 (?:)</div></pre></td></tr></table></figure>

<p>三元操作符用于替代下面的代码:</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (val != <span class="number">0</span>) {</div><div class="line">  <span class="keyword">return</span> foo();</div><div class="line">} <span class="keyword">else</span> {</div><div class="line">  <span class="keyword">return</span> bar();</div><div class="line">}</div></pre></td></tr></table></figure>

<p>你可以写成:</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">return</span> val ? foo() : bar();</div></pre></td></tr></table></figure>

<p>在生成 HTML 代码时也是很有用的:</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> html = <span class="string">'&lt;input type="checkbox"'</span> +</div><div class="line">    (isChecked ? <span class="string">' checked'</span> : <span class="string">''</span>) +</div><div class="line">    (isEnabled ? <span class="string">''</span> : <span class="string">' disabled'</span>) +</div><div class="line">    <span class="string">' name="foo"&gt;'</span>;</div></pre></td></tr></table></figure>

<p>&amp;&amp; 和 ||<br>二元布尔操作符是可短路的, 只有在必要时才会计算到最后一项.<br>“||” 被称作为 ‘default’ 操作符, 因为可以这样:</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/** @param {*=} opt_win */</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span><span class="params">(opt_win)</span> </span>{</div><div class="line">  <span class="keyword">var</span> win;</div><div class="line">  <span class="keyword">if</span> (opt_win) {</div><div class="line">    win = opt_win;</div><div class="line">  } <span class="keyword">else</span> {</div><div class="line">    win = <span class="built_in">window</span>;</div><div class="line">  }</div><div class="line">  <span class="comment">// ...</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>你可以使用它来简化上面的代码:</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/** @param {*=} opt_win */</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span><span class="params">(opt_win)</span> </span>{</div><div class="line">  <span class="keyword">var</span> win = opt_win || <span class="built_in">window</span>;</div><div class="line">  <span class="comment">// ...</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>“&amp;&amp;” 也可简短代码.比如:</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (node) {</div><div class="line">  <span class="keyword">if</span> (node.kids) {</div><div class="line">    <span class="keyword">if</span> (node.kids[index]) {</div><div class="line">      foo(node.kids[index]);</div><div class="line">    }</div><div class="line">  }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>你可以像这样来使用:</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (node && node.kids && node.kids[index]) {</div><div class="line">  foo(node.kids[index]);</div><div class="line">}</div></pre></td></tr></table></figure>

<p>或者:</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> kid = node && node.kids && node.kids[index];</div><div class="line"><span class="keyword">if</span> (kid) {</div><div class="line">  foo(kid);</div><div class="line">}</div></pre></td></tr></table></figure>

<p>不过这样就有点儿过头了:</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">node && node.kids && node.kids[index] && foo(node.kids[index]);</div></pre></td></tr></table></figure>

<p>使用 join() 来创建字符串<br>通常是这样使用的:</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">listHtml</span><span class="params">(items)</span> </span>{</div><div class="line">  <span class="keyword">var</span> html = <span class="string">'&lt;div class="foo"&gt;'</span>;</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; items.length; ++i) {</div><div class="line">    <span class="keyword">if</span> (i &gt; <span class="number">0</span>) {</div><div class="line">      html += <span class="string">', '</span>;</div><div class="line">    }</div><div class="line">    html += itemHtml(items[i]);</div><div class="line">  }</div><div class="line">  html += <span class="string">'&lt;/div&gt;'</span>;</div><div class="line">  <span class="keyword">return</span> html;</div><div class="line">}</div></pre></td></tr></table></figure>

<p>但这样在 IE 下非常慢, 可以用下面的方式:</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">listHtml</span><span class="params">(items)</span> </span>{</div><div class="line">  <span class="keyword">var</span> html = [];</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; items.length; ++i) {</div><div class="line">    html[i] = itemHtml(items[i]);</div><div class="line">  }</div><div class="line">  <span class="keyword">return</span> <span class="string">'&lt;div class="foo"&gt;'</span> + html.join(<span class="string">', '</span>) + <span class="string">'&lt;/div&gt;'</span>;</div><div class="line">}</div></pre></td></tr></table></figure>

<p>你也可以是用数组作为字符串构造器, 然后通过 myArray.join(‘’) 转换成字符串. 不过由于赋值操作快于数组的 push(), 所以尽量使用赋值操作.<br>类型检测 (来源于 jQuery Core Style Guidelines)<br>直接类型（实际类型，Actual Types）</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">String</span>:</div><div class="line">  <span class="keyword">typeof</span> variable === <span class="string">"string"</span></div><div class="line"><span class="built_in">Number</span>:</div><div class="line">  <span class="keyword">typeof</span> variable === <span class="string">"number"</span></div><div class="line"><span class="built_in">Boolean</span>:</div><div class="line">  <span class="keyword">typeof</span> variable === <span class="string">"boolean"</span></div><div class="line"><span class="built_in">Object</span>:</div><div class="line">  <span class="keyword">typeof</span> variable === <span class="string">"object"</span></div><div class="line"><span class="built_in">Array</span>:</div><div class="line">  <span class="built_in">Array</span>.isArray(arrayLikeObject)</div><div class="line">  (如果可能的话)</div><div class="line">Node:</div><div class="line">  elem.nodeType === <span class="number">1</span></div><div class="line"><span class="literal">null</span>:</div><div class="line">  variable === <span class="literal">null</span></div><div class="line"><span class="literal">null</span> or <span class="literal">undefined</span>:</div><div class="line">  variable == <span class="literal">null</span></div><div class="line"><span class="literal">undefined</span>:</div><div class="line">全局变量:</div><div class="line"></div><div class="line">  <span class="keyword">typeof</span> variable === <span class="string">"undefined"</span></div><div class="line"></div><div class="line">局部变量:</div><div class="line"></div><div class="line">  variable === <span class="literal">undefined</span></div><div class="line"></div><div class="line">属性:</div><div class="line"></div><div class="line">  object.prop === <span class="literal">undefined</span></div><div class="line">  object.hasOwnProperty(prop)</div><div class="line">  <span class="string">"prop"</span> <span class="keyword">in</span> object</div></pre></td></tr></table></figure>

<p>转换类型（强制类型，Coerced Types）<br>考虑下面这个的含义…<br>给定的 HTML:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"text"</span> <span class="attribute">id</span>=<span class="value">"foo-input"</span> <span class="attribute">value</span>=<span class="value">"1"</span>&gt;</span></div></pre></td></tr></table></figure>



<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// `foo` 已经被赋予值 `0`，类型为 `number`</span></div><div class="line"><span class="keyword">var</span> foo = <span class="number">0</span>;</div><div class="line"><span class="comment">// typeof foo;</span></div><div class="line"><span class="comment">// "number"</span></div><div class="line">...</div><div class="line"><span class="comment">// 在后续的代码中，你需要更新 `foo`，赋予在 input 元素中得到的新值</span></div><div class="line">foo = <span class="built_in">document</span>.getElementById(<span class="string">"foo-input"</span>).value;</div><div class="line"><span class="comment">// 如果你现在测试 `typeof foo`, 结果将是 `string`</span></div><div class="line"><span class="comment">// 这意味着你在 if 语句检测 `foo` 有类似于此的逻辑:</span></div><div class="line"><span class="keyword">if</span> (foo === <span class="number">1</span>) {</div><div class="line">  importantTask();</div><div class="line">}</div><div class="line"><span class="comment">// `importantTask()` 将永远不会被执行，即使 `foo` 有一个值 "1"</span></div><div class="line"><span class="comment">// 你可以巧妙地使用 + / - 一元运算符强制转换类型以解决问题:</span></div><div class="line">foo = +<span class="built_in">document</span>.getElementById(<span class="string">"foo-input"</span>).value;</div><div class="line"><span class="comment">//    ^ + 一元运算符将它右边的运算对象转换为 `number`</span></div><div class="line"><span class="comment">// typeof foo;</span></div><div class="line"><span class="comment">// "number"</span></div><div class="line"><span class="keyword">if</span> (foo === <span class="number">1</span>) {</div><div class="line">  importantTask();</div><div class="line">}</div><div class="line"><span class="comment">// `importantTask()` 将被调用</span></div></pre></td></tr></table></figure>

<p>对于强制类型转换这里有几个例子:</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> number = <span class="number">1</span>,</div><div class="line">  string = <span class="string">"1"</span>,</div><div class="line">  bool = <span class="literal">false</span>;</div><div class="line">number;</div><div class="line"><span class="comment">// 1</span></div><div class="line">number + <span class="string">""</span>;</div><div class="line"><span class="comment">// "1"</span></div><div class="line">string;</div><div class="line"><span class="comment">// "1"</span></div><div class="line">+string;</div><div class="line"><span class="comment">// 1</span></div><div class="line">+string++;</div><div class="line"><span class="comment">// 1</span></div><div class="line">string;</div><div class="line"><span class="comment">// 2</span></div><div class="line">bool;</div><div class="line"><span class="comment">// false</span></div><div class="line">+bool;</div><div class="line"><span class="comment">// 0</span></div><div class="line">bool + <span class="string">""</span>;</div><div class="line"><span class="comment">// "false"</span></div></pre></td></tr></table></figure>



<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> number = <span class="number">1</span>,</div><div class="line">  string = <span class="string">"1"</span>,</div><div class="line">  bool = <span class="literal">true</span>;</div><div class="line">string === number;</div><div class="line"><span class="comment">// false</span></div><div class="line">string === number + <span class="string">""</span>;</div><div class="line"><span class="comment">// true</span></div><div class="line">+string === number;</div><div class="line"><span class="comment">// true</span></div><div class="line">bool === number;</div><div class="line"><span class="comment">// false</span></div><div class="line">+bool === number;</div><div class="line"><span class="comment">// true</span></div><div class="line">bool === string;</div><div class="line"><span class="comment">// false</span></div><div class="line">bool === !!string;</div><div class="line"><span class="comment">// true</span></div></pre></td></tr></table></figure>



<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> num = <span class="number">2.5</span>;</div><div class="line"><span class="built_in">parseInt</span>(num, <span class="number">10</span>);</div><div class="line"><span class="comment">// 等价于...</span></div><div class="line">~~num;</div><div class="line">num &gt;&gt; <span class="number">0</span>;</div><div class="line">num &gt;&gt;&gt; <span class="number">0</span>;</div><div class="line"><span class="comment">// 结果都是 2</span></div><div class="line"><span class="comment">// 时刻牢记心底, 负值将被区别对待...</span></div><div class="line"><span class="keyword">var</span> neg = -<span class="number">2.5</span>;</div><div class="line"><span class="built_in">parseInt</span>(neg, <span class="number">10</span>);</div><div class="line"><span class="comment">// 等价于...</span></div><div class="line">~~neg;</div><div class="line">neg &gt;&gt; <span class="number">0</span>;</div><div class="line"><span class="comment">// 结果都是 -2</span></div><div class="line"><span class="comment">// 但是...</span></div><div class="line">neg &gt;&gt;&gt; <span class="number">0</span>;</div><div class="line"><span class="comment">// 结果即是 4294967294</span></div></pre></td></tr></table></figure>

<p>字符串转换为整数<br>将字符串转换为整数有以下几种方式，可以在这里进行测试对比：</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> number1 = <span class="string">"45"</span>;</div><div class="line"><span class="comment">// ParseInt() Test on chrome for mac:31% slower</span></div><div class="line"><span class="keyword">var</span> i = <span class="built_in">parseInt</span>(number1);</div><div class="line"><span class="comment">// Using unary Test on chrome for mac:67% slower</span></div><div class="line"><span class="keyword">var</span> j = +number1;</div><div class="line"><span class="comment">// Number constructor Test on chrome for mac:59% slower</span></div><div class="line"><span class="keyword">var</span> k = <span class="built_in">Number</span>(number1);</div><div class="line"><span class="comment">// By multplication Test on chrome for mac:69% slower</span></div><div class="line"><span class="keyword">var</span> l = number1 * <span class="number">1</span>;</div><div class="line"><span class="comment">// parseInt with Test on chrome for mac:radix ±3.85% fastest</span></div><div class="line"><span class="keyword">var</span> m = <span class="built_in">parseInt</span>(number1, <span class="number">10</span>);</div></pre></td></tr></table></figure>

<p>所以推荐使用 parseInt(number1, 10) 这种方式，不过 +number1 更为简单，在操作次数极少的情况下也可以酌情使用。<br>对比运算</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 当只是判断一个 array 是否有长度，相对于使用这个:</span></div><div class="line"><span class="keyword">if</span> (array.length &gt; <span class="number">0</span>) ...</div><div class="line"><span class="comment">// ...判断真伪, 请使用这种:</span></div><div class="line"><span class="keyword">if</span> (array.length) ...</div><div class="line"><span class="comment">// 当只是判断一个 array 是否为空，相对于使用这个:</span></div><div class="line"><span class="keyword">if</span> (array.length === <span class="number">0</span>) ...</div><div class="line"><span class="comment">// ...判断真伪, 请使用这种:</span></div><div class="line"><span class="keyword">if</span> (!array.length) ...</div><div class="line"><span class="comment">// 当只是判断一个 string 是否为空，相对于使用这个:</span></div><div class="line"><span class="keyword">if</span> (string !== <span class="string">""</span>) ...</div><div class="line"><span class="comment">// ...判断真伪, 请使用这种:</span></div><div class="line"><span class="keyword">if</span> (string) ...</div><div class="line"><span class="comment">// 当只是判断一个 string 是为空，相对于使用这个:</span></div><div class="line"><span class="keyword">if</span> (string === <span class="string">""</span>) ...</div><div class="line"><span class="comment">// ...判断真伪, 请使用这种:</span></div><div class="line"><span class="keyword">if</span> (!string) ...</div><div class="line"><span class="comment">// 当只是判断一个引用是为真，相对于使用这个:</span></div><div class="line"><span class="keyword">if</span> (foo === <span class="literal">true</span>) ...</div><div class="line"><span class="comment">// ...判断只需像你所想，享受内置功能的好处:</span></div><div class="line"><span class="keyword">if</span> (foo) ...</div><div class="line"><span class="comment">// 当只是判断一个引用是为假，相对于使用这个:</span></div><div class="line"><span class="keyword">if</span> (foo === <span class="literal">false</span>) ...</div><div class="line"><span class="comment">// ...使用叹号将其转换为真</span></div><div class="line"><span class="keyword">if</span> (!foo) ...</div><div class="line"><span class="comment">// ...需要注意的是：这个将会匹配 0, "", null, undefined, NaN</span></div><div class="line"><span class="comment">// 如果你 _必须_ 是布尔类型的 false，请这样用：</span></div><div class="line"><span class="keyword">if</span> (foo === <span class="literal">false</span>) ...</div><div class="line"><span class="comment">// 如果想计算一个引用可能是 null 或者 undefined，但并不是 false, "" 或者 0,</span></div><div class="line"><span class="comment">// 相对于使用这个：</span></div><div class="line"><span class="keyword">if</span> (foo === <span class="literal">null</span> || foo === <span class="literal">undefined</span>) ...</div><div class="line"><span class="comment">// ...享受 == 类型强制转换的好处，像这样:</span></div><div class="line"><span class="keyword">if</span> (foo == <span class="literal">null</span>) ...</div><div class="line"><span class="comment">// 谨记，使用 == 将会令 `null` 匹配 `null` 和 `undefined`</span></div><div class="line"><span class="comment">// 但不是 `false`，"" 或者 0</span></div><div class="line"><span class="literal">null</span> == <span class="literal">undefined</span></div></pre></td></tr></table></figure>

<p>总是判断最好、最精确的值，上述是指南而非教条。</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 类型转换和对比运算说明</span></div><div class="line"><span class="comment">// 首次 `===`，`==` 次之 (除非需要松散类型的对比)</span></div><div class="line"><span class="comment">// `===` 总不做类型转换，这意味着:</span></div><div class="line"><span class="string">"1"</span> === <span class="number">1</span>;</div><div class="line"><span class="comment">// false</span></div><div class="line"><span class="comment">// `==` 会转换类型，这意味着:</span></div><div class="line"><span class="string">"1"</span> == <span class="number">1</span>;</div><div class="line"><span class="comment">// true</span></div><div class="line"><span class="comment">// 布尔, 真 & 伪</span></div><div class="line"><span class="comment">// 布尔:</span></div><div class="line"><span class="literal">true</span>, <span class="literal">false</span></div><div class="line"><span class="comment">// 真:</span></div><div class="line"><span class="string">"foo"</span>, <span class="number">1</span></div><div class="line"><span class="comment">// 伪:</span></div><div class="line"><span class="string">""</span>, <span class="number">0</span>, <span class="literal">null</span>, <span class="literal">undefined</span>, <span class="literal">NaN</span>, <span class="keyword">void</span> <span class="number">0</span></div><div class="line">Misc</div></pre></td></tr></table></figure>

<p>这个部分将要说明的想法和理念都并非教条。相反更鼓励对现存实践保持好奇，以尝试提供完成一般 JavaScript 编程任务的更好方案。<br>提前返回值提升代码的可读性并且没有太多性能上的差别</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 不好:</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">returnLate</span><span class="params">(foo)</span> </span>{</div><div class="line">  <span class="keyword">var</span> ret;</div><div class="line">  <span class="keyword">if</span> (foo) {</div><div class="line">    ret = <span class="string">"foo"</span>;</div><div class="line">  } <span class="keyword">else</span> {</div><div class="line">    ret = <span class="string">"quux"</span>;</div><div class="line">  }</div><div class="line">  <span class="keyword">return</span> ret;</div><div class="line">}</div><div class="line"><span class="comment">// 好:</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">returnEarly</span><span class="params">(foo)</span> </span>{</div><div class="line">  <span class="keyword">if</span> (foo) {</div><div class="line">    <span class="keyword">return</span> <span class="string">"foo"</span>;</div><div class="line">  }</div><div class="line">  <span class="keyword">return</span> <span class="string">"quux"</span>;</div><div class="line">}</div></pre></td></tr></table></figure>

<p>for循环遍历</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// for循环遍历:</span></div><div class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>, l = arr.length; i &lt; l; i++){</div><div class="line">    <span class="comment">// doSomething here</span></div><div class="line">}</div><div class="line"><span class="comment">// 上面的方式优于:</span></div><div class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; arr.length; i++){</div><div class="line">    <span class="comment">// doSomething here</span></div><div class="line">}</div><div class="line"><span class="comment">// 前一种方式只会计算一次 arr 的长度，而后一种方式会计算 arr.length + 1 次，效率比较低</span></div></pre></td></tr></table></figure>

<p>保持一致性.<br>当你在编辑代码之前, 先花一些时间查看一下现有代码的风格. 如果他们给算术运算符添加了空格, 你也应该添加. 如果他们的注释使用一个个星号盒子, 那么也请你使用这种方式.<br>代码风格中一个关键点是整理一份常用词汇表, 开发者认同它并且遵循, 这样在代码中就能统一表述. 我们在这提出了一些全局上的风格规则, 但也要考虑自身情况形成自己的代码风格. 但如果你添加的代码和现有的代码有很大的区别, 这就让阅读者感到很不和谐. 所以, 避免这种情况的发生.</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>






  
    <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <time datetime="2014-04-28T05:45:35.000Z"><a href="/2014/04/28/python-mysql-restful/">4月 28 2014</a></time>
      
      
  
    <h1 class="title"><a href="/2014/04/28/python-mysql-restful/">python为mysql实现restful接口</a></h1>
  

    </header>
    <div class="entry">
      
        <p>最近在做游戏服务分层的时候，一直想把mysql的访问独立成一个单独的服务DBGate，原因如下:</p>
<ul>
<li>请求收拢到DBGate，可以使DBGate变为无状态的，方便横向扩展</li>
<li>当请求量或者存储量变大时，mysql需要做分库分表，DBGate可以内部直接处理，外界无感知</li>
<li>通过restful限制对数据请求的形式，仅支持简单的get/post/patch/put 进行增删改查，并不支持复杂查询。这个也是和游戏业务的特性有关，如果网站等需要复杂查询的业务，对此并不适合</li>
<li>DBGate使用多进程模式，方便控制与mysql之间的链接数，进行mysql访问量阀值保护</li>
<li>方便在DBGate上进行访问量统计，慢查询统计、权限控制等等一系列逻辑</li>
<li>目前是使用python，以后要使用其他语言进行mysql操作时，只要进行标准的http请求即可，不会出现不兼容的情况<br>当然坏处也是有的：</li>
<li>首当其冲就是单次请求的响应时间变长，毕竟中间加了一层服务，并且还是http格式</li>
<li>部署上比原来复杂了一些，很多对mysql直接操作的思维需要进行转变，一开始可能会有些不适</li>
</ul>
<p>不过总的来说，还是利大于弊，所以最终还是决定搭建DBGate</p>
<p>当然，我们不可能去手工挨个写每个库表对应的restful服务，值得庆幸的是django和flask都提供了对应的解决方案，我们一个个介绍.</p>
<p>Flask<br>参考链接: flask-restless</p>
<p>flask-restless使用方法比较简单，我直接贴一下代码即可:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"> </div><div class="line"><span class="keyword">import</span> datetime</div><div class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</div><div class="line"><span class="keyword">from</span> flask_sqlalchemy <span class="keyword">import</span> SQLAlchemy</div><div class="line"><span class="keyword">from</span> flask_restless <span class="keyword">import</span> APIManager</div><div class="line"> </div><div class="line"> </div><div class="line">app = Flask(__name__)</div><div class="line">db = SQLAlchemy(app)</div><div class="line">restless = APIManager(app, flask_sqlalchemy_db=db)</div><div class="line"> </div><div class="line"> </div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span><span class="params">(db.Model)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    user</div><div class="line">    """</div><div class="line"> </div><div class="line">    id = db.Column(db.Integer, primary_key=<span class="keyword">True</span>)</div><div class="line">    username = db.Column(db.String(<span class="number">255</span>), unique=<span class="keyword">True</span>, nullable=<span class="keyword">False</span>)</div><div class="line">    password = db.Column(db.String(<span class="number">255</span>), nullable=<span class="keyword">False</span>)</div><div class="line">    create_time = db.Column(db.DateTime, nullable=<span class="keyword">False</span>, default=datetime.datetime.utcnow)</div><div class="line">    login_time = db.Column(db.DateTime)</div><div class="line"> </div><div class="line"> </div><div class="line">restless.create_api(User, methods=[<span class="string">'GET'</span>, <span class="string">'POST'</span>, <span class="string">'DELETE'</span>, <span class="string">'PATCH'</span>, <span class="string">'PUT'</span>], results_per_page=<span class="number">100</span>)</div><div class="line"> </div><div class="line">db.create_all()</div><div class="line"> </div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    app.run(port=<span class="number">25000</span>)</div></pre></td></tr></table></figure>

<p>其对应的restful操作如下:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">获取用户列表:   GET /user</div><div class="line">添加用户:       POST /user</div><div class="line">获取单个用户:   GET /user/<span class="number">1</span></div><div class="line">覆盖单个用户:   PUT /user/<span class="number">1</span></div><div class="line">修改单个用户:   PATCH /user/<span class="number">1</span></div></pre></td></tr></table></figure>

<p>注意:</p>
<ul>
<li>在http请求中，记得加入header: Content-Type: application/json</li>
<li>flask-restless中，PUT和PATCH一样，都是传入什么字段，只修改什么字段，不会完全覆盖</li>
</ul>
<p>Django<br>参考链接: Django REST framework</p>
<p>Django用起来要更复杂一些，也因为django版自带了一个可视化的操作页面，如下:<br><img src="/img/django1.png"></p>
<ol>
<li>在settings中添加:</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">REST_FRAMEWORK = {</div><div class="line">    <span class="comment"># Use hyperlinked styles by default.</span></div><div class="line">    <span class="comment"># Only used if the `serializer_class` attribute is not set on a view.</span></div><div class="line">    <span class="string">'DEFAULT_MODEL_SERIALIZER_CLASS'</span>:</div><div class="line">        <span class="string">'rest_framework.serializers.HyperlinkedModelSerializer'</span>,</div><div class="line"> </div><div class="line">    <span class="comment"># Use Django's standard `django.contrib.auth` permissions,</span></div><div class="line">    <span class="comment"># or allow read-only access for unauthenticated users.</span></div><div class="line">    <span class="string">'DEFAULT_PERMISSION_CLASSES'</span>: [</div><div class="line">        <span class="comment">#'rest_framework.permissions.DjangoModelPermissionsOrAnonReadOnly',</span></div><div class="line">        <span class="string">'rest_framework.permissions.IsAdminUser'</span>,</div><div class="line">    ]</div><div class="line">}</div></pre></td></tr></table></figure>

<ol>
<li><p>通过startapp建立一个app: demo</p>
</li>
<li><p>修改demo的models:</p>
</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span><span class="params">(models.Model)</span>:</span></div><div class="line">    <span class="comment"># key是保留字</span></div><div class="line">    password = models.IntegerField()</div><div class="line">    nick = models.CharField(max_length=<span class="number">255</span>)</div><div class="line">    create_time = models.DateTimeField(default=datetime.datetime.now)</div></pre></td></tr></table></figure>

<ol>
<li>在demo下新建serializers.py</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</div><div class="line"><span class="keyword">from</span> models <span class="keyword">import</span> User</div><div class="line"> </div><div class="line"> </div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserSerializer</span><span class="params">(serializers.ModelSerializer)</span>:</span></div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></div><div class="line">        model = User</div></pre></td></tr></table></figure>

<ol>
<li>在demo下修改views.py</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</div><div class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> viewsets</div><div class="line"> </div><div class="line"><span class="keyword">from</span> serializers <span class="keyword">import</span> UserSerializer</div><div class="line"><span class="keyword">from</span> models <span class="keyword">import</span> User</div><div class="line"> </div><div class="line"> </div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserViewSet</span><span class="params">(viewsets.ModelViewSet)</span>:</span></div><div class="line">    queryset = User.objects.all()</div><div class="line">    serializer_class = UserSerializer</div></pre></td></tr></table></figure>

<ol>
<li>在demo下新建urls.py</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> os.path</div><div class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> patterns, include, url</div><div class="line"><span class="keyword">from</span> django.conf.urls.static <span class="keyword">import</span> static</div><div class="line"><span class="keyword">from</span> django.conf <span class="keyword">import</span> settings</div><div class="line"><span class="keyword">import</span> views</div><div class="line"> </div><div class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> routers</div><div class="line"> </div><div class="line">appname = os.path.basename(os.path.dirname(os.path.abspath(__file__)))</div><div class="line"> </div><div class="line">router = routers.DefaultRouter()</div><div class="line">router.register(<span class="string">'users'</span>, views.UserViewSet, appname)</div><div class="line"> </div><div class="line">urlpatterns = patterns(<span class="string">''</span>,</div><div class="line">                       url(<span class="string">r'^'</span>, include(router.urls)),</div><div class="line">)</div></pre></td></tr></table></figure>

<ol>
<li>在mysite.urls下include demo.urls和rest_framework.urls</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">urlpatterns = patterns(<span class="string">''</span>,</div><div class="line">    url(<span class="string">r'^demo/'</span>, include(<span class="string">'demo.urls'</span>)),</div><div class="line">    url(<span class="string">r'^admin/'</span>, include(admin.site.urls)),</div><div class="line">    url(<span class="string">r'^api-auth/'</span>, include(<span class="string">'rest_framework.urls'</span>, namespace=<span class="string">'rest_framework'</span>))</div><div class="line">)</div></pre></td></tr></table></figure>

<ol>
<li>执行初始化数据操作:</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">python manage.py syncdb</div></pre></td></tr></table></figure>

<p>之后访问: <a href="http://127.0.0.1:8000/demo" target="_blank" rel="external">http://127.0.0.1:8000/demo</a> 即可看到如下界面了:<br><img src="/img/django2.png"></p>
<p>对应的测试代码如下:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> json</div><div class="line"><span class="keyword">import</span> requests</div><div class="line"><span class="keyword">from</span> urlparse <span class="keyword">import</span> urljoin</div><div class="line"> </div><div class="line">BASE_URL = <span class="string">'http://127.0.0.1:16500/'</span></div><div class="line">AUTH = (<span class="string">'admin'</span>, <span class="string">'admin'</span>)</div><div class="line"> </div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_get_user_list</span><span class="params">()</span>:</span></div><div class="line">    rsp = requests.get(urljoin(BASE_URL, <span class="string">'/demo/users/'</span>), auth=AUTH, headers={</div><div class="line">        <span class="string">'Accept'</span>: <span class="string">'application/json'</span></div><div class="line">    })</div><div class="line">    <span class="keyword">assert</span> rsp.ok</div><div class="line"> </div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_post_user_list</span><span class="params">()</span>:</span></div><div class="line">    json_data = dict(</div><div class="line">        password=<span class="number">0</span>,</div><div class="line">        nick=<span class="string">'oo'</span>,</div><div class="line">        create_time=<span class="string">'2014-03-3T03:3:3'</span></div><div class="line">    )</div><div class="line">    rsp = requests.post(urljoin(BASE_URL, <span class="string">'/demo/users/'</span>), auth=AUTH, headers={</div><div class="line">        <span class="string">'Accept'</span>: <span class="string">'application/json'</span>,</div><div class="line">        <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span>,</div><div class="line">    }, data=json.dumps(json_data))</div><div class="line">    <span class="keyword">assert</span> rsp.ok</div><div class="line"> </div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_get_user</span><span class="params">()</span>:</span></div><div class="line">    rsp = requests.get(urljoin(BASE_URL, <span class="string">'/demo/users/1'</span>), auth=AUTH, headers={</div><div class="line">        <span class="string">'Accept'</span>: <span class="string">'application/json'</span>,</div><div class="line">        <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span>,</div><div class="line">    })</div><div class="line">    <span class="keyword">assert</span> rsp.ok</div><div class="line"> </div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_put_user</span><span class="params">()</span>:</span></div><div class="line">    json_data = dict(</div><div class="line">        password=<span class="number">100</span>,</div><div class="line">        nick=<span class="string">'xx'</span>,</div><div class="line">        create_time=<span class="string">'2014-03-3T03:3:3'</span></div><div class="line">    )</div><div class="line">    <span class="comment"># 注意最后的 /</span></div><div class="line">    rsp = requests.put(urljoin(BASE_URL, <span class="string">'/demo/users/1/'</span>), auth=AUTH, headers={</div><div class="line">        <span class="string">'Accept'</span>: <span class="string">'application/json'</span>,</div><div class="line">        <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span>,</div><div class="line">        }, data=json.dumps(json_data),</div><div class="line">    )</div><div class="line">    <span class="keyword">assert</span> rsp.ok, rsp.status_code</div><div class="line"> </div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_patch_user</span><span class="params">()</span>:</span></div><div class="line">    json_data = dict(</div><div class="line">        password=<span class="number">300</span>,</div><div class="line">        )</div><div class="line">    rsp = requests.patch(urljoin(BASE_URL, <span class="string">'/demo/users/1/'</span>), auth=AUTH, headers={</div><div class="line">        <span class="string">'Accept'</span>: <span class="string">'application/json'</span>,</div><div class="line">        <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span>,</div><div class="line">        }, data=json.dumps(json_data),</div><div class="line">    )</div><div class="line">    <span class="keyword">assert</span> rsp.ok, rsp.status_code</div></pre></td></tr></table></figure>

<p>Django REST framework 是严格区分PUT和PATCH的，这一点和flask-restless 不一样，需要注意。</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>






  

  <ul class="page-direction" id="page-direction">
    <li><a class="page-prev icon-chevron-sign-left" href="javascript:;" title="上一页"></a></li>
    <li><a class="page-next icon-chevron-sign-right" href="javascript:;" title="下一页"></a></li>
</ul>

    <nav id="page-list" class="page-list"><a class="extend prev" rel="prev" href="/categories/日志/">Prev</a><a class="page-number" href="/categories/日志/">1</a><span class="page-number current">2</span><a class="page-number" href="/categories/日志/page/3/">3</a><a class="extend next" rel="next" href="/categories/日志/page/3/">Next</a></nav>

<nav id="pagination">
  
    <a href="/categories/日志/" class="alignleft prev">上一页</a>
  
  
    <a href="/categories/日志/page/3/" class="alignright next">下一页</a>
  
  <div class="clearfix"></div>
</nav>
</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="text" name="q" results="0" placeholder="搜一下">
    <i class="icon-search"></i>
    <input type="hidden" name="q" value="site:lawrence-zxc.github.io">
  </form>
</div>

  
<div class="widget tag">
  <h3 class="title">标签</h3>
  <ul class="entry">
  
    <li><a href="/tags/Java/">Java</a><small>9</small></li>
  
    <li><a href="/tags/JavaScript/">JavaScript</a><small>4</small></li>
  
    <li><a href="/tags/Linux/">Linux</a><small>6</small></li>
  
    <li><a href="/tags/Mac-Unix/">Mac/Unix</a><small>1</small></li>
  
    <li><a href="/tags/Mongodb/">Mongodb</a><small>1</small></li>
  
    <li><a href="/tags/Mysql/">Mysql</a><small>3</small></li>
  
    <li><a href="/tags/Nginx/">Nginx</a><small>4</small></li>
  
    <li><a href="/tags/Oracle/">Oracle</a><small>2</small></li>
  
    <li><a href="/tags/Python/">Python</a><small>3</small></li>
  
    <li><a href="/tags/其他/">其他</a><small>1</small></li>
  
    <li><a href="/tags/前端/">前端</a><small>1</small></li>
  
    <li><a href="/tags/开始/">开始</a><small>3</small></li>
  
    <li><a href="/tags/技术/">技术</a><small>2</small></li>
  
    <li><a href="/tags/旅行/">旅行</a><small>1</small></li>
  
    <li><a href="/tags/架构/">架构</a><small>2</small></li>
  
    <li><a href="/tags/理财/">理财</a><small>1</small></li>
  
    <li><a href="/tags/生活/">生活</a><small>1</small></li>
  
    <li><a href="/tags/读书/">读书</a><small>1</small></li>
  
    <li><a href="/tags/随感/">随感</a><small>2</small></li>
  
  </ul>
</div>


  <div class="trace-invest">
    <span>
        <a href="https://github.com/Lawrence-zxc" target="_blank">欢迎光临我的技术Blog网站 </br>Fork me on Github</a>
    </span>
</div>


  
<div class="widget tag">
  <h3 class="title">最新文章</h3>
  <ul class="entry">
    
      <li>
        <a href="/2014/10/28/jvm-strace/">jvm退出的原因,使用strace定位</a>
      </li>
    
      <li>
        <a href="/2014/10/28/load-balancing/">负载均衡和过载保护</a>
      </li>
    
      <li>
        <a href="/2014/10/24/java-regex/">正则表达式匹配中文</a>
      </li>
    
      <li>
        <a href="/2014/10/23/qiu/">秋</a>
      </li>
    
      <li>
        <a href="/2014/10/14/blog2/">RESTful Web Services中API的设计原则</a>
      </li>
    
      <li>
        <a href="/2014/10/11/switch-hosts/">分享一个切换hosts的python脚本</a>
      </li>
    
      <li>
        <a href="/2014/10/09/blog4/">mysql多列索引详解</a>
      </li>
    
      <li>
        <a href="/2014/10/05/rizhi/">琐忆</a>
      </li>
    
      <li>
        <a href="/2014/10/01/aboutMe/">关于我</a>
      </li>
    
      <li>
        <a href="/2014/09/21/centos-install-oracle/">centos install oracle 11g</a>
      </li>
    
      <li>
        <a href="/2014/09/18/blog3/">Nginx+Lua+GraphicsMagick实现动态生成指定尺寸的图片</a>
      </li>
    
      <li>
        <a href="/2014/09/05/blog1/">REST风格的软件架构</a>
      </li>
    
  </ul>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <div id="go-pg-top"><i class="icon-arrow-up"></i></div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2014 Jeck Zhang
  
</div>
<div class="clearfix"></div></footer>
  <script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript" charset="utf-8" src="/js/page.js"></script>

</body>

</html>