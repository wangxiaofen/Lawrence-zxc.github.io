<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>第 6 页 | Jeck_Zhang</title>
  <meta name="author" content="Jeck Zhang">
  
  <meta name="description" content="zxc&#39;s blog | java | ruby | perl | linux">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="Jeck_Zhang"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link type="image/x-icon" href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Jeck_Zhang" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script src="/js/jquery.min.js"></script>
  
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-45019001-1', 'topdna.org');
  ga('send', 'pageview');

</script>


</head>


<body>
  <!--[if lte IE 8]> <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'> <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode"><img src="http://storage.ie6countdown.com/assets/100/images/banners/warning_bar_0027_Simplified Chinese.jpg" border="0" height="42" width="820" alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today." style='margin-left:auto;margin-right:auto;display: block;'/></a></div> <![endif]-->
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">Jeck_Zhang</a></h1>
  <h2><a href="/">Write the Code. Change the World.</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">首页</a></li>
    
      <li><a href="http://weibo.com/zxc337">weibo</a></li>
    
      <li><a href="/2014/10/01/aboutMe/">关于</a></li>
    
      <li><a href="/tags/随感/">随感</a></li>
    
      <li><a href="/tags/技术/">技术</a></li>
    
      <li><a href="/tags/理财/">理财</a></li>
    
      <li><a href="/tags/生活/">生活</a></li>
    
      <li><a href="/archives">归档</a></li>
    
    <li><a href="/atom.xml">RSS</a></li>
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper">
  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <time datetime="2012-04-16T09:05:42.000Z"><a href="/2012/04/16/java-object-init/">4月 16 2012</a></time>
      
      
  
    <h1 class="title"><a href="/2012/04/16/java-object-init/">java对象初始化顺序问题</a></h1>
  

    </header>
    <div class="entry">
      
        <p>今天我在Dzone阅读了一篇关于<a href="http://java.dzone.com/articles/java-object-initialization?utm_source=feedburner&amp;utm_medium=feed&amp;utm_campaign=Feed%3A+javalobby%2Ffrontpage+%28Javalobby+%2F+Java+Zone%29&amp;utm_content=" target="_blank" rel="external">java对象实例初始化顺序</a>的有趣文章。说它有趣，是因为作者使用了一种并不太推荐的编码风格，只有用这种编码风格才能触发这个极为少见的 Java object initialization order 问题。</p>
<p>其实java对象初始化顺序算是一个比较基础的java知识点。但是网上的文章多半描述不清，使用上一不小心就容易出问题。<br>所以在本文中，我想结合JLS和自己的理解，举例剖析问题的所在。</p>
<p>OK，我们先来看个模仿Dzone作者原意的简单例子:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.zxc.tmp;</div><div class="line"><span class="comment">//</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span> <span class="keyword">extends</span> <span class="title">B</span> </span>{</div><div class="line">	<span class="keyword">public</span> <span class="keyword">int</span> a = <span class="number">100</span>;</div><div class="line">	<span class="comment">//</span></div><div class="line">	<span class="keyword">public</span> <span class="title">A</span>() {</div><div class="line">		<span class="keyword">super</span>();</div><div class="line">		System.out.println(a);</div><div class="line">		a = <span class="number">200</span>;</div><div class="line">	}</div><div class="line">	<span class="comment">//</span></div><div class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(String[] args) {</div><div class="line">		System.out.println(<span class="keyword">new</span> A().a);</div><div class="line">	}</div><div class="line">}</div><div class="line"><span class="comment">//</span></div><div class="line">class B {</div><div class="line">	<span class="keyword">public</span> <span class="title">B</span>() {</div><div class="line">		System.out.println(((A) <span class="keyword">this</span>).a);</div><div class="line">	}</div><div class="line">}</div></pre></td></tr></table></figure>

<p>例子代码很简单，不多做解释了，直接看输出:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="number">0</span></div><div class="line"><span class="number">100</span></div><div class="line"><span class="number">200</span></div></pre></td></tr></table></figure>

<p>对照这个输出，我们来详细分析一下对象的初始化顺序：<br>1，为A类分配内存空间，初始化所有成员变量为默认值，包括primitive类型(int=0,boolean=false,…)和Reference类型。<br>2，调用A类构造函数。<br>3，调用B类构造函数。<br>4，调用Object空构造函数。（java编译器会默认加此构造函数，且object构造函数是个空函数，所以立即返回）<br>5，<strong>初始化B类成员变量，因为B类没有成员变量，跳过。</strong><br>6，执行sysout输出子类A的成员变量小a。// 此时为0<br>7，<strong>初始化A类成员变量，将A类成员变量小a赋值100。</strong><br>8，执行sysout输出当前A类的成员变量小a。// 此时为100<br>9，赋值当前A类的成员变量小a为200。<br>10，main函数中执行sysout，输出A类实例的成员变量小a。// 此时为200</p>
<p>加粗的那两行描述是重点，结论是<strong>成员变量初始化是在父类构造函数调用完后，在此之前，成员变量的值均是默认值。</strong><br>Dzone作者就是栽在这里，没有仔细分析成员变量初始化在对象初始化中的顺序，造成了程序未按原意执行。<br>其实这类问题，熟悉原理是一方面，本质上只要不在构造函数中插入过多的业务逻辑，出问题的概率也会低很多。</p>
<p>最后，我们再来看看JLS中给出的Java类对象初始化顺序定义，这是一个带条件分支的流程描述：</p>
<ul>
<li>Assign the arguments for the constructor to newly created parameter variables for this constructor invocation.</li>
<li>If this constructor begins with an explicit constructor invocation of another constructor in the same class (using this), then evaluate the arguments and process that constructor invocation recursively using these same five steps. If that constructor invocation completes abruptly, then this procedure completes abruptly for the same reason; otherwise, continue with step 5.</li>
<li>This constructor does not begin with an explicit constructor invocation of another constructor in the same class (using this). If this constructor is for a class other than Object, then this constructor will begin with an explicit or implicit invocation of a superclass constructor (using super). Evaluate the arguments and process that superclass constructor invocation recursively using these same five steps. If that constructor invocation completes abruptly, then this procedure completes abruptly for the same reason. Otherwise, continue with step 4.</li>
<li>Execute the instance initializers and instance variable initializers for this class, assigning the values of instance variable initializers to the corresponding instance variables, in the left-to-right order in which they appear textually in the source code for the class. If execution of any of these initializers results in an exception, then no further initializers are processed and this procedure completes abruptly with that same exception. Otherwise, continue with step 5. (In some early implementations, the compiler incorrectly omitted the code to initialize a field if the field initializer expression was a constant expression whose value was equal to the default initialization value for its type.)</li>
<li>Execute the rest of the body of this constructor. If that execution completes abruptly, then this procedure completes abruptly for the same reason. Otherwise, this procedure completes normally.</li>
</ul>
<p>引用自 <a href="http://java.sun.com/docs/books/jls/second_edition/html/execution.doc.html#44670" target="_blank" rel="external">section 12.5 of the Java Language Spec</a></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>







  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <time datetime="2012-03-23T05:12:38.000Z"><a href="/2012/03/23/java-oop/">3月 23 2012</a></time>
      
      
  
    <h1 class="title"><a href="/2012/03/23/java-oop/">面向对象的SOLID原则与Java类库框架设计哲学</a></h1>
  

    </header>
    <div class="entry">
      
        <p>面向对象编程注重的是：</p>
<ul>
<li>1）数据和其行为的打包封装</li>
<li>2）程序的接口和实现的解耦</li>
</ul>
<p>一般来说以下是面向对象的五大设计原则，但是，我觉得这些原则可适用于所有的软件开发。</p>
<h3 id="Single_Responsibility_Principle_(SRP)_–_职责单一原则">Single Responsibility Principle (SRP) – 职责单一原则</h3>
<p>关于单一职责原则，其核心的思想是：<strong>一个类，只做一件事，并把这件事做好，其只有一个引起它变化的原因</strong>。单一职责原则可以看作是低耦合、高内聚在面向对象原则上的引申，将职责定义为引起变化的原因，以提高内聚性来减少引起变化的原因。职责过多，可能引起它变化的原因就越多，这将导致职责依赖，相互之间就产生影响，从而极大的损伤其内聚性和耦合度。单一职责，通常意味着单一的功能，因此不要为一个模块实现过多的功能点，以保证实体只有一个引起它变化的原因。</p>
<p>换一种理解思路：职责单一是<strong>模块化思想</strong>的最好体现,所有的对象小而美,只关注一件事并做好它,</p>
<ul>
<li>Unix/Linux是这一原则的完美体现者。各个程序都独立负责一个单一的事。</li>
<li>Windows是这一原则的反面示例。几乎所有的程序都交织耦合在一起。</li>
</ul>
<h3 id="Open/Closed_Principle_(OCP)_–_开闭原则">Open/Closed Principle (OCP) – 开闭原则</h3>
<p>关于开发封闭原则，其核心的思想是：模块是可扩展的，而不可修改的。也就是说，<strong>对扩展是开放的，而对修改是封闭的</strong>。</p>
<p>对扩展开放，意味着有新的需求或变化时，可以对现有代码进行扩展，以适应新的情况。<br>对修改封闭，意味着类一旦设计完成，就可以独立完成其工作，而不要对类进行任何修改。<br>对于面向对象来说，需要你依赖抽象，而不是实现，23个经典设计模式中的“策略模式”就是这个实现。对于非面向对象编程，一些API需要你传入一个你可以扩展的函数，比如我们的C 语言的qsort()允许你提供一个“比较器”，STL中的容器类的内存分配，ACE中的多线程的各种锁。对于软件方面，浏览器的各种插件属于这个原则的实践。</p>
<h3 id="Liskov_substitution_principle_(LSP)_–_里氏代换原则">Liskov substitution principle (LSP) – 里氏代换原则</h3>
<p>软件工程大师Robert C. Martin把里氏代换原则最终简化为一句话：<em>“Subtypes must be substitutable for their base types”</em>。也就是，子类必须能够替换成它们的基类。即：子类应该可以替换任何基类能够出现的地方，并且经过替换以后，代码还能正常工作。另外，不应该在代码中出现if/else之类对子类类型进行判断的条件。里氏替换原则LSP是使代码符合开闭原则的一个重要保证。正是由于子类型的可替换性才使得父类型的模块在无需修改的情况下就可以扩展。</p>
<p>这么说来，似乎有点教条化，我非常建议大家看看这个原则个两个最经典的案例——“正方形不是长方形”和“鸵鸟不是鸟”。通过这两个案例，你会明白《墨子 小取》中说的 ——“娣，美人也，爱娣，非爱美人也….盗，人也；恶盗，非恶人也。”——妹妹虽然是美人，但喜欢妹妹并不代表喜欢美人。盗贼是人，但讨厌盗贼也并不代表就讨厌人类。<strong>这个原则让你考虑的不是语义上对象的间的关系，而是实际需求的环境</strong>。</p>
<p>在很多情况下，在设计初期我们类之间的关系不是很明确，LSP则给了我们一个判断和设计类之间关系的基准：需不需要继承，以及怎样设计继承关系。</p>
<h3 id="Interface_Segregation_Principle_(ISP)_–_接口隔离原则">Interface Segregation Principle (ISP) – 接口隔离原则</h3>
<p>接口隔离原则意思是把功能实现在接口中，而不是类中，使用多个专门的接口比使用单一的总接口要好。</p>
<p>举个例子，我们对电脑有不同的使用方式，比如：写作，通讯，看电影，打游戏，上网，编程，计算，数据等，如果我们把这些功能都声明在电脑的抽类里面，那么，我们的上网本，PC机，服务器，笔记本的实现类都要实现所有的这些接口，这就显得太复杂了。所以，我们可以把其这些功能接口隔离开来，比如：工作学习接口，编程开发接口，上网娱乐接口，计算和数据服务接口，这样，我们的不同功能的电脑就可以有所选择地继承这些接口。</p>
<p>这个原则可以提升我们“搭积木式”的软件开发。对于设计来说，Java中的各种Event Listener和Adapter，对于软件开发来说，不同的用户权限有不同的功能，不同的版本有不同的功能，都是这个原则的应用。</p>
<h3 id="Dependency_Inversion_Principle_(DIP)_–_依赖倒置原则">Dependency Inversion Principle (DIP) – 依赖倒置原则</h3>
<p>高层模块不应该依赖于低层模块的实现，而是依赖于高层抽象。</p>
<p>举个例子，墙面的开关不应该依赖于电灯的开关实现，而是应该依赖于一个抽象的开关的标准接口，这样，当我们扩展程序的时候，我们的开关同样可以控制其它不同的灯，甚至不同的电器。也就是说，电灯和其它电器继承并实现我们的标准开关接口，而我们的开关产商就可不需要关于其要控制什么样的设备，只需要关心那个标准的开关标准。这就是依赖倒置原则。</p>
<p>这就好像浏览器并不依赖于后面的web服务器，其只依赖于HTTP协议。这个原则实在是太重要了，社会的分工化，标准化都是这个设计原则的体现。</p>
<p><br></p>
<p>J2EE开发主流的应用框架Spring很好地践行了以上这些设计思想,下面来聊聊Spring的设计哲学;</p>
<h3 id="Spring_IOC">Spring IOC</h3>
<p>控制反转依赖注入并不是我们嘴上说说的，它是一个非常实用的理念，是一种设计思想，很好地诠释了依赖倒置原则和中介者思想(缓存思想)。</p>
<p>前SUN公司首席科学家 <em>Bill Joy</em> 说过:<strong><em>在计算机系结构领域中，<code>缓存</code>是唯一能称得上伟大的思想，其他的一切发明和技术不过是在不同场景下运用这一思想而已</em></strong>。其实这句话我觉得可以适用用任何一个计算机以及编程领域。里面的<code>缓存</code>可以理解为<code>中间件</code>，<code>代理</code>或者<code>映射</code>。Java 因为有了<code>JVM</code> 能够模拟机器，所示使它能够跨平台。这里的JVM也是一个缓存。其实<code>缓存的思想</code>在现实中也是如此，你做不了的事情，你可以通过别人帮你做，此时别人就成了缓存。有时候面对复杂的框架的时候，我们第一直觉就可以把它当做一个缓存，因为这些框架做的事我们都可以做，只是我们现在把我们原本应该做的事让框架帮我们做了，我们试着去想这个框架可以代替我做那些事，我用这个框架可以节省我那些操作，去用它而不是一开始就去研究它。</p>
<p>有些人即使在使用了IOC之后还没有意识到为什么要用IOC，经常面临这些问题:</p>
<ul>
<li>不知道为什么要用IOC容器来创建对象，自己手动new对象出来有什么不好？</li>
<li>自己写一个单例的对象也可以实现需求，为什么一定要用容器创建？</li>
</ul>
<p>IOC容器的意义在于：</p>
<ul>
<li>管理了对象之间的关系</li>
</ul>
<p>在面向对象编程中我们过多的使用组合思想，对象与对象相互依赖，关系非常复杂，在没有使用Ioc容器的时候，通常的做法是在new对象的时候来构建并管理这种对象的依赖关系，最普遍的手段是写死在代码里面，甚至把需要调用的实际对象类型也写死，这种做法几乎失去了面向接口编程的意义，代码错综复杂，有时为了理清楚对象间的依赖关系而花费过多不必要时间，这完全背离了 <strong><em>职责单一原则</em></strong> 思想，事实上对象不仅需要管理对象内部逻辑，还需要管理与其他对象间的依赖关系，对象会直接控制其他对象及其生命周期等。</p>
<p>那么这时候我们会想到把依赖关系托付给第三方，比如Spring Ioc配置文件，Spring注解等，由Ioc容器动态创建对象和对象间的依赖关系，其实就是把原先由对象自己管理的依赖关系，从对象内部剥离了出来，让对象的职责更单一，在对象需要的时候再由Ioc容器注入进去。这里集中体现了中介思想和缓存思想，Ioc容器此时相对于一个中介，管理着众多大大小小的Bean对象。</p>
<p>使用Ioc容器后具体对象不再依赖于另一个具体对象实现类，而只是依赖于它的接口。创建和控制具体对象都转到了Ioc容器本身来负责。至此，对象的创建和生命周期的控制，得到了反转。这里控制了什么呢？又反转了什么呢？其实就是把对对象的管理权交给了Ioc容器，对象之间好像不再有依赖关系了，对象只依赖于接口协议。这样一来，对象就只有选择接口实现类的权利而没有设计管理接口实现类的权利。好像整个编程过程中，控制反转到了接口(协议)这一边。</p>
<p>在一个分层架构的应用程序中，我们不仅仅注入平行层级的对象，还可以注入下级对象，实现从上到下的自动注入，整个系统就非常灵活。使用Ioc容器带来的好处是，使用户代码和具体对象的创建相分离，解决了耦合度，使具体对象可以在用户代码外部注入，以类似组件plugin的方式灵活注入。用户的业务代码以及要注入的依赖对象都是相对独立的模块，可以在其它地方使用。</p>
<ul>
<li>管理了对象的生命周期</li>
</ul>
<p>有时候写出了单例或者是new出来的对象，还会有根据线程、根据请求来的特殊生命周期的对象，如果手写代码来管理生命周期一来很麻烦，二来也不方便调整，通过容器来管理对象的生命周期简单高效，并且我们很容易对Ioc容器进行扩展提供不同的生命周期的Bean，也就是可扩展生命周期的类型。</p>
<p>当我们引入了Ioc容器后，它也会根据自身需要去独立发展，形成很多新的需求点出来，比如AOP，SpringMVC等等一些即插即用的组件。</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>







  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <time datetime="2012-03-11T03:15:44.000Z"><a href="/2012/03/11/leetcode/">3月 11 2012</a></time>
      
      
  
    <h1 class="title"><a href="/2012/03/11/leetcode/">LeetCode题目解答,Java实现(Hard部分)</a></h1>
  

    </header>
    <div class="entry">
      
        <p>以下是LeetCode题目解答的最后一部分：Hard部分,以下代码均用java实现。</p>
<table>
<thead>
<tr>
<th><a href="https://leetcode.com/problemset/" target="_blank" rel="external">Title</a></th>
<th style="text-align:center"><a href="https://leetcode.com/problemset/" target="_blank" rel="external">Acceptance</a></th>
<th style="text-align:center"><a href="https://leetcode.com/problemset/" target="_blank" rel="external">Difficulty</a></th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#text-justification">Text Justification</a></td>
<td style="text-align:center">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;14.0%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td style="text-align:center">Hard</td>
</tr>
<tr>
<td><a href="#search-in-rotated-sorted-array">Search in Rotated Sorted Array</a></td>
<td style="text-align:center">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;28.6%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td style="text-align:center">Hard</td>
</tr>
<tr>
<td><a href="#binary-tree-maximum-path-sum">Binary Tree Maximum Path Sum</a></td>
<td style="text-align:center">20.2%</td>
<td style="text-align:center">Hard</td>
</tr>
<tr>
<td><a href="#reverse-nodes-in-k-group">Reverse Nodes in k-Group</a></td>
<td style="text-align:center">24.9%</td>
<td style="text-align:center">Hard</td>
</tr>
<tr>
<td><a href="#binary-tree-postorder-traversal">Binary Tree Postorder Traversal</a></td>
<td style="text-align:center">31.0%</td>
<td style="text-align:center">Hard</td>
</tr>
<tr>
<td><a href="#candy">Candy</a></td>
<td style="text-align:center">19.3%</td>
<td style="text-align:center">Hard</td>
</tr>
<tr>
<td><a href="#edit-distance">Edit Distance</a></td>
<td style="text-align:center">25.5%</td>
<td style="text-align:center">Hard</td>
</tr>
<tr>
<td><a href="#recover-binary-search-tree">Recover Binary Search Tree</a></td>
<td style="text-align:center">23.7%</td>
<td style="text-align:center">Hard</td>
</tr>
<tr>
<td><a href="#populating-next-right-pointers-in-each-node-ii">Populating Next Right Pointers in Each Node II</a></td>
<td style="text-align:center">30.7%</td>
<td style="text-align:center">Hard</td>
</tr>
<tr>
<td><a href="#permutations-ii">Permutations II</a></td>
<td style="text-align:center">25.0%</td>
<td style="text-align:center">Hard</td>
</tr>
<tr>
<td><a href="#best-time-to-buy-and-sell-stock-iii">Best Time to Buy and Sell Stock III</a></td>
<td style="text-align:center">22.4%</td>
<td style="text-align:center">Hard</td>
</tr>
<tr>
<td><a href="#palindrome-partitioning-ii">Palindrome Partitioning II</a></td>
<td style="text-align:center">18.3%</td>
<td style="text-align:center">Hard</td>
</tr>
<tr>
<td><a href="#n-queens-ii">N-Queens II</a></td>
<td style="text-align:center">33.9%</td>
<td style="text-align:center">Hard</td>
</tr>
<tr>
<td><a href="#substring-with-concatenation-of-all-words">Substring with Concatenation of All Words</a></td>
<td style="text-align:center">18.1%</td>
<td style="text-align:center">Hard</td>
</tr>
<tr>
<td><a href="#sudoku-solver">Sudoku Solver</a></td>
<td style="text-align:center">20.9%</td>
<td style="text-align:center">Hard</td>
</tr>
<tr>
<td><a href="#n-queens">N-Queens</a></td>
<td style="text-align:center">25.9%</td>
<td style="text-align:center">Hard</td>
</tr>
<tr>
<td><a href="#minimum-window-substring">Minimum Window Substring</a></td>
<td style="text-align:center">18.1%</td>
<td style="text-align:center">Hard</td>
</tr>
<tr>
<td><a href="#merge-k-sorted-lists">Merge k Sorted Lists</a></td>
<td style="text-align:center">21.2%</td>
<td style="text-align:center">Hard</td>
</tr>
<tr>
<td><a href="#merge-intervals">Merge Intervals</a></td>
<td style="text-align:center">20.9%</td>
<td style="text-align:center">Hard</td>
</tr>
<tr>
<td><a href="#scramble-string">Scramble String</a></td>
<td style="text-align:center">22.8%</td>
<td style="text-align:center">Hard</td>
</tr>
<tr>
<td><a href="#trapping-rain-water">Trapping Rain Water</a></td>
<td style="text-align:center">28.9%</td>
<td style="text-align:center">Hard</td>
</tr>
<tr>
<td><a href="#median-of-two-sorted-arrays">Median of Two Sorted Arrays</a></td>
<td style="text-align:center">17.6%</td>
<td style="text-align:center">Hard</td>
</tr>
<tr>
<td><a href="#maximal-rectangle">Maximal Rectangle</a></td>
<td style="text-align:center">21.5%</td>
<td style="text-align:center">Hard</td>
</tr>
<tr>
<td><a href="#max-points-on-a-line">Max Points on a Line</a></td>
<td style="text-align:center">11.2%</td>
<td style="text-align:center">Hard</td>
</tr>
<tr>
<td><a href="#lru-cache">LRU Cache</a></td>
<td style="text-align:center">14.1%</td>
<td style="text-align:center">Hard</td>
</tr>
<tr>
<td><a href="#longest-valid-parentheses">Longest Valid Parentheses</a></td>
<td style="text-align:center">19.7%</td>
<td style="text-align:center">Hard</td>
</tr>
<tr>
<td><a href="#longest-consecutive-sequence">Longest Consecutive Sequence</a></td>
<td style="text-align:center">28.2%</td>
<td style="text-align:center">Hard</td>
</tr>
<tr>
<td><a href="#copy-list-with-random-pointer">Copy List with Random Pointer</a></td>
<td style="text-align:center">23.5%</td>
<td style="text-align:center">Hard</td>
</tr>
<tr>
<td><a href="#largest-rectangle-in-histogram">Largest Rectangle in Histogram</a></td>
<td style="text-align:center">21.5%</td>
<td style="text-align:center">Hard</td>
</tr>
<tr>
<td><a href="#jump-game-ii">Jump Game II</a></td>
<td style="text-align:center">24.7%</td>
<td style="text-align:center">Hard</td>
</tr>
<tr>
<td><a href="#interleaving-string">Interleaving String</a></td>
<td style="text-align:center">19.5%</td>
<td style="text-align:center">Hard</td>
</tr>
<tr>
<td><a href="#insert-interval">Insert Interval</a></td>
<td style="text-align:center">20.7%</td>
<td style="text-align:center">Hard</td>
</tr>
<tr>
<td><a href="#wildcard-matching">Wildcard Matching</a></td>
<td style="text-align:center">14.3%</td>
<td style="text-align:center">Hard</td>
</tr>
<tr>
<td><a href="#distinct-subsequences">Distinct Subsequences</a></td>
<td style="text-align:center">25.0%</td>
<td style="text-align:center">Hard</td>
</tr>
<tr>
<td><a href="#word-break-ii">Word Break II</a></td>
<td style="text-align:center">16.6%</td>
<td style="text-align:center">Hard</td>
</tr>
<tr>
<td><a href="#first-missing-positive">First Missing Positive</a></td>
<td style="text-align:center">22.6%</td>
<td style="text-align:center">Hard</td>
</tr>
<tr>
<td><a href="#word-ladder-ii">Word Ladder II</a></td>
<td style="text-align:center">11.5%</td>
<td style="text-align:center">Hard</td>
</tr>
<tr>
<td><a href="#find-minimum-in-rotated-sorted-array-ii">Find Minimum in Rotated Sorted Array II</a></td>
<td style="text-align:center">27.9%</td>
<td style="text-align:center">Hard</td>
</tr>
<tr>
<td><a href="#regular-expression-matching">Regular Expression Matching</a></td>
<td style="text-align:center">20.2%</td>
<td style="text-align:center">Hard</td>
</tr>
</tbody>
</table>
<h3 id="Text_Justification"><span id="text-justification" style="color: #ff0000;">Text Justification</span></h3>
<p>【题目】Given an array of words and a length L, format the text such that each line has exactly L characters and is fully (left and right) justified.<br>You should pack your words in a greedy approach; that is, pack as many words as you can in each line. Pad extra spaces ‘ ‘ when necessary so that each line has exactly Lcharacters.<br>Extra spaces between words should be distributed as evenly as possible. If the number of spaces on a line do not divide evenly between words, the empty slots on the left will be assigned more spaces than the slots on the right.<br>For the last line of text, it should be left justified and no extra space is inserted between words.</p>
<p>For example,<br>words: [“This”, “is”, “an”, “example”, “of”, “text”, “justification.”]<br>L: 16.</p>
<p>Return the formatted lines as:<br>[<br>   “This    is    an”,<br>   “example  of text”,<br>   “justification.  “<br>]<br>Note: Each word is guaranteed not to exceed L in length.</p>
<p>【解答】主要要把题意理解透彻，几个corner case的理解，包括最末一行的处理，还有面对空字符串的处理。遍历的时候，i从0遍历到words.length，在i==words.length的时候处理最末一行的情况。感觉这个题目其实没有太多技巧性，就是需要细心和耐心，把逻辑想清楚。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>{</div><div class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title">fullJustify</span>(String[] words, <span class="keyword">int</span> L) {</div><div class="line">        List&lt;String&gt; result = <span class="keyword">new</span> ArrayList&lt;String&gt;();</div><div class="line">        StringBuilder sb = <span class="keyword">new</span> StringBuilder();</div><div class="line"> </div><div class="line">        List&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;String&gt;();</div><div class="line">        <span class="keyword">int</span> lenSum = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= words.length; i++) {</div><div class="line">            String cur;</div><div class="line">            <span class="keyword">if</span> (i == words.length)</div><div class="line">                cur = <span class="string">""</span>;</div><div class="line">            <span class="keyword">else</span></div><div class="line">                cur = words[i];</div><div class="line"> </div><div class="line">            <span class="keyword">if</span> (lenSum + cur.length() + list.size() &gt; L || i == words.length) {</div><div class="line">                <span class="keyword">int</span> slots = list.size() - <span class="number">1</span>;</div><div class="line"> </div><div class="line">                <span class="keyword">int</span> basicSpaces = <span class="number">0</span>;</div><div class="line">                <span class="keyword">if</span> (slots != <span class="number">0</span>)</div><div class="line">                    basicSpaces = (L - lenSum) / slots;</div><div class="line">                <span class="keyword">if</span> (i==words.length)</div><div class="line">                    basicSpaces = <span class="number">1</span>;</div><div class="line"> </div><div class="line">                <span class="keyword">int</span> moreSpaces = L - lenSum;</div><div class="line">                <span class="keyword">if</span> (slots != <span class="number">0</span> && basicSpaces &gt; <span class="number">0</span>)</div><div class="line">                    moreSpaces = (L - lenSum) % slots;</div><div class="line">                <span class="keyword">if</span> (i==words.length)</div><div class="line">                    moreSpaces = L - lenSum - slots;</div><div class="line"> </div><div class="line">                <span class="comment">// append</span></div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; list.size(); j++) {</div><div class="line">                    <span class="keyword">if</span> (j != <span class="number">0</span>) {</div><div class="line">                        <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; basicSpaces; k++)</div><div class="line">                            sb.append(<span class="string">' '</span>);</div><div class="line"> </div><div class="line">                        <span class="keyword">if</span> (moreSpaces &gt; <span class="number">0</span> && i != words.length) {</div><div class="line">                            sb.append(<span class="string">' '</span>);</div><div class="line">                            moreSpaces--;</div><div class="line">                        }</div><div class="line">                    }</div><div class="line">                    sb.append(list.get(j));</div><div class="line">                }</div><div class="line"> </div><div class="line">                <span class="comment">// trailing spaces</span></div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; moreSpaces; k++) {</div><div class="line">                    sb.append(<span class="string">' '</span>);</div><div class="line">                }</div><div class="line"> </div><div class="line">                list.clear();</div><div class="line">                lenSum = <span class="number">0</span>;</div><div class="line"> </div><div class="line">                result.add(sb.toString());</div><div class="line">                sb = <span class="keyword">new</span> StringBuilder();</div><div class="line">            }</div><div class="line"> </div><div class="line">            list.add(cur);</div><div class="line">            lenSum += cur.length();</div><div class="line">        }</div><div class="line"> </div><div class="line">        <span class="keyword">return</span> result;</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="Search_in_Rotated_Sorted_Array"><span id="search-in-rotated-sorted-array" style="color: #ff0000;">Search in Rotated Sorted Array</span></h3>
<p>【题目】Suppose a sorted array is rotated at some pivot unknown to you beforehand.</p>
<p>(i.e., 0 1 2 4 5 6 7 might become 4 5 6 7 0 1 2).</p>
<p>You are given a target value to search. If found in the array return its index, otherwise return -1.</p>
<p>You may assume no duplicate exists in the array. </p>
<p>【解答】不知道为什么这道题归为Hard，其实思路还是很容易找到的。如果是一个单纯的升序排列的数组，那就是二分法查找，现在这个数组可能被rotate了，那么还是借由二分法，只不过在找到中间的数了之后，需要比较中间数和最右数（或者最左数），有这样的结论：</p>
<ol>
<li>如果中间数大于最右数，那么最大最小数的分界点在右半支，而左半支严格单调递增，在这种情况下通过比较左半支的首尾两个数，判断目标数在不在左半支内，如果不在，就一定在右半支内。</li>
<li>如果中间数小于最右数，那么最大最小数的分界点在左半支，而右半支严格单调递增，在这种情况下通过比较右半支的首尾两个数，判断目标数在不在右半支内，如果不在，就一定在左半支内。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> <span class="title">search</span>(<span class="keyword">int</span>[] A, <span class="keyword">int</span> target) {</div><div class="line">        <span class="keyword">return</span> search(A, target, <span class="number">0</span>, A.length-<span class="number">1</span>);</div><div class="line">    }</div><div class="line">     </div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> <span class="title">search</span>(<span class="keyword">int</span>[] A, <span class="keyword">int</span> target, <span class="keyword">int</span> start, <span class="keyword">int</span> end) {</div><div class="line">        <span class="keyword">if</span> (start&gt;end)</div><div class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</div><div class="line">         </div><div class="line">        <span class="keyword">int</span> mid = (end+start)/<span class="number">2</span>;</div><div class="line">         </div><div class="line">        <span class="keyword">if</span> (target==A[mid])</div><div class="line">            <span class="keyword">return</span> mid;</div><div class="line">         </div><div class="line">        <span class="keyword">if</span> (A[end]&gt;=A[mid]) { <span class="comment">// the right part is increasing</span></div><div class="line">            <span class="keyword">if</span> (target&gt;A[end] || targetA[mid]) {</div><div class="line">                <span class="keyword">return</span> search(A, target, mid+<span class="number">1</span>, end);</div><div class="line">            } <span class="keyword">else</span> {</div><div class="line">                <span class="keyword">return</span> search(A, target, start, mid-<span class="number">1</span>);</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="Binary_Tree_Maximum_Path_Sum"><span id="binary-tree-maximum-path-sum" style="color: #ff0000;">Binary Tree Maximum Path Sum</span></h3>
<p>【题目】Given a binary tree, find the maximum path sum.</p>
<p>The path may start and end at any node in the tree.</p>
<p>For example:<br>Given the below binary tree,</p>
<pre><code>   1
  / <span class="command">\
</span> 2   3
</code></pre><p>Return 6.</p>
<p>【解答】定义一个maxSinglePath方法，用来返回以root为根的树从根开始存在的最大单向路径（根到某叶子或者根到某分支节点）。再定义一个pathSum方法，用来返回以root为根时，该树的最大path sum，在该方法内，调用maxSinglePath方法分别获取左子树和右子树的最大单向路径，二者之和再加上当前节点的值为包含当前root的最大path sum，再递归求出左子树的最大path sum和右子树的最大path sum，三者取最大值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> <span class="title">maxPathSum</span>(TreeNode root) {</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">null</span>==root)</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">         </div><div class="line">        Map&lt;TreeNode, Integer&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</div><div class="line">        <span class="keyword">return</span> pathSum(root, map);</div><div class="line">    }</div><div class="line">     </div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> <span class="title">pathSum</span>(TreeNode root, Map&lt;TreeNode, Integer&gt; map) {</div><div class="line">        <span class="keyword">int</span> left = <span class="number">0</span>;</div><div class="line">        <span class="keyword">if</span> (root.left!=<span class="keyword">null</span>) {</div><div class="line">            left = maxSinglePath(root.left, map);</div><div class="line">            <span class="keyword">if</span> (left&lt;<span class="number">0</span>)</div><div class="line">                left = <span class="number">0</span>;</div><div class="line">        }</div><div class="line">         </div><div class="line">        <span class="keyword">int</span> right = <span class="number">0</span>;</div><div class="line">        <span class="keyword">if</span> (root.right!=<span class="keyword">null</span>) {</div><div class="line">            right = maxSinglePath(root.right, map);</div><div class="line">            <span class="keyword">if</span> (right&lt;<span class="number">0</span>)</div><div class="line">                right = <span class="number">0</span>;</div><div class="line">        }</div><div class="line">         </div><div class="line">        <span class="keyword">int</span> current = left + right + root.val;</div><div class="line">         </div><div class="line">        <span class="keyword">if</span> (root.left!=<span class="keyword">null</span>) {</div><div class="line">            <span class="keyword">int</span> l = pathSum(root.left, map);</div><div class="line">            <span class="keyword">if</span> (l&gt;current)</div><div class="line">                current = l;</div><div class="line">        }</div><div class="line">         </div><div class="line">        <span class="keyword">if</span> (root.right!=<span class="keyword">null</span>) {</div><div class="line">            <span class="keyword">int</span> r = pathSum(root.right, map);</div><div class="line">            <span class="keyword">if</span> (r&gt;current)</div><div class="line">                current = r;</div><div class="line">        }</div><div class="line">         </div><div class="line">        <span class="keyword">return</span> current;</div><div class="line">    }</div><div class="line">     </div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> <span class="title">maxSinglePath</span>(TreeNode root, Map&lt;TreeNode, Integer&gt; map) {</div><div class="line">        <span class="keyword">if</span> (map.containsKey(root))</div><div class="line">            <span class="keyword">return</span> map.get(root);</div><div class="line">         </div><div class="line">        <span class="keyword">int</span> left = <span class="number">0</span>;</div><div class="line">        <span class="keyword">if</span> (root.left!=<span class="keyword">null</span>) {</div><div class="line">            left = maxSinglePath(root.left, map);</div><div class="line">            <span class="keyword">if</span> (left&lt;<span class="number">0</span>)</div><div class="line">                left = <span class="number">0</span>;</div><div class="line">        }</div><div class="line">         </div><div class="line">        <span class="keyword">int</span> right = <span class="number">0</span>;</div><div class="line">        <span class="keyword">if</span> (root.right!=<span class="keyword">null</span>) {</div><div class="line">            right = maxSinglePath(root.right, map);</div><div class="line">            <span class="keyword">if</span> (right&lt;<span class="number">0</span>)</div><div class="line">                right = <span class="number">0</span>;</div><div class="line">        }</div><div class="line">         </div><div class="line">        <span class="keyword">int</span> maxVal = Math.max(left, right) + root.val;</div><div class="line">        map.put(root, maxVal);</div><div class="line">         </div><div class="line">        <span class="keyword">return</span> maxVal;</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="Reverse_Nodes_in_k-Group"><span id="reverse-nodes-in-k-group" style="color: #ff0000;">Reverse Nodes in k-Group</span></h3>
<p>【题目】Given a linked list, reverse the nodes of a linked list k at a time and return its modified list.<br>If the number of nodes is not a multiple of k then left-out nodes in the end should remain as it is.<br>You may not alter the values in the nodes, only nodes itself may be changed.<br>Only constant memory is allowed.</p>
<p>For example,<br>Given this linked list: 1-&gt;2-&gt;3-&gt;4-&gt;5</p>
<p>For k = 2, you should return: 2-&gt;1-&gt;4-&gt;3-&gt;5</p>
<p>For k = 3, you should return: 3-&gt;2-&gt;1-&gt;4-&gt;5<br>【解答】引入一个伪节点作为头，可以免去对head的特殊处理。基本思路是：一个快指针，一个慢指针，平时慢指针不动，快指针往前跑，在二者间距达到k时，令start=slow.next，end=fast，对于[start,end]这一段区间的节点指向反向，反向后令slow.next=end，fast=start。题目不难，小心一点便是。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>{</div><div class="line">    <span class="keyword">public</span> ListNode <span class="title">reverseKGroup</span>(ListNode head, <span class="keyword">int</span> k) {</div><div class="line">        ListNode fake = <span class="keyword">new</span> ListNode(<span class="number">0</span>);</div><div class="line">        fake.next = head;</div><div class="line">         </div><div class="line">        ListNode fast = fake;</div><div class="line">        ListNode slow = fake;</div><div class="line">         </div><div class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</div><div class="line">        <span class="keyword">while</span> (fast!=<span class="keyword">null</span>) {</div><div class="line">            <span class="keyword">if</span> (count==k) {</div><div class="line">                ListNode start = slow.next;</div><div class="line">                ListNode end = fast;</div><div class="line">                fast = end.next;</div><div class="line">                 </div><div class="line">                ListNode n = start;</div><div class="line">                ListNode next = n.next;</div><div class="line">                <span class="keyword">while</span> (n!=end) {</div><div class="line">                    ListNode temp = next.next;</div><div class="line">                    next.next = n;</div><div class="line">                     </div><div class="line">                    n = next;</div><div class="line">                    next = temp;</div><div class="line">                }</div><div class="line">                 </div><div class="line">                slow.next = end;</div><div class="line">                start.next = fast;</div><div class="line">                 </div><div class="line">                slow = start;</div><div class="line">                fast = slow;</div><div class="line">                 </div><div class="line">                count=<span class="number">0</span>;</div><div class="line">            } <span class="keyword">else</span> {</div><div class="line">                fast = fast.next;</div><div class="line">                count++;</div><div class="line">            }</div><div class="line">        }</div><div class="line">         </div><div class="line">        <span class="keyword">return</span> fake.next;</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="Binary_Tree_Postorder_Traversal"><span id="binary-tree-postorder-traversal" style="color: #ff0000;">Binary Tree Postorder Traversal</span></h3>
<p>【题目】Given a binary tree, return the postorder traversal of its nodes’ values.</p>
<p>For example:<br>Given binary tree {1,#,2,3},</p>
<pre><code>       1
        <span class="command">\
</span>           2
        /
       3
</code></pre><p>return [3,2,1].</p>
<p>Note: Recursive solution is trivial, could you do it iteratively?<br>解答】如果是递归遍历，没有任何难度，也不可能放到Hard级别里面来。用非递归方式，需要一个辅助栈，用来存放节点pop出来的当前状态。具体说：</p>
<ul>
<li>当前节点不为空，就先遍历左子树，同时当前节点入栈，状态栈入true；</li>
<li>当前节点为空，退栈，如果状态为true，就遍历右子树，状态栈顶变为false；</li>
<li>当前节点为空，退栈，如果状态为false，就遍历退栈节点，相应状态元素退栈。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>{</div><div class="line">    <span class="keyword">public</span> List&lt;Integer&gt; <span class="title">postorderTraversal</span>(TreeNode root) {</div><div class="line">        Stack&lt;TreeNode&gt; stack = <span class="keyword">new</span> Stack&lt;&gt;();</div><div class="line">        Stack&lt;Boolean&gt; status = <span class="keyword">new</span> Stack&lt;&gt;();</div><div class="line">        List&lt;Integer&gt; result = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">         </div><div class="line">        TreeNode node = root;</div><div class="line">        <span class="keyword">while</span> (!stack.isEmpty() || node!=<span class="keyword">null</span>) {</div><div class="line">            <span class="keyword">if</span> (<span class="keyword">null</span>!=node) {</div><div class="line">                stack.push(node);</div><div class="line">                status.push(<span class="keyword">true</span>);</div><div class="line">                 </div><div class="line">                node = node.left;</div><div class="line">            } <span class="keyword">else</span> {</div><div class="line">                node = stack.peek();</div><div class="line">                <span class="keyword">boolean</span> flag = status.pop();</div><div class="line">                 </div><div class="line">                <span class="keyword">if</span> (flag) {</div><div class="line">                    node = node.right;</div><div class="line">                    status.push(<span class="keyword">false</span>);</div><div class="line">                } <span class="keyword">else</span> {</div><div class="line">                    result.add(node.val);</div><div class="line">                    stack.pop();</div><div class="line">                    node = <span class="keyword">null</span>;</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line">         </div><div class="line">        <span class="keyword">return</span> result;</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="Candy"><span id="candy" style="color: #ff0000;">Candy</span></h3>
<p>【题目】There are N children standing in a line. Each child is assigned a rating value.</p>
<p>You are giving candies to these children subjected to the following requirements:</p>
<p>Each child must have at least one candy.<br>Children with a higher rating get more candies than their neighbors.<br>What is the minimum candies you must give?</p>
<p>【解答】最开始我选择的做法是像分析函数曲线一样找拐点，如果知道这条曲线的拐点，比如极大值，那么极大值左侧是递增的，极大值右侧是递减的；极小值左侧递减，右侧递增。这里特别麻烦的地方在于，极小值取值是显然为1，但极大值的取值取决于极大值两侧单调曲线的长度，要取长的那一侧的最大值。</p>
<p>比如ratings=[1, 2, 3, 4, 5, 4, 1]，其中ratings[4]就是一个极大值，但是取值candies[4]取决于ratings[4]左右两侧单调曲线的长度，左侧比右侧长，因此要根据左侧来计数取值，在这里candies[4]就取5（如果根据右侧来取值就是3，那就错了）。还需要考虑一些特殊的case，比如极大、极小值出现在首尾，这种情况下是只有右侧或者只有左侧单调曲线的。因此这个办法的代码写起来比较复杂。</p>
<p>下面这个办法我也是参考了别人的解法的，两遍遍历，一遍正向，一遍逆向，思路非常清晰：</p>
<p>正向遍历的时候，如果发现递增序列，就放置一个从1开始依次递增的数，但是，存在这样错误的情况：如果是递减序列的情况呢，这里全放置了1；<br>那么这个问题就需要通过逆向遍历来消除。<br>那么这个办法对于我之前办法所说的那个不易处理的问题，通过逆向遍历中的一个关系为且的子判断条件candies[i]&lt;=candies[i+1]给巧妙的规避掉了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> <span class="title">candy</span>(<span class="keyword">int</span>[] ratings) {</div><div class="line">        <span class="keyword">if</span> (ratings == <span class="keyword">null</span> || ratings.length == <span class="number">0</span>)</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">        <span class="keyword">if</span> (ratings.length == <span class="number">1</span>)</div><div class="line">            <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line"> </div><div class="line">        <span class="keyword">int</span>[] candies = <span class="keyword">new</span> <span class="keyword">int</span>[ratings.length];</div><div class="line">        candies[<span class="number">0</span>] = <span class="number">1</span>;</div><div class="line"> </div><div class="line">        <span class="comment">// forward</span></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; ratings.length; i++) {</div><div class="line">            <span class="comment">// rating: asc</span></div><div class="line">            <span class="keyword">if</span> (ratings[i] &gt; ratings[i - <span class="number">1</span>])</div><div class="line">                candies[i] = candies[i - <span class="number">1</span>] + <span class="number">1</span>;</div><div class="line">            <span class="keyword">else</span></div><div class="line">                candies[i] = <span class="number">1</span>;</div><div class="line">        }</div><div class="line">        <span class="comment">// backward</span></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = ratings.length - <span class="number">2</span>; i &gt;= <span class="number">0</span>; i--) {</div><div class="line">            <span class="comment">// rating: desc && candy: asc</span></div><div class="line">            <span class="keyword">if</span> (ratings[i] &gt; ratings[i + <span class="number">1</span>] && candies[i] &lt;= candies[i + <span class="number">1</span>])</div><div class="line">                candies[i] = candies[i + <span class="number">1</span>] + <span class="number">1</span>;</div><div class="line">        }</div><div class="line"> </div><div class="line">        <span class="keyword">int</span> total = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; ratings.length; i++)</div><div class="line">            total += candies[i];</div><div class="line"> </div><div class="line">        <span class="keyword">return</span> total;</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="Edit_Distance"><span id="edit-distance" style="color: #ff0000;">Edit Distance</span></h3>
<p>【题目】Given two words word1 and word2, find the minimum number of steps required to convert word1 to word2. (each operation is counted as 1 step.)</p>
<p>You have the following 3 operations permitted on a word:</p>
<p>a) Insert a character<br>b) Delete a character<br>c) Replace a character</p>
<p>【解答】遇到这种求两个东西之间距离的，要么回溯法，要么动态规划。这里就是动态规划，这个题目还是很有代表性的。建立一个dist二维数组，注意行、列的长度要分别比word1和word2的长度多1，dist[i][j]用来表示word1.substring(0,i)到word2.substring(0,j)的距离。因此dist[i][j]在i==0的时候为j，在j==0的时候为i。其余的情况，根据insert、delete和replace三种可能性分类讨论，取三种情况的最小距离。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> <span class="title">minDistance</span>(String word1, String word2) {</div><div class="line">        Integer[][] dist = <span class="keyword">new</span> Integer[word1.length()+<span class="number">1</span>][word2.length()+<span class="number">1</span>];</div><div class="line">        <span class="keyword">return</span> min(word1, word2, word1.length(), word2.length(), dist);</div><div class="line">    }</div><div class="line">     </div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> <span class="title">min</span>(String w1, String w2, <span class="keyword">int</span> i, <span class="keyword">int</span> j, Integer[][] dist) {</div><div class="line">        <span class="keyword">if</span> (dist[i][j]!=<span class="keyword">null</span>)</div><div class="line">            <span class="keyword">return</span> dist[i][j];</div><div class="line">         </div><div class="line">        <span class="keyword">if</span> (i==<span class="number">0</span>) {</div><div class="line">            dist[i][j] = j;</div><div class="line">            <span class="keyword">return</span> j;</div><div class="line">        } <span class="keyword">else</span> <span class="keyword">if</span> (j==<span class="number">0</span>) {</div><div class="line">            dist[i][j] = i;</div><div class="line">            <span class="keyword">return</span> i;</div><div class="line">        }</div><div class="line">         </div><div class="line">        <span class="keyword">char</span> ci = w1.charAt(i-<span class="number">1</span>);</div><div class="line">        <span class="keyword">char</span> cj = w2.charAt(j-<span class="number">1</span>);</div><div class="line">         </div><div class="line">        <span class="keyword">if</span> (ci==cj) {</div><div class="line">            dist[i][j] = min(w1, w2, i-<span class="number">1</span>, j-<span class="number">1</span>, dist);</div><div class="line">            <span class="keyword">return</span> dist[i][j];</div><div class="line">        }</div><div class="line">         </div><div class="line">        <span class="keyword">int</span> insert = min(w1, w2, i-<span class="number">1</span>, j, dist) + <span class="number">1</span>;</div><div class="line">        <span class="keyword">int</span> replace = min(w1, w2, i-<span class="number">1</span>, j-<span class="number">1</span>, dist) + <span class="number">1</span>;</div><div class="line">        <span class="keyword">int</span> delete = min(w1, w2, i, j-<span class="number">1</span>, dist) + <span class="number">1</span>;</div><div class="line">         </div><div class="line">        <span class="keyword">int</span> result = Math.min(delete, Math.min(insert, replace));</div><div class="line">         </div><div class="line">        dist[i][j] = result;</div><div class="line">        <span class="keyword">return</span> result;</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="Recover_Binary_Search_Tree"><span id="recover-binary-search-tree" style="color: #ff0000;">Recover Binary Search Tree</span></h3>
<p>【题目】Two elements of a binary search tree (BST) are swapped by mistake.</p>
<p>Recover the tree without changing its structure.</p>
<p>Note:<br>A solution using O(n) space is pretty straight forward. Could you devise a constant space solution?</p>
<p>【解答】对于BST，对任一节点，满足左分支上面所有的节点都小于根节点，右分支上面所有的节点都大于根节点，而中序遍历能够保证形成正确的递增序列，因此遍历时能够保证当前节点的大小一定大于前一个节点的大小。这一点是做这道题的基础。</p>
<p>对于其中某两个节点被错误的swap了，这里有两种情况可供讨论：</p>
<p>两个错误节点是相邻的，比如：0,1,2,3,5,4,6，这种情况中序遍历的整个过程只能发现一次异常节点，在这里是4，这种情况，需要把异常节点和它前面那个节点调换，即4和5调换；<br>两个错误节点不相邻，比如：0,1,5,3,4,2,6，这种情况中序遍历的整个过程可以发现两次异常节点，在这里分别为3和2，这种情况下，需要把第一个异常节点的前面那个节点和第二个异常节点调换，即5和2。<br>掌握这两点规律以后问题就很好解了。下面的解法里面，en用于存储第一个异常节点，enLast表示第一个异常节点的前面那个节点。StopTraversalException的定义其实是可选的，用于在发现第二个异常节点之后直接交换错误值并返回，没必要再往后遍历了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line">class StopTraversalException extends RuntimeException {</div><div class="line">    <span class="keyword">public</span> <span class="title">StopTraversalException</span>() {</div><div class="line">        <span class="keyword">super</span>();</div><div class="line">    }</div><div class="line">}</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>{</div><div class="line">    <span class="keyword">private</span> TreeNode en = <span class="keyword">null</span>;</div><div class="line">    <span class="keyword">private</span> TreeNode enLast = <span class="keyword">null</span>;</div><div class="line">    <span class="keyword">private</span> TreeNode last = <span class="keyword">new</span> TreeNode(Integer.MIN_VALUE);</div><div class="line">     </div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">recoverTree</span>(TreeNode root) {</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">null</span>==root)</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">             </div><div class="line">        <span class="keyword">try</span> {</div><div class="line">            traverse(root);</div><div class="line">        } <span class="keyword">catch</span> (StopTraversalException e) {</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        }</div><div class="line">         </div><div class="line">        swap(en, enLast);</div><div class="line">    }</div><div class="line">     </div><div class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title">traverse</span>(TreeNode root) {</div><div class="line">        <span class="keyword">if</span> (root.left!=<span class="keyword">null</span>)</div><div class="line">            traverse(root.left);</div><div class="line">         </div><div class="line">        <span class="keyword">if</span> (last.val&gt;root.val) {</div><div class="line">            <span class="keyword">if</span> (en==<span class="keyword">null</span>) {</div><div class="line">                en = root;</div><div class="line">                enLast = last;</div><div class="line">            } <span class="keyword">else</span> {</div><div class="line">                swap(enLast, root);</div><div class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> StopTraversalException();</div><div class="line">            }</div><div class="line">        }</div><div class="line">         </div><div class="line">        last = root;</div><div class="line">         </div><div class="line">        <span class="keyword">if</span> (root.right!=<span class="keyword">null</span>)</div><div class="line">            traverse(root.right);</div><div class="line">    }</div><div class="line">     </div><div class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title">swap</span>(TreeNode n1, TreeNode n2) {</div><div class="line">        <span class="keyword">int</span> temp = n1.val;</div><div class="line">        n1.val = n2.val;</div><div class="line">        n2.val = temp;</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="Populating_Next_Right_Pointers_in_Each_Node_II"><span id="populating-next-right-pointers-in-each-node-ii" style="color: #ff0000;">Populating Next Right Pointers in Each Node II</span></h3>
<p>【题目】Follow up for problem “Populating Next Right Pointers in Each Node“.</p>
<p>What if the given tree could be any binary tree? Would your previous solution still work?</p>
<p>Note:</p>
<p>You may only use constant extra space.<br>For example,</p>
<p>Given the following binary tree,</p>
<pre><code>     1
   /  <span class="command">\
</span>  2    3
 / <span class="command">\ </span>   <span class="command">\
</span>4   5    7
</code></pre><p>After calling your function, the tree should look like:</p>
<pre><code>     <span class="number">1</span> <span class="subst">-&gt; </span><span class="built_in">NULL</span>
   <span class="subst">/</span>  <span class="subst">\</span>
  <span class="number">2</span> <span class="subst">-&gt; </span><span class="number">3</span> <span class="subst">-&gt; </span><span class="built_in">NULL</span>
 <span class="subst">/</span> <span class="subst">\</span>    <span class="subst">\</span>
<span class="number">4</span><span class="subst">-&gt; </span><span class="number">5</span> <span class="subst">-&gt; </span><span class="number">7</span> <span class="subst">-&gt; </span><span class="built_in">NULL</span>
</code></pre><p>【解答】看起来只是在《Populating Next Right Pointers in Each Node》基础上增加了一个节点可能为空的情况，但是难度其实增加不少。我把原有的递归改成这种从上到下一层一层循环执行的逻辑，我觉得是比较清晰的办法。对于每一层（level），引入一个fake节点来帮助掌控每一层的头部，按序构建next关联关系。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">connect</span>(TreeLinkNode root) {</div><div class="line">        <span class="keyword">if</span> (root == <span class="keyword">null</span>)</div><div class="line">            <span class="keyword">return</span>;</div><div class="line"> </div><div class="line">        TreeLinkNode level = root;</div><div class="line">        <span class="keyword">while</span> (level != <span class="keyword">null</span>) {</div><div class="line">            TreeLinkNode n = level;</div><div class="line">            TreeLinkNode fake = <span class="keyword">new</span> TreeLinkNode(<span class="number">0</span>);</div><div class="line">            TreeLinkNode child = fake;</div><div class="line"> </div><div class="line">            <span class="keyword">while</span> (n != <span class="keyword">null</span>) {</div><div class="line">                <span class="keyword">if</span> (n.left != <span class="keyword">null</span>) {</div><div class="line">                    child.next = n.left;</div><div class="line">                    child = child.next;</div><div class="line">                }</div><div class="line"> </div><div class="line">                <span class="keyword">if</span> (n.right != <span class="keyword">null</span>) {</div><div class="line">                    child.next = n.right;</div><div class="line">                    child = child.next;</div><div class="line">                }</div><div class="line"> </div><div class="line">                n = n.next;</div><div class="line">            }</div><div class="line"> </div><div class="line">            child.next = <span class="keyword">null</span>;</div><div class="line">            level = fake.next;</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="Permutations_II"><span id="permutations-ii" style="color: #ff0000;">Permutations II</span></h3>
<p>【题目】Given a collection of numbers that might contain duplicates, return all possible unique permutations.</p>
<p>For example,<br>[1,1,2] have the following unique permutations:<br>[1,1,2], [1,2,1], and [2,1,1].</p>
<p>【解答】大致的思路就是回溯法，但是这里需要注意去重的处理，如果这一点上思路选择不合适的话就会绕很大的圈子。先给num数组排序，那么对于任何重复数字的情况，例如num为1,2,2,3,4，其中2有重复，假设给这两个2分别标号：2-1和2-2，如果我可以保证最终输出的序列中，2的顺序也是一致的，即2-1一定出现在2-2之前，那么，就恰好去重了。</p>
<p>所以在下面的build方法里面的for循环中，第二个continue的判断条件，就用到了这样的逻辑——如果num[i]==num[i-1]且used[i-1]==false，这表示当有某个数重复出现时，这个序列先用到了后面的那个，这违背了重复数字保序性的要求。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>{</div><div class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title">permuteUnique</span>(<span class="keyword">int</span>[] num) {</div><div class="line">        List&lt;List&lt;Integer&gt;&gt; total = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        <span class="keyword">if</span> (num==<span class="keyword">null</span>)</div><div class="line">            <span class="keyword">return</span> total;</div><div class="line">         </div><div class="line">        Arrays.sort(num);</div><div class="line">         </div><div class="line">        <span class="keyword">boolean</span>[] used = <span class="keyword">new</span> <span class="keyword">boolean</span>[num.length];</div><div class="line">        build(num, used, <span class="keyword">new</span> ArrayList&lt;Integer&gt;(), total);</div><div class="line">         </div><div class="line">        <span class="keyword">return</span> total;</div><div class="line">    }</div><div class="line">     </div><div class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title">build</span> (<span class="keyword">int</span>[] nums, <span class="keyword">boolean</span>[] used, List&lt;Integer&gt; list, List&lt;List&lt;Integer&gt;&gt; total) {</div><div class="line">        <span class="keyword">if</span> (list.size()==nums.length) {</div><div class="line">            total.add(list);</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        }</div><div class="line">         </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;nums.length; i++) {</div><div class="line">            <span class="keyword">if</span> (used[i])</div><div class="line">                <span class="keyword">continue</span>;</div><div class="line">             </div><div class="line">            <span class="keyword">if</span> (i&gt;<span class="number">0</span> && nums[i]==nums[i-<span class="number">1</span>] && !used[i-<span class="number">1</span>])</div><div class="line">                 <span class="keyword">continue</span>;</div><div class="line">             </div><div class="line">            used[i] = <span class="keyword">true</span>;</div><div class="line">            List&lt;Integer&gt; l = <span class="keyword">new</span> ArrayList&lt;&gt;(list);</div><div class="line">            l.add(nums[i]);</div><div class="line">            build (nums, used, l, total);</div><div class="line">            used[i] = <span class="keyword">false</span>;</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="Best_Time_to_Buy_and_Sell_Stock_III"><span id="best-time-to-buy-and-sell-stock-iii" style="color: #ff0000;">Best Time to Buy and Sell Stock III</span></h3>
<p>【题目】Say you have an array for which the i<span style="box-sizing: border-box; position: relative; font-size: 11px; line-height: 0; vertical-align: baseline; top: -0.5em;">th</span> element is the price of a given stock on day i.</p>
<p>Design an algorithm to find the maximum profit. You may complete at most two transactions.</p>
<p>Note:<br>You may not engage in multiple transactions at the same time (ie, you must sell the stock before you buy again).</p>
<p>【解答】最开始我还是按照《Best Time to Buy and Sell Stock》的思路来解题：那个思路已经可以给出一段区间内的max profit，保留该方法，当前这道题相当于给出一个切分点i，在[0,i]和[i,prices.length)这两段区间内分别求max profit，取二者之和的最大值。但是在遇到比较长的case的时候超时了，所以引入二维数组来缓存计算过的数据，减少重复计算：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> <span class="title">maxProfit</span>(<span class="keyword">int</span>[] prices) {</div><div class="line">        <span class="keyword">if</span> (prices.length&lt;=<span class="number">1</span>)</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">         </div><div class="line">        mins = <span class="keyword">new</span> Integer[prices.length][prices.length];</div><div class="line">        maxs = <span class="keyword">new</span> Integer[prices.length][prices.length];</div><div class="line">         </div><div class="line">        <span class="keyword">int</span> max = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;prices.length; i++) {</div><div class="line">            <span class="keyword">int</span> left = maxProfit(prices, <span class="number">0</span>, i+<span class="number">1</span>);</div><div class="line">            <span class="keyword">int</span> right = maxProfit(prices, i, prices.length-i);</div><div class="line">             </div><div class="line">            <span class="keyword">if</span> (left+right&gt;max)</div><div class="line">                max = left+right;</div><div class="line">        }</div><div class="line">         </div><div class="line">        <span class="keyword">return</span> max;</div><div class="line">    }</div><div class="line">     </div><div class="line">    <span class="keyword">private</span> Integer[][] mins; <span class="comment">// first n days</span></div><div class="line">    <span class="keyword">private</span> Integer[][] maxs; <span class="comment">// last n days</span></div><div class="line"> </div><div class="line">     </div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> <span class="title">maxProfit</span>(<span class="keyword">int</span>[] prices, <span class="keyword">int</span> offset, <span class="keyword">int</span> len) {</div><div class="line">        <span class="keyword">if</span> (len&lt;=<span class="number">1</span>) {</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">        }</div><div class="line">         </div><div class="line">        <span class="keyword">if</span> (mins[offset][<span class="number">0</span>]==<span class="keyword">null</span>)</div><div class="line">            mins[offset][<span class="number">0</span>] = prices[offset];</div><div class="line">        <span class="keyword">if</span> (maxs[offset+len-<span class="number">1</span>][offset+len-<span class="number">1</span>]==<span class="keyword">null</span>)</div><div class="line">            maxs[offset+len-<span class="number">1</span>][offset+len-<span class="number">1</span>] = prices[offset+len-<span class="number">1</span>];</div><div class="line">         </div><div class="line">        <span class="comment">// fill max prices, from right to left</span></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=len-<span class="number">2</span>; i&gt;=<span class="number">0</span>; i–) {</div><div class="line">            <span class="keyword">if</span> (maxs[offset+len-<span class="number">1</span>][i]==<span class="keyword">null</span>) {</div><div class="line">                <span class="keyword">if</span> (prices[offset+i]&gt;maxs[offset+len-<span class="number">1</span>][i+<span class="number">1</span>])</div><div class="line">                    maxs[offset+len-<span class="number">1</span>][i] = prices[offset+i];</div><div class="line">                <span class="keyword">else</span></div><div class="line">                    maxs[offset+len-<span class="number">1</span>][i] = maxs[offset+len-<span class="number">1</span>][i+<span class="number">1</span>];</div><div class="line">            }</div><div class="line">        }</div><div class="line">         </div><div class="line">        <span class="comment">// fill min prices, and calculate the biggest profit, from left to right</span></div><div class="line">        <span class="keyword">int</span> biggestProfit = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;len; i++) {</div><div class="line">            <span class="keyword">if</span> (mins[offset][i]==<span class="keyword">null</span>) {</div><div class="line">                <span class="keyword">if</span> (prices[offset+i]&lt;mins[offset][i-<span class="number">1</span>])</div><div class="line">                    mins[offset][i] = prices[offset+i];</div><div class="line">                <span class="keyword">else</span></div><div class="line">                    mins[offset][i] = mins[offset][i-<span class="number">1</span>];</div><div class="line">            }</div><div class="line">             </div><div class="line">            <span class="keyword">int</span> profit = maxs[offset+len-<span class="number">1</span>][i] – mins[offset][i];</div><div class="line">            <span class="keyword">if</span> (profit&gt;biggestProfit)</div><div class="line">                biggestProfit = profit;</div><div class="line">        }</div><div class="line">         </div><div class="line">        <span class="keyword">return</span> biggestProfit;</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>可是依然超时。这个思路毕竟也是换汤不换药，n平方的复杂度。造成这种局面的原因在于，</p>
<p> 外层循环那个n是来自于寻找前半段和后半段的切分点，这一层循环是无论如何都少不了的；<br> 里层循环那个n则是因为对每次前半段或者后半段自身，要再从后往前寻找最大价格，再从前往后遍历寻找最小价格，并且求出最大收益。<br>于是换个思路，改进球最大收益的过程，</p>
<p> 第一遍，从前往后循环对每个i的取值计算[0,i]的最大收益；<br> 第二遍，从后往前循环对每个i的取值计算[i,prices.length)的最大收益，并根据profits[i]的值相加球总收益，记录总收益的最大值。<br>于是复杂度变成n了：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> <span class="title">maxProfit</span>(<span class="keyword">int</span>[] prices) {</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == prices || prices.length &lt;= <span class="number">1</span>)</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line"> </div><div class="line">        <span class="keyword">int</span>[] profits = <span class="keyword">new</span> <span class="keyword">int</span>[prices.length];</div><div class="line">        profits[<span class="number">0</span>] = <span class="number">0</span>;</div><div class="line">        <span class="keyword">int</span> minPrice = prices[<span class="number">0</span>], maxProfit = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; prices.length; i++) {</div><div class="line">            minPrice = Math.min(prices[i - <span class="number">1</span>], minPrice);</div><div class="line">            <span class="keyword">if</span> (maxProfit &lt; prices[i] - minPrice)</div><div class="line">                maxProfit = prices[i] - minPrice;</div><div class="line">            profits[i] = maxProfit;</div><div class="line">        }</div><div class="line"> </div><div class="line">        <span class="keyword">int</span> maxPrice = prices[prices.length - <span class="number">1</span>];</div><div class="line">        <span class="keyword">int</span> maxFinalProfit = profits[prices.length - <span class="number">1</span>];</div><div class="line">        maxProfit = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = prices.length - <span class="number">2</span>; i &gt;= <span class="number">0</span>; i--) {</div><div class="line">            maxPrice = Math.max(maxPrice, prices[i + <span class="number">1</span>]);</div><div class="line">            <span class="keyword">if</span> (maxProfit &lt; maxPrice - prices[i])</div><div class="line">                maxProfit = maxPrice - prices[i];</div><div class="line">            <span class="keyword">if</span> (maxFinalProfit &lt; profits[i] + maxProfit)</div><div class="line">                maxFinalProfit = profits[i] + maxProfit;</div><div class="line">        }</div><div class="line"> </div><div class="line">        <span class="keyword">return</span> maxFinalProfit;</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="Palindrome_Partitioning_II"><span id="palindrome-partitioning-ii" style="color: #ff0000;">Palindrome Partitioning II</span></h3>
<p>【题目】Given a string s, partition s such that every substring of the partition is a palindrome.</p>
<p>Return the minimum cuts needed for a palindrome partitioning of s.</p>
<p>For example, given s = “aab”,<br>Return 1 since the palindrome partitioning [“aa”,”b”] could be produced using 1 cut.</p>
<p>【解答】借由《Palindrome Partitioning》的思路，对于给定的区间[start,end)，先判断是否是回文，如果不是，分别尝试在区间的各个位置截断，判断前半段和后半段是否都是回文。在对一些变态case超时以后，分两次加上了两个cache，isPalindromeCache和minCutCache，分别存储判断是否为回文的记录和计算cut次数的记录：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> <span class="title">minCut</span>(String s) {</div><div class="line">        Boolean[][] isPalindromeCache = <span class="keyword">new</span> Boolean[s.length()][s.length()];</div><div class="line">        Integer[][] minCutCache = <span class="keyword">new</span> Integer[s.length()][s.length()];</div><div class="line">        <span class="keyword">if</span> (isPalindrome(s, <span class="number">0</span>, s.length(), cache))</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">         </div><div class="line">        <span class="keyword">return</span> minCut(s, <span class="number">0</span>, s.length(), isPalindromeCache, minCutCache);</div><div class="line">    }</div><div class="line">     </div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> <span class="title">minCut</span>(String s, <span class="keyword">int</span> start, <span class="keyword">int</span> end, Boolean[][] isPalindromeCache, Integer[][] minCutCache) {</div><div class="line">        <span class="keyword">if</span> (end-start&lt;=<span class="number">1</span>)</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line"> </div><div class="line">        <span class="keyword">int</span> min = end-start-<span class="number">1</span>;</div><div class="line">         </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;end-start-<span class="number">1</span>; i++) {</div><div class="line">            <span class="keyword">if</span> (isPalindrome(s, start, start+i, isPalindromeCache)) {</div><div class="line">                <span class="keyword">if</span> (isPalindrome(s, start+i, end, isPalindromeCache))</div><div class="line">                    <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">                 </div><div class="line">                <span class="keyword">int</span> cut = minCut(s, start+i, end, isPalindromeCache)+<span class="number">1</span>;</div><div class="line">                <span class="keyword">if</span> (cut&lt;min)</div><div class="line">                    min = cut;</div><div class="line">            }</div><div class="line">        }</div><div class="line">         </div><div class="line">        <span class="keyword">return</span> min;</div><div class="line">    }</div><div class="line">     </div><div class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isPalindrome</span>(String s, <span class="keyword">int</span> start, <span class="keyword">int</span> end, Boolean[][] isPalindromeCache) {</div><div class="line">        <span class="keyword">if</span> (isPalindromeCache[start][end-<span class="number">1</span>]!=<span class="keyword">null</span>)</div><div class="line">            <span class="keyword">return</span> isPalindromeCache[start][end-<span class="number">1</span>];</div><div class="line">             </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=start, j=end-<span class="number">1</span>; j&gt;i; j--,i++) {</div><div class="line">            <span class="keyword">if</span> (s.charAt(i)!=s.charAt(j))</div><div class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">        }</div><div class="line">         </div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>可即便如此，在遇到另外一些变态case的时候依然超时，比如这样一个case：514个a，加两个b，再加946个a。下面这个方法的思路也是从别处借鉴来的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> <span class="title">minCut</span>(String s) {</div><div class="line">        <span class="keyword">int</span> len = s.length();</div><div class="line"> </div><div class="line">        <span class="keyword">int</span>[] cut = <span class="keyword">new</span> <span class="keyword">int</span>[len + <span class="number">1</span>];</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= len; i++)</div><div class="line">            cut[i] = len - i;</div><div class="line"> </div><div class="line">        <span class="keyword">boolean</span>[][] isPalindrome = <span class="keyword">new</span> <span class="keyword">boolean</span>[len][len];</div><div class="line">         </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = len - <span class="number">1</span>; i &&gt;t;= <span class="number">0</span>; i--) {</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = i; j &lt; len; j++) {</div><div class="line">                <span class="keyword">if</span> (s.charAt(i) == s.charAt(j)</div><div class="line">                        && (j - i &lt; <span class="number">2</span> || isPalindrome[i + <span class="number">1</span>][j - <span class="number">1</span>])) {</div><div class="line">                    isPalindrome[i][j] = <span class="keyword">true</span>;</div><div class="line">                     </div><div class="line">                    cut[i] = Math.min(cut[i], cut[j + <span class="number">1</span>] + <span class="number">1</span>);</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keyword">return</span> cut[<span class="number">0</span>] - <span class="number">1</span>;</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>逻辑上看简单多了，但是其实要更不容易想出来。用一个二维数组isPalindrome存放是否为回文的状态，两层循环嵌套，i从后往前，j从i往后遍历，如果s[i]==s[j]，并且前一个状态，即isPalindrome[i+1][j-1]为真，那么isPalindrome[i][j]也为真。一维数组cut用来存放需要切分的次数，初始为字符串区域的长度。</p>
<h3 id="N-Queens_II"><span id="n-queens-ii" style="color: #ff0000;">N-Queens II</span></h3>
<p>【题目】Follow up for N-Queens problem.<br><img src="http://www.leetcode.com/wp-content/uploads/2012/03/8-queens.png"><br>Now, instead outputting board configurations, return the total number of distinct solutions.</p>
<p>【解答】紧跟着N-Queens那道题，思路简直一模一样。不是很理解为啥弄两道差不多的题目。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>{</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> total = <span class="number">0</span>;</div><div class="line">     </div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> <span class="title">totalNQueens</span>(<span class="keyword">int</span> n) {</div><div class="line">        solveNQueens(<span class="number">0</span>, n, <span class="keyword">new</span> <span class="keyword">int</span>[n]);</div><div class="line">        <span class="keyword">return</span> total;</div><div class="line">    }</div><div class="line">     </div><div class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title">solveNQueens</span>(<span class="keyword">int</span> i, <span class="keyword">int</span> n, <span class="keyword">int</span>[] positions) {</div><div class="line">        <span class="keyword">if</span> (i == n) {</div><div class="line">            total++;</div><div class="line">        } <span class="keyword">else</span> {</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++) {</div><div class="line">                positions[i] = j; <span class="comment">// row: i, col: j</span></div><div class="line">                <span class="keyword">if</span> (validate(i, positions)) {</div><div class="line">                    solveNQueens(i + <span class="number">1</span>, n, positions);</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line"> </div><div class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">validate</span>(<span class="keyword">int</span> maxRow, <span class="keyword">int</span>[] positions) {</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; maxRow; i++) {</div><div class="line">            <span class="keyword">if</span> (positions[i] == positions[maxRow] <span class="comment">// same column</span></div><div class="line">                    || Math.abs(positions[i] - positions[maxRow]) == maxRow - i) <span class="comment">// catercorner line</span></div><div class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">        }</div><div class="line">         </div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="Substring_with_Concatenation_of_All_Words"><span id="substring-with-concatenation-of-all-words" style="color: #ff0000;">Substring with Concatenation of All Words</span></h3>
<p>【题目】You are given a string, S, and a list of words, L, that are all of the same length. Find all starting indices of substring(s) in S that is a concatenation of each word in L exactly once and without any intervening characters.</p>
<p>For example, given:<br>S: “barfoothefoobarman”<br>L: [“foo”, “bar”]</p>
<p>You should return the indices: [0,9].<br>(order does not matter).</p>
<p>【解答】先把L放到一个map里面去，key为单词，value为该单词在L中出现的次数。再遍历S，以S中每个字母为开头时，寻找是否存在满足题目要求的子串：发现单词匹配，就从dictCopy里面给这个单词出现的次数减一，如果一切匹配，就不会出现num==null或者num==0的情况。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>{</div><div class="line">    <span class="keyword">public</span> List&lt;Integer&gt; <span class="title">findSubstring</span>(String S, String[] L) {</div><div class="line">        Map&lt;String, Integer&gt; dict = <span class="keyword">new</span> HashMap&lt;&gt;();</div><div class="line">        <span class="keyword">for</span> (String l : L) {</div><div class="line">            <span class="keyword">if</span> (!dict.containsKey(l)) {</div><div class="line">                dict.put(l, <span class="number">0</span>);</div><div class="line">            }</div><div class="line">             </div><div class="line">            dict.put(l, dict.get(l)+<span class="number">1</span>);</div><div class="line">        }</div><div class="line">         </div><div class="line">        <span class="keyword">int</span> len = L[<span class="number">0</span>].length();</div><div class="line">        <span class="keyword">int</span> lenSum = len*L.length;</div><div class="line">         </div><div class="line">        List&lt;Integer&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">         </div><div class="line">        traverseS : <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;=S.length()-lenSum; i++) {</div><div class="line">            Map&lt;String, Integer&gt; dictCopy = <span class="keyword">new</span> HashMap&lt;&gt;(dict);</div><div class="line">             </div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j=i; j&lt;i+lenSum; j=j+len) {</div><div class="line">                String s = S.substring(j, j+len);</div><div class="line">                Integer num = dictCopy.get(s);</div><div class="line">                <span class="keyword">if</span> (num==<span class="keyword">null</span> || num==<span class="number">0</span>)</div><div class="line">                    <span class="keyword">continue</span> traverseS;</div><div class="line">                num--;</div><div class="line">                dictCopy.put(s, num);</div><div class="line">            }</div><div class="line">             </div><div class="line">            list.add(i);</div><div class="line">        }</div><div class="line">         </div><div class="line">        <span class="keyword">return</span> list;</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="Sudoku_Solver"><span id="sudoku-solver" style="color: #ff0000;">Sudoku Solver</span></h3>
<p>【题目】Write a program to solve a Sudoku puzzle by filling the empty cells.</p>
<p>Empty cells are indicated by the character ‘.’.</p>
<p>You may assume that there will be only one unique solution.<br><img src="http://upload.wikimedia.org/wikipedia/commons/thumb/f/ff/Sudoku-by-L2G-20050714.svg/250px-Sudoku-by-L2G-20050714.svg.png"><br>A sudoku puzzle…<br><img src="http://upload.wikimedia.org/wikipedia/commons/thumb/3/31/Sudoku-by-L2G-20050714_solution.svg/250px-Sudoku-by-L2G-20050714_solution.svg.png"><br>…and its solution numbers marked in red.</p>
<p>【解答】回溯法，每个可以填写数字的位置挨个试，用validate方法来验证当前的填写是否正确，不需要等整个board全部填完了再判断，每填写一个数就可以判断了。办法挺死板的，当时想着不行的话再想办法优化，不过居然AC了，真是……</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">solveSudoku</span>(<span class="keyword">char</span>[][] board) {</div><div class="line">        solve(board);</div><div class="line">    }</div><div class="line"> </div><div class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">solve</span>(<span class="keyword">char</span>[][] board) {</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">9</span>; ++i) {</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;<span class="number">9</span>; ++j) {</div><div class="line">                <span class="keyword">if</span> (<span class="string">'.'</span> == board[i][j]) {</div><div class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> k=<span class="number">1</span>; k&lt;=<span class="number">9</span>; ++k) {</div><div class="line">                        board[i][j] = (<span class="keyword">char</span>)(<span class="string">'0'</span>+k);</div><div class="line">                         </div><div class="line">                        <span class="keyword">if</span> (validate(board, i, j) && solve(board))</div><div class="line">                            <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">                         </div><div class="line">                        board[i][j] = <span class="string">'.'</span>;</div><div class="line">                    }</div><div class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line">         </div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    }</div><div class="line">     </div><div class="line">    <span class="comment">// x: row, y: col</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">validate</span>(<span class="keyword">char</span>[][] board, <span class="keyword">int</span> x, <span class="keyword">int</span> y) {</div><div class="line">        <span class="comment">// col==y</span></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">9</span>; i++)</div><div class="line">            <span class="keyword">if</span> (i!=x && board[i][y]==board[x][y])</div><div class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">         </div><div class="line">        <span class="comment">// row==x</span></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j&lt;<span class="number">9</span>; j++)</div><div class="line">            <span class="keyword">if</span> (j!=y && board[x][j]==board[x][y])</div><div class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">         </div><div class="line">        <span class="comment">// each cube</span></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">3</span>*(x/<span class="number">3</span>); i&lt;<span class="number">3</span>*(x/<span class="number">3</span>+<span class="number">1</span>); i++)</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">3</span>*(y/<span class="number">3</span>); j&lt;<span class="number">3</span>*(y/<span class="number">3</span>+<span class="number">1</span>); j++)</div><div class="line">                <span class="keyword">if</span> (i!=x && j!=y && board[i][j]==board[x][y])</div><div class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">         </div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="N-Queens"><span id="n-queens" style="color: #ff0000;">N-Queens</span></h3>
<p>【题目】The n-queens puzzle is the problem of placing n queens on an n×n chessboard such that no two queens attack each other.<br><img src="http://www.leetcode.com/wp-content/uploads/2012/03/8-queens.png"></p>
<p>Given an integer n, return all distinct solutions to the n-queens puzzle.</p>
<p>Each solution contains a distinct board configuration of the n-queens’ placement, where ‘Q’ and ‘.’ both indicate a queen and an empty space respectively.</p>
<p>For example,<br>There exist two distinct solutions to the 4-queens puzzle:</p>
<pre><code>[
     [<span class="string">".Q.."</span>,  // Solution <span class="number">1</span>
      <span class="string">"...Q"</span>,
      <span class="string">"Q..."</span>,
      <span class="string">"..Q."</span>],

     [<span class="string">"..Q."</span>,  // Solution <span class="number">2</span>
      <span class="string">"Q..."</span>,
      <span class="string">"...Q"</span>,
      <span class="string">".Q.."</span>]
]
</code></pre><p>【解答】这个题目是比较经典的回溯法题目，很多教科书里面都有。根据国际象棋的规则，这里要求任意两个皇后不能在同一行，不能在同一列，不能在同一条对角线上。使用一个int数组来存放当前棋盘上皇后的状态，int[i]=j，表示第i行上，皇后放在第j列，这样天然避免了在同一行情况的出现，也避免了使用二维数组来保存状态；但是不能在同一列和不能在同一条对角线需要每次摆放一个皇后以后立马检查。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>{</div><div class="line">    <span class="keyword">public</span> List&lt;String[]&gt; <span class="title">solveNQueens</span>(<span class="keyword">int</span> n) {</div><div class="line">        List&lt;String[]&gt; list = <span class="keyword">new</span> ArrayList&lt;String[]&gt;();</div><div class="line">        solveNQueens(<span class="number">0</span>, n, <span class="keyword">new</span> <span class="keyword">int</span>[n], list);</div><div class="line">        <span class="keyword">return</span> list;</div><div class="line">    }</div><div class="line"> </div><div class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title">solveNQueens</span>(<span class="keyword">int</span> i, <span class="keyword">int</span> n, <span class="keyword">int</span>[] positions,</div><div class="line">            List&lt;String[]&gt; list) {</div><div class="line">        <span class="keyword">if</span> (i == n) {</div><div class="line">            outputToList(n, positions, list);</div><div class="line">        } <span class="keyword">else</span> {</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++) {</div><div class="line">                positions[i] = j; <span class="comment">// row: i, col: j</span></div><div class="line">                <span class="keyword">if</span> (validate(i, positions)) {</div><div class="line">                    solveNQueens(i + <span class="number">1</span>, n, positions, list);</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line"> </div><div class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title">outputToList</span>(<span class="keyword">int</span> n, <span class="keyword">int</span>[] positions, List&lt;String[]&gt; list) {</div><div class="line">        String[] result = <span class="keyword">new</span> String[n];</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) {</div><div class="line">            StringBuffer sb = <span class="keyword">new</span> StringBuffer();</div><div class="line">             </div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++) {</div><div class="line">                <span class="keyword">if</span> (j == positions[i])</div><div class="line">                    sb.append(<span class="string">'Q'</span>);</div><div class="line">                <span class="keyword">else</span></div><div class="line">                    sb.append(<span class="string">'.'</span>);</div><div class="line">            }</div><div class="line">             </div><div class="line">            result[i] = sb.toString();</div><div class="line">        }</div><div class="line">         </div><div class="line">        list.add(result);</div><div class="line">    }</div><div class="line"> </div><div class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">validate</span>(<span class="keyword">int</span> maxRow, <span class="keyword">int</span>[] positions) {</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; maxRow; i++) {</div><div class="line">            <span class="keyword">if</span> (positions[i] == positions[maxRow] <span class="comment">// same column</span></div><div class="line">                    || Math.abs(positions[i] - positions[maxRow]) == maxRow - i) <span class="comment">// catercorner line</span></div><div class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">        }</div><div class="line">         </div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="Minimum_Window_Substring"><span id="minimum-window-substring" style="color: #ff0000;">Minimum Window Substring</span></h3>
<p>【题目】Given a string S and a string T, find the minimum window in S which will contain all the characters in T in complexity O(n).</p>
<p>For example, S = “ADOBECODEBANC” T = “ABC”</p>
<p>Minimum window is “BANC”.</p>
<p>Note: If there is no such window in S that covers all characters in T, return the emtpy string “”.</p>
<p>If there are multiple such windows, you are guaranteed that there will always be only one unique minimum window in S.<br>【解答】注意题目要求的复杂度是n阶的，因此不能在循环中去匹配变化子串和T，那样就n的平方阶了。可以通过一个有限长的int数组来表达这个字符串T，大致思路如下：</p>
<p>双指针，一左一右，[left,right]这段区域内的子串就是待认定的window substring；<br>把T用一个长度为128的int数组来表达，下标表示字符的ascii码，值表示该字符在T中出现的次数；<br>整个流程就是是right和left分别尝试右移的过程，始终尽量保持[left,right]包含window substring：<br>    (1) 如果rightOrLeft为真，并且right能够右移，就右移并判定子串是否包含T，如果包含就判断是否需要更新min；如果包含或者干脆就不能右移，把移动的标志位置反。<br>    (2) 如果rightOrLeft为false，考虑left右移，并判定子串是否包含T，如果包含就判断是否需要更新min；如果不包含就把移动的标志位置反，让下次迭代去尝试right右移。<br>注意处理开头的特殊情况，即初始状态left==right==0，需要先把S[0]放到source里面去，避免遗漏。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line">public <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>{</div><div class="line">    public <span class="type">String</span> minWindow(<span class="type">String</span> <span class="type">S</span>, <span class="type">String</span> <span class="type">T</span>) {</div><div class="line">        int[] target = <span class="keyword">new</span> int[<span class="number">128</span>];</div><div class="line">        <span class="keyword">for</span> (int i=<span class="number">0</span>; i&lt;<span class="type">T</span>.length(); i++) {</div><div class="line">            target[(int)(<span class="type">T</span>.charAt(i))]++;</div><div class="line">        }</div><div class="line">         </div><div class="line">        int <span class="keyword">left</span>=<span class="number">0</span>;</div><div class="line">        int <span class="keyword">right</span>=<span class="number">0</span>;</div><div class="line">        int[] source = <span class="keyword">new</span> int[<span class="number">128</span>];</div><div class="line">        source[(int)(<span class="type">S</span>.charAt(<span class="number">0</span>))]++;</div><div class="line">        <span class="type">String</span> <span class="built_in">min</span> = <span class="string">""</span>;</div><div class="line">        <span class="keyword">if</span> (<span class="type">T</span>.equals(<span class="type">S</span>.substring(<span class="number">0</span>,<span class="number">1</span>)))</div><div class="line">            <span class="built_in">min</span> = <span class="type">S</span>.substring(<span class="number">0</span>,<span class="number">1</span>);</div><div class="line">        boolean rightOrLeft = <span class="built_in">true</span>; <span class="comment">// true: right, false: left</span></div><div class="line">         </div><div class="line">        <span class="keyword">while</span> (<span class="built_in">true</span>) {</div><div class="line">            <span class="keyword">if</span> (rightOrLeft) {</div><div class="line">                <span class="keyword">if</span> (<span class="keyword">right</span>&lt;<span class="type">S</span>.length()-<span class="number">1</span>) {</div><div class="line">                    <span class="keyword">right</span>++;</div><div class="line">                    source[(int)(<span class="type">S</span>.charAt(<span class="keyword">right</span>))]++;</div><div class="line">                } <span class="keyword">else</span> {</div><div class="line">                    rightOrLeft = <span class="built_in">false</span>;</div><div class="line">                }</div><div class="line">                 </div><div class="line">                <span class="keyword">if</span> (match(source, target)) {</div><div class="line">                    <span class="keyword">if</span> (<span class="string">""</span>.equals(<span class="built_in">min</span>) || <span class="built_in">min</span>.length()&gt;<span class="keyword">right</span>-<span class="keyword">left</span>+<span class="number">1</span>)</div><div class="line">                        <span class="built_in">min</span> = <span class="type">S</span>.substring(<span class="keyword">left</span>, <span class="keyword">right</span>+<span class="number">1</span>);</div><div class="line">                     </div><div class="line">                    rightOrLeft = <span class="built_in">false</span>;</div><div class="line">                }</div><div class="line">            } <span class="keyword">else</span> {</div><div class="line">                <span class="keyword">if</span> (<span class="keyword">left</span>==<span class="type">S</span>.length()-<span class="number">1</span>)</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                 </div><div class="line">                source[(int)(<span class="type">S</span>.charAt(<span class="keyword">left</span>))]--;</div><div class="line">                <span class="keyword">left</span>++;</div><div class="line">                 </div><div class="line">                <span class="keyword">if</span> (match(source, target)) {</div><div class="line">                    <span class="keyword">if</span> (<span class="string">""</span>.equals(<span class="built_in">min</span>) || <span class="built_in">min</span>.length()&gt;<span class="keyword">right</span>-<span class="keyword">left</span>+<span class="number">1</span>)</div><div class="line">                        <span class="built_in">min</span> = <span class="type">S</span>.substring(<span class="keyword">left</span>, <span class="keyword">right</span>+<span class="number">1</span>);</div><div class="line">                } <span class="keyword">else</span> {</div><div class="line">                    rightOrLeft = <span class="built_in">true</span>;</div><div class="line">                }</div><div class="line">            } <span class="comment">// else</span></div><div class="line">        } <span class="comment">// while</span></div><div class="line">         </div><div class="line">        <span class="keyword">return</span> <span class="built_in">min</span>;</div><div class="line">    }</div><div class="line">     </div><div class="line">    private boolean match(int[] <span class="keyword">left</span>, int[] <span class="keyword">right</span>) {</div><div class="line">        <span class="keyword">for</span> (int i=<span class="number">0</span>; i&lt;<span class="number">128</span>; i++) {</div><div class="line">            <span class="keyword">if</span> (<span class="keyword">left</span>[i]&lt;<span class="keyword">right</span>[i])</div><div class="line">                <span class="keyword">return</span> <span class="built_in">false</span>;</div><div class="line">        }</div><div class="line">         </div><div class="line">        <span class="keyword">return</span> <span class="built_in">true</span>;</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="Merge_k_Sorted_Lists"><span id="merge-k-sorted-lists" style="color: #ff0000;">Merge k Sorted Lists</span></h3>
<p>【题目】Merge k sorted linked lists and return it as one sorted list. Analyze and describe its complexity.</p>
<p>【解答】这道题是有一定典型意义的。如果是两个列表归并，那么显然就使用传统归并排序的方法就好了，但是现在是m个列表归并，这就意味着，在每一轮归并的迭代中，假使每个列表取一个元素，那么着m个元素的大小关系是完全不可知的，原有排好序的list特性并没有充分利用，这能优化吗？</p>
<p>进一步考虑，在对刚才说的m个元素排序以后，比如说我就知道了最小元素是来自7号链表的，那么，我可以想象，最终结果中，次小元素要么在当前这剩下的m-1个元素里面，要么就是7号链表剩下元素的头部了。要充分利用这个信息，才可以让算法的复杂度降下来。</p>
<p>要不断取得这m个元素中最小的，于是我联想到了堆排序（各种排序方法，包括堆排序，我以前在这篇文中总结过）。每次从最小堆中抽走堆顶，接下去就补充被抽走堆顶的next元素到堆中，重新恢复最小堆。分析一下复杂度，按照刚才的定义，全部元素是(m<em>n)，堆大小是m，那么整个复杂度就是m</em>n(log m)。</p>
<p>在Java中，其实已经有封装好堆排序的现成的东西了（这是个死知识），那个东西就是PriorityQueue：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>{</div><div class="line">    <span class="keyword">public</span> ListNode <span class="title">mergeKLists</span>(List&lt;ListNode&gt; lists) {</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">null</span>==lists || lists.isEmpty())</div><div class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">         </div><div class="line">        PriorityQueue&lt;ListNode&gt; queue = <span class="keyword">new</span> PriorityQueue&lt;&gt;(lists.size(), <span class="keyword">new</span> Comparator&lt;ListNode&gt;(){</div><div class="line">            <span class="annotation">@Override</span></div><div class="line">            <span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span>(ListNode n1, ListNode n2) {</div><div class="line">                <span class="keyword">if</span> (n1.val==n2.val)</div><div class="line">                    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (n1.val&lt;n2.val)</div><div class="line">                    <span class="keyword">return</span> -<span class="number">1</span>;</div><div class="line">                <span class="keyword">else</span></div><div class="line">                    <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">            }</div><div class="line">        });</div><div class="line">         </div><div class="line">        <span class="comment">// initialization</span></div><div class="line">        <span class="keyword">for</span> (ListNode n : lists) {</div><div class="line">            <span class="keyword">if</span> (n==<span class="keyword">null</span>)</div><div class="line">                <span class="keyword">continue</span>;</div><div class="line">                 </div><div class="line">            queue.add(n);</div><div class="line">        }</div><div class="line">         </div><div class="line">        ListNode fakeHead = <span class="keyword">new</span> ListNode(<span class="number">0</span>);</div><div class="line">        ListNode current = fakeHead;</div><div class="line">         </div><div class="line">        <span class="keyword">while</span> (!queue.isEmpty()) {</div><div class="line">            ListNode n = queue.poll();</div><div class="line">            current.next = n;</div><div class="line">            current = n;</div><div class="line">            <span class="keyword">if</span> (n.next!=<span class="keyword">null</span>)</div><div class="line">                queue.add(n.next);</div><div class="line">        }</div><div class="line">         </div><div class="line">        <span class="keyword">return</span> fakeHead.next;</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="Merge_Intervals"><span id="merge-intervals" style="color: #ff0000;">Merge Intervals</span></h3>
<p>【题目】Given a collection of intervals, merge all overlapping intervals.</p>
<p>For example,<br>Given [1,3],[2,6],[8,10],[15,18],<br>return [1,6],[8,10],[15,18].</p>
<p>【解答】这题相对来说比较简单。先排序，按照start属性来排。之后开始遍历intervals，如果发现有重叠的interval，就合并；如果发现非重叠的interval，放置较靠前的一个到最终的list里面去。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>{</div><div class="line">    <span class="keyword">public</span> List&lt;Interval&gt; <span class="title">merge</span>(List&lt;Interval&gt; intervals) {</div><div class="line">        Collections.sort(intervals, <span class="keyword">new</span> Comparator&lt;Interval&gt;(){</div><div class="line">            <span class="annotation">@Override</span></div><div class="line">            <span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span>(Interval left, Interval right) {</div><div class="line">                <span class="keyword">if</span> (left.start == right.start)</div><div class="line">                    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (left.start &lt; right.start)</div><div class="line">                    <span class="keyword">return</span> -<span class="number">1</span>;</div><div class="line">                <span class="keyword">else</span></div><div class="line">                    <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">            }</div><div class="line">        });</div><div class="line">         </div><div class="line">        List&lt;Interval&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        Interval toCompare = <span class="keyword">null</span>;</div><div class="line">         </div><div class="line">        <span class="keyword">for</span> (Interval interval : intervals) {</div><div class="line">            <span class="keyword">if</span> (toCompare!=<span class="keyword">null</span> && interval.end&gt;=toCompare.start && interval.start&lt;=toCompare.end) {</div><div class="line">                toCompare.start = Math.min(interval.start, toCompare.start);</div><div class="line">                toCompare.end = Math.max(interval.end, toCompare.end);</div><div class="line">            } <span class="keyword">else</span> {</div><div class="line">                <span class="keyword">if</span> (toCompare!=<span class="keyword">null</span>)</div><div class="line">                    list.add(toCompare);</div><div class="line">                toCompare = interval;</div><div class="line">            }</div><div class="line">        }</div><div class="line">         </div><div class="line">        <span class="keyword">if</span> (<span class="keyword">null</span>!=toCompare)</div><div class="line">            list.add(toCompare);</div><div class="line">         </div><div class="line">        <span class="keyword">return</span> list;</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="Scramble_String"><span id="scramble-string" style="color: #ff0000;">Scramble String</span></h3>
<p>【题目】Given a string s1, we may represent it as a binary tree by partitioning it to two non-empty substrings recursively.</p>
<p>Below is one possible representation of s1 = “great”:</p>
<pre><code>    great
   /    <span class="command">\
</span>  gr    eat
 / <span class="command">\ </span>   /  <span class="command">\
</span>g   r  e   at
           / <span class="command">\
</span>          a   t
</code></pre><p>To scramble the string, we may choose any non-leaf node and swap its two children.</p>
<p>For example, if we choose the node “gr” and swap its two children, it produces a scrambled string “rgeat”.</p>
<pre><code>    rgeat
   /    <span class="command">\
</span>  rg    eat
 / <span class="command">\ </span>   /  <span class="command">\
</span>r   g  e   at
           / <span class="command">\
</span>          a   t
</code></pre><p>We say that “rgeat” is a scrambled string of “great”.</p>
<p>Similarly, if we continue to swap the children of nodes “eat” and “at”, it produces a scrambled string “rgtae”.</p>
<pre><code>    rgtae
   /    <span class="command">\
</span>  rg    tae
 / <span class="command">\ </span>   /  <span class="command">\
</span>r   g  ta  e
       / <span class="command">\
</span>      t   a
</code></pre><p>We say that “rgtae” is a scrambled string of “great”.</p>
<p>Given two strings s1 and s2 of the same length, determine if s2 is a scrambled string of s1.</p>
<p>【解答】终于做到一道3维动态规划的题目了。最开始我就是简单的回溯遍历，结果执行超时了，于是想到DP。cache[i][j][k]表示的是，s1以下标i为起点，s2以下标j为起点，二者长度都为k时，这两个子串是否满足scramble关系，即s1的[i,i+k)和s2的[j,j+k)是否满足scramble关系。</p>
<p>这一点不难想到，并且想到以后就可以落实代码了。但是在写代码判断scramble关系的时候，考虑swap和非swap两种情况，而且很容易写错：</p>
<p>s1的[start1,start1+i)和s2的[start2,start2+i)满足scramble关系，并且s1的[start1+i,start1+len)和s2的[start2+i, start2+len)也满足scramble关系，这种情况是两个子串没有发生swap的；<br>另一种情况自然就是两个子串发生了swap，即s1的[start1+len-i,start1+len)和s2的[start2, start2+i)满足scramble关系，并且s1的[start1,start1+len-i)和s2的[start2+i,start2+len)也满足scrmable关系。<br>上面两种情况只需具备其一就返回true，像这种比较绕的DP题目，我觉得写出数学通式是最关键的一步。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isScramble</span>(String s1, String s2) {</div><div class="line">        <span class="keyword">if</span> (s1.length()!=s2.length())</div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">         </div><div class="line">        <span class="comment">// cache[i][j][k]: scramble between s1:[i,i+k) and s2:[j,j+k)</span></div><div class="line">        Boolean[][][] cache = <span class="keyword">new</span> Boolean[s1.length()][s1.length()][s1.length()+<span class="number">1</span>];</div><div class="line">         </div><div class="line">        <span class="keyword">return</span> isScramble(s1, s2, <span class="number">0</span>, <span class="number">0</span>, s1.length(), cache);</div><div class="line">    }</div><div class="line">     </div><div class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isScramble</span>(String s1, String s2, <span class="keyword">int</span> start1, <span class="keyword">int</span> start2, <span class="keyword">int</span> len, Boolean[][][] cache) {</div><div class="line">        <span class="keyword">if</span> (cache[start1][start2][len]!=<span class="keyword">null</span>)</div><div class="line">            <span class="keyword">return</span> cache[start1][start2][len];</div><div class="line">         </div><div class="line">        <span class="comment">// exit</span></div><div class="line">        <span class="keyword">if</span> (len==<span class="number">1</span>) {</div><div class="line">            cache[start1][start2][len] = s1.charAt(start1)==s2.charAt(start2);</div><div class="line">            <span class="keyword">return</span> cache[start1][start2][len];</div><div class="line">        }</div><div class="line">         </div><div class="line">        <span class="comment">// s1:[start1, start1+i) &lt;=&gt; s2:[start2, start2+i) and s1:[start1+i, start1+len) &lt;=&gt; s2:[start2+i, start2+len)</span></div><div class="line">        <span class="comment">// or</span></div><div class="line">        <span class="comment">// s1:[start1+len-i, start1+len) &lt;=&gt; s2:[start2, start2+i) and s1:[start1, start1+len-i) &lt;=&gt; s2:[start2+i, start2+len)</span></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;len; i++) {</div><div class="line">            <span class="keyword">if</span> (</div><div class="line">                (isScramble(s1, s2, start1, start2, i, cache) && isScramble(s1, s2, start1+i, start2+i, len-i, cache))</div><div class="line">                ||</div><div class="line">                (isScramble(s1, s2, start1+len-i, start2, i, cache) && isScramble(s1, s2, start1, start2+i, len-i, cache))</div><div class="line">            ) {</div><div class="line">                cache[start1][start2][len] = <span class="keyword">true</span>;</div><div class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">            }</div><div class="line">        }</div><div class="line">         </div><div class="line">        cache[start1][start2][len] = <span class="keyword">false</span>;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="Trapping_Rain_Water"><span id="trapping-rain-water" style="color: #ff0000;">Trapping Rain Water</span></h3>
<p>【题目】Given n non-negative integers representing an elevation map where the width of each bar is 1, compute how much water it is able to trap after raining.</p>
<p>For example,<br>Given [0,1,0,2,1,0,1,3,2,1,2,1], return 6.<br><img src="http://www.leetcode.com/wp-content/uploads/2012/08/rainwatertrap.png"><br>The above elevation map is represented by array [0,1,0,2,1,0,1,3,2,1,2,1]. In this case, 6 units of rain water (blue section) are being trapped. Thanks Marcos for contributing this image!</p>
<p>【解答】这道题是hard里面相对比较简单的。大致的思路就是，找最长的两根杆子，分别为最长和次长，而两根杆子中间的部分，每个位置都去算距离次长杆子的距离，这些距离累加起来就是这两根杆子中间部分可以trap的雨水的量，而对于这两根杆子两侧的部分，继续递归求解。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> <span class="title">trap</span>(<span class="keyword">int</span>[] A) {</div><div class="line">        <span class="keyword">return</span> trap(A, <span class="number">0</span>, A.length-<span class="number">1</span>);</div><div class="line">    }</div><div class="line">     </div><div class="line">    <span class="comment">// [start, end]</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> <span class="title">trap</span>(<span class="keyword">int</span>[] A, <span class="keyword">int</span> start, <span class="keyword">int</span> end) {</div><div class="line">        <span class="keyword">if</span> (start+<span class="number">1</span>&gt;=end)</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">         </div><div class="line">        <span class="keyword">int</span> maxIndex = -<span class="number">1</span>;</div><div class="line">        <span class="keyword">int</span> secondMaxIndex = -<span class="number">1</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=start; i&lt;=end; i++) {</div><div class="line">            <span class="keyword">if</span> (secondMaxIndex==-<span class="number">1</span> || A[i]&gt;A[secondMaxIndex]) {</div><div class="line">                secondMaxIndex = i;</div><div class="line">                 </div><div class="line">                <span class="keyword">if</span> (maxIndex==-<span class="number">1</span> || A[secondMaxIndex]&gt;A[maxIndex]) {</div><div class="line">                    <span class="keyword">int</span> temp = maxIndex;</div><div class="line">                    maxIndex = secondMaxIndex;</div><div class="line">                    secondMaxIndex = temp;</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line">         </div><div class="line">        <span class="keyword">int</span> left = Math.min(maxIndex, secondMaxIndex);</div><div class="line">        <span class="keyword">int</span> right = Math.max(maxIndex, secondMaxIndex);</div><div class="line">         </div><div class="line">        <span class="keyword">int</span> leftPart = trap(A, start, left);</div><div class="line">        <span class="keyword">int</span> rightPart = trap(A, right, end);</div><div class="line">         </div><div class="line">        <span class="keyword">int</span> midPart = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=left+<span class="number">1</span>; i&lt;right; i++) {</div><div class="line">            midPart += A[secondMaxIndex] - A[i];</div><div class="line">        }</div><div class="line">         </div><div class="line">        <span class="keyword">return</span> leftPart+midPart+rightPart;</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="Median_of_Two_Sorted_Arrays"><span id="median-of-two-sorted-arrays" style="color: #ff0000;">Median of Two Sorted Arrays</span></h3>
<p>【题目】There are two sorted arrays A and B of size m and n respectively. Find the median of the two sorted arrays. The overall run time complexity should be O(log (m+n)).</p>
<p>【解答】首先要明确中位数的概念：在A和B的总数为奇数时，中位数是中间那个数；总数为偶数时，中位数是中间那两个数的算术平均数。</p>
<p>这道题麻烦的地方在于时间复杂度是log(m+n)，要得到这种时间复杂度，每个数遍历一遍显然是不可能的。于是就要充分利用好A和B都是有序的特点，而联想到二分搜索的时间复杂度恰好是log(n)，所以思路就是看看能不能利用或者借鉴上二分搜索。</p>
<p>再一个如果强化一下条件，假设这里m==n，那么拿A的中位数和B的中位数比较，如果A的中位数比较大，那么最后我们要求的A并B的中位数应该在B的后半段+A的前半段里，这样可以一直递归求解。现在m不一定等于n，这个结论也依然成立，每次分别比较A和B的中位数后可以给A、B分别砍掉半支，这样最后求解的复杂度恰好就是O(log(m+n))。</p>
<p>在求中位数的时候小心坐标运算的时候发生错误，我反正错了N次。思路好找，要写对还挺难的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">double</span> <span class="title">findMedianSortedArrays</span>(<span class="keyword">int</span> A[], <span class="keyword">int</span> B[]) {</div><div class="line">        <span class="keyword">if</span> ((A.length + B.length) % <span class="number">2</span> == <span class="number">0</span>) {</div><div class="line">            <span class="keyword">int</span> midLeft = (A.length + B.length) / <span class="number">2</span> - <span class="number">1</span>;</div><div class="line">            <span class="keyword">int</span> midRight = (A.length + B.length) / <span class="number">2</span>;</div><div class="line">            <span class="keyword">return</span> (<span class="number">0.0</span> + find(A, B, midRight, <span class="number">0</span>, A.length - <span class="number">1</span>, <span class="number">0</span>, B.length - <span class="number">1</span>) + find(</div><div class="line">                    A, B, midLeft, <span class="number">0</span>, A.length - <span class="number">1</span>, <span class="number">0</span>, B.length - <span class="number">1</span>)) / <span class="number">2</span>;</div><div class="line">        } <span class="keyword">else</span> {</div><div class="line">            <span class="keyword">int</span> mid = (A.length + B.length) / <span class="number">2</span>;</div><div class="line">            <span class="keyword">return</span> (<span class="keyword">double</span>) find(A, B, mid, <span class="number">0</span>, A.length - <span class="number">1</span>, <span class="number">0</span>, B.length - <span class="number">1</span>);</div><div class="line">        }</div><div class="line">    }</div><div class="line"> </div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> <span class="title">find</span>(<span class="keyword">int</span> A[], <span class="keyword">int</span> B[], <span class="keyword">int</span> i, <span class="keyword">int</span> aStart, <span class="keyword">int</span> aEnd, <span class="keyword">int</span> bStart,</div><div class="line">            <span class="keyword">int</span> bEnd) {</div><div class="line"> </div><div class="line">        <span class="keyword">if</span> (aEnd - aStart &lt; <span class="number">0</span>)</div><div class="line">            <span class="keyword">return</span> B[bStart + i];</div><div class="line">        <span class="keyword">if</span> (bEnd - bStart &lt; <span class="number">0</span>)</div><div class="line">            <span class="keyword">return</span> A[aStart + i];</div><div class="line">        <span class="keyword">if</span> (i == <span class="number">0</span>)</div><div class="line">            <span class="keyword">return</span> A[aStart] &lt; B[bStart] ? A[aStart] : B[bStart];</div><div class="line"> </div><div class="line">        <span class="keyword">int</span> aRelativePos = (<span class="keyword">int</span>) (((<span class="number">0.0</span> + (aEnd - aStart + <span class="number">1</span>)) / ((aEnd</div><div class="line">                - aStart + <span class="number">1</span>) + (bEnd - bStart + <span class="number">1</span>))) * i);</div><div class="line">        <span class="keyword">int</span> aMid = aRelativePos + aStart;</div><div class="line">        <span class="keyword">int</span> bMid = i - aRelativePos - <span class="number">1</span> + bStart;</div><div class="line"> </div><div class="line">        <span class="keyword">if</span> (A[aMid] &gt; B[bMid]) {</div><div class="line">            i -= bMid - bStart + <span class="number">1</span>;</div><div class="line">            aEnd = aMid;</div><div class="line">            bStart = bMid + <span class="number">1</span>;</div><div class="line">        } <span class="keyword">else</span> {</div><div class="line">            i -= aMid - aStart + <span class="number">1</span>;</div><div class="line">            bEnd = bMid;</div><div class="line">            aStart = aMid + <span class="number">1</span>;</div><div class="line">        }</div><div class="line"> </div><div class="line">        <span class="keyword">return</span> find(A, B, i, aStart, aEnd, bStart, bEnd);</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="Maximal_Rectangle"><span id="maximal-rectangle" style="color: #ff0000;">Maximal Rectangle</span></h3>
<p>【题目】Given a 2D binary matrix filled with 0’s and 1’s, find the largest rectangle containing all ones and return its area.</p>
<p>【解答】首先要理解题意，这里说的是要求这个矩形里面包含1，并且是只包含1，“rectangle containing all ones”，反正开始我是没有理解出，这句话是表示“只”包含1的。</p>
<p>比如这样一幅图：</p>
<p>1 0 1 0 1</p>
<p>1 1 1 0 0</p>
<p>0 1 1 0 1</p>
<p>那么这个矩形应该是用下划线标出的区域，因此应该返回4。</p>
<p>那怎么做呢？先降维思考一下，如果matrix只有一维，那就好办了，寻找连续的1，连续最多的就是最大的值。现在是二维，也可以往一维上面靠，做法就是：从上往下一行一行遍历，每一行的每个元素，都表示和上一行同一列连通（上下都是1就表示连通）的累加值。也就是说，上面这个图变成了：</p>
<p>1 0 1 0 1</p>
<p>2 1 2 0 0</p>
<p>0 2 2 0 1</p>
<p>只有上下连通，才会被累加，如果断掉了，就置为0。</p>
<p>现在，每一行遍历完毕的时候，我拿到该行的结果，就可以去计算截止到该行为止的最大值了。</p>
<p>比如最后这行：</p>
<p>0 2 2 0 1</p>
<p>把这个数组（命名为acc）画成等价的柱状图就是：<br><img src="http://www.raychase.net/wp-content/uploads/2015/01/chartchart1.png"><br>我拿Excel草草画的图，但是可见要求最大的矩形应该就是acc[1]和acc[2]的和，为4。但是在求最大值的时候，需要按照高度从1到acc里元素的最大值为上限依次遍历，寻找连续块的最大值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> <span class="title">maximalRectangle</span>(<span class="keyword">char</span>[][] matrix) {</div><div class="line">        <span class="keyword">if</span> (matrix.length==<span class="number">0</span> || matrix[<span class="number">0</span>].length==<span class="number">0</span>)</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">         </div><div class="line">        <span class="keyword">int</span>[] acc = <span class="keyword">new</span> <span class="keyword">int</span>[matrix[<span class="number">0</span>].length];</div><div class="line">        <span class="keyword">int</span> max = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;matrix.length; i++) {</div><div class="line">            <span class="keyword">int</span> singleMax = <span class="number">0</span>;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;matrix[i].length; j++) {</div><div class="line">                <span class="keyword">if</span> (matrix[i][j]==<span class="string">'0'</span>) {</div><div class="line">                    acc[j] = <span class="number">0</span>;</div><div class="line">                } <span class="keyword">else</span> {</div><div class="line">                    acc[j]++;</div><div class="line">                     </div><div class="line">                    <span class="keyword">if</span> (acc[j]&gt;singleMax)</div><div class="line">                        singleMax = acc[j];</div><div class="line">                }</div><div class="line">            }</div><div class="line">             </div><div class="line">            <span class="keyword">int</span> newMax = calculateMax(acc, singleMax);</div><div class="line">            <span class="keyword">if</span> (newMax&gt;max)</div><div class="line">                max = newMax;</div><div class="line">        }</div><div class="line">         </div><div class="line">        <span class="keyword">return</span> max;</div><div class="line">    }</div><div class="line">     </div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> <span class="title">calculateMax</span>(<span class="keyword">int</span>[] acc, <span class="keyword">int</span> singleMax) {</div><div class="line">        <span class="keyword">int</span> max = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=singleMax; i++) {</div><div class="line">            <span class="keyword">int</span> accInRow = <span class="number">0</span>;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;acc.length; j++) {</div><div class="line">                <span class="keyword">if</span> (acc[j]&gt;=i) {</div><div class="line">                    accInRow += i;</div><div class="line">                     </div><div class="line">                    <span class="keyword">if</span> (accInRow&gt;max)</div><div class="line">                        max = accInRow;</div><div class="line">                } <span class="keyword">else</span> {</div><div class="line">                    accInRow = <span class="number">0</span>;</div><div class="line">                } <span class="comment">// else</span></div><div class="line">            } <span class="comment">// for j</span></div><div class="line">        } <span class="comment">// for i</span></div><div class="line">         </div><div class="line">        <span class="keyword">return</span> max;</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>AC了，代码其实并不复杂，但是其实复杂度够高的，达到了O(x<em>y</em>m)，其中x和y分别表示矩阵的长和宽，m表示某一行上积累的最大高度（acc里的最大值）。</p>
<p>当然，网传有更牛逼更简洁的解法，也更不好懂，<a href="http://www.cnblogs.com/lichen782/p/leetcode_Largest_Rectangle_in_Histogram.html" target="_blank" rel="external">这篇文章</a>提到，我就不贴了。</p>
<h3 id="Max_Points_on_a_Line"><span id="max-points-on-a-line" style="color: #ff0000;">Max Points on a Line</span></h3>
<p>题目】Given n points on a 2D plane, find the maximum number of points that lie on the same straight line.</p>
<p>【解答】最开始我的做法是，O(n^2)的复杂度，每取得两个点，就可以列出一个直线方程：y=kx+b，并把该直线方程放到一个map里面去，后续出现新的直线的时候都要先到map里面去寻找是否能够找到重合的直线，但是值得注意的有两处：</p>
<p>k和b都要表示成分数，不要使用double或者float，否则可能损失精度，比较两个float或者double的大小可能是不准确的；<br>在直线垂直于x轴的时候，原有方程不存在，直线方程为x=x0。<br>不过原始代码却执行超时了。</p>
<p>在此基础上整理一下思路，下面的解法AC，getCount方法，是对于给定的两个点p1、p2，寻找Point[]数组里面和p1、p2形成的直线斜率相同的点的个数（注意时刻都不要使用真正求斜率的除法，因为那样会引入double或者float型，丢失精度）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> <span class="title">maxPoints</span>(Point[] points) {</div><div class="line">        <span class="keyword">if</span> (points.length &lt;= <span class="number">1</span>)</div><div class="line">            <span class="keyword">return</span> points.length;</div><div class="line"> </div><div class="line">        <span class="keyword">int</span> maxCount = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; points.length; i++) {</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; points.length; j++) {</div><div class="line">                <span class="keyword">if</span> (points[i] == points[j])</div><div class="line">                    <span class="keyword">continue</span>;</div><div class="line">                <span class="keyword">int</span> count = getCount(points, points[i], points[j]);</div><div class="line">                <span class="keyword">if</span> (count &gt; maxCount)</div><div class="line">                    maxCount = count;</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keyword">return</span> maxCount;</div><div class="line">    }</div><div class="line"> </div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span>(Point[] points, Point p1, Point p2) {</div><div class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</div><div class="line"> </div><div class="line">        <span class="comment">// vertical</span></div><div class="line">        <span class="keyword">if</span> (p1.x == p2.x) {</div><div class="line">            <span class="keyword">for</span> (Point p : points) {</div><div class="line">                <span class="keyword">if</span> (p.x == p1.x)</div><div class="line">                    count++;</div><div class="line">            }</div><div class="line">            <span class="keyword">return</span> count;</div><div class="line">        }</div><div class="line"> </div><div class="line">        <span class="comment">// horizontal</span></div><div class="line">        <span class="keyword">if</span> (p1.y == p2.y) {</div><div class="line">            <span class="keyword">for</span> (Point p : points) {</div><div class="line">                <span class="keyword">if</span> (p.y == p1.y)</div><div class="line">                    count++;</div><div class="line">            }</div><div class="line">            <span class="keyword">return</span> count;</div><div class="line">        }</div><div class="line"> </div><div class="line">        <span class="keyword">for</span> (Point p : points) {</div><div class="line">            <span class="comment">// gradient: (p2.y-p1.y)/(p2.x-p1.x)</span></div><div class="line">            <span class="keyword">if</span> ((p.y - p2.y) * (p1.x - p2.x) == (p1.y - p2.y) * (p.x - p2.x)) {</div><div class="line">                count++;</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keyword">return</span> count;</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="LRU_Cache"><span id="lru-cache" style="color: #ff0000;">LRU Cache</span></h3>
<p>【题目】Design and implement a data structure for Least Recently Used (LRU) cache. It should support the following operations: <code>get</code> and <code>set</code>.</p>
<p><code>get(key)</code> - Get the value (will always be positive) of the key if the key exists in the cache, otherwise return -1.<br><code>set(key, value)</code> - Set or insert the value if the key is not already present. When the cache reached its capacity, it should invalidate the least recently used item before inserting a new item.</p>
<p>【解答】这里应用一点小知识，LinkedHashMap其实已经把这个LRU的事情做好了，只要覆写removeEldestEntry方法，判断如果大小大过容量，就返回true。构造方法，需要调用父类构造方法，传入的三个参数分别表示：初始大小、扩容增长因子、访问顺序（accessOrder）。其中第三个参数尤其重要，accessOrder为true时，每次调用get方法访问行为发生后，会把最近访问的对象移动到头部，而超出容量移除对象时，是从尾部开始的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.util.LinkedHashMap;</div><div class="line"> </div><div class="line">class LRULinkedHashMap extends LinkedHashMap&lt;Integer, Integer&gt; {</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> capacity;</div><div class="line">    <span class="keyword">public</span> <span class="title">LRULinkedHashMap</span>(<span class="keyword">int</span> capacity) {</div><div class="line">        <span class="keyword">super</span>(capacity, <span class="number">0.75</span>F, <span class="keyword">true</span>);</div><div class="line">        <span class="keyword">this</span>.capacity = capacity;</div><div class="line">    }</div><div class="line">     </div><div class="line">    <span class="annotation">@Override</span></div><div class="line">    <span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">removeEldestEntry</span>(Map.Entry paramEntry) {</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.entrySet().size()&gt;capacity)</div><div class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    }</div><div class="line"> </div><div class="line">}</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LRUCache</span> </span>{</div><div class="line">    <span class="keyword">private</span> LRULinkedHashMap map;</div><div class="line">     </div><div class="line">    <span class="keyword">public</span> <span class="title">LRUCache</span>(<span class="keyword">int</span> capacity) {</div><div class="line">        <span class="keyword">this</span>.map = <span class="keyword">new</span> LRULinkedHashMap(capacity);</div><div class="line">    }</div><div class="line">     </div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> <span class="title">get</span>(<span class="keyword">int</span> key) {</div><div class="line">        Integer result = <span class="keyword">this</span>.map.get(key);</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">null</span>==result)</div><div class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</div><div class="line">        <span class="keyword">return</span> result;</div><div class="line">    }</div><div class="line">     </div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span>(<span class="keyword">int</span> key, <span class="keyword">int</span> value) {</div><div class="line">        <span class="keyword">this</span>.map.put(key, value);</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="Longest_Valid_Parentheses"><span id="longest-valid-parentheses" style="color: #ff0000;">Longest Valid Parentheses</span></h3>
<p>【题目】Given a string containing just the characters ‘(‘ and ‘)’, find the length of the longest valid (well-formed) parentheses substring.</p>
<p>For “(()”, the longest valid parentheses substring is “()”, which has length = 2.</p>
<p>Another example is “)()())”, where the longest valid parentheses substring is “()()”, which has length = 4.</p>
<p>【解答】这道题也算hard里面相对简单的。基本思路是DP，但是最开始我用递归，从长串往短串方向递归调用，结果一个长case让我栈溢出了。于是改成循环，从短串往长串遍历（i从小到大），而在每次迭代中从右向左寻找包含s[i]的合法序列（j从大到小）：</p>
<p>每次循环迭代都拿包含s[i]的括号序列和不包含s[i]的括号序列（即前一次迭代的结果）比较，取较大值留下来。比如()()，i==2时，s[2]是(，结果是2；i==3时，s[3]是)，最长串是4，结果是2和4的最大值，为4。<br>用rightNum变量记录目前多余的右括号，需要继续找左括号来匹配。如果rightNum&lt;0，就要跳出本次迭代，因为左括号太多了，而右括号又必须先于左括号出现（因为j从大到小变化），允许合法出现的机会已经错过了；只有当rightNum变为0时，表示当前的串是一个合法的结果，更新accumation为当前串的长度len。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> <span class="title">longestValidParentheses</span>(String s) {</div><div class="line">        <span class="keyword">if</span> (s==<span class="keyword">null</span>)</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">         </div><div class="line">        <span class="keyword">int</span> longest = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;s.length(); i++) {</div><div class="line">            <span class="keyword">int</span> rightNum = <span class="number">0</span>;</div><div class="line">            <span class="keyword">int</span> len = <span class="number">0</span>;</div><div class="line">            <span class="keyword">int</span> accumulation = <span class="number">0</span>;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j=i; j&gt;=<span class="number">0</span>; j--) {</div><div class="line">                <span class="keyword">char</span> ch = s.charAt(j);</div><div class="line">                <span class="keyword">if</span> (ch==<span class="string">')'</span>) {</div><div class="line">                    rightNum++;</div><div class="line">                } <span class="keyword">else</span> {</div><div class="line">                    rightNum--;</div><div class="line">                    <span class="keyword">if</span> (rightNum&lt;<span class="number">0</span>)</div><div class="line">                        <span class="keyword">break</span>;</div><div class="line">                     </div><div class="line">                    len += <span class="number">2</span>;</div><div class="line">                    <span class="keyword">if</span> (rightNum==<span class="number">0</span>)</div><div class="line">                        accumulation = len;</div><div class="line">                }</div><div class="line">            }</div><div class="line">             </div><div class="line">            <span class="keyword">if</span> (accumulation&gt;longest)</div><div class="line">                longest = accumulation;</div><div class="line">        }</div><div class="line">         </div><div class="line">        <span class="keyword">return</span> longest;</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="Longest_Consecutive_Sequence"><span id="longest-consecutive-sequence" style="color: #ff0000;">Longest Consecutive Sequence</span></h3>
<p>【题目】Given an unsorted array of integers, find the length of the longest consecutive elements sequence.</p>
<p>For example,<br>Given <code>[100, 4, 200, 1, 3, 2]</code>,<br>The longest consecutive elements sequence is <code>[1, 2, 3, 4]</code>. Return its length: <code>4</code>.</p>
<p>Your algorithm should run in O(n) complexity.</p>
<p>【解答】这道题的关键在于时间复杂度要求是O(n)的，这就意味着，排序不用想了，而遍历这个数组的时候，还得用常量时间复杂度去做额外的操作。如果拼命去想怎么从原数组里面挨个取出元素来，怎么放到某一个容器里面，在整个数组便利完成之后，要让这个最长序列的结果也得出来的话，就走入死胡同了。原因在于，比如有序列1,2,3,4的话，当你2先放入容器，4再放入的时候，很难找到和2之间的关联。但是，反过来就不一样了。先把所有的数都一股脑儿倒到一个set里面去，然后从中任取一个数，接着这个数开始往大的序列和往小的序列都挨个尝试从这个set里面取出来，取到说明有连续串，一直取到这一串数断掉为止。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> <span class="title">longestConsecutive</span>(<span class="keyword">int</span>[] num) {</div><div class="line">        <span class="keyword">if</span> (num==<span class="keyword">null</span>)</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">             </div><div class="line">        Set&lt;Integer&gt; total = <span class="keyword">new</span> HashSet&lt;&gt;();</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> n : num) {</div><div class="line">            total.add(n);</div><div class="line">        }</div><div class="line">         </div><div class="line">        <span class="keyword">int</span> max = <span class="number">0</span>;</div><div class="line">        <span class="keyword">while</span> (!total.isEmpty()) {</div><div class="line">            <span class="keyword">int</span> n = total.iterator().next();</div><div class="line">            total.remove(n);</div><div class="line">             </div><div class="line">            <span class="keyword">int</span> count = <span class="number">1</span>;</div><div class="line">             </div><div class="line">            <span class="keyword">int</span> i = n;</div><div class="line">            <span class="keyword">while</span> (total.remove(++i))</div><div class="line">                count++;</div><div class="line">             </div><div class="line">            i = n;</div><div class="line">            <span class="keyword">while</span> (total.remove(--i))</div><div class="line">                count++;</div><div class="line">             </div><div class="line">            <span class="keyword">if</span> (count&gt;max)</div><div class="line">                max = count;</div><div class="line">        }</div><div class="line">         </div><div class="line">        <span class="keyword">return</span> max;</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="Copy_List_with_Random_Pointer"><span id="copy-list-with-random-pointer" style="color: #ff0000;">Copy List with Random Pointer</span></h3>
<p>【题目】A linked list is given such that each node contains an additional random pointer which could point to any node in the list or null.</p>
<p>Return a deep copy of the list.</p>
<p>【解答】这题比较简单。首先，按照不考虑random属性的情况，过一遍这个list，创建一个新的list，但是，每过到一个节点的时候，就以&lt;老节点,新节点&gt;这样的组合放到map里面去。之后再过第二遍的时候，对于每一个老节点，以及它的random属性所指向的节点，都可以在这个map里面找到对应的新节点。</p>
<p>对于新建的链表，下面使用了一个fakeTargetHead来简化代码，避免head的特殊判断。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>{</div><div class="line">    <span class="keyword">public</span> RandomListNode <span class="title">copyRandomList</span>(RandomListNode head) {</div><div class="line">        Map&lt;RandomListNode, RandomListNode&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</div><div class="line">         </div><div class="line">        RandomListNode fakeTargetHead = <span class="keyword">new</span> RandomListNode(<span class="number">0</span>);</div><div class="line">         </div><div class="line">        RandomListNode src = head;</div><div class="line">        RandomListNode target = fakeTargetHead;</div><div class="line">        <span class="keyword">while</span> (src!=<span class="keyword">null</span>) {</div><div class="line">            RandomListNode node = <span class="keyword">new</span> RandomListNode(src.label);</div><div class="line">            map.put(src, node);</div><div class="line">             </div><div class="line">            target.next = node;</div><div class="line">             </div><div class="line">            src = src.next;</div><div class="line">            target = target.next;</div><div class="line">        }</div><div class="line">         </div><div class="line">        src = head;</div><div class="line">        <span class="keyword">while</span> (src!=<span class="keyword">null</span>) {</div><div class="line">            <span class="keyword">if</span> (<span class="keyword">null</span>!=src.random) {</div><div class="line">                RandomListNode node = map.get(src);</div><div class="line">                RandomListNode to = map.get(src.random);</div><div class="line">                 </div><div class="line">                node.random = to;</div><div class="line">            }</div><div class="line">             </div><div class="line">            src = src.next;</div><div class="line">        }</div><div class="line">         </div><div class="line">        <span class="keyword">return</span> fakeTargetHead.next;</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="Largest_Rectangle_in_Histogram"><span id="largest-rectangle-in-histogram" style="color: #ff0000;">Largest Rectangle in Histogram</span></h3>
<p>【题目】Given n non-negative integers representing the histogram’s bar height where the width of each bar is 1, find the area of largest rectangle in the histogram.<br><img src="http://www.leetcode.com/wp-content/uploads/2012/04/histogram.png"><br>Above is a histogram where width of each bar is 1, given height = [2,1,5,6,2,3].<br><img src="http://www.leetcode.com/wp-content/uploads/2012/04/histogram_area.png"><br>The largest rectangle is shown in the shaded area, which has area = 10 unit.</p>
<p>For example,</p>
<p>Given height = [2,1,5,6,2,3],<br>return 10.</p>
<p>【解答】这个题目可以看作是《Maximal Rectangle》中间的一部分，但是它时间上面的要求，要比那道题高得多。因此我一开始使用解那道题里面的办法来解，就超时了：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> <span class="title">largestRectangleArea</span>(<span class="keyword">int</span>[] height) {</div><div class="line">        <span class="keyword">if</span> (height==<span class="keyword">null</span>)</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">             </div><div class="line">        <span class="keyword">int</span> max = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> h : height)</div><div class="line">            <span class="keyword">if</span> (h&gt;max)</div><div class="line">                max = h;</div><div class="line">         </div><div class="line">        <span class="keyword">int</span> largest = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=max; i++) {</div><div class="line">            <span class="keyword">int</span> total = <span class="number">0</span>;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> h : height) {</div><div class="line">                <span class="keyword">if</span> (h&gt;=i) {</div><div class="line">                    total += i;</div><div class="line">                     </div><div class="line">                    <span class="keyword">if</span> (total&gt;largest)</div><div class="line">                        largest = total;</div><div class="line">                } <span class="keyword">else</span> {</div><div class="line">                    total = <span class="number">0</span>;</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line">         </div><div class="line">        <span class="keyword">return</span> largest;</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>导致超时的case是[0,0,0,0,0,0,0,0,2147483647]，显然，我让i从1循环到2147483674，这太不合理了。于是我想，i不需要循环那么多，只需要循环height数组里面的那几个数就可以了，而height数组里面的数是可能有重复的，如果case有1000个1怎么办，其实i只需要取一次1就可以了，因此引入一个HashSet来去重：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> <span class="title">largestRectangleArea</span>(<span class="keyword">int</span>[] height) {</div><div class="line">        <span class="keyword">if</span> (height==<span class="keyword">null</span>)</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">         </div><div class="line">        Set&lt;Integer&gt; set = <span class="keyword">new</span> HashSet&lt;&gt;();</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> h : height)</div><div class="line">            <span class="keyword">if</span> (!set.contains(h))</div><div class="line">                set.add(h);</div><div class="line">         </div><div class="line">        <span class="keyword">int</span> largest = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i : set) {</div><div class="line">            <span class="keyword">int</span> total = <span class="number">0</span>;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> h : height) {</div><div class="line">                <span class="keyword">if</span> (h&gt;=i) {</div><div class="line">                    total += i;</div><div class="line">                     </div><div class="line">                    <span class="keyword">if</span> (total&gt;largest)</div><div class="line">                        largest = total;</div><div class="line">                } <span class="keyword">else</span> {</div><div class="line">                    total = <span class="number">0</span>;</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line">         </div><div class="line">        <span class="keyword">return</span> largest;</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>刚才那个case确实过了，但是碰到一个巨长无比的case又嗝屁了，归根到底这也是个n平方的复杂度。在网上这道题我找到了很多解法，有的解法虽然能AC，但是只是针对case做了优化，换一种类型的case其实还是会挂，因此并没有从实际上解决问题，但是，看看下面这个办法（来自<a href="http://blog.csdn.net/doc_sgl/article/details/11805519" target="_blank" rel="external">这个blog</a>），大致是思路就是从左往右遍历，用一个栈来存储递增的高度序列，如果发现高度递减，停止入栈，并不断出栈以分别计算以之前栈内存放的每个高度作为最终高度的矩形面积。具体解法刚才的blog链接上叙述得非常清楚了，图文并茂。这个办法是非常漂亮的，简洁清晰，而且时间复杂度也要低得多。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> <span class="title">largestRectangleArea</span>(<span class="keyword">int</span>[] height) {</div><div class="line">        Stack&lt;Integer&gt; stk = <span class="keyword">new</span> Stack&lt;&gt;();</div><div class="line">        <span class="keyword">int</span> i = <span class="number">0</span>;</div><div class="line">        <span class="keyword">int</span> maxArea = <span class="number">0</span>;</div><div class="line">         </div><div class="line">        <span class="keyword">while</span> (i &lt;= height.length) {</div><div class="line">            <span class="keyword">int</span> currentHeight = <span class="number">0</span>;</div><div class="line">            <span class="keyword">if</span> (i != height.length)</div><div class="line">                currentHeight = height[i];</div><div class="line">             </div><div class="line">            <span class="keyword">if</span> (stk.empty() || height[stk.peek()] &lt;= currentHeight) {</div><div class="line">                stk.push(i++);</div><div class="line">            } <span class="keyword">else</span> {</div><div class="line">                <span class="keyword">int</span> t = stk.pop();</div><div class="line">                maxArea = Math.max(maxArea, height[t] * (stk.empty() ? i : i - stk.peek() - <span class="number">1</span>));</div><div class="line">            }</div><div class="line">        }</div><div class="line">         </div><div class="line">        <span class="keyword">return</span> maxArea;</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="Jump_Game_II"><span id="jump-game-ii" style="color: #ff0000;">Jump Game II</span></h3>
<p>【题目】Given an array of non-negative integers, you are initially positioned at the first index of the array.</p>
<p>Each element in the array represents your maximum jump length at that position.</p>
<p>Your goal is to reach the last index in the minimum number of jumps.</p>
<p>For example:<br>Given array A = <code>[2,3,1,1,4]</code></p>
<p>The minimum number of jumps to reach the last index is 2. (Jump 1 step from index 0 to 1, then 3 steps to the last index.)</p>
<p>【解答】这个题目在hard的题目里算是简单的。在任意一个位置，都存在着当前jump数值可达的范围[x,range]，还存在着该区间的一系列A[i]+i所取的最大值nextRange，当i&gt;range时，更新range为原nextRange，并且jump数加一。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> <span class="title">jump</span>(<span class="keyword">int</span>[] A) {</div><div class="line">        <span class="keyword">if</span> (A.length == <span class="number">1</span>)</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line"> </div><div class="line">        <span class="keyword">int</span> jump = <span class="number">0</span>;</div><div class="line">        <span class="keyword">int</span> range = <span class="number">0</span>;</div><div class="line">        <span class="keyword">int</span> nextRange = <span class="number">0</span>;</div><div class="line"> </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; A.length; i++) {</div><div class="line">            <span class="keyword">if</span> (range &lt; i) {</div><div class="line">                <span class="keyword">if</span> (i &lt;= nextRange) {</div><div class="line">                    jump++;</div><div class="line">                    range = nextRange;</div><div class="line">                } <span class="keyword">else</span> {</div><div class="line">                    <span class="keyword">return</span> -<span class="number">1</span>; <span class="comment">// unreachable</span></div><div class="line">                }</div><div class="line">            }</div><div class="line"> </div><div class="line">            <span class="keyword">if</span> (A[i] + i &gt; nextRange)</div><div class="line">                nextRange = A[i] + i;</div><div class="line"> </div><div class="line">            <span class="keyword">if</span> (i == A.length - <span class="number">1</span>)</div><div class="line">                <span class="keyword">return</span> jump;</div><div class="line">        }</div><div class="line"> </div><div class="line">        <span class="keyword">return</span> -<span class="number">1</span>; <span class="comment">// impossible</span></div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="Interleaving_String"><span id="interleaving-string" style="color: #ff0000;">Interleaving String</span></h3>
<p>【题目】Given s1, s2, s3, find whether s3 is formed by the interleaving of s1 and s2.</p>
<p>For example,<br>Given:<br>s1 = <code>&quot;aabcc&quot;</code>,<br>s2 = <code>&quot;dbbca&quot;</code>,</p>
<p>When s3 = <code>&quot;aadbbcbcac&quot;</code>, return true.<br>When s3 = <code>&quot;aadbbbaccc&quot;</code>, return false.</p>
<p>【解答】这道题给我的第一感觉就是使用<code>回溯法</code>，分别从s1、s2和s3取一个字符，分别命名为c1、c2和c3，如果c1==c3而c2!=c3，那么这个字符从s1取；如果c2==c3而c1!=c3，那么字符从s2取。麻烦的是c1==c3且c2==c3的情况，相当于回溯的路径出现了分支，于是我使用一个stack来存放分支。最终回溯的路径会是深度优先遍历一棵二叉树。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div></pre></td><td class="code"><pre><div class="line">class Fork {</div><div class="line">    <span class="keyword">int</span> i1;</div><div class="line">    <span class="keyword">int</span> i2;</div><div class="line">    <span class="keyword">int</span> i3;</div><div class="line">     </div><div class="line">    <span class="keyword">public</span> <span class="title">Fork</span>(<span class="keyword">int</span> i1, <span class="keyword">int</span> i2, <span class="keyword">int</span> i3) {</div><div class="line">        <span class="keyword">this</span>.i1 = i1;</div><div class="line">        <span class="keyword">this</span>.i2 = i2;</div><div class="line">        <span class="keyword">this</span>.i3 = i3;</div><div class="line">    }</div><div class="line">}</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isInterleave</span>(String s1, String s2, String s3) {</div><div class="line">        <span class="keyword">if</span> (s1.length()+s2.length()!=s3.length())</div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">             </div><div class="line">        <span class="keyword">int</span> i1=<span class="number">0</span>, i2=<span class="number">0</span>, i3=<span class="number">0</span>;</div><div class="line">        Stack&lt;Fork&gt; stack = <span class="keyword">new</span> Stack&lt;&gt;();</div><div class="line">         </div><div class="line">        <span class="keyword">while</span> ((i1&lt;s1.length() && i2&lt;s2.length()) || !stack.isEmpty()) {</div><div class="line">            <span class="keyword">char</span> c1 = <span class="number">0</span>;</div><div class="line">            <span class="keyword">char</span> c2 = <span class="number">0</span>;</div><div class="line">            <span class="keyword">char</span> c3 = <span class="number">0</span>;</div><div class="line">             </div><div class="line">            <span class="keyword">if</span> (i1&lt;s1.length())</div><div class="line">                c1 = s1.charAt(i1);</div><div class="line">            <span class="keyword">if</span> (i2&lt;s2.length())</div><div class="line">                c2 = s2.charAt(i2);</div><div class="line">            <span class="keyword">if</span> (i3&lt;s3.length())</div><div class="line">                c3 = s3.charAt(i3);</div><div class="line">             </div><div class="line">            <span class="keyword">if</span> ( c1==<span class="number">0</span> || c2==<span class="number">0</span> || (c1!=c3&&c2!=c3) ) {</div><div class="line">                <span class="keyword">if</span> (stack.isEmpty())</div><div class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">                 </div><div class="line">                Fork fork = stack.pop();</div><div class="line">                i1 = fork.i1;</div><div class="line">                i2 = fork.i2;</div><div class="line">                i3 = fork.i3;</div><div class="line">                 </div><div class="line">                i2++;</div><div class="line">                i3++;</div><div class="line">                 </div><div class="line">                <span class="keyword">continue</span>;</div><div class="line">            }</div><div class="line">             </div><div class="line">            <span class="keyword">if</span> (c1==c3 && c2==c3) {</div><div class="line">                Fork fork = <span class="keyword">new</span> Fork(i1,i2,i3);</div><div class="line">                stack.push(fork);</div><div class="line">                i1++;</div><div class="line">                i3++;</div><div class="line">            } <span class="keyword">else</span> <span class="keyword">if</span> (c1==c3) {</div><div class="line">                i1++;</div><div class="line">                i3++;</div><div class="line">            } <span class="keyword">else</span> {</div><div class="line">                i2++;</div><div class="line">                i3++;</div><div class="line">            }</div><div class="line">        }</div><div class="line">         </div><div class="line">        <span class="keyword">while</span> (i1&lt;s1.length()) {</div><div class="line">            <span class="keyword">char</span> c1 = s1.charAt(i1);</div><div class="line">            <span class="keyword">char</span> c3 = s3.charAt(i3);</div><div class="line">             </div><div class="line">            <span class="keyword">if</span> (c1!=c3)</div><div class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">             </div><div class="line">            i1++;</div><div class="line">            i3++;</div><div class="line">        }</div><div class="line">         </div><div class="line">        <span class="keyword">while</span> (i2&lt;s2.length()) {</div><div class="line">            <span class="keyword">char</span> c2 = s2.charAt(i2);</div><div class="line">            <span class="keyword">char</span> c3 = s3.charAt(i3);</div><div class="line">             </div><div class="line">            <span class="keyword">if</span> (c2!=c3)</div><div class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">             </div><div class="line">            i2++;</div><div class="line">            i3++;</div><div class="line">        }</div><div class="line">         </div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>但是很快遇到某case的时候超时了，仔细分析了一下这个方法，最好的情况下时间复杂度是n阶，最坏的情况下时间复杂度达到了2的n次方阶。</p>
<p>现在换个思路，不是从前往后，而是从后往前想，假如说result[i][j]表示s1的前i个字符形成的子串和s2的前j个字符形成的子串能否interleave成s3的前i+j个字符形成的子串，那么就有这样的递推关系：</p>
<ul>
<li>只要 result[i][j - 1] &amp;&amp; s2.charAt(j - 1) == s3.charAt(i + j - 1) 或者 result[i - 1][j] &amp;&amp; s1.charAt(i - 1) == s3.charAt(i + j - 1) 有一个为真，result[i][j]就为真。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isInterleave</span>(String s1, String s2, String s3) {</div><div class="line">        <span class="keyword">if</span> (s3.length() != (s2.length() + s1.length()))</div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line"> </div><div class="line">        <span class="keyword">boolean</span> result[][] = <span class="keyword">new</span> <span class="keyword">boolean</span>[s1.length() + <span class="number">1</span>][s2.length() + <span class="number">1</span>];</div><div class="line">        result[<span class="number">0</span>][<span class="number">0</span>] = <span class="keyword">true</span>;</div><div class="line"> </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= s1.length(); i++)</div><div class="line">            result[i][<span class="number">0</span>] = result[i - <span class="number">1</span>][<span class="number">0</span>] && (s1.charAt(i - <span class="number">1</span>) == s3.charAt(i - <span class="number">1</span>));</div><div class="line"> </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= s2.length(); j++)</div><div class="line">            result[<span class="number">0</span>][j] = result[<span class="number">0</span>][j - <span class="number">1</span>] && (s2.charAt(j - <span class="number">1</span>) == s3.charAt(j - <span class="number">1</span>));</div><div class="line"> </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= s1.length(); i++) {</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= s2.length(); j++) {</div><div class="line">                <span class="keyword">boolean</span> r = result[i][j - <span class="number">1</span>] && s2.charAt(j - <span class="number">1</span>) == s3.charAt(i + j - <span class="number">1</span>);</div><div class="line">                result[i][j] = r || (result[i - <span class="number">1</span>][j] && s1.charAt(i - <span class="number">1</span>) == s3.charAt(i + j - <span class="number">1</span>));</div><div class="line">            }</div><div class="line">        }</div><div class="line"> </div><div class="line">        <span class="keyword">return</span> result[s1.length()][s2.length()];</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>再看一下这个方法的复杂度，稳定在n的平方。</p>
<h3 id="Insert_Interval"><span id="insert-interval" style="color: #ff0000;">Insert Interval</span></h3>
<p>【题目】Given a set of non-overlapping intervals, insert a new interval into the intervals (merge if necessary).</p>
<p>You may assume that the intervals were initially sorted according to their start times.</p>
<p>Example 1:<br>Given intervals [1,3],[6,9], insert and merge [2,5] in as [1,5],[6,9].</p>
<p>Example 2:<br>Given [1,2],[3,5],[6,7],[8,10],[12,16], insert and merge [4,9] in as [1,2],[3,10],[12,16].</p>
<p>This is because the new interval [4,9] overlaps with [3,5],[6,7],[8,10].</p>
<p>【解答】循环过程中，分三种情况讨论：</p>
<ul>
<li>newInterval在interval的右侧，把左侧的interval加入list；</li>
<li>newInterval在interval左侧，把左侧的newInterval加入list，把原右侧的interval置为新的newInterval；</li>
<li>newInterval和interval有重叠，这种情况下，构造一个新的newInterval，覆盖范围为原有interval和newInterval的并集。</li>
</ul>
<p>待循环结束，list里面添加余下的尚未处理的那个newInterval（因为它在右侧）。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>{</div><div class="line">    <span class="keyword">public</span> ArrayList&lt;Interval&gt; <span class="title">insert</span>(ArrayList&lt;Interval&gt; intervals, Interval newInterval) {</div><div class="line">  </div><div class="line">        ArrayList&lt;Interval&gt; res = <span class="keyword">new</span> ArrayList&lt;Interval&gt;();</div><div class="line">  </div><div class="line">        <span class="keyword">for</span> (Interval interval : intervals) {</div><div class="line">            <span class="keyword">if</span> (interval.end &lt; newInterval.start) { <span class="comment">// [1,2] _[3,4]_</span></div><div class="line">                res.add(interval);</div><div class="line">            } <span class="keyword">else</span> <span class="keyword">if</span> (interval.start &gt; newInterval.end) { <span class="comment">// _[1,2]_ [3,4]</span></div><div class="line">                res.add(newInterval);</div><div class="line">                newInterval = interval;</div><div class="line">            } <span class="keyword">else</span> <span class="keyword">if</span> (interval.end &gt;= newInterval.start || interval.start &lt;= newInterval.end) { <span class="comment">// [1,3] _[2,4]_ or _[1,3]_ [2,4]</span></div><div class="line">                <span class="keyword">int</span> start = Math.min(interval.start, newInterval.start);</div><div class="line">                <span class="keyword">int</span> end = Math.max(newInterval.end, interval.end);</div><div class="line">                 </div><div class="line">                newInterval = <span class="keyword">new</span> Interval(start, end);</div><div class="line">            } <span class="keyword">else</span> {</div><div class="line">                <span class="comment">// unreachable</span></div><div class="line">            }</div><div class="line">        }</div><div class="line">  </div><div class="line">        res.add(newInterval);</div><div class="line">  </div><div class="line">        <span class="keyword">return</span> res;</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="Wildcard_Matching"><span id="wildcard-matching" style="color: #ff0000;">Wildcard Matching</span></h3>
<p>【题目】Implement wildcard pattern matching with support for ‘?’ and ‘*’.</p>
<pre><code><span class="string">'?'</span> Matches <span class="keyword">any</span> single <span class="keyword">character</span>.
<span class="string">'*'</span> Matches <span class="keyword">any</span> sequence <span class="operator">of</span> <span class="keyword">characters</span> (including <span class="operator">the</span> <span class="constant">empty</span> sequence).

The matching should cover <span class="operator">the</span> entire input <span class="keyword">string</span> (<span class="operator">not</span> partial).

The <span class="function"><span class="keyword">function</span> <span class="title">prototype</span> <span class="title">should</span> <span class="title">be</span>:</span>
bool isMatch(const <span class="keyword">char</span> *s, const <span class="keyword">char</span> *p)

Some examples:
isMatch(<span class="string">"aa"</span>,<span class="string">"a"</span>) → <span class="constant">false</span>
isMatch(<span class="string">"aa"</span>,<span class="string">"aa"</span>) → <span class="constant">true</span>
isMatch(<span class="string">"aaa"</span>,<span class="string">"aa"</span>) → <span class="constant">false</span>
isMatch(<span class="string">"aa"</span>, <span class="string">"*"</span>) → <span class="constant">true</span>
isMatch(<span class="string">"aa"</span>, <span class="string">"a*"</span>) → <span class="constant">true</span>
isMatch(<span class="string">"ab"</span>, <span class="string">"?*"</span>) → <span class="constant">true</span>
isMatch(<span class="string">"aab"</span>, <span class="string">"c*a*b"</span>) → <span class="constant">false</span>
</code></pre><p>【解答】看到题目以后，第一反应就是通过一个递归函数来解题：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isMatch</span>(String s, String p) {</div><div class="line">        <span class="keyword">return</span> isMatch(s, <span class="number">0</span>, p, <span class="number">0</span>);</div><div class="line">    }</div><div class="line">     </div><div class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isMatch</span>(String s, <span class="keyword">int</span> si, String p, <span class="keyword">int</span> pi) {</div><div class="line">        <span class="keyword">if</span> (pi==p.length())</div><div class="line">            <span class="keyword">return</span> si==s.length();</div><div class="line">         </div><div class="line">        <span class="keyword">char</span> cp = p.charAt(pi);</div><div class="line">         </div><div class="line">        <span class="keyword">if</span> (si==s.length()) {</div><div class="line">            <span class="keyword">if</span> (cp==<span class="string">'*'</span>)</div><div class="line">                <span class="keyword">return</span> isMatch(s, si, p, pi+<span class="number">1</span>);</div><div class="line">             </div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">        }</div><div class="line">         </div><div class="line">        <span class="keyword">char</span> cs = s.charAt(si);</div><div class="line">         </div><div class="line">        <span class="keyword">if</span> (cp==<span class="string">'*'</span>) {</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;s.length()-si; i++) {</div><div class="line">                <span class="keyword">if</span> (isMatch(s, si+i, p, pi+<span class="number">1</span>))</div><div class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">            }</div><div class="line">             </div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">        } <span class="keyword">else</span> <span class="keyword">if</span> (cp==<span class="string">'?'</span>) {</div><div class="line">            <span class="keyword">return</span> isMatch(s, si+<span class="number">1</span>, p, pi+<span class="number">1</span>);</div><div class="line">        } <span class="keyword">else</span> {</div><div class="line">            <span class="keyword">if</span> (cs==cp)</div><div class="line">                <span class="keyword">return</span> isMatch(s, si+<span class="number">1</span>, p, pi+<span class="number">1</span>);</div><div class="line">             </div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>然后，在巨长的case上面执行超时了。于是想了想，除了星号（<em>）以外，其它情况的递归都显然可以免去；而如果遇到星号，要比较星号后面的字符，比如ababccccdddd去匹配</em>d，那么遇到星号以后，要看星号后面那个字符，在这里是d，去源字符串s里面找，如果不是d的话直接忽略掉，如果是d的话继续递归匹配：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isMatch</span>(String s, String p) {</div><div class="line">        <span class="keyword">return</span> isMatch(s, <span class="number">0</span>, p, <span class="number">0</span>);</div><div class="line">    }</div><div class="line">     </div><div class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isMatch</span>(String s, <span class="keyword">int</span> si, String p, <span class="keyword">int</span> pi) {</div><div class="line">        <span class="keyword">while</span> (pi&lt;p.length()) {</div><div class="line">            <span class="keyword">char</span> cp = p.charAt(pi);</div><div class="line">             </div><div class="line">            <span class="keyword">if</span> (si==s.length()) {</div><div class="line">                <span class="keyword">if</span> (cp==<span class="string">'*'</span>)</div><div class="line">                    pi++;</div><div class="line">                 </div><div class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">            }</div><div class="line">             </div><div class="line">            <span class="keyword">char</span> cs = s.charAt(si);</div><div class="line">             </div><div class="line">            <span class="keyword">if</span> (cp==<span class="string">'*'</span>) {</div><div class="line">                pi++;</div><div class="line"> </div><div class="line">                <span class="keyword">int</span> minLen = <span class="number">0</span>;</div><div class="line">                <span class="keyword">while</span> (<span class="keyword">true</span>) {</div><div class="line">                    <span class="keyword">if</span> (pi==p.length()) {</div><div class="line">                        <span class="keyword">if</span> (s.length()-si&gt;=minLen)</div><div class="line">                            <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">                        <span class="keyword">else</span></div><div class="line">                            <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">                    }</div><div class="line">                     </div><div class="line">                    <span class="keyword">char</span> cp2 = p.charAt(pi);</div><div class="line">                    <span class="keyword">if</span> (cp2==<span class="string">'*'</span>) {</div><div class="line">                        minLen = <span class="number">0</span>;</div><div class="line">                        pi++;</div><div class="line">                    } <span class="keyword">else</span> <span class="keyword">if</span> (cp2==<span class="string">'?'</span>) {</div><div class="line">                        minLen++;</div><div class="line">                        pi++;</div><div class="line">                    } <span class="keyword">else</span> {</div><div class="line">                        <span class="keyword">for</span> (<span class="keyword">int</span> i=si; i&lt;s.length(); i++) {</div><div class="line">                            <span class="keyword">if</span> (s.charAt(i)==cp2 && i-si&gt;=minLen && isMatch(s, i+<span class="number">1</span>, p, pi+<span class="number">1</span>))</div><div class="line">                                <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">                        }</div><div class="line">                        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">                    }</div><div class="line">                }</div><div class="line">            } <span class="keyword">else</span> <span class="keyword">if</span> (cp==<span class="string">'?'</span>) {</div><div class="line">                si++;</div><div class="line">                pi++;</div><div class="line">            } <span class="keyword">else</span> {</div><div class="line">                <span class="keyword">if</span> (cs==cp) {</div><div class="line">                    si++;</div><div class="line">                    pi++;</div><div class="line">                }</div><div class="line">                 </div><div class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">            }</div><div class="line">        }</div><div class="line">         </div><div class="line">        <span class="keyword">return</span> si==s.length();</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>可是，遇到某变态case继续超时……于是搞了N久，最后可行的办法是，利用一个标识是否遇到星号的变量（asterisk），以及额外的两个标识在星号之后在s和p出现的指针sa和pa，整个大循环的逻辑是：</p>
<ul>
<li>如果si和pi指向的字符相等，或者pi指向了问号，那么，si++，pi++，这两个是基本指针的前进；</li>
<li>如果pi指向了星号，把pi移到星号之后的那个字符，并且把此时是si存为sa，pi存为pa；</li>
<li>对于余下的情况，考虑在出现过星号的情况，因为两个字符不相等了，那么星号后面那个字符相应的匹配位置需要在s中往后移。</li>
</ul>
<p>注意：在遇到星号的时候要把pi和si分别赋给pa和sa，而在有星号出现后的未匹配事件发生时，要把pa和sa赋回给pi和si（相当于pa和sa占住位置，pi和si往前试探着前行）；另外，循环完毕后，要判断p内还有没有非星号的字符，如果有就匹配失败了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isMatch</span>(String s, String p) {</div><div class="line">        <span class="keyword">return</span> isMatch(s, <span class="number">0</span>, p, <span class="number">0</span>);</div><div class="line">    }</div><div class="line">     </div><div class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isMatch</span>(String s, <span class="keyword">int</span> si, String p, <span class="keyword">int</span> pi) {</div><div class="line">        <span class="keyword">boolean</span> asterisk = <span class="keyword">false</span>;</div><div class="line">        <span class="keyword">int</span> sa = <span class="number">0</span>, pa = <span class="number">0</span>;</div><div class="line"> </div><div class="line">        <span class="keyword">while</span> (si &lt; s.length()) {</div><div class="line">            <span class="keyword">if</span> (pi == p.length()) {</div><div class="line">                <span class="keyword">if</span> (asterisk) {</div><div class="line">                    sa++;</div><div class="line">                    si = sa;</div><div class="line">                    pi = pa;</div><div class="line">                    <span class="keyword">continue</span>;</div><div class="line">                } <span class="keyword">else</span> {</div><div class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">                }</div><div class="line">            }</div><div class="line"> </div><div class="line">            <span class="keyword">char</span> cp = p.charAt(pi);</div><div class="line">            <span class="keyword">char</span> cs = s.charAt(si);</div><div class="line"> </div><div class="line">            <span class="keyword">if</span> (cp == <span class="string">'*'</span>) {</div><div class="line">                asterisk = <span class="keyword">true</span>;</div><div class="line"> </div><div class="line">                pi++;</div><div class="line">                pa = pi;</div><div class="line">                sa = si;</div><div class="line">            } <span class="keyword">else</span> <span class="keyword">if</span> (cp == <span class="string">'?'</span>) {</div><div class="line">                si++;</div><div class="line">                pi++;</div><div class="line">            } <span class="keyword">else</span> {</div><div class="line">                <span class="keyword">if</span> (cs == cp) {</div><div class="line">                    si++;</div><div class="line">                    pi++;</div><div class="line">                } <span class="keyword">else</span> <span class="keyword">if</span> (asterisk) {</div><div class="line">                    pi = pa;</div><div class="line">                    sa++;</div><div class="line">                    si = sa;</div><div class="line">                } <span class="keyword">else</span> {</div><div class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line"> </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = pi; i &lt; p.length(); i++) {</div><div class="line">            <span class="keyword">if</span> (p.charAt(i) != <span class="string">'*'</span>)</div><div class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">        }</div><div class="line"> </div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="Distinct_Subsequences"><span id="distinct-subsequences" style="color: #ff0000;">Distinct Subsequences</span></h3>
<p>【题目】Given a string S and a string T, count the number of distinct subsequences of T in S.</p>
<p>A subsequence of a string is a new string which is formed from the original string by deleting some (can be none) of the characters without disturbing the relative positions of the remaining characters. (ie, <code>&quot;ACE&quot;</code> is a subsequence of <code>&quot;ABCDE&quot;</code> while <code>&quot;AEC&quot;</code> is not).</p>
<p>Here is an example:<br>S = <code>&quot;rabbbit&quot;</code>, T = <code>&quot;rabbit&quot;</code></p>
<p>Return <code>3</code>.<br>【解答】拿到这样的题目，首先，回溯法遍历所有情况肯定是可以做的，但是那样复杂度太高。为了减小复杂度，很容易考虑到使用动态规划。但是动态规划怎么设计递推关系就很重要了：</p>
<ul>
<li>考虑到S.length()&gt;=T.length()，那么其中一种递推关系是，假设f(i)表示S的[0,i)子串和T形成的distinct子串数量，那么如果可以找到f(i+1)和f(i)之间的递推关系就好解了，这是其中一个思路，写出来的DP是一维的；</li>
<li>也可以假设f(i,j)表示的是S的[0,i)子串和T的[0,j)子串，需要寻找f(i,j)和f(i-1,j)、f(i,j-1)、f(i-1,j-1)这样的递推关系，我采用的是这一条思路：</li>
<li>如果S[i]==T[j]，那么当S[i]没出现在T里面的时候，f(i,j)=f(i-1,j)，当S[i]出现在T里面，就有f(i,j)=f(i-1,j-1)，因此，这种情况下f(i,j) = f(i-1,j) + f(i-1,j-1)；</li>
<li>如果S[i]!=T[j]，那么显然S[i]不能出现在T里面，于是f(i,j) = f(i-1,j)。</li>
</ul>
<p>注意程序出口，当j为0，即T变成了空串，序列数就是1；反过来，当S为空串的时候，T一定是空串，否则T的长度大于S的长度了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> <span class="title">numDistinct</span>(String S, String T) {</div><div class="line">        Integer[][] cache = <span class="keyword">new</span> Integer[S.length()+<span class="number">1</span>][T.length()+<span class="number">1</span>];</div><div class="line">        <span class="keyword">return</span> numDistinct(S, T, S.length(), T.length(), cache);</div><div class="line">    }</div><div class="line">     </div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> <span class="title">numDistinct</span>(String S, String T, <span class="keyword">int</span> i, <span class="keyword">int</span> j, Integer[][] cache) {</div><div class="line">        <span class="keyword">if</span> (cache[i][j]!=<span class="keyword">null</span>)</div><div class="line">            <span class="keyword">return</span> cache[i][j];</div><div class="line">         </div><div class="line">        <span class="keyword">if</span> (i&gt;<span class="number">0</span>) {</div><div class="line">            <span class="keyword">char</span> sc = S.charAt(i-<span class="number">1</span>);</div><div class="line">            <span class="keyword">char</span> st = <span class="number">0</span>;</div><div class="line">            <span class="keyword">if</span> (j&gt;<span class="number">0</span>)</div><div class="line">                st = T.charAt(j-<span class="number">1</span>);</div><div class="line">             </div><div class="line">            <span class="keyword">int</span> prev = numDistinct(S, T, i-<span class="number">1</span>, j, cache);</div><div class="line">             </div><div class="line">            <span class="keyword">if</span> (sc!=st || j==<span class="number">0</span>) {</div><div class="line">                cache[i][j] = prev;</div><div class="line">                <span class="keyword">return</span> prev;</div><div class="line">            } <span class="keyword">else</span> {</div><div class="line">                <span class="keyword">int</span> total = prev + numDistinct(S, T, i-<span class="number">1</span>, j-<span class="number">1</span>, cache);</div><div class="line">                cache[i][j] = total;</div><div class="line">                <span class="keyword">return</span> total;</div><div class="line">            }</div><div class="line">        } <span class="keyword">else</span> {</div><div class="line">            <span class="keyword">if</span> (j==<span class="number">0</span>) {</div><div class="line">                cache[i][j] = <span class="number">1</span>;</div><div class="line">                <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">            } <span class="keyword">else</span> {</div><div class="line">                cache[i][j] = <span class="number">0</span>;</div><div class="line">                <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>可是上的解法在某变态case的时候出现了StackOverflowError，通常这种情况下，如果你的编程语言支持尾递归，那可以考虑把它优化成尾递归的形式，如果不支持（比如Java），那就干脆尝试把它写成循环（其实下面的代码还是显得啰嗦，还可以继续优化，我留着这样是因为在思考过程中把所有分支情况全部写出来了，是最原始的分类讨论的体现，我觉得看起来直白；而且，空间复杂度上面，是可以从n平方降到n的，因为i是一直在增大，之前的数据没有必要保留，每次这个数组保存的都是当前i的迭代数据）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> <span class="title">numDistinct</span>(String S, String T) {</div><div class="line">        <span class="keyword">if</span> (T.length()==<span class="number">0</span>)</div><div class="line">            <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">        <span class="keyword">if</span> (S.length()==<span class="number">0</span>)</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">         </div><div class="line">        <span class="keyword">int</span>[][] cache = <span class="keyword">new</span> <span class="keyword">int</span>[S.length()][T.length()];</div><div class="line"> </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;S.length(); i++) {</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;=i && j&lt;T.length(); j++) {</div><div class="line">                <span class="keyword">if</span> (S.charAt(i)!=T.charAt(j)) {</div><div class="line">                    <span class="keyword">if</span> (i&gt;j) { <span class="comment">// i!=0</span></div><div class="line">                        cache[i][j] = cache[i-<span class="number">1</span>][j];</div><div class="line">                    } <span class="keyword">else</span> {</div><div class="line">                        cache[i][j] = <span class="number">0</span>;</div><div class="line">                    }</div><div class="line">                } <span class="keyword">else</span> {</div><div class="line">                    <span class="keyword">if</span> (i&gt;j) {</div><div class="line">                        <span class="keyword">if</span> (j==<span class="number">0</span>)</div><div class="line">                            cache[i][j] = cache[i-<span class="number">1</span>][j] + <span class="number">1</span>;</div><div class="line">                        <span class="keyword">else</span></div><div class="line">                            cache[i][j] = cache[i-<span class="number">1</span>][j] + cache[i-<span class="number">1</span>][j-<span class="number">1</span>];</div><div class="line">                    } <span class="keyword">else</span> {</div><div class="line">                        <span class="keyword">if</span> (i==<span class="number">0</span>)</div><div class="line">                            cache[i][j] = <span class="number">1</span>;</div><div class="line">                        <span class="keyword">else</span></div><div class="line">                            cache[i][j] = cache[i-<span class="number">1</span>][j-<span class="number">1</span>];</div><div class="line">                    }</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line">         </div><div class="line">        <span class="keyword">return</span> cache[S.length()-<span class="number">1</span>][T.length()-<span class="number">1</span>];</div><div class="line">    } </div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="Word_Break_II"><span id="word-break-ii" style="color: #ff0000;">Word Break II</span></h3>
<p>【题目】Given a string s and a dictionary of words dict, add spaces in s to construct a sentence where each word is a valid dictionary word.</p>
<p>Return all such possible sentences.</p>
<p>For example, given<br>s = <code>&quot;catsanddog&quot;</code>,<br>dict = <code>[&quot;cat&quot;, &quot;cats&quot;, &quot;and&quot;, &quot;sand&quot;, &quot;dog&quot;]</code>.</p>
<p>A solution is <code>[&quot;cats and dog&quot;, &quot;cat sand dog&quot;]</code>.</p>
<p>【解答】动态规划求解。判断给定字符串是否以某单词结尾，如果是，就抠掉该结尾单词，余下子串继续递归判断。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>{</div><div class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title">wordBreak</span>(String s, Set&lt;String&gt; dict) {</div><div class="line">        Map&lt;Integer, List&lt;String&gt;&gt; map = <span class="keyword">new</span> HashMap&lt;Integer, List&lt;String&gt;&gt;();</div><div class="line">        List&lt;String&gt; defaultList = <span class="keyword">new</span> ArrayList&lt;String&gt;();</div><div class="line">        defaultList.add(<span class="string">""</span>);</div><div class="line">        map.put(-<span class="number">1</span>, defaultList);</div><div class="line">        <span class="keyword">return</span> getAllPossibleSentences(s, dict, s.length()-<span class="number">1</span>, map);</div><div class="line">    }</div><div class="line">     </div><div class="line">    <span class="keyword">private</span> List&lt;String&gt; <span class="title">getAllPossibleSentences</span>(String s, Set&lt;String&gt; dict, <span class="keyword">int</span> pos, Map&lt;Integer, List&lt;String&gt;&gt; map){</div><div class="line">        <span class="keyword">if</span> (map.containsKey(pos))</div><div class="line">            <span class="keyword">return</span> map.get(pos);</div><div class="line">         </div><div class="line">        String sub = s.substring(<span class="number">0</span>, pos+<span class="number">1</span>);</div><div class="line">        List&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;String&gt;();</div><div class="line">        <span class="keyword">for</span> (String word : dict) {</div><div class="line">            <span class="keyword">if</span> (sub.endsWith(word)) {</div><div class="line">                <span class="keyword">int</span> firstSegEnd = pos - word.length();</div><div class="line">                <span class="keyword">if</span> (firstSegEnd&lt;-<span class="number">1</span>) <span class="comment">// no solution found</span></div><div class="line">                    <span class="keyword">continue</span>;</div><div class="line">                 </div><div class="line">                List&lt;String&gt; subList = getAllPossibleSentences(s, dict, firstSegEnd, map);</div><div class="line">                <span class="keyword">for</span> (String str : subList) {</div><div class="line">                    <span class="keyword">if</span> (<span class="string">""</span>.equals(str))</div><div class="line">                        list.add(word);</div><div class="line">                    <span class="keyword">else</span></div><div class="line">                        list.add(str + <span class="string">" "</span> + word);</div><div class="line">                }</div><div class="line">            } <span class="comment">// if</span></div><div class="line">        }<span class="comment">// for</span></div><div class="line">         </div><div class="line">        map.put(pos, list)</div><div class="line">        <span class="keyword">return</span> list;</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="First_Missing_Positive"><span id="first-missing-positive" style="color: #ff0000;">First Missing Positive</span></h3>
<p>【题目】Given an unsorted integer array, find the first missing positive integer.</p>
<p>For example,<br>Given <code>[1,2,0]</code> return 3,<br>and <code>[3,4,-1,1]</code> return 2.</p>
<p>Your algorithm should run in O(n) time and uses constant space.</p>
<p>【解答】我开始只注意到了O(n)的时间复杂度，于是引入一个HashSet，把所有数往里一放，最后再从1开始累加，并挨个检查在set里面有没有，要没有就说明找到那个数了：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> <span class="title">firstMissingPositive</span>(<span class="keyword">int</span>[] A) {</div><div class="line">        Set&lt;Integer&gt; set = <span class="keyword">new</span> HashSet&lt;&gt;();</div><div class="line">         </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> a : A)</div><div class="line">            set.add(a);</div><div class="line">         </div><div class="line">        <span class="keyword">int</span> i = <span class="number">1</span>;</div><div class="line">        <span class="keyword">while</span> (i&lt;=A.length) {</div><div class="line">            <span class="keyword">if</span> (!set.contains(i))</div><div class="line">                <span class="keyword">return</span> i;</div><div class="line">             </div><div class="line">            i++;</div><div class="line">        }</div><div class="line">         </div><div class="line">        <span class="keyword">return</span> i;</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>但是后来看到题目要求常量的额外空间，那我的这个办法其实是错误的。要记录下这些数，又要常量复杂度，只能考虑能不能重用入参数组A了，按理说修改参数里面的东西是不会引入空间复杂度的。</p>
<p>对于数组A，如果所有的A[i]==i+1的话，那么说明这些数正好是从1开始的连续正整数序列，但是现在有可能有0，有负数，而正数序列也可能有重复，有断开的地方……但无论怎样，遍历一遍A，用交换的办法尽可能把每个数都放到该放的地方去，当然，只有大小不超过A长度的正整数才能够找到安居之所。即，把A[i]放到A[A[i]-1]去。这一遍遍历之后，从头开始数，第一个数值和下标对不上（即A[i]!=i+1）的那个元素的下标，就是要求的missing positive。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> <span class="title">firstMissingPositive</span>(<span class="keyword">int</span>[] A) {</div><div class="line">        Set&lt;Integer&gt; set = <span class="keyword">new</span> HashSet&lt;&gt;();</div><div class="line">         </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> a : A)</div><div class="line">            set.add(a);</div><div class="line">         </div><div class="line">        <span class="keyword">int</span> i = <span class="number">1</span>;</div><div class="line">        <span class="keyword">while</span> (i&lt;=A.length) {</div><div class="line">            <span class="keyword">if</span> (!set.contains(i))</div><div class="line">                <span class="keyword">return</span> i;</div><div class="line">             </div><div class="line">            i++;</div><div class="line">        }</div><div class="line">         </div><div class="line">        <span class="keyword">return</span> i;</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>虽说AC了，但是粗看我对其中的时间复杂度是否为n阶并不确定，看着一个for和一个while嵌套的。于是我改成了这样：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> <span class="title">firstMissingPositive</span>(<span class="keyword">int</span>[] A) {</div><div class="line">        <span class="keyword">int</span> i=<span class="number">0</span>;</div><div class="line">        <span class="keyword">while</span> (i&lt;A.length) {</div><div class="line">            <span class="keyword">if</span> (A[i]!=(i+<span class="number">1</span>) && A[i]&gt;=<span class="number">1</span> && A[i]&lt;=A.length && A[A[i]-<span class="number">1</span>]!=A[i]) {</div><div class="line">                <span class="comment">// swap</span></div><div class="line">                <span class="keyword">int</span> temp = A[i];</div><div class="line">                A[i] = A[temp-<span class="number">1</span>];</div><div class="line">                A[temp-<span class="number">1</span>] = temp;</div><div class="line">            } <span class="keyword">else</span> {</div><div class="line">                i++;</div><div class="line">            }</div><div class="line">        }</div><div class="line">     </div><div class="line">        <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;A.length; i++) {</div><div class="line">            <span class="keyword">if</span> (A[i]!=i+<span class="number">1</span>)</div><div class="line">                <span class="keyword">return</span> i+<span class="number">1</span>;</div><div class="line">        }</div><div class="line">         </div><div class="line">        <span class="keyword">return</span> A.length+<span class="number">1</span>;</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>看着是少了一层嵌套循环，但是其实呢，做法上面换汤不换药，在每次swap发生的时候，i是不前进的，也就是说，对于A[i]，swap一次，把A[i]换到该去的地方去了，但是换过来一个别的数，而这个新数因为在A[i]上，要继续swap……直到条件不满足，没有继续swap的必要，i才继续前进。但是仔细分析，由于每个到来到A[i]的数都去了它应该去的地方，A[i]去了新地方以后便不会再被换走，因而复杂度确实为n。不管是写成上面那种形式还是这种形式。</p>
<p>这道题还是有些有趣的。</p>
<h3 id="Word_Ladder_II"><span id="word-ladder-ii" style="color: #ff0000;">Word Ladder II</span></h3>
<p>【题目】Given two words (start and end), and a dictionary, find all shortest transformation sequence(s) from start to end, such that:</p>
<p>Only one letter can be changed at a time<br>Each intermediate word must exist in the dictionary<br>For example,</p>
<p>Given:<br>start = <code>&quot;hit&quot;</code><br>end = <code>&quot;cog&quot;</code><br>dict = <code>[&quot;hot&quot;,&quot;dot&quot;,&quot;dog&quot;,&quot;lot&quot;,&quot;log&quot;]</code></p>
<p>Return</p>
<pre><code>  [
    [<span class="string">"hit"</span>,<span class="string">"hot"</span>,<span class="string">"dot"</span>,<span class="string">"dog"</span>,<span class="string">"cog"</span>],
    [<span class="string">"hit"</span>,<span class="string">"hot"</span>,<span class="string">"lot"</span>,<span class="string">"log"</span>,<span class="string">"cog"</span>]
  ]
</code></pre><p>Note:</p>
<ul>
<li>All words have the same length.</li>
<li>All words contain only lowercase alphabetic characters.</li>
</ul>
<p>【解答】这道题刚拿到手的时候觉得挺简单的，BFS。每一层都去dict里面寻找所有的单词，如果二者只差一个字母（isNeighbor），就找到结果了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>{</div><div class="line">    <span class="keyword">public</span> List&lt;List&lt;String&gt;&gt; <span class="title">findLadders</span>(String start, String end, Set&lt;String&gt; dict) {</div><div class="line">        List&lt;List&lt;String&gt;&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        List&lt;String&gt; ll = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        ll.add(start);</div><div class="line">        list.add(ll);</div><div class="line">        dict.remove(start);</div><div class="line">         </div><div class="line">        <span class="keyword">while</span> (!dict.isEmpty()) {</div><div class="line">            Set&lt;String&gt; toRemove = <span class="keyword">new</span> HashSet&lt;&gt;();</div><div class="line">            List&lt;List&lt;String&gt;&gt; newList = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">            List&lt;List&lt;String&gt;&gt; matched = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">             </div><div class="line">            <span class="keyword">for</span> (List&lt;String&gt; l : list) {</div><div class="line">                String from = l.get(l.size()-<span class="number">1</span>);</div><div class="line">                <span class="keyword">for</span> (String d : dict) {</div><div class="line">                    <span class="keyword">if</span> (isNeighbor(from, d)) {</div><div class="line">                        toRemove.add(d);</div><div class="line">                         </div><div class="line">                        List&lt;String&gt; nl = <span class="keyword">new</span> ArrayList&lt;&gt;(l);</div><div class="line">                        nl.add(d);</div><div class="line"> </div><div class="line">                        <span class="keyword">if</span> (d.equals(end))</div><div class="line">                            matched.add(nl);</div><div class="line">                        <span class="keyword">else</span></div><div class="line">                            newList.add(nl);</div><div class="line">                    }</div><div class="line">                }</div><div class="line">            }</div><div class="line">             </div><div class="line">            <span class="keyword">if</span> (!matched.isEmpty())</div><div class="line">                <span class="keyword">return</span> matched;</div><div class="line">             </div><div class="line">            <span class="keyword">if</span> (toRemove.isEmpty())</div><div class="line">                <span class="keyword">return</span> <span class="keyword">new</span> ArrayList&lt;List&lt;String&gt;&gt;();</div><div class="line">             </div><div class="line">            dict.removeAll(toRemove);</div><div class="line">            list = newList;</div><div class="line">        }</div><div class="line">         </div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ArrayList&lt;List&lt;String&gt;&gt;();</div><div class="line">    }</div><div class="line">     </div><div class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isNeighbor</span>(String s1, String s2) {</div><div class="line">        <span class="keyword">boolean</span> dif = <span class="keyword">false</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;s1.length(); i++) {</div><div class="line">            <span class="keyword">char</span> c1 = s1.charAt(i);</div><div class="line">            <span class="keyword">char</span> c2 = s2.charAt(i);</div><div class="line">             </div><div class="line">            <span class="keyword">if</span> (c1!=c2) {</div><div class="line">                <span class="keyword">if</span> (!dif)</div><div class="line">                    dif = <span class="keyword">true</span>;</div><div class="line">                <span class="keyword">else</span></div><div class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">            }</div><div class="line">        }</div><div class="line">         </div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>但是很快遇到某case就超时了。于是调整一下角度，对每次待匹配的单词，不是去dict里面匹配，而是根据该单词的每个字母，都可以变化成任意一个其它字母的规则，因为那样每次都形成一个新单词，再拿这个新单词到dict里面去寻找是否有匹配：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>{</div><div class="line">    <span class="keyword">public</span> List&lt;List&lt;String&gt;&gt; <span class="title">findLadders</span>(String start, String end, Set&lt;String&gt; dict) {</div><div class="line">        List&lt;List&lt;String&gt;&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        List&lt;String&gt; ll = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        ll.add(start);</div><div class="line">        list.add(ll);</div><div class="line">        dict.remove(start);</div><div class="line">         </div><div class="line">        <span class="keyword">while</span> (!dict.isEmpty()) {</div><div class="line">            Set&lt;String&gt; toRemove = <span class="keyword">new</span> HashSet&lt;&gt;();</div><div class="line">            List&lt;List&lt;String&gt;&gt; newList = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">            List&lt;List&lt;String&gt;&gt; matched = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">             </div><div class="line">            <span class="keyword">for</span> (List&lt;String&gt; l : list) {</div><div class="line">                String from = l.get(l.size()-<span class="number">1</span>);</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;from.length(); i++) {</div><div class="line">                    <span class="keyword">for</span> (<span class="keyword">char</span> ch=<span class="string">'a'</span>; ch&lt;=<span class="string">'z'</span>; ch++) {</div><div class="line">                        <span class="keyword">char</span>[] cs = from.toCharArray();</div><div class="line">                        <span class="keyword">if</span> (cs[i]!=ch)</div><div class="line">                            cs[i] = ch;</div><div class="line">                        String ns = <span class="keyword">new</span> String(cs);</div><div class="line">                         </div><div class="line">                        <span class="keyword">if</span> (dict.contains(ns)) {</div><div class="line">                            toRemove.add(ns);</div><div class="line">                             </div><div class="line">                            List&lt;String&gt; nl = <span class="keyword">new</span> ArrayList&lt;&gt;(l);</div><div class="line">                            nl.add(ns);</div><div class="line">                             </div><div class="line">                            <span class="keyword">if</span> (ns.equals(end))</div><div class="line">                                matched.add(nl);</div><div class="line">                            <span class="keyword">else</span></div><div class="line">                                newList.add(nl);</div><div class="line">                        }</div><div class="line">                    }</div><div class="line">                }</div><div class="line">            }</div><div class="line">             </div><div class="line">            <span class="keyword">if</span> (!matched.isEmpty())</div><div class="line">                <span class="keyword">return</span> matched;</div><div class="line">             </div><div class="line">            <span class="keyword">if</span> (toRemove.isEmpty())</div><div class="line">                <span class="keyword">return</span> <span class="keyword">new</span> ArrayList&lt;List&lt;String&gt;&gt;();</div><div class="line">             </div><div class="line">            dict.removeAll(toRemove);</div><div class="line">            list = newList;</div><div class="line">        }</div><div class="line">         </div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ArrayList&lt;List&lt;String&gt;&gt;();</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>结果出现了Memory Limit Exceeded。怎么办呢？忽然想到了对于这种搜索的改进，从start开始的单向搜索可以优化成从start和end两头一起往中间搜索这样的双向搜索形式，理论上可以减少BSF最宽一层的节点数量（代码看起来有点长，但是其实逻辑并不复杂）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>{</div><div class="line">    <span class="keyword">public</span> List&lt;List&lt;String&gt;&gt; <span class="title">findLadders</span>(String start, String end, Set&lt;String&gt; dict) {</div><div class="line">        <span class="comment">// forward list</span></div><div class="line">        List&lt;List&lt;String&gt;&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        List&lt;String&gt; ll = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        ll.add(start);</div><div class="line">        list.add(ll);</div><div class="line">        dict.remove(start);</div><div class="line">         </div><div class="line">        <span class="comment">// backward list</span></div><div class="line">        List&lt;List&lt;String&gt;&gt; backList = <span class="keyword">null</span>;</div><div class="line">         </div><div class="line">        List&lt;List&lt;String&gt;&gt; matched = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">         </div><div class="line">        <span class="keyword">while</span> (!dict.isEmpty()) {</div><div class="line">            <span class="comment">// 1. forward bfs</span></div><div class="line">            Set&lt;String&gt; toRemove = <span class="keyword">new</span> HashSet&lt;&gt;();</div><div class="line">            List&lt;List&lt;String&gt;&gt; newList = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">             </div><div class="line">            <span class="keyword">for</span> (List&lt;String&gt; l : list) {</div><div class="line">                String from = l.get(l.size()-<span class="number">1</span>);</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;from.length(); i++) {</div><div class="line">                    <span class="keyword">for</span> (<span class="keyword">char</span> ch=<span class="string">'a'</span>; ch&lt;=<span class="string">'z'</span>; ch++) {</div><div class="line">                        <span class="keyword">char</span>[] cs = from.toCharArray();</div><div class="line">                        <span class="keyword">if</span> (cs[i]!=ch)</div><div class="line">                            cs[i] = ch;</div><div class="line">                        String ns = <span class="keyword">new</span> String(cs);</div><div class="line">                         </div><div class="line">                        <span class="keyword">if</span> (dict.contains(ns)) {</div><div class="line">                            toRemove.add(ns);</div><div class="line">                             </div><div class="line">                            List&lt;String&gt; nl = <span class="keyword">new</span> ArrayList&lt;&gt;(l);</div><div class="line">                            nl.add(ns);</div><div class="line">                             </div><div class="line">                            <span class="keyword">if</span> (ns.equals(end))</div><div class="line">                                matched.add(nl);</div><div class="line">                            <span class="keyword">else</span></div><div class="line">                                newList.add(nl);</div><div class="line">                        }</div><div class="line">                    }</div><div class="line">                }</div><div class="line">            }</div><div class="line">             </div><div class="line">            <span class="keyword">if</span> (!matched.isEmpty() || toRemove.isEmpty())</div><div class="line">                <span class="keyword">return</span> matched;</div><div class="line">             </div><div class="line">            dict.removeAll(toRemove);</div><div class="line">            list = newList;</div><div class="line">             </div><div class="line">            <span class="comment">// 2. backward bfs</span></div><div class="line">            <span class="keyword">if</span> (backList==<span class="keyword">null</span>) {</div><div class="line">                backList = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">                ll = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">                ll.add(end);</div><div class="line">                backList.add(ll);</div><div class="line">                dict.remove(end);</div><div class="line">            }</div><div class="line">             </div><div class="line">            newList = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">            toRemove.clear();</div><div class="line">             </div><div class="line">            <span class="keyword">for</span> (List&lt;String&gt; bl : backList) {</div><div class="line">                String b = bl.get(<span class="number">0</span>);</div><div class="line">                <span class="keyword">for</span> (String s : dict) {</div><div class="line">                    <span class="keyword">if</span> (isNeighbor(b, s)) {</div><div class="line">                        toRemove.add(s);</div><div class="line">                         </div><div class="line">                        List&lt;String&gt; nl = <span class="keyword">new</span> ArrayList&lt;&gt;(bl);</div><div class="line">                        nl.add(<span class="number">0</span>, s);</div><div class="line">                         </div><div class="line">                        newList.add(nl);</div><div class="line">                    }</div><div class="line">                }</div><div class="line">            }</div><div class="line">             </div><div class="line">            <span class="keyword">if</span> (toRemove.isEmpty())</div><div class="line">                <span class="keyword">return</span> matched;</div><div class="line">                 </div><div class="line">            dict.removeAll(toRemove);</div><div class="line">            backList = newList;</div><div class="line">             </div><div class="line">            <span class="comment">// 3. match</span></div><div class="line">            <span class="keyword">for</span> (List&lt;String&gt; l : list) {</div><div class="line">                <span class="keyword">for</span> (List&lt;String&gt; bl : backList) {</div><div class="line">                    String s1 = l.get(l.size()-<span class="number">1</span>);</div><div class="line">                    String s2 = bl.get(<span class="number">0</span>);</div><div class="line">                     </div><div class="line">                    <span class="keyword">if</span> (isNeighbor(s1, s2)) {</div><div class="line">                        List&lt;String&gt; nl = <span class="keyword">new</span> ArrayList&lt;&gt;(l);</div><div class="line">                        nl.addAll(bl);</div><div class="line">                         </div><div class="line">                        matched.add(nl);</div><div class="line">                    }</div><div class="line">                }</div><div class="line">            }</div><div class="line">             </div><div class="line">            <span class="keyword">if</span> (!matched.isEmpty())</div><div class="line">                <span class="keyword">return</span> matched;</div><div class="line">        }</div><div class="line">         </div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ArrayList&lt;List&lt;String&gt;&gt;();</div><div class="line">    }</div><div class="line">     </div><div class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isNeighbor</span>(String s1, String s2) {</div><div class="line">        <span class="keyword">boolean</span> dif = <span class="keyword">false</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;s1.length(); i++) {</div><div class="line">            <span class="keyword">char</span> c1 = s1.charAt(i);</div><div class="line">            <span class="keyword">char</span> c2 = s2.charAt(i);</div><div class="line">             </div><div class="line">            <span class="keyword">if</span> (c1!=c2) {</div><div class="line">                <span class="keyword">if</span> (!dif)</div><div class="line">                    dif = <span class="keyword">true</span>;</div><div class="line">                <span class="keyword">else</span></div><div class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">            }</div><div class="line">        }</div><div class="line">         </div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>代码真是复杂不少，遗憾的是，继续Memory Limit Exceeded，服了，这条路看来是走不通了。从网上搜索，有各种解法，都挺复杂的。下面列出的这个方法是从这个博客上面摘录下来的，属于思路上相对比较清晰的做法了。整个过程拆成两步，BFS来构造表示单词变化关系的树，DFS来最后搜索路径。从宏观的复杂度上看，比我最原始的做法节约就节约在对路径list的遍历上面，我的做法因为要遍历路径的list，导致循环嵌套多了一层，但是这里使用一个map存放每个节点和下一层的对应关系，省下了这层循环，当然，最后需要额外的DFS来构造这个list。虽说如此，我还是觉得方法不够优雅简洁，如果你有清晰简洁的方法，请告诉我。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>{</div><div class="line">    class WordWithLevel {</div><div class="line">        String word;</div><div class="line">        <span class="keyword">int</span> level;</div><div class="line"> </div><div class="line">        <span class="keyword">public</span> <span class="title">WordWithLevel</span>(String word, <span class="keyword">int</span> level) {</div><div class="line">            <span class="keyword">this</span>.word = word;</div><div class="line">            <span class="keyword">this</span>.level = level;</div><div class="line">        }</div><div class="line">    }</div><div class="line"> </div><div class="line">    <span class="keyword">private</span> String end;</div><div class="line">    <span class="keyword">private</span> ArrayList&lt;ArrayList&lt;String&gt;&gt; result;</div><div class="line">    <span class="keyword">private</span> Map&lt;String, List&lt;String&gt;&gt; nextMap;</div><div class="line"> </div><div class="line">    <span class="keyword">public</span> ArrayList&lt;ArrayList&lt;String&gt;&gt; <span class="title">findLadders</span>(String start, String end,</div><div class="line">            HashSet&lt;String&gt; dict) {</div><div class="line">        result = <span class="keyword">new</span> ArrayList&lt;ArrayList&lt;String&gt;&gt;();</div><div class="line">        <span class="keyword">this</span>.end = end;</div><div class="line"> </div><div class="line">        <span class="comment">// unvisited words set</span></div><div class="line">        Set&lt;String&gt; unVisited = <span class="keyword">new</span> HashSet&lt;String&gt;();</div><div class="line">        unVisited.addAll(dict);</div><div class="line">        unVisited.add(start);</div><div class="line">        unVisited.remove(end);</div><div class="line"> </div><div class="line">        <span class="comment">// used to record the map info of &lt;word : the words of next level&gt;</span></div><div class="line">        nextMap = <span class="keyword">new</span> HashMap&lt;String, List&lt;String&gt;&gt;();</div><div class="line">        <span class="keyword">for</span> (String e : unVisited) {</div><div class="line">            nextMap.put(e, <span class="keyword">new</span> ArrayList&lt;String&gt;());</div><div class="line">        }</div><div class="line"> </div><div class="line">        <span class="comment">// BFS to search from the end to start</span></div><div class="line">        Queue&lt;WordWithLevel&gt; queue = <span class="keyword">new</span> LinkedList&lt;WordWithLevel&gt;();</div><div class="line">        queue.add(<span class="keyword">new</span> WordWithLevel(end, <span class="number">0</span>));</div><div class="line">        <span class="keyword">boolean</span> found = <span class="keyword">false</span>;</div><div class="line">        <span class="keyword">int</span> finalLevel = Integer.MAX_VALUE;</div><div class="line">        <span class="keyword">int</span> currentLevel = <span class="number">0</span>;</div><div class="line">        <span class="keyword">int</span> preLevel = <span class="number">0</span>;</div><div class="line">        Set&lt;String&gt; visitedWordsInThisLevel = <span class="keyword">new</span> HashSet&lt;String&gt;();</div><div class="line">        <span class="keyword">while</span> (!queue.isEmpty()) {</div><div class="line">            WordWithLevel wordWithLevel = queue.poll();</div><div class="line">            String word = wordWithLevel.word;</div><div class="line">            currentLevel = wordWithLevel.level;</div><div class="line">            <span class="keyword">if</span> (found && currentLevel &gt; finalLevel) {</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            }</div><div class="line">            <span class="keyword">if</span> (currentLevel &gt; preLevel) {</div><div class="line">                unVisited.removeAll(visitedWordsInThisLevel);</div><div class="line">            }</div><div class="line">            preLevel = currentLevel;</div><div class="line">            <span class="keyword">char</span>[] wordCharArray = word.toCharArray();</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; word.length(); ++i) {</div><div class="line">                <span class="keyword">char</span> originalChar = wordCharArray[i];</div><div class="line">                <span class="keyword">boolean</span> foundInThisCycle = <span class="keyword">false</span>;</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">char</span> c = <span class="string">'a'</span>; c &lt;= <span class="string">'z'</span>; ++c) {</div><div class="line">                    wordCharArray[i] = c;</div><div class="line">                    String newWord = <span class="keyword">new</span> String(wordCharArray);</div><div class="line">                    <span class="keyword">if</span> (c != originalChar && unVisited.contains(newWord)) {</div><div class="line">                        nextMap.get(newWord).add(word);</div><div class="line">                        <span class="keyword">if</span> (newWord.equals(start)) {</div><div class="line">                            found = <span class="keyword">true</span>;</div><div class="line">                            finalLevel = currentLevel;</div><div class="line">                            foundInThisCycle = <span class="keyword">true</span>;</div><div class="line">                            <span class="keyword">break</span>;</div><div class="line">                        }</div><div class="line">                        <span class="keyword">if</span> (visitedWordsInThisLevel.add(newWord)) {</div><div class="line">                            queue.add(<span class="keyword">new</span> WordWithLevel(newWord,</div><div class="line">                                    currentLevel + <span class="number">1</span>));</div><div class="line">                        }</div><div class="line">                    }</div><div class="line">                }</div><div class="line">                <span class="keyword">if</span> (foundInThisCycle) {</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                }</div><div class="line">                wordCharArray[i] = originalChar;</div><div class="line">            }</div><div class="line">        }</div><div class="line"> </div><div class="line">        <span class="keyword">if</span> (found) {</div><div class="line">            <span class="comment">// dfs to get the paths</span></div><div class="line">            ArrayList&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;String&gt;();</div><div class="line">            list.add(start);</div><div class="line">            getPaths(start, list, finalLevel + <span class="number">1</span>);</div><div class="line">        }</div><div class="line">        <span class="keyword">return</span> result;</div><div class="line">    }</div><div class="line"> </div><div class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title">getPaths</span>(String currentWord, ArrayList&lt;String&gt; list, <span class="keyword">int</span> level) {</div><div class="line">        <span class="keyword">if</span> (currentWord.equals(end)) {</div><div class="line">            result.add(<span class="keyword">new</span> ArrayList&lt;String&gt;(list));</div><div class="line">        } <span class="keyword">else</span> <span class="keyword">if</span> (level &gt; <span class="number">0</span>) {</div><div class="line">            List&lt;String&gt; parentsSet = nextMap.get(currentWord);</div><div class="line">            <span class="keyword">for</span> (String parent : parentsSet) {</div><div class="line">                list.add(parent);</div><div class="line">                getPaths(parent, list, level - <span class="number">1</span>);</div><div class="line">                list.remove(list.size() - <span class="number">1</span>);</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="Find_Minimum_in_Rotated_Sorted_Array_II"><span id="find-minimum-in-rotated-sorted-array-ii" style="color: #ff0000;">Find Minimum in Rotated Sorted Array II</span></h3>
<p>【题目】Follow up for “Find Minimum in Rotated Sorted Array”:<br>What if duplicates are allowed? Would this affect the run-time complexity? How and why?</p>
<p>Suppose a sorted array is rotated at some pivot unknown to you beforehand.</p>
<p>(i.e., <code>0 1 2 4 5 6 7</code>might become<code>4 5 6 7 0 1 2</code>).</p>
<p>Find the minimum element.</p>
<p>The array may contain duplicates.</p>
<p>【解答】解这个题目，先简化一下条件，不考虑duplicates存在的情况，那么任意两个元素都不相等，通过比对num[left]、num[mid]和num[right]会得出三种可能的大小关系组合，用具体例子来说就是：</p>
<ul>
<li>num[left]</li>
<li>num[left]num[right]，比如3 4 5 1 2；</li>
<li>num[left]&gt;num[mid] &amp;&amp; num[mid]</li>
</ul>
<p>在这之后，再考虑存在duplicates的情况。这样就不容易遗留可能性。另外，需要注意两个特殊情况：</p>
<ul>
<li>一种最特殊的情况是num[left]、num[mid]和num[right]三者全部相等，这个时候就完全不知道这个pivot到底在左半支还是右半支，这时候只能left右移并right左移，一点一点缩小范围。所以最坏情况下时间复杂度是n。</li>
<li>还有一个要注意的是，当left和right只相差1的时候，mid==left，如果再走到left=mid赋值的分支里面，就会死循环，为了避免这种情况发生，需要处理好这种情况。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> <span class="title">findMin</span>(<span class="keyword">int</span>[] num) {</div><div class="line">        <span class="keyword">int</span> left = <span class="number">0</span>;</div><div class="line">        <span class="keyword">int</span> right = num.length-<span class="number">1</span>;</div><div class="line">         </div><div class="line">        <span class="keyword">while</span> (left&lt;right-<span class="number">1</span>) {</div><div class="line">            <span class="keyword">int</span> mid = (right+left)/<span class="number">2</span>;</div><div class="line">             </div><div class="line">            <span class="keyword">if</span> (num[left]num[mid]) {</div><div class="line">                    <span class="keyword">return</span> num[left];</div><div class="line">                } <span class="keyword">else</span> <span class="keyword">if</span> (num[right]num[mid]) { <span class="comment">// 4 5 1 2 3</span></div><div class="line">                <span class="keyword">if</span> (num[mid]num[right]) {</div><div class="line">                    <span class="comment">// impossible</span></div><div class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Impossible..."</span>);</div><div class="line">                } <span class="keyword">else</span> { <span class="comment">// num[mid]==num[right]</span></div><div class="line">                    right = mid;</div><div class="line">                }</div><div class="line">            } <span class="keyword">else</span> {</div><div class="line">                <span class="keyword">if</span> (num[right]==num[mid]) {</div><div class="line">                    left++;</div><div class="line">                    right--;</div><div class="line">                } <span class="keyword">else</span> {</div><div class="line">                    left = mid;</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line">         </div><div class="line">        <span class="keyword">return</span> Math.min(num[left], num[right]);</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="Regular_Expression_Matching"><span id="regular-expression-matching" style="color: #ff0000;">Regular Expression Matching</span></h3>
<p>【题目】Implement regular expression matching with support for ‘.’ and ‘<em>‘.<br>    ‘.’ Matches any single character.<br>    ‘</em>‘ Matches zero or more of the preceding element.</p>
<pre><code>The matching should cover the entire input <span class="built_in">string</span> (<span class="keyword">not</span> <span class="keyword">partial</span>).

The <span class="keyword">function</span> prototype should be:
bool isMatch(<span class="keyword">const</span> <span class="built_in">char</span> *s, <span class="keyword">const</span> <span class="built_in">char</span> *p)

Some examples:
isMatch(<span class="string">"aa"</span>,<span class="string">"a"</span>) → <span class="literal">false</span>
isMatch(<span class="string">"aa"</span>,<span class="string">"aa"</span>) → <span class="literal">true</span>
isMatch(<span class="string">"aaa"</span>,<span class="string">"aa"</span>) → <span class="literal">false</span>
isMatch(<span class="string">"aa"</span>, <span class="string">"a*"</span>) → <span class="literal">true</span>
isMatch(<span class="string">"aa"</span>, <span class="string">".*"</span>) → <span class="literal">true</span>
isMatch(<span class="string">"ab"</span>, <span class="string">".*"</span>) → <span class="literal">true</span>
isMatch(<span class="string">"aab"</span>, <span class="string">"c*a*b"</span>) → <span class="literal">true</span>
</code></pre><p>【解答】点号和星号的含义和正则表达式一致。注意”abc”.matches(“.<em>“)是返回true的，换言之，”.</em>“可以代表任何字符串，空串也可以。我原来的做法是尝试使用在DP中分类讨论的办法，包括分成”a”、”.a”、”a<em>“、”.</em>”这几种情况分别处理，代码写得冗长，做到一半自己都搞晕了。本来想继续沿着DP的思路走下去，但是看到下面的这个做法（来自于<a href="http://www.programcreek.com/2012/12/leetcode-regular-expression-matching-in-java/" target="_blank" rel="external">这里</a>）以后，我觉得我原来的思路太弱了。下面这个做法是我目前看到的解法最简洁漂亮的代码，整个过程也不需要用额外的空间来存储重复计算的结果。思路是，把各种情况分成这样两种：</p>
<ul>
<li>p的第二个字符（p[1]）不是星号，在这种情况下，如果第一个字符p[0]是星号，或者p[0]==s[0]，那就可以继续递归匹配余下的子串，否则返回匹配失败；</li>
<li>p的第二个字符（p[1]）是星号，在这种情况下，通过一个i来表示”.<em>“或者”a</em>“管住的那段S子串的结束位置（即s中的子串[0,i]），i之后的子串和p去掉开头的这个”.<em>“或者”a</em>“后余下的子串继续参与后续的匹配，匹配上了皆大欢喜，匹配不上则令i前进。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isMatch</span>(String s, String p) {</div><div class="line">        <span class="keyword">if</span> (p.length() == <span class="number">0</span>)</div><div class="line">            <span class="keyword">return</span> s.length() == <span class="number">0</span>;</div><div class="line"> </div><div class="line">        <span class="keyword">if</span> (p.length() == <span class="number">1</span> || p.charAt(<span class="number">1</span>) != <span class="string">'*'</span>) {</div><div class="line">            <span class="comment">// empty s or unmatch</span></div><div class="line">            <span class="keyword">if</span> (s.length() &lt; <span class="number">1</span> || (p.charAt(<span class="number">0</span>) != <span class="string">'.'</span> && s.charAt(<span class="number">0</span>) != p.charAt(<span class="number">0</span>)))</div><div class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">             </div><div class="line">            <span class="keyword">return</span> isMatch(s.substring(<span class="number">1</span>), p.substring(<span class="number">1</span>));</div><div class="line">        } <span class="keyword">else</span> {</div><div class="line">            <span class="keyword">int</span> i = -<span class="number">1</span>;</div><div class="line">            <span class="comment">// match</span></div><div class="line">            <span class="keyword">while</span> (i &lt; s.length() && (i &lt; <span class="number">0</span> || p.charAt(<span class="number">0</span>) == <span class="string">'.'</span> || p.charAt(<span class="number">0</span>) == s.charAt(i))) {</div><div class="line">                <span class="keyword">if</span> (isMatch(s.substring(i + <span class="number">1</span>), p.substring(<span class="number">2</span>)))</div><div class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">                i++;</div><div class="line">            }</div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>


      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>







  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <time datetime="2012-03-10T09:15:44.000Z"><a href="/2012/03/10/leetcode-database/">3月 10 2012</a></time>
      
      
  
    <h1 class="title"><a href="/2012/03/10/leetcode-database/">LeetCode数据库题目解答</a></h1>
  

    </header>
    <div class="entry">
      
        <p>在之前做程序算法题的途中发现，LeetCode上面推出了数据库解答，有十道题，于是这两天晚上时间就给做了。解答是次要主要的好处是，正好复习复习SQL一些查询语句的写法，比如自定义变量和常用函数。题目都比较简单，少做解释，以贴题目和答案为主。</p>
<table>
<thead>
<tr>
<th><a href="https://leetcode.com/problemset/database/" target="_blank" rel="external">Title</a></th>
<th style="text-align:center"><a href="https://leetcode.com/problemset/database/" target="_blank" rel="external">Acceptance</a></th>
<th style="text-align:center"><a href="https://leetcode.com/problemset/database/" target="_blank" rel="external">Difficulty</a></th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#combine-two-tables">Combine Two Tables</a></td>
<td style="text-align:center">32.5%</td>
<td style="text-align:center">Easy</td>
</tr>
<tr>
<td><a href="#second-highest-salary">Second Highest Salary</a></td>
<td style="text-align:center">23.8%</td>
<td style="text-align:center">Easy</td>
</tr>
<tr>
<td><a href="#nth-highest-salary">Nth Highest Salary</a></td>
<td style="text-align:center">14.1%</td>
<td style="text-align:center">Medium</td>
</tr>
<tr>
<td><a href="#rank-scores">Rank Scores</a></td>
<td style="text-align:center">20.7%</td>
<td style="text-align:center">Medium</td>
</tr>
<tr>
<td><a href="#consecutive-numbers">Consecutive Numbers</a></td>
<td style="text-align:center">20.2%</td>
<td style="text-align:center">Medium</td>
</tr>
<tr>
<td><a href="#employees-earning-more-than-their-managers">Employees Earning More Than Their Managers</a></td>
<td style="text-align:center">44.2%</td>
<td style="text-align:center">Easy</td>
</tr>
<tr>
<td><a href="#duplicate-emails">Duplicate Emails</a></td>
<td style="text-align:center">38.0%</td>
<td style="text-align:center">Easy</td>
</tr>
<tr>
<td><a href="#customers-who-never-order">Customers Who Never Order</a></td>
<td style="text-align:center">34.2%</td>
<td style="text-align:center">Easy</td>
</tr>
<tr>
<td><a href="#department-highest-salary">Department Highest Salary</a></td>
<td style="text-align:center">19.2%</td>
<td style="text-align:center">Medium</td>
</tr>
<tr>
<td><a href="#department-top-three-salaries">Department Top Three Salaries</a></td>
<td style="text-align:center">16.3%</td>
<td style="text-align:center">Hard</td>
</tr>
</tbody>
</table>
<h3 id="Combine_Two_Tables"><span id="combine-two-tables" style="color: #ff0000;">Combine Two Tables</span></h3>
<p>【题目】</p>
<p>Table: Person</p>
<pre><code><span class="code">+-------------+</span>---------+
<span class="header">| Column Name | Type    |
+-------------+---------+</span>
| PersonId    | int     |
| FirstName   | varchar |
<span class="header">| LastName    | varchar |
+-------------+---------+</span>
</code></pre><p>PersonId is the primary key column for this table.<br>Table: Address</p>
<pre><code><span class="code">+-------------+</span>---------+
<span class="header">| Column Name | Type    |
+-------------+---------+</span>
| AddressId   | int     |
| PersonId    | int     |
| City        | varchar |
<span class="header">| State       | varchar |
+-------------+---------+</span>
</code></pre><p>AddressId is the primary key column for this table.<br>Write a SQL query for a report that provides the following information for each person in the Person table, regardless if there is an address for each of those people:</p>
<p>FirstName, LastName, City, State<br>【解答】</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="operator"><span class="keyword">select</span> p.FirstName, p.LastName, a.City, a.State <span class="keyword">from</span> Person p <span class="keyword">left</span> <span class="keyword">outer</span> <span class="keyword">join</span> Address a <span class="keyword">on</span> p.PersonId=a.PersonId;</span></div></pre></td></tr></table></figure>

<h3 id="Second_Highest_Salary"><span id="second-highest-salary" style="color: #ff0000;">Second Highest Salary</span></h3>
<p>【题目】</p>
<p>Write a SQL query to get the second highest salary from the Employee table.</p>
<pre><code><span class="code">+----+</span>--------+
<span class="header">| Id | Salary |
+----+--------+</span>
| 1  | 100    |
| 2  | 200    |
<span class="header">| 3  | 300    |
+----+--------+</span>
</code></pre><p>For example, given the above Employee table, the second highest salary is 200. If there is no second highest salary, then the query should return null.</p>
<p>【解答】 题目简单，但是如果和我一样，发现几个常用函数都不记得了，可以<a href="http://www.tutorialspoint.com/mysql/mysql-useful-functions.htm" target="_blank" rel="external">复习一下</a>。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="operator"><span class="keyword">select</span> <span class="keyword">IFNULL</span>( (<span class="keyword">select</span> e.Salary <span class="keyword">from</span> Employee e <span class="keyword">group</span> <span class="keyword">by</span> e.Salary <span class="keyword">order</span> <span class="keyword">by</span> e.Salary <span class="keyword">desc</span> <span class="keyword">limit</span> <span class="number">1</span>, <span class="number">1</span>), <span class="literal">NULL</span>) SecondHighestSalary;</span></div></pre></td></tr></table></figure>

<h3 id="Nth_Highest_Salary"><span id="nth-highest-salary" style="color: #ff0000;">Nth Highest Salary</span></h3>
<p>【题目】</p>
<p>Write a SQL query to get the nth highest salary from the Employee table.</p>
<pre><code><span class="code">+----+</span>--------+
<span class="header">| Id | Salary |
+----+--------+</span>
| 1  | 100    |
| 2  | 200    |
<span class="header">| 3  | 300    |
+----+--------+</span>
</code></pre><p>For example, given the above Employee table, the nth highest salary where n = 2 is 200. If there is no nth highest salary, then the query should return null.</p>
<p>【解答】第n高，这就得用自定义变量了，平时很少用这东西，于是<a href="http://dev.mysql.com/doc/refman/5.0/en/user-variables.html" target="_blank" rel="external">复习了一下</a>先。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="operator"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> getNthHighestSalary(N <span class="built_in">INT</span>) <span class="keyword">RETURNS</span> <span class="built_in">INT</span></span></div><div class="line"><span class="keyword">BEGIN</span></div><div class="line">    <span class="keyword">RETURN</span> (</div><div class="line">        <span class="keyword">select</span> <span class="keyword">IFNULL</span>(Salary, <span class="literal">NULL</span>) Salary <span class="keyword">from</span> (</div><div class="line">            <span class="keyword">select</span> @row_num := @row_num+<span class="number">1</span> Rank, Salary <span class="keyword">from</span> (</div><div class="line">                <span class="keyword">select</span> Salary <span class="keyword">from</span> Employee <span class="keyword">group</span> <span class="keyword">by</span> Salary <span class="keyword">desc</span></div><div class="line">            ) t1 <span class="keyword">join</span> (</div><div class="line">                <span class="keyword">select</span> @row_num := <span class="number">0</span> <span class="keyword">from</span> dual</div><div class="line">            ) t2</div><div class="line">        ) t <span class="keyword">where</span> t.Rank=N</div><div class="line">    );</div><div class="line"><span class="operator"><span class="keyword">END</span></span></div></pre></td></tr></table></figure>

<h3 id="Rank_Scores"><span id="rank-scores" style="color: #ff0000;">Rank Scores</span></h3>
<p>【题目】</p>
<p>Write a SQL query to rank scores. If there is a tie between two scores, both should have the same ranking. Note that after a tie, the next ranking number should be the next consecutive integer value. In other words, there should be no “holes” between ranks.</p>
<pre><code><span class="code">+----+</span>-------+
<span class="header">| Id | Score |
+----+-------+</span>
| 1  | 3.50  |
| 2  | 3.65  |
| 3  | 4.00  |
| 4  | 3.85  |
| 5  | 4.00  |
<span class="header">| 6  | 3.65  |
+----+-------+</span>
</code></pre><p>For example, given the above Scores table, your query should generate the following report (order by highest score):<br>    +———-+———+<br>    | Score | Rank |<br>    +———-+———+<br>    | 4.00  | 1    |<br>    | 4.00  | 1    |<br>    | 3.85  | 2    |<br>    | 3.65  | 3    |<br>    | 3.65  | 3    |<br>    | 3.50  | 4    |<br>    +———-+———+<br>【解答】又是一道自定义变量的题目，这种模式应当熟悉，还是挺常见的。如果不能使用“set @var_name=0;”的话（要求用一句SQL搞定），那可以在子句里面定义“select @var_name:=0”，再在它的外面使用这个变量。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="operator"><span class="keyword">select</span> s.Score, t.Rank <span class="keyword">from</span> (</span></div><div class="line">    <span class="keyword">select</span> @row_num:=@row_num+<span class="number">1</span> Rank, Score <span class="keyword">from</span> (</div><div class="line">         <span class="keyword">select</span> Score <span class="keyword">from</span> Scores <span class="keyword">group</span> <span class="keyword">by</span> Score <span class="keyword">desc</span></div><div class="line">    ) t1 <span class="keyword">join</span> (</div><div class="line">        <span class="keyword">select</span> @row_num := <span class="number">0</span> <span class="keyword">from</span> dual</div><div class="line">    ) t2</div><div class="line">) t, Scores s <span class="keyword">where</span> s.Score=t.Score <span class="keyword">group</span> <span class="keyword">by</span> Score <span class="keyword">desc</span>, Rank <span class="keyword">asc</span>, Id;</div></pre></td></tr></table></figure>

<h3 id="Consecutive_Numbers"><span id="consecutive-numbers" style="color: #ff0000;">Consecutive Numbers</span></h3>
<p>【题目】</p>
<p>Write a SQL query to find all numbers that appear at least three times consecutively.</p>
<pre><code><span class="code">+----+</span>-----+
<span class="header">| Id | Num |
+----+-----+</span>
| 1  |  1  |
| 2  |  1  |
| 3  |  1  |
| 4  |  2  |
| 5  |  1  |
| 6  |  2  |
<span class="header">| 7  |  2  |
+----+-----+</span>
</code></pre><p>For example, given the above Logs table, 1 is the only number that appears consecutively for at least three times.<br>【解答】</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="operator"><span class="keyword">select</span> <span class="keyword">DISTINCT</span>(l1.Num) <span class="keyword">from</span> <span class="keyword">Logs</span> l1, <span class="keyword">Logs</span> l2, <span class="keyword">Logs</span> l3 <span class="keyword">where</span> l1.Id+<span class="number">1</span>=l2.Id <span class="keyword">and</span> l1.Id+<span class="number">2</span>=l3.Id <span class="keyword">and</span> l1.Num=l2.Num <span class="keyword">and</span> l1.Num=l3.Num;</span></div></pre></td></tr></table></figure>

<h3 id="Employees_Earning_More_Than_Their_Managers"><span id="employees-earning-more-than-their-managers" style="color: #ff0000;">Employees Earning More Than Their Managers</span></h3>
<p>【题目】</p>
<p>The Employee table holds all employees including their managers. Every employee has an Id, and there is also a column for the manager Id.</p>
<pre><code><span class="code">+----+</span>-------<span class="code">+--------+</span>-----------+
<span class="header">| Id | Name  | Salary | ManagerId |
+----+-------+--------+-----------+</span>
| 1  | Joe   | 70000  | 3         |
| 2  | Henry | 80000  | 4         |
| 3  | Sam   | 60000  | NULL      |
<span class="header">| 4  | Max   | 90000  | NULL      |
+----+-------+--------+-----------+</span>
</code></pre><p>Given the Employee table, write a SQL query that finds out employees who earn more than their managers. For the above table, Joe is the only employee who earns more than his manager.</p>
<pre><code><span class="code">+----------+</span>
<span class="header">| Employee |
+----------+</span>
<span class="header">| Joe      |
+----------+</span>
</code></pre><p>【解答】</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="operator"><span class="keyword">select</span> e.Name <span class="keyword">from</span> Employee e, Employee m <span class="keyword">where</span> e.ManagerId=m.Id <span class="keyword">and</span> e.Salary&gt;m.Salary;</span></div></pre></td></tr></table></figure>

<h3 id="Duplicate_Emails"><span id="duplicate-emails" style="color: #ff0000;">Duplicate Emails</span></h3>
<p>【题目】</p>
<p>Write a SQL query to find all duplicate emails in a table named Person.</p>
<pre><code><span class="code">+----+</span>---------+
<span class="header">| Id | Email   |
+----+---------+</span>
| 1  | a@b.com |
| 2  | c@d.com |
<span class="header">| 3  | a@b.com |
+----+---------+</span>
</code></pre><p>For example, your query should return the following for the above table:</p>
<pre><code><span class="code">+---------+</span>
<span class="header">| Email   |
+---------+</span>
<span class="header">| a@b.com |
+---------+</span>
</code></pre><p>Note: All emails are in lowercase.<br>【解答】</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="operator"><span class="keyword">select</span> <span class="keyword">distinct</span>(p.Email) <span class="keyword">from</span> Person p, Person q <span class="keyword">where</span> p.Id!=q.Id <span class="keyword">and</span> p.Email=q.Email;</span></div></pre></td></tr></table></figure>

<h3 id="Customers_Who_Never_Order"><span id="customers-who-never-order" style="color: #ff0000;">Customers Who Never Order</span></h3>
<p>【题目】</p>
<p>Suppose that a website contains two tables, the Customers table and the Orders table. Write a SQL query to find all customers who never order anything.</p>
<p>Table: Customers.</p>
<pre><code><span class="code">+----+</span>-------+
<span class="header">| Id | Name  |
+----+-------+</span>
| 1  | Joe   |
| 2  | Henry |
| 3  | Sam   |
<span class="header">| 4  | Max   |
+----+-------+</span>
</code></pre><p>Table: Orders.</p>
<pre><code><span class="code">+----+</span>------------+
<span class="header">| Id | CustomerId |
+----+------------+</span>
| 1  | 3          |
<span class="header">| 2  | 1          |
+----+------------+</span>
</code></pre><p>Using the above tables as example, return the following:</p>
<pre><code><span class="code">+-----------+</span>
<span class="header">| Customers |
+-----------+</span>
| Henry     |
<span class="header">| Max       |
+-----------+</span>
</code></pre><p>【解答】</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="operator"><span class="keyword">select</span> c.Name Customers <span class="keyword">from</span> Customers c <span class="keyword">where</span> c.Id <span class="keyword">not</span> <span class="keyword">in</span> (</span></div><div class="line">    <span class="keyword">select</span> CustomerId <span class="keyword">from</span> Orders</div><div class="line">)</div></pre></td></tr></table></figure>

<h3 id="Department_Highest_Salary"><span id="department-highest-salary" style="color: #ff0000;">Department Highest Salary</span></h3>
<p>【题目】</p>
<p>The Employee table holds all employees. Every employee has an Id, a salary, and there is also a column for the department Id.</p>
<pre><code><span class="code">+----+</span>-------<span class="code">+--------+</span>--------------+
<span class="header">| Id | Name  | Salary | DepartmentId |
+----+-------+--------+--------------+</span>
| 1  | Joe   | 70000  | 1            |
| 2  | Henry | 80000  | 2            |
| 3  | Sam   | 60000  | 2            |
<span class="header">| 4  | Max   | 90000  | 1            |
+----+-------+--------+--------------+</span>
</code></pre><p>The Department table holds all departments of the company.</p>
<pre><code><span class="code">+----+</span>----------+
<span class="header">| Id | Name     |
+----+----------+</span>
| 1  | IT       |
<span class="header">| 2  | Sales    |
+----+----------+</span>
</code></pre><p>Write a SQL query to find employees who have the highest salary in each of the departments. For the above tables, Max has the highest salary in the IT department and Henry has the highest salary in the Sales department.</p>
<pre><code><span class="code">+------------+</span>----------<span class="code">+--------+</span>
<span class="header">| Department | Employee | Salary |
+------------+----------+--------+</span>
| IT         | Max      | 90000  |
<span class="header">| Sales      | Henry    | 80000  |
+------------+----------+--------+</span>
</code></pre><p>【解答】</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="operator"><span class="keyword">select</span> d.Name Department, e.Name Employee, s.Salary <span class="keyword">from</span> (</span></div><div class="line">    <span class="keyword">select</span> <span class="keyword">MAX</span>(e.Salary) Salary, e.DepartmentId <span class="keyword">from</span> Employee e, Department d <span class="keyword">where</span> e.DepartmentId=d.Id <span class="keyword">group</span> <span class="keyword">by</span> e.DepartmentId</div><div class="line">) s, Employee e, Department d <span class="keyword">where</span> s.Salary=e.Salary <span class="keyword">and</span> e.DepartmentId=d.Id <span class="keyword">and</span> e.DepartmentId=s.DepartmentId;</div></pre></td></tr></table></figure>

<h3 id="Department_Top_Three_Salaries"><span id="department-top-three-salaries" style="color: #ff0000;">Department Top Three Salaries</span></h3>
<p>【题目】</p>
<p>The Employee table holds all employees. Every employee has an Id, and there is also a column for the department Id.</p>
<pre><code><span class="code">+----+</span>-------<span class="code">+--------+</span>--------------+
<span class="header">| Id | Name  | Salary | DepartmentId |
+----+-------+--------+--------------+</span>
| 1  | Joe   | 70000  | 1            |
| 2  | Henry | 80000  | 2            |
| 3  | Sam   | 60000  | 2            |
| 4  | Max   | 90000  | 1            |
| 5  | Janet | 69000  | 1            |
<span class="header">| 6  | Randy | 85000  | 1            |
+----+-------+--------+--------------+</span>
</code></pre><p>The Department table holds all departments of the company.</p>
<pre><code><span class="code">+----+</span>----------+
<span class="header">| Id | Name     |
+----+----------+</span>
| 1  | IT       |
<span class="header">| 2  | Sales    |
+----+----------+</span>
</code></pre><p>Write a SQL query to find employees who earn the top three salaries in each of the department. For the above tables, your SQL query should return the following rows.</p>
<pre><code><span class="code">+------------+</span>----------<span class="code">+--------+</span>
<span class="header">| Department | Employee | Salary |
+------------+----------+--------+</span>
| IT         | Max      | 90000  |
| IT         | Randy    | 85000  |
| IT         | Joe      | 70000  |
| Sales      | Henry    | 80000  |
<span class="header">| Sales      | Sam      | 60000  |
+------------+----------+--------+</span>
</code></pre><p>【解答】这道题拿MySql做其实是有点难了，如果我用Oracle，我就可以 rank() over(partition by xxx order by xxx desc) 这样搞了，但是MySql比较挫的地方在于没有这样分区操作的东西。不过最后还是借助了三个自定义变量搞定。意思就不解释了，还是好懂的：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="operator"><span class="keyword">select</span> Department, Employee, Salary <span class="keyword">from</span> (</span></div><div class="line">    <span class="keyword">select</span></div><div class="line">        <span class="keyword">IF</span>(@lastDep!=t1.Department, @<span class="keyword">count</span>:=<span class="number">0</span>, @<span class="keyword">count</span>:=@<span class="keyword">count</span>), <span class="keyword">IF</span>(@lastDep=t1.Department <span class="keyword">and</span> @lastSalary!=t1.Salary, @<span class="keyword">count</span>:=@<span class="keyword">count</span>+<span class="number">1</span>, @<span class="keyword">count</span>:=@<span class="keyword">count</span>) Cnt,</div><div class="line">        @lastDep:=t1.Department, @lastSalary:=t1.Salary,</div><div class="line">        t1.Department, t1.Employee, t1.Salary</div><div class="line">    <span class="keyword">from</span> (</div><div class="line">        <span class="keyword">select</span> d.Name Department, e.Name Employee, e.Salary</div><div class="line">        <span class="keyword">from</span> Department d, Employee e <span class="keyword">where</span> d.Id=e.DepartmentId <span class="keyword">order</span> <span class="keyword">by</span> Department <span class="keyword">asc</span>, Salary <span class="keyword">desc</span></div><div class="line">    ) t1, (</div><div class="line">            <span class="keyword">select</span> @lastDep:=<span class="literal">null</span>, @lastSalary:=<span class="number">0</span>, @<span class="keyword">count</span>:=<span class="number">0</span> <span class="keyword">from</span> dual</div><div class="line">    ) t2</div><div class="line">) f <span class="keyword">where</span> Cnt&lt;<span class="number">3</span>;</div></pre></td></tr></table></figure>

<p>事后，我去看了看讨论区，发现一个漂亮的解答，没有用任何自定义变量，关键就是distinct(Salary)去和原Salary比较，过滤掉这个条件下出现次数大于3的情况：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="operator"><span class="keyword">select</span> D.Name <span class="keyword">as</span> Department, E.Name <span class="keyword">as</span> Employee, E.Salary <span class="keyword">as</span> Salary </span></div><div class="line">  <span class="keyword">from</span> Employee E, Department D</div><div class="line">   <span class="keyword">where</span> (<span class="keyword">select</span> <span class="keyword">count</span>(<span class="keyword">distinct</span>(Salary)) <span class="keyword">from</span> Employee </div><div class="line">           <span class="keyword">where</span> DepartmentId = E.DepartmentId <span class="keyword">and</span> Salary &gt; E.Salary) <span class="keyword">in</span> (<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>)</div><div class="line">         <span class="keyword">and</span></div><div class="line">           E.DepartmentId = D.Id </div><div class="line">         <span class="keyword">order</span> <span class="keyword">by</span> E.DepartmentId, E.Salary <span class="keyword">DESC</span>;</div></pre></td></tr></table></figure>


      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>







  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <time datetime="2011-12-26T13:45:29.000Z"><a href="/2011/12/26/concurrenthashmap/">12月 26 2011</a></time>
      
      
  
    <h1 class="title"><a href="/2011/12/26/concurrenthashmap/">由ConcurrentHashMap的一个NullPointerException异常引起的错误</a></h1>
  

    </header>
    <div class="entry">
      
        <p>开发中碰到ConcurrentHashMap NullPointerException not allow null key and value,由ConcurrentHashMap的一个NullPointerException异常引起，结合ConcurrentHashMap源码分析为什么ConcurrentHashMap不允许空key和value以及如何改造进行支持。</p>
<p>1、异常分析<br>前几天碰到一个异常,日志信息如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">FATAL EXCEPTION: main</div><div class="line">java.lang.NullPointerException</div><div class="line">    at java.util.concurrent.ConcurrentHashMap.remove(ConcurrentHashMap.java:<span class="number">921</span>)</div><div class="line">    at cn.trinea.appsearch.service.AppSearchService.deleteDownloadAndUpdateViewInfo(AppSearchService.java:<span class="number">586</span>)</div><div class="line">    at cn.trinea.appsearch.service.AppSearchService.installFinish(AppSearchService.java:<span class="number">1111</span>)</div><div class="line">    at cn.trinea.appsearch.service.AppSearchService.access$<span class="number">10</span>(AppSearchService.java:<span class="number">1102</span>)</div><div class="line">    at cn.trinea.appsearch.service.AppSearchService$MyHandler.handleMessage(AppSearchService.java:<span class="number">1062</span>)</div><div class="line">    at android.os.Handler.dispatchMessage(Handler.java:<span class="number">99</span>)</div><div class="line">    at android.os.Looper.loop(Looper.java:<span class="number">153</span>)</div><div class="line">    at android.app.ActivityThread.main(ActivityThread.java:<span class="number">5198</span>)</div><div class="line">    at java.lang.reflect.Method.invokeNative(Native Method)</div><div class="line">    at java.lang.reflect.Method.invoke(Method.java:<span class="number">511</span>)</div><div class="line">    at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:<span class="number">826</span>)</div><div class="line">    at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:<span class="number">589</span>)</div><div class="line">    at dalvik.system.NativeStart.main(Native Method)</div></pre></td></tr></table></figure>

<p>本以为是并发异常，后发现不对，因为ConcurrentHashMap已经使用继承自ReentrantLock的Segment，保证了线程安全，Java如果有这么大的bug肯定早修复了。看了下源码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="javadoc">/**</span></div><div class="line"> * Removes the key (and its corresponding value) from this map.</div><div class="line"> * This method does nothing if the key is not in the map.</div><div class="line"> *</div><div class="line"> *<span class="javadoctag"> @param</span>  key the key that needs to be removed</div><div class="line"> *<span class="javadoctag"> @return</span> the previous value associated with &lt;tt&gt;key&lt;/tt&gt;, or</div><div class="line"> *         &lt;tt&gt;null&lt;/tt&gt; if there was no mapping for &lt;tt&gt;key&lt;/tt&gt;</div><div class="line"> *<span class="javadoctag"> @throws</span> NullPointerException if the specified key is null</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> V <span class="title">remove</span>(Object key) {</div><div class="line">    <span class="keyword">int</span> hash = hash(key);</div><div class="line">    Segment&lt;K,V&gt; s = segmentForHash(hash);</div><div class="line">    <span class="keyword">return</span> s == <span class="keyword">null</span> ? <span class="keyword">null</span> : s.remove(key, hash, <span class="keyword">null</span>);</div><div class="line">}</div></pre></td></tr></table></figure>

<p>发现自己大意了，在获取hashCode时NPE(hashMap不会,因为它会对null key做一次处理)。ConcurrentHashMap不接受null key和null value这个常识一时疏忽了,调用的地方确实有可能传入null。这样在remove前进行null判断即可解决。</p>
<p>在问题解决后,想到hashMap和linkedhashMap都允许null key和null value,treeMap不允许null key,但允许null value,而ConcurrentHashMap既不允许null key也不允许null value，why?</p>
<p>2、not allow null key and value<br>stackoverflow并结合了源码分析了一下<br>(1) treeMap不允许null key是因为compare会导致NPE,可通过以下代码实现null key支持</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">SortedMap&lt;Integer, Integer&gt; map = <span class="keyword">new</span> TreeMap&lt;Integer, Integer&gt;(<span class="keyword">new</span> Comparator&lt;Integer&gt;() {</div><div class="line"></div><div class="line">									<span class="annotation">@Override</span></div><div class="line">									<span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span>(Integer arg0, Integer arg1) {</div><div class="line">										<span class="keyword">if</span> (arg0 == <span class="keyword">null</span>) {</div><div class="line">											<span class="keyword">if</span> (arg1 == <span class="keyword">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">											<span class="keyword">return</span> -<span class="number">1</span>;</div><div class="line">										}</div><div class="line">										<span class="keyword">if</span> (arg1 == <span class="keyword">null</span>) <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">										<span class="keyword">return</span> arg0.compareTo(arg1);</div><div class="line">									}</div><div class="line">								});</div></pre></td></tr></table></figure>

<p>(2) ConcurrentHashMap不允许null key和null value，是因为ConcurrentHashMap的锁机制<br>对于get(Object key)如果返回null,ConcurrentHashMap没办法判断是key不存在还是value就是null。有人得问了那么hashmap呢, 为什么可以，hashmap我们可以通过下面代码实现判断</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">Map&lt;String, String&gt; map = Collections.synchronizedMap(<span class="keyword">new</span> HashMap&lt;String, String&gt;());</div><div class="line">String key = <span class="string">"aa"</span>, value;</div><div class="line"><span class="keyword">synchronized</span> (map) {</div><div class="line">    <span class="keyword">if</span> (map.containsKey(key)) {</div><div class="line">        value = map.get(key);</div><div class="line">    } <span class="keyword">else</span> {</div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">"key is not exist"</span>);</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>使用Collections.synchronizedMap对hashmap加锁,Collections.synchronizedMap的锁是同步锁,就是对象本身,所以synchronized (map)与Collections.synchronizedMap内锁统一。而ConcurrentHashMap的并发控制是利用分离锁实现的(16个重入锁),在外部无法获得锁,自己也没有提供函数进行判断，所以无奈了。</p>
<p>那么有没有办法既保证map的并发安全同时又允许null key和null value呢,当然了,两种方式<br>第一种实际上面已经展现了,通过Collections.synchronizedMap对hashmap加锁即可。synchronizedMap保证了线程安全,hashmap又允许null key和null value。<br>不过Collections.synchronizedMap的并发性能自然比不上ConcurrentHashMap的分桶锁机制,如果对性能要求较高<br>理论上也可以重写ConcurrentHashMap添加一个函数支持上面代码段的并发，但这个要求对ConcurrentHashMap的分离锁相当熟悉</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>







  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <time datetime="2011-11-10T08:50:10.000Z"><a href="/2011/11/10/my-java-dev-tools/">11月 10 2011</a></time>
      
      
  
    <h1 class="title"><a href="/2011/11/10/my-java-dev-tools/">我的Java程序员开发常用工具集</a></h1>
  

    </header>
    <div class="entry">
      
        <p>我发现很多人没办法高效地解决问题的关键原因是不熟悉工具，不熟悉工具也还罢了，甚至还不知道怎么去找工具，这个问题就大条了。我想列下我能想到的一个Java程序员会用到的常用工具。</p>
<p>一、编码工具</p>
<p> 1.IDE：<a href="http://www.eclipse.org/" target="_blank" rel="external">Eclipse</a>或者<a href="http://www.jetbrains.com/idea/" target="_blank" rel="external">IDEA</a>，熟悉尽可能多的快捷键，《<a href="https://www.google.com/#hl=zh-CN&amp;site=&amp;source=hp&amp;q=Eclipse+%E5%B8%B8%E7%94%A8%E5%BF%AB%E6%8D%B7%E9%94%AE&amp;oq=Eclipse+%E5%B8%B8%E7%94%A8%E5%BF%AB%E6%8D%B7%E9%94%AE&amp;aq=f&amp;aqi=g-l1&amp;aql=&amp;gs_l=hp.3..0i13.449l7739l0l7948l53l49l9l4l4l9l278l4511l14j15j7l36l0.&amp;bav=on.2,or.r_gc.r_pw.r_cp.,cf.osb&amp;fp=eef1a08d3fa904e4&amp;biw=1594&amp;bih=858" target="_blank" rel="external">Eclipse常见快捷键列表</a>》</p>
<p> 2.插件：<br> (1) <a href="http://findbugs.sourceforge.net/" target="_blank" rel="external">Findbugs</a>，在release之前进行一次静态代码检查是必须的<br> (2) <a href="http://www.atlassian.com/software/clover/overview" target="_blank" rel="external">Clover</a>，关心你的单元测试覆盖率<br> (3) <a href="http://checkstyle.sourceforge.net/" target="_blank" rel="external">Checkstyle</a> 代码风格检查</p>
<p> 3.构建和部署工具:ant或者maven，现在主流都是maven了吧，使用<a href="http://www.sonatype.org/nexus/" target="_blank" rel="external">nexus搭建maven私服</a>，再加上持续集成<a href="http://jenkins-ci.org/" target="_blank" rel="external">jenkins</a>。代码质量不用愁。</p>
<p> 4.版本管理工具： svn或者git</p>
<p> 5.<a href="http://www.linuxsky.org/doc/admin/200712/213.html" target="_blank" rel="external">diff</a>和<a href="http://www.linuxsky.org/doc/admin/200712/213.html" target="_blank" rel="external">patch</a></p>
<p> 6.设置你的eclipse或者IDEA，如formatter,save actions以及code template等。代码风格，直接用google的也可以啊。《<a href="http://code.google.com/p/google-styleguide/" target="_blank" rel="external">Google style guide</a>》</p>
<p> 7.掌握一个文本编辑器，Emacs或者VIM，熟悉常用快捷键。这在你需要在线编辑代码，或者编写其他语言代码时候特别有用。《<a href="http://linuxtoy.org/archives/why-emacs-vim-good.html" target="_blank" rel="external">神器圣战</a>》</p>
<p>二、JDK相关</p>
<p>1.jstat : 观察GC情况，如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">jstat -gcutil pid <span class="number">3078</span></div></pre></td></tr></table></figure>

<p>2.jmap，查看heap情况，如查看存活对象列表：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">jmap -histo:live pid |grep com.company |less</div></pre></td></tr></table></figure>

<p>或者dump内存用来分析：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">jmap -dump:file=test.bin pid</div></pre></td></tr></table></figure>

<p>3.分析dump的堆文件，可以用jhat:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">jhat test.bin</div></pre></td></tr></table></figure>

<p>  分析完成后可以用浏览器查看堆的情况。这个工具的分析结果还比较原始，你还可以用Eclipse MAT插件进行图形化分析，或者IBM的<a href="https://www.ibm.com/developerworks/community/groups/service/html/communityview?communityUuid=4544bafe-c7a2-455f-9d43-eb866ea60091" target="_blank" rel="external">Heap Analyzer</a>.</p>
<p>4.jvisualvm和jconsole： JVM自带的性能分析和监控工具，怎么用？请自己看<a href="http://docs.oracle.com/javase/6/docs/technotes/guides/visualvm/index.html" target="_blank" rel="external">文档</a>。</p>
<p>5.jstack：分析线程堆栈，如</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">jstack pid &gt; thread_dump</div></pre></td></tr></table></figure>

<p>查看CPU最高的线程在干什么的方法结合top和jstack：<a href="http://www.iteye.com/topic/1114219" target="_blank" rel="external">http://www.iteye.com/topic/1114219</a></p>
<p>6.更多JVM工具，参见官方文档：<a href="http://docs.oracle.com/javase/6/docs/technotes/tools/" target="_blank" rel="external">http://docs.oracle.com/javase/6/docs/technotes/tools/</a></p>
<p>7.学习使用btrace分析java运行时问题。《(Btrace使用简介)[<a href="http://rdc.taobao.com/team/jm/archives/509]》" target="_blank" rel="external">http://rdc.taobao.com/team/jm/archives/509]》</a></p>
<p>8.GC日志分析工具：GC viewer、GC-console或者自己挑<a href="http://stackoverflow.com/questions/1839599/analyze-gc-logs-for-sun-hotspots-jvm-6" target="_blank" rel="external">这里</a>。</p>
<p>9.性能分析工具，除了自带的jvisualvm外，还可以用商业的jprofiler。</p>
<p>10.<a href="http://kenwublog.com/docs/java6-jvm-options-chinese-edition.htm" target="_blank" rel="external">JVM参数大全</a></p>
<p>11.《<a href="http://hllvm.group.iteye.com/group/topic/27945" target="_blank" rel="external">JVM调优标准参数陷阱</a>》，iteye神贴。</p>
<p>三、Linux工具</p>
<p>1.熟悉<a href="http://www.commandlinefu.com/commands/browse/sort-by-votes" target="_blank" rel="external">常用的shell命令</a>，</p>
<p>2.设置<a href="http://paulkeck.com/ssh/" target="_blank" rel="external">ssh免登陆</a></p>
<p>3.使用htop替换top。</p>
<p>4.熟悉下strace,gdb甚至systemtap来分析问题。</p>
<p>5.熟悉vmstat,iostat,sar等性能统计工具。</p>
<p>5.自动化部署脚本，<a href="http://docs.fabfile.org/en/1.4.1/index.html" target="_blank" rel="external">py-fabric</a>或者自荐下这个<a href="https://github.com/killme2008/clojure-control" target="_blank" rel="external">clojure-control</a>。</p>
<p>四、其他</p>
<p>1.掌握一门脚本语言，<a href="http://python.org/" target="_blank" rel="external">Python</a>或者<a href="http://www.ruby-lang.org/" target="_blank" rel="external">Ruby</a>，高效解决一些需要quick and dirty的任务：比如读写文件、导入导出数据库、网页爬虫等。注意不是python.com，咔咔。</p>
<p><code>Python</code>推荐<a href="http://woodpecker.org.cn/" target="_blank" rel="external">啄木鸟社区</a>,<code>Ruby</code>推荐<a href="https://ruby-china.org/" target="_blank" rel="external">Ruby China</a></p>
<p>2.使用Linux或者Mac os系统作为你的开发环境。</p>
<p>3.升级你的“硬件工具”，双屏大屏显示器、SSD、8G内存甚至更多。</p>
<p>4.你懂的：<a href="https://code.google.com/p/goagent/" target="_blank" rel="external">https://code.google.com/p/goagent/</a> ; <a href="https://github.com/justjavac/Google-IPs/blob/master/README.md" target="_blank" rel="external">https://github.com/justjavac/Google-IPs/blob/master/README.md</a></p>
<p>五、如何查找工具？</p>
<p>1.搜索引擎，google或者baidu，《<a href="http://www.williamlong.info/archives/728.html" target="_blank" rel="external">搜索技巧</a>》</p>
<p>2.万能的stack overflow：<a href="http://stackoverflow.com/" target="_blank" rel="external">http://stackoverflow.com/</a></p>
<p>3.虚心问牛人。</p>
<p>六、最重要的是⋯⋯</p>
<p>一颗永不停止学习的心。</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>







  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <time datetime="2011-06-22T07:22:16.000Z"><a href="/2011/06/22/mongodb-commond/">6月 22 2011</a></time>
      
      
  
    <h1 class="title"><a href="/2011/06/22/mongodb-commond/">MongoDB常见操作命令整理</a></h1>
  

    </header>
    <div class="entry">
      
        <p>近期学习了一些Nosql技术,主要是在看Mongodb相关知识,整理了一份mongodb的命令行操作指令,用的时候方便找</p>
<p>数据库操作语法<br><code>mongo --path</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">db.AddUser(username,password)  <span class="comment">#添加用户</span></div><div class="line">db.auth(usrename,password)     <span class="comment">#设置数据库连接验证</span></div><div class="line">db.cloneDataBase(fromhost)     <span class="comment">#从目标服务器克隆一个数据库</span></div><div class="line">db.commandHelp(name)           <span class="comment">#returns the help for the command</span></div><div class="line">db.copyDatabase(fromdb,todb,fromhost)  <span class="comment">#复制数据库fromdb---源数据库名称，todb---目标数据库名称，fromhost---源数据库服务器地址</span></div><div class="line">db.createCollection(name,{size:<span class="number">3333</span>,capped:<span class="number">333</span>,max:<span class="number">88888</span>})  <span class="comment">#创建一个数据集，相当于一个表</span></div><div class="line">db.currentOp()                 <span class="comment">#取消当前库的当前操作</span></div><div class="line">db.dropDataBase()              <span class="comment">#删除当前数据库</span></div><div class="line">db.eval(func,args)             <span class="comment">#run code server-side</span></div><div class="line">db.getCollection(cname)        <span class="comment">#取得一个数据集合，同用法：db['cname'] or db.cname</span></div><div class="line">db.getCollenctionNames()       <span class="comment">#取得所有数据集合的名称列表</span></div><div class="line">db.getLastError()              <span class="comment">#返回最后一个错误的提示消息</span></div><div class="line">db.getLastErrorObj()           <span class="comment">#返回最后一个错误的对象</span></div><div class="line">db.getMongo()                  <span class="comment">#取得当前服务器的连接对象get the server connection object</span></div><div class="line">db.getMondo().setSlaveOk()     <span class="comment">#allow this connection to read from then nonmaster membr of a replica pair</span></div><div class="line">db.getName()                   <span class="comment">#返回当操作数据库的名称</span></div><div class="line">db.getPrevError()              <span class="comment">#返回上一个错误对象</span></div><div class="line">db.getProfilingLevel()         <span class="comment">#获取分析等级</span></div><div class="line">db.getReplicationInfo()        <span class="comment">#获取复制信息</span></div><div class="line">db.getSisterDB(name)           <span class="comment">#get the db at the same server as this onew</span></div><div class="line">db.killOp()                    <span class="comment">#停止（杀死）在当前库的当前操作</span></div><div class="line">db.printCollectionStats()      <span class="comment">#返回当前库的数据集状态</span></div><div class="line">db.printReplicationInfo()</div><div class="line">db.printSlaveReplicationInfo()</div><div class="line">db.printShardingStatus()       <span class="comment">#返回当前数据库是否为共享数据库</span></div><div class="line">db.removeUser(username)        <span class="comment">#删除用户</span></div><div class="line">db.repairDatabase()            <span class="comment">#修复当前数据库</span></div><div class="line">db.resetError()                </div><div class="line">db.runCommand(cmdObj)          <span class="comment">#run a database command. if cmdObj is a string, turns it into {cmdObj:1}</span></div><div class="line">db.setProfilingLevel(level)    <span class="comment">#0=off,1=slow,2=all</span></div><div class="line">db.shutdownServer()            <span class="comment">#关闭当前服务程序</span></div><div class="line">db.version()                   <span class="comment">#返回当前程序的版本信息</span></div></pre></td></tr></table></figure>

<p>数据集(表)操作语法</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">db.linlin.find({id:<span class="number">10</span>})          <span class="comment">#返回linlin数据集ID=10的数据集</span></div><div class="line">db.linlin.find({id:<span class="number">10</span>}).count()  <span class="comment">#返回linlin数据集ID=10的数据总数</span></div><div class="line">db.linlin.find({id:<span class="number">10</span>}).limit(<span class="number">2</span>) <span class="comment">#返回linlin数据集ID=10的数据集从第二条开始的数据集</span></div><div class="line">db.linlin.find({id:<span class="number">10</span>}).skip(<span class="number">8</span>)  <span class="comment">#返回linlin数据集ID=10的数据集从0到第八条的数据集</span></div><div class="line">db.linlin.find({id:<span class="number">10</span>}).limit(<span class="number">2</span>).skip(<span class="number">8</span>)  <span class="comment">#返回linlin数据集ID=1=的数据集从第二条到第八条的数据</span></div><div class="line">db.linlin.find({id:<span class="number">10</span>}).sort()   <span class="comment">#返回linlin数据集ID=10的排序数据集</span></div><div class="line">db.linlin.findOne([query])       <span class="comment">#返回符合条件的一条数据</span></div><div class="line">db.linlin.getDB()                <span class="comment">#返回此数据集所属的数据库名称</span></div><div class="line">db.linlin.getIndexes()           <span class="comment">#返回些数据集的索引信息</span></div><div class="line">db.linlin.group({key:...,initial:...,reduce:...[,cond:...]})</div><div class="line">db.linlin.mapReduce(mayFunction,reduceFunction,&lt;optional params&gt;)</div><div class="line">db.linlin.remove(query)                      <span class="comment">#在数据集中删除一条数据</span></div><div class="line">db.linlin.renameCollection(newName)          <span class="comment">#重命名些数据集名称</span></div><div class="line">db.linlin.save(obj)                          <span class="comment">#往数据集中插入一条数据</span></div><div class="line">db.linlin.stats()                            <span class="comment">#返回此数据集的状态</span></div><div class="line">db.linlin.storageSize()                      <span class="comment">#返回此数据集的存储大小</span></div><div class="line">db.linlin.totalIndexSize()                   <span class="comment">#返回此数据集的索引文件大小</span></div><div class="line">db.linlin.totalSize()                        <span class="comment">#返回些数据集的总大小</span></div><div class="line">db.linlin.update(query,object[,upsert_bool]) <span class="comment">#在此数据集中更新一条数据                         </span></div><div class="line">db.linlin.validate()                         <span class="comment">#验证此数据集                                        </span></div><div class="line">db.linlin.getShardVersion()                  <span class="comment">#返回数据集共享版本号</span></div></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">db.linlin.find({<span class="string">'name'</span>:<span class="string">'foobar'</span>})    <span class="comment">#select * from linlin where name='foobar'</span></div><div class="line">db.linlin.find()                     <span class="comment">#select * from linlin</span></div><div class="line">db.linlin.find({<span class="string">'ID'</span>:<span class="number">10</span>}).count()    <span class="comment">#select count(*) from linlin where ID=10</span></div><div class="line">db.linlin.find().skip(<span class="number">10</span>).limit(<span class="number">20</span>)  <span class="comment">#从查询结果的第十条开始读20条数据  select * from linlin limit 10,20  ----------mysql</span></div><div class="line">db.linlin.find({<span class="string">'ID'</span>:{<span class="variable">$in</span>:[<span class="number">25</span>,<span class="number">35</span>,<span class="number">45</span>]}})  <span class="comment">#select * from linlin where ID in (25,35,45)</span></div><div class="line">db.linlin.find().sort({<span class="string">'ID'</span>:-<span class="number">1</span>})      <span class="comment">#select * from linlin order by ID desc</span></div><div class="line">db.linlin.distinct(<span class="string">'name'</span>,{<span class="string">'ID'</span>:{<span class="variable">$lt</span>:<span class="number">20</span>}})   <span class="comment">#select distinct(name) from linlin where ID&lt;20</span></div></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">db.linlin.group({key:{<span class="string">'name'</span>:<span class="literal">true</span>},cond:{<span class="string">'name'</span>:<span class="string">'foo'</span>},reduce:function(obj,prev){prev.msum+=obj.marks;},initial:{msum:<span class="number">0</span>}}) <span class="comment">#select name,sum(marks) from linlin group by name</span></div><div class="line">db.linlin.find(<span class="string">'this.ID&lt;20'</span>,{name:<span class="number">1</span>})     <span class="comment">#select name from linlin where ID&lt;20</span></div></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">db.linlin.insert({<span class="string">'name'</span>:<span class="string">'foobar'</span>,<span class="string">'age'</span>:<span class="number">25</span>})  <span class="comment">#insert into linlin ('name','age') values('foobar',25)</span></div><div class="line">db.linlin.insert({<span class="string">'name'</span>:<span class="string">'foobar'</span>,<span class="string">'age'</span>:<span class="number">25</span>,<span class="string">'email'</span>:<span class="string">'cclove2@163.com'</span>})</div></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">db.linlin.remove({})                   <span class="comment">#相当于sql中的 delete * from linlin</span></div><div class="line">db.linlin.remove({<span class="string">'age'</span>:<span class="number">20</span>})           <span class="comment">#delete linlin where age=20</span></div><div class="line">db.linlin.remove({<span class="string">'age'</span>:{<span class="variable">$lt</span>:<span class="number">20</span>}})     <span class="comment">#delete linlin where age&lt;20</span></div><div class="line">db.linlin.remove({<span class="string">'age'</span>:{<span class="variable">$lte</span>:<span class="number">20</span>}})    <span class="comment">#delete linlin where age&lt;=20</span></div><div class="line">db.linlin.remove({<span class="string">'age'</span>:{<span class="variable">$gt</span>:<span class="number">20</span>}})     <span class="comment">#delete linlin where age&gt;20</span></div><div class="line">db.linlin.remove({<span class="string">'age'</span>:{<span class="variable">$gte</span>:<span class="number">20</span>}})    <span class="comment">#delete linlin where age&gt;=20</span></div><div class="line">db.linlin.remove({<span class="string">'age'</span>:{<span class="variable">$ne</span>:<span class="number">20</span>}})     <span class="comment">#delete linlin where age!=20</span></div></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">db.linlin.update({<span class="string">'name'</span>:<span class="string">'foobar'</span>},{<span class="variable">$set</span>:{<span class="string">'age'</span>:<span class="number">36</span>}})  <span class="comment">#update linlin set age=36 where name='foobar'</span></div><div class="line">db.linlin.update({<span class="string">'name'</span>:<span class="string">'foobar'</span>},{<span class="variable">$inc</span>:{<span class="string">'age'</span>:<span class="number">3</span>}})   <span class="comment">#update linlin set age=age+3 where name='foobar'</span></div></pre></td></tr></table></figure>


      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>







  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <time datetime="2011-03-19T15:01:00.000Z"><a href="/2011/03/19/thread-lock/">3月 19 2011</a></time>
      
      
  
    <h1 class="title"><a href="/2011/03/19/thread-lock/">并发锁机制和Lock-Free算法</a></h1>
  

    </header>
    <div class="entry">
      
        <h3 id="原子类型">原子类型</h3>
<p>这是由硬件提供原子操作指令实现的。在非激烈竞争的情况下,开销更小,速度更快。<br>java.util.concurrent中实现的原子操作类包括: <code>AtomicBoolean</code>、<code>AtomicInteger</code>、<code>AtomicLong</code>、<code>AtomicReference</code></p>
<p>不使用AtomicInteger</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">class Counter {</div><div class="line">	<span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">int</span> count = <span class="number">0</span>;</div><div class="line">	<span class="comment">//若要线程安全执行执行count++,需要加锁</span></div><div class="line">	<span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">increment</span>() { </div><div class="line">		count++;</div><div class="line">	}</div><div class="line">	<span class="comment">//</span></div><div class="line">	<span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span>() {</div><div class="line">		<span class="keyword">return</span> count;</div><div class="line">	}</div><div class="line">}</div></pre></td></tr></table></figure>

<p>使用AtomicInteger</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">class Counter {</div><div class="line">	<span class="keyword">private</span> AtomicInteger count = <span class="keyword">new</span> AtomicInteger();</div><div class="line"></div><div class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">increment</span>() { </div><div class="line">		<span class="comment">//￼使用AtomicInteger之后,不需要加锁,也可以实现线程安全</span></div><div class="line">		count.incrementAndGet();</div><div class="line">	}</div><div class="line"></div><div class="line">	<span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span>() {</div><div class="line">		<span class="keyword">return</span> count.get();</div><div class="line">	}</div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="非阻塞型同步(Non-blocking_Synchronization)">非阻塞型同步(Non-blocking Synchronization)</h3>
<p>如何正确有效的保护共享数据是编写并行程序必须面临的一个难题,通常的手段就是同步;同步可分为阻塞型同步(Blocking Synchronization)和非阻塞型同步( Non-blocking Synchronization).</p>
<p>阻塞型同步是指当一个线程到达临界区时,因另外一个线程已经持有访问该共享数据的锁, 从而不能获取锁资源而阻塞,直到另外一个线程释放锁。常见的同步原语有 mutex、 semaphore 等。如果同步方案采用不当,就会造成死锁(deadlock),活锁(livelock)和 优先级反转(priority inversion),以及效率低下等现象。</p>
<p><img src="/img/threadLock.jpg"></p>
<p>为了降低风险程度和提高程序运行效率,业界提出了不采用锁的同步方案,依照这种设计思路设计的算法称为非阻塞型算法,其本质特征就是停止一个线程的执行不会阻碍系统中其他执行实体的运行。<br>当今比较流行的 Non-blocking Synchronization 实现方案有三种: </p>
<ul>
<li><p>Wait-free<br>Wait-free是指任意线程的任何操作都可以在有限步之内结束,而不用关心其它线程的执行速度。Wait-free是基于 per-thread 的,可以认为是 starvation-free 的。非常遗憾的是实际情况并非如此,采用 Wait-free 的程序并不能保证 starvation-free,同时内存消耗也随线程数量而线性增长。目前只有极少数的非阻塞算法实现了这一点。</p>
</li>
<li><p>Lock-Free<br>Lock-Free是指能够确保执行它的所有线程中至少有一个能够继续往下执行。由于每个线程不是 starvation-free 的,即有些线程可能会被任意地延迟,然而在每一步都至少有一 个线程能够往下执行,因此系统作为一个整体是在持续执行的,可以认为是 system-wide 的。所有 Wait-free 的算法都是 Lock-Free 的。</p>
</li>
<li><p>Obstruction-free<br>Obstruction-free是指在任何时间点,一个孤立运行线程的每一个操作可以在有限步之内结束。只要没有竞争,线程就可以持续运行。一旦共享数据被修改,Obstruction-free 要 求中止已经完成的部分操作,并进行回滚。 所有 Lock-Free 的算法都是 Obstruction-free 的。</p>
</li>
</ul>
<h3 id="使用Lock-Free算法">使用Lock-Free算法</h3>
<p>不使用Lock-Free算法示例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">class Counter {</div><div class="line">	<span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">int</span> max = <span class="number">0</span>;</div><div class="line">	<span class="comment">//若要线程安全,需要加锁</span></div><div class="line">	<span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">set</span>(<span class="keyword">int</span> value) { </div><div class="line">		<span class="keyword">if</span> (value &gt; max) {</div><div class="line">			max = value; </div><div class="line">		}</div><div class="line">	}</div><div class="line">	<span class="comment">//</span></div><div class="line">	<span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getMax</span>() {</div><div class="line">		<span class="keyword">return</span> max;</div><div class="line">	}</div><div class="line">}</div></pre></td></tr></table></figure>

<p>使用Lock-Free算法代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">class Counter {</div><div class="line">	<span class="keyword">private</span> AtomicInteger max = <span class="keyword">new</span> AtomicInteger();</div><div class="line">	<span class="comment">//LockFree算法,不需要加锁。</span></div><div class="line">	<span class="comment">//通常都是三个部分组成: 1.循环 2.CAS (CompareAndSet) 3.回退</span></div><div class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span>(<span class="keyword">int</span> value) { </div><div class="line">		<span class="comment">//第一步循环</span></div><div class="line">		<span class="keyword">for</span> (;;) {</div><div class="line">			<span class="keyword">int</span> current = max.get(); </div><div class="line">			<span class="keyword">if</span> (value &gt; current) {</div><div class="line">				<span class="comment">//第二步CAS</span></div><div class="line">				<span class="keyword">if</span> (max.compareAndSet(current, value)) { </div><div class="line">					<span class="comment">//第三步回退</span></div><div class="line">					<span class="keyword">break</span>;</div><div class="line">				} <span class="keyword">else</span> {</div><div class="line">					<span class="keyword">continue</span>;</div><div class="line">				}</div><div class="line">			} <span class="keyword">else</span> { </div><div class="line">				<span class="keyword">break</span>; </div><div class="line">			}</div><div class="line">	￼￼	} </div><div class="line">	}</div><div class="line">	<span class="comment">//</span></div><div class="line">	<span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getMax</span>() {</div><div class="line">		<span class="keyword">return</span> max.get();</div><div class="line">	}</div><div class="line">}</div></pre></td></tr></table></figure>

<p>同样地实现,把for(;;)改成do…while循环</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">class Counter {</div><div class="line">	<span class="keyword">private</span> AtomicInteger max = <span class="keyword">new</span> AtomicInteger();</div><div class="line">	<span class="comment">//</span></div><div class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span>(<span class="keyword">int</span> value) { </div><div class="line">		<span class="keyword">int</span> current;</div><div class="line">		do {</div><div class="line">			current = max.get();</div><div class="line">			<span class="keyword">if</span> (value &lt;= current) { </div><div class="line">				<span class="keyword">break</span>;</div><div class="line">			}</div><div class="line">		} <span class="keyword">while</span> (!max.compareAndSet(current, value));</div><div class="line">	}</div><div class="line">	<span class="comment">//</span></div><div class="line">	<span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getMax</span>() { </div><div class="line">		<span class="keyword">return</span> max.get();</div><div class="line">	} </div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="使用Lock-Free数据结构">使用Lock-Free数据结构</h3>
<p>使用HashMap</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">class BeanManager {</div><div class="line">	<span class="keyword">private</span> Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</div><div class="line">	<span class="comment">//</span></div><div class="line">	<span class="keyword">public</span> Object <span class="title">getBean</span>(String key) { </div><div class="line">		<span class="keyword">synchronized</span> (map) {</div><div class="line">			Object bean = map.get(key); </div><div class="line">			<span class="keyword">if</span> (bean == <span class="keyword">null</span>) {</div><div class="line">				map.put(key, createBean());</div><div class="line">				bean = map.get(key); </div><div class="line">			}</div><div class="line">			<span class="keyword">return</span> bean; </div><div class="line">		} </div><div class="line">	}</div><div class="line">}</div></pre></td></tr></table></figure>

<p>使用ConcurrentHashMap</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">class BeanManager {</div><div class="line">	<span class="keyword">private</span> ConcurrentMap&lt;String, Object&gt; map = <span class="keyword">new</span> ConcurrentHashMap&lt;String, Object&gt;();</div><div class="line">	<span class="comment">//</span></div><div class="line">	<span class="keyword">public</span> Object <span class="title">getBean</span>(String key) { </div><div class="line">		Object bean = map.get(key);</div><div class="line">		<span class="keyword">if</span> (bean == <span class="keyword">null</span>) {</div><div class="line">			<span class="comment">//使用ConcurrentMap,避免直接使用锁,锁由数据结构来管理。</span></div><div class="line">			map.putIfAbsent(key, createBean()); </div><div class="line">			bean = map.get(key);</div><div class="line">		}</div><div class="line">		<span class="keyword">return</span> bean; </div><div class="line">	}</div><div class="line">}</div></pre></td></tr></table></figure>

<p>ConcurrentHashMap并没有实现Lock-Free,只是使用了分离锁的办法使得能够支持多个Writer并发。 ConcurrentHashMap需要使用更多的内存。</p>
<h3 id="同样的思路用于更新数据库">同样的思路用于更新数据库</h3>
<p>乐观锁</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SequenceDao</span> <span class="keyword">extends</span> <span class="title">SqlMapClientDaoSupport</span> </span>{</div><div class="line">	<span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">compareAndSet</span>(String name, <span class="keyword">int</span> value, <span class="keyword">int</span> expect) {</div><div class="line">		Map&lt;String, Object&gt; parameters = <span class="keyword">new</span> HashMap&lt;String, Object&gt;(); parameters.put(<span class="string">"name"</span>, name);</div><div class="line">		parameters.put(<span class="string">"value"</span>, value);</div><div class="line">		parameters.put(<span class="string">"expect"</span>, expect);</div><div class="line">		<span class="comment">// UPDATE t_sequence SET value = #value# WHERE name = #name# AND value = #expect#</span></div><div class="line">		<span class="keyword">int</span> updateCount = getSqlMapClientTemplate().update(<span class="string">"Sequence.compareAndSet"</span>, parameters); <span class="comment">//通过UpdateCount来实现 CompareAndSet</span></div><div class="line">		<span class="keyword">return</span> updateCount == <span class="number">1</span>;</div><div class="line">	}</div><div class="line">}</div><div class="line"><span class="comment">//</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SequenceService</span> </span>{</div><div class="line">	<span class="annotation">@Transactional</span>(propagation = Propagation.NOT_SUPPORTED) </div><div class="line">	<span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">increment</span>(String sequenceName) {</div><div class="line">		<span class="comment">//三个部分:1.循环 2.CAS (CompareAndSet) 3.回退</span></div><div class="line">		<span class="keyword">for</span> (;;) {</div><div class="line">			<span class="keyword">int</span> value = dao.getValue(sequenceName);</div><div class="line">			<span class="keyword">if</span> (dao.compareAndSet(sequenceName, value + <span class="number">1</span>, value)) {</div><div class="line">				<span class="keyword">break</span>;</div><div class="line">			}</div><div class="line">		}</div><div class="line">	}</div><div class="line">}</div></pre></td></tr></table></figure>

<p>注意,乐观锁时必须使用:@Transactional(propagation = Propagation.NOT_SUPPORTED)</p>
<p>对比,使用悲观锁版本</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SequenceDao</span> <span class="keyword">extends</span> <span class="title">SqlMapClientDaoSupport</span> </span>{ </div><div class="line">	<span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getValueForUpdate</span>(String name) {</div><div class="line">		<span class="comment">// SELECT value FROM t_sequence WHERE name = #name# FOR UPDATE</span></div><div class="line">		<span class="keyword">return</span> (Integer) getSqlMapClientTemplate().queryForObject(<span class="string">"Sequence.getValueForUpdate"</span>, name); </div><div class="line">	}</div><div class="line">	<span class="comment">//</span></div><div class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span>(String name, <span class="keyword">int</span> value) {</div><div class="line">		Map&lt;String, Object&gt; parameters = <span class="keyword">new</span> HashMap&lt;String, Object&gt;(); parameters.put(<span class="string">"name"</span>, name);</div><div class="line">		parameters.put(<span class="string">"value"</span>, value);</div><div class="line">		<span class="comment">// UPDATE t_sequence SET value = #value# WHERE name = #name#</span></div><div class="line">		getSqlMapClientTemplate().update(<span class="string">"Sequence.set"</span>, parameters); </div><div class="line">	}</div><div class="line">}</div><div class="line"><span class="comment">//</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SequenceService</span> </span>{</div><div class="line">	<span class="annotation">@Transactional</span>(propagation = Propagation.REQUIRED) </div><div class="line">	<span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">increment2</span>(String sequenceName) {</div><div class="line">		<span class="comment">//￼读取时,就开始加锁</span></div><div class="line">		<span class="keyword">int</span> value = dao.getValueForUpdate(sequenceName);</div><div class="line">		dao.set(sequenceName, value + <span class="number">1</span>); </div><div class="line">	}</div><div class="line">}</div></pre></td></tr></table></figure>

<p>Lock-Free算法,可以说是乐观锁,如果非激烈竞争的时候,不需要使用锁,从而开销更小,速度更快。</p>
<h3 id="使用CopyOnWriteArrayList">使用CopyOnWriteArrayList</h3>
<p>COW(CopyOnWrite)是一种很古老的技术,类似的并发数据结构有:<code>ConcurrentSkipListMap</code>,<code>ConcurrentSkipListSet</code>,<code>CopyOnWriteArrayList</code>,<code>CopyOnWriteArraySet</code></p>
<p>不使用COW,使用ArrayList示例代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">class Engine {</div><div class="line">	<span class="keyword">private</span> List&lt;Listener&gt; listeners = <span class="keyword">new</span> ArrayList&lt;Listener&gt;();</div><div class="line">	<span class="comment">//</span></div><div class="line">	<span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">addListener</span>(Listener listener) { </div><div class="line">		<span class="keyword">synchronized</span> (listeners) {</div><div class="line">			<span class="keyword">return</span> listeners.add(listener); </div><div class="line">		}</div><div class="line">	}</div><div class="line">	<span class="comment">//</span></div><div class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doXXX</span>() { </div><div class="line">		<span class="keyword">synchronized</span> (listeners) {</div><div class="line">		<span class="keyword">for</span> (Listener listener : listeners) { </div><div class="line">			listener.handle();	</div><div class="line">		}</div><div class="line">	}</div><div class="line">}</div></pre></td></tr></table></figure>

<p>使用CopyOnWriteArrayList</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">class Engine {</div><div class="line">	<span class="keyword">private</span> List&lt;Listener&gt; listeners = <span class="keyword">new</span> CopyOnWriteArrayList &lt;Listener&gt;();</div><div class="line">	<span class="comment">//￼适当使用CopyOnWriteArrayList,能够提高读操作效率</span></div><div class="line">	<span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">addListener</span>(Listener listener) { </div><div class="line">		<span class="keyword">return</span> listeners.add(listener);</div><div class="line">	}</div><div class="line">	<span class="comment">//</span></div><div class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doXXX</span>() {</div><div class="line">		<span class="keyword">for</span> (Listener listener : listeners) {</div><div class="line">			listeners.handle();</div><div class="line">		}</div><div class="line">	}</div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="锁的使用">锁的使用</h3>
<ul>
<li><p>使用支持CAS的数据结构,避免使用锁,如: AtomicXXX、ConcurrentMap、CopyOnWriteList、ConcurrentLinkedQueue</p>
</li>
<li><p>一定要使用锁的时候,注意获得锁的顺序,相反顺序获得锁,就容易产生死锁。</p>
</li>
<li><p>死锁经常是无法完全避免的,鸵鸟策略被很多基础框架所采用。</p>
</li>
<li><p>通过Dump线程的StackTrace,例如linux下执行命令 <code>kill -3 &lt;pid&gt;</code>,或者<code>jstack –l &lt;pid&gt;</code>,或 者使用<code>Jconsole</code>连接上去查看线程的<code>StackTrace</code>,由此来诊断死锁问题。</p>
</li>
<li><p>外部锁常被忽视而导致死锁,例如数据库的锁</p>
</li>
<li><p>存在检测死锁的办法</p>
</li>
<li><p>存在一些预防死锁的手段,比如Lock的tryLock,JDK 7中引入的<code>Phaser</code>等。</p>
</li>
</ul>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>







  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <time datetime="2011-03-14T13:45:57.000Z"><a href="/2011/03/14/thread-blocking/">3月 14 2011</a></time>
      
      
  
    <h1 class="title"><a href="/2011/03/14/thread-blocking/">Java并发阻塞队列(put和take、offer和poll、drainTo)的使用</a></h1>
  

    </header>
    <div class="entry">
      
        <p>阻塞队列,是一种常用的并发数据结构,常用于生产者-消费者模式。 </p>
<h3 id="阻塞队列基础概念">阻塞队列基础概念</h3>
<p>在Java中,有很多种阻塞队列:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">ArrayBlockingQueue  	<span class="comment">//最常用</span></div><div class="line">LinkedBlockingQueue  	<span class="comment">//不会满的</span></div><div class="line">SynchronousQueue    	<span class="comment">//size为0</span></div><div class="line">PriorityBlockingQueue</div><div class="line">CompletionService 		<span class="comment">//BlockingQueue + Executor</span></div><div class="line">TransferQueue 			<span class="comment">//JDK 7中更快的SynchronousQueue</span></div></pre></td></tr></table></figure>

<p>生产者消费者模型</p>
<pre><code>        producer    <span class="comment">------------------------&gt;    consumer</span>
                    +<span class="comment">----+----+----+----+----+</span>
                    +    +      +    +    +    +
                    +<span class="comment">----+----+----+----+----+</span>
                  /                            \ <span class="keyword">for</span> (;;) {
   <span class="comment"> // 如果队列满则阻塞                                blockingQ.take(); // 如果队列空则阻塞</span>
    blockingQ.<span class="built_in">put</span>(object);                        }
</code></pre><h3 id="使用阻塞队列">使用阻塞队列</h3>
<pre><code><span class="code">        +--------------+-------------+</span>
<span class="code">        |          Queue&lt;T&gt;          |</span>
<span class="code">        +--------------+-------------+</span>
<span class="code">        +--------------+-------------+</span>
<span class="code">        | add(E) : boolean           |</span>
<span class="code">        | remove() : E               |</span>
<span class="code">        | offer() : boolean          |</span>
<span class="code">        | poll() : E                 | </span>
<span class="code">        | element() : E              |</span>
<span class="code">        | peek() : E                 |</span>
<span class="code">        +--------------+-------------+</span>
<span class="code">                       ^</span>
<span class="code">                      /|\</span>
<span class="code">                继承自  |     </span>
<span class="header">                       |
+----------------------+---------------------+</span>
<span class="header">|             BlockingQueue&lt;T&gt;               |
+----------------------+---------------------+</span>
<span class="code">+----------------------+</span>---------------------+
| put(E)                                     |
| take() : E                                 |
| offer(E, long, TimeUnit) : boolean         |
| poll(long, TimeUnit) : E                   |
| remainingCapacity()                        |
| drainTo(Collection&lt;? super E&gt;) : int       |
<span class="header">| drainTo(Collection&lt;? super E&gt;, int ) : int |
+----------------------+---------------------+</span>
</code></pre><p>BlockingQueue使用注意:</p>
<ul>
<li>使用BlockingQueue的时候,尽量不要使用从Queue继承下来的方法,否则就失去了Blocking的特性了。</li>
<li>在BlockingQueue中,要使用put和take,而非offer和poll。如果 要使用offer和poll,也是要使用带等待时间参数的offer和poll。</li>
<li>使用drainTo批量获得其中的内容,能够减少锁的次数。</li>
</ul>
<p>代码片段一(错误)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">final</span> BlockingQueue&lt;Object&gt; blockingQ = <span class="keyword">new</span> ArrayBlockingQueue&lt;Object&gt;(<span class="number">10</span>); </div><div class="line">Thread thread = <span class="keyword">new</span> Thread(<span class="string">"consumer thread"</span>) {</div><div class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span>() { </div><div class="line">		<span class="keyword">for</span> (;;) {</div><div class="line">			Object object = blockingQ.poll();<span class="comment">//错误,不等待就会直接返回</span></div><div class="line">			handle(object);</div><div class="line">		} </div><div class="line">	}</div><div class="line">};</div></pre></td></tr></table></figure>

<p>代码片段二</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">final</span> BlockingQueue&lt;Object&gt; blockingQ = <span class="keyword">new</span> ArrayBlockingQueue&lt;Object&gt;(<span class="number">10</span>); </div><div class="line">Thread thread = <span class="keyword">new</span> Thread(<span class="string">"consumer thread"</span>) {</div><div class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span>() { </div><div class="line">		<span class="keyword">for</span> (;;) {</div><div class="line">			<span class="keyword">try</span> {</div><div class="line">				<span class="comment">//注意此处</span></div><div class="line">				Object object = blockingQ.take(); <span class="comment">// 等到有数据才继续 </span></div><div class="line">				handle(object);</div><div class="line">			} <span class="keyword">catch</span> (InterruptedException e) { </div><div class="line">				<span class="keyword">break</span>;</div><div class="line">			} <span class="keyword">catch</span> (Exception e) {</div><div class="line">				<span class="comment">// handle exception</span></div><div class="line">			} </div><div class="line">		}</div><div class="line">	}</div><div class="line">};</div></pre></td></tr></table></figure>

<p>代码片段三</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">final</span> BlockingQueue&lt;Object&gt; blockingQ = <span class="keyword">new</span> ArrayBlockingQueue&lt;Object&gt;(<span class="number">10</span>); </div><div class="line">Thread thread = <span class="keyword">new</span> Thread(<span class="string">"consumer thread"</span>) {</div><div class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span>() { </div><div class="line">		<span class="keyword">for</span> (;;) {</div><div class="line">			<span class="keyword">try</span> {</div><div class="line">				<span class="comment">//注意此处</span></div><div class="line">				Object object = blockingQ.poll(<span class="number">1</span>, TimeUnit.SECONDS); <span class="comment">//防止死等 </span></div><div class="line">				<span class="keyword">if</span> (object == <span class="keyword">null</span>) {</div><div class="line">					<span class="keyword">continue</span>; <span class="comment">//或者做其他处理 </span></div><div class="line">				}</div><div class="line">			} <span class="keyword">catch</span> (InterruptedException e) { </div><div class="line">				<span class="keyword">break</span>;</div><div class="line">			} <span class="keyword">catch</span> (Exception e) {</div><div class="line">				<span class="comment">// handle exception</span></div><div class="line">			} </div><div class="line">		}</div><div class="line">	}</div><div class="line">};</div></pre></td></tr></table></figure>

<h3 id="实现一个简单的阻塞队列">实现一个简单的阻塞队列</h3>
<p>未取得锁就直接执行wait、notfiy、notifyAll会抛异常</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">class BlockingQ {</div><div class="line">	<span class="keyword">private</span> Object notEmpty = <span class="keyword">new</span> Object();</div><div class="line">	<span class="keyword">private</span> Queue&lt;Object&gt; linkedList = <span class="keyword">new</span> LinkedList&lt;Object&gt;();</div><div class="line">	<span class="comment">//</span></div><div class="line">	<span class="keyword">public</span> Object <span class="title">take</span>() <span class="keyword">throws</span> InterruptedException { </div><div class="line">		<span class="keyword">synchronized</span> (notEmpty) {</div><div class="line">			<span class="keyword">if</span> (linkedList.size() == <span class="number">0</span>) { </div><div class="line">				<span class="comment">//要执行wait操作,必须先取得该对象的锁</span></div><div class="line">				<span class="comment">//执行wait操作之后,锁会释放</span></div><div class="line">				<span class="comment">//被唤醒之前,需要先获得锁</span></div><div class="line">				notEmpty.wait();</div><div class="line">			}</div><div class="line">			<span class="keyword">return</span> linkedList.poll(); </div><div class="line">		}</div><div class="line">	}</div><div class="line">	<span class="comment">//</span></div><div class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">offer</span>(Object object) { </div><div class="line">		<span class="keyword">synchronized</span> (notEmpty) {</div><div class="line">			<span class="keyword">if</span> (linkedList.size() == <span class="number">0</span>) { </div><div class="line">				<span class="comment">//要执行notify和notifyAll操作,都必须先取得该对象的锁</span></div><div class="line">				notEmpty.notifyAll();</div><div class="line">			}</div><div class="line">			linkedList.add(object); </div><div class="line">		} </div><div class="line">	}</div><div class="line">}</div></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">class BlockingQ {</div><div class="line">	<span class="keyword">private</span> Object notEmpty = <span class="keyword">new</span> Object();</div><div class="line">	<span class="keyword">private</span> Object notFull = <span class="keyword">new</span> Object();</div><div class="line">	<span class="keyword">private</span> Queue&lt;Object&gt; linkedList = <span class="keyword">new</span> LinkedList&lt;Object&gt;(); </div><div class="line">	<span class="keyword">private</span> <span class="keyword">int</span> maxLength = <span class="number">10</span>;</div><div class="line">	<span class="comment">//</span></div><div class="line">	<span class="keyword">public</span> Object <span class="title">take</span>() <span class="keyword">throws</span> InterruptedException { </div><div class="line">		<span class="comment">//分别需要对notEmpty和notFull加锁</span></div><div class="line">		<span class="keyword">synchronized</span> (notEmpty) {</div><div class="line">			<span class="keyword">if</span> (linkedList.size() == <span class="number">0</span>) { </div><div class="line">				notEmpty.wait();</div><div class="line">			}</div><div class="line">			<span class="comment">//分别需要对notEmpty和notFull加锁</span></div><div class="line">			<span class="keyword">synchronized</span> (notFull) {</div><div class="line">				<span class="keyword">if</span> (linkedList.size() == maxLength) { </div><div class="line">					notFull.notifyAll();</div><div class="line">				}</div><div class="line">			<span class="keyword">return</span> linkedList.poll(); </div><div class="line">		}</div><div class="line">	}</div><div class="line">	<span class="comment">//</span></div><div class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">offer</span>(Object object) <span class="keyword">throws</span> InterruptedException { </div><div class="line">		<span class="comment">//分别需要对notEmpty和notFull加锁</span></div><div class="line">		<span class="keyword">synchronized</span> (notEmpty) {</div><div class="line">			<span class="keyword">if</span> (linkedList.size() == <span class="number">0</span>) { </div><div class="line">				notEmpty.notifyAll();</div><div class="line">			}</div><div class="line">			<span class="comment">//分别需要对notEmpty和notFull加锁</span></div><div class="line">			<span class="keyword">synchronized</span> (notFull) {</div><div class="line">				<span class="keyword">if</span> (linkedList.size() == maxLength) { </div><div class="line">					notFull.wait();</div><div class="line">				}</div><div class="line">				linkedList.add(object); </div><div class="line">			}</div><div class="line">		}</div><div class="line">	}</div><div class="line">}</div></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">class BlockingQ {</div><div class="line">	<span class="keyword">private</span> Lock lock = <span class="keyword">new</span> ReentrantLock();</div><div class="line">	<span class="comment">// 一个锁可以创建多个Condition</span></div><div class="line">	<span class="keyword">private</span> Condition notEmpty = lock.newCondition();</div><div class="line">	<span class="keyword">private</span> Condition notFull = lock.newCondition();</div><div class="line">	<span class="keyword">private</span> Queue&lt;Object&gt; linkedList = <span class="keyword">new</span> LinkedList&lt;Object&gt;(); </div><div class="line">	<span class="keyword">private</span> <span class="keyword">int</span> maxLength = <span class="number">10</span>;</div><div class="line">	<span class="comment">//</span></div><div class="line">	<span class="keyword">public</span> Object <span class="title">take</span>() <span class="keyword">throws</span> InterruptedException {</div><div class="line">		lock.lock(); </div><div class="line">		<span class="keyword">try</span> {</div><div class="line">			<span class="keyword">if</span> (linkedList.size() == <span class="number">0</span>) { </div><div class="line">				<span class="comment">// 要执行await操作,必须先取得该Condition的锁。 </span></div><div class="line">				<span class="comment">// 执行await操作之后,锁会释放。 </span></div><div class="line">				<span class="comment">// 被唤醒之前,需要先获得锁。</span></div><div class="line">				notEmpty.await();</div><div class="line">			}</div><div class="line">			<span class="keyword">if</span> (linkedList.size() == maxLength) {</div><div class="line">				notFull.signalAll(); </div><div class="line">			}</div><div class="line">			<span class="keyword">return</span> linkedList.poll(); </div><div class="line">		} <span class="keyword">finally</span> {</div><div class="line">			lock.unlock(); </div><div class="line">		}</div><div class="line">	}</div><div class="line">	<span class="comment">//</span></div><div class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">offer</span>(Object object) <span class="keyword">throws</span> InterruptedException {</div><div class="line">		lock.lock(); </div><div class="line">		<span class="keyword">try</span> {</div><div class="line">			<span class="keyword">if</span> (linkedList.size() == <span class="number">0</span>) { </div><div class="line">				<span class="comment">//￼要执行signal和signalAll操作,都必须先取 得该对象</span></div><div class="line">				notEmpty.signalAll();</div><div class="line">			}</div><div class="line">			<span class="keyword">if</span> (linkedList.size() == maxLength) {</div><div class="line">				notFull.await(); </div><div class="line">			}</div><div class="line">			linkedList.add(object); </div><div class="line">		} <span class="keyword">finally</span> {</div><div class="line">			lock.unlock(); </div><div class="line">		}</div><div class="line">	}</div><div class="line">}</div></pre></td></tr></table></figure>

<p>注意:未锁就直接执行await、signal、siganlAll会抛异常</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>







  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <time datetime="2011-02-12T07:49:30.000Z"><a href="/2011/02/12/git-pro/">2月 12 2011</a></time>
      
      
  
    <h1 class="title"><a href="/2011/02/12/git-pro/">Git配置和常用命令</a></h1>
  

    </header>
    <div class="entry">
      
        <p>Git是一个分布式版本控制／软件配置管理软件，原来是linux内核开发者林纳斯·托瓦兹（Linus Torvalds）为了更好地管理linux内核开发而创立的。</p>
<h3 id="Git配置">Git配置</h3>
<figure class="highlight git"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">git config --<span class="keyword">global</span> user.name <span class="string">"Lawrence-zxc"</span></div><div class="line">git config --<span class="keyword">global</span> user.email <span class="string">"zhangxiongcai337@gmail.com"</span></div><div class="line">git config --<span class="keyword">global</span> color.ui <span class="literal">true</span></div><div class="line">git config --<span class="keyword">global</span> <span class="keyword">alias</span>.co checkout</div><div class="line">git config --<span class="keyword">global</span> <span class="keyword">alias</span>.ci commit</div><div class="line">git config --<span class="keyword">global</span> <span class="keyword">alias</span>.st status</div><div class="line">git config --<span class="keyword">global</span> <span class="keyword">alias</span>.br branch</div><div class="line">git config -l  <span class="preprocessor"># 列举所有配置</span></div></pre></td></tr></table></figure>

<p>用户的git配置文件在<code>~/.gitconfig</code>，我的配置：</p>
<figure class="highlight git"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">  /Users/zxc/workspace/blog  ❤  cat ~/.gitconfig </div><div class="line">[user]</div><div class="line">    <span class="variable">email =</span> zhangxiongcai337@gmail.com</div><div class="line">    <span class="variable">name =</span> Lawrence-zxc</div><div class="line">[color]</div><div class="line">    <span class="variable">ui =</span> auto</div><div class="line">[color <span class="string">"branch"</span>]</div><div class="line">    <span class="variable">current =</span> yellow reverse</div><div class="line">    <span class="variable">local =</span> yellow</div><div class="line">    <span class="variable">remote =</span> green</div><div class="line">[color <span class="string">"diff"</span>]</div><div class="line">    <span class="variable">meta =</span> yellow bold</div><div class="line">    <span class="variable">frag =</span> magenta bold</div><div class="line">    <span class="variable">old =</span> red bold</div><div class="line">    <span class="variable">new =</span> green bold</div><div class="line">[color <span class="string">"status"</span>]</div><div class="line">    <span class="variable">added =</span> yellow</div><div class="line">    <span class="variable">changed =</span> green</div><div class="line">    <span class="variable">untracked =</span> cyan</div><div class="line">[alias]</div><div class="line">    <span class="variable">st =</span> <span class="string">"status"</span></div><div class="line">    <span class="variable">co =</span> checkout</div><div class="line">    <span class="variable">ls =</span> <span class="string">"ls-files"</span></div><div class="line">    <span class="variable">ci =</span> commit</div><div class="line">    <span class="variable">br =</span> branch</div><div class="line">    <span class="variable">rt =</span> reset --hard</div><div class="line">    <span class="variable">unstage =</span> reset HEAD</div><div class="line">    <span class="variable">uncommit =</span> reset --soft HEAD^</div><div class="line">    <span class="variable">l =</span> log <span class="variable">--pretty=</span>oneline --abbrev-commit --graph --decorate</div><div class="line">    <span class="variable">amend =</span> commit --amend </div><div class="line">    <span class="variable">who =</span> shortlog -n -s --no-merges </div><div class="line">    <span class="variable">g =</span> grep -n --color -E </div><div class="line">    <span class="variable">cp =</span> cherry-pick -x </div><div class="line">    <span class="variable">cb =</span> checkout -b </div><div class="line">[core]</div><div class="line">    <span class="variable">filemode =</span> <span class="constant">true</span></div></pre></td></tr></table></figure>

<h3 id="Git常用命令">Git常用命令</h3>
<p>查看、帮助命令</p>
<figure class="highlight git"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="input"><span class="prompt">git help &lt;command&gt;</span>  <span class="comment"># 显示command的help</span></span></div><div class="line">git show            <span class="comment"># 显示某次提交的内容</span></div><div class="line">git show <span class="variable">$id</span></div></pre></td></tr></table></figure>

<p>查看提交记录</p>
<figure class="highlight git"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">git <span class="keyword">log</span></div><div class="line">git <span class="keyword">log</span> &lt;file&gt;      <span class="comment"># 查看该文件每次提交记录</span></div><div class="line">git <span class="keyword">log</span> -p &lt;file&gt;   <span class="comment"># 显示版本历史，以及版本间的内容差异</span></div><div class="line">git <span class="keyword">log</span> -p -<span class="number">2</span>       <span class="comment"># 查看最近两次详细修改内容的diff</span></div><div class="line">git <span class="keyword">log</span> --<span class="keyword">stat</span>      <span class="comment"># 查看提交统计信息</span></div><div class="line">git <span class="keyword">log</span> --since=<span class="string">"6 hours"</span>  <span class="comment"># 显示最近6小时提交</span></div><div class="line">git <span class="keyword">log</span> --before=<span class="string">"2 days"</span>  <span class="comment"># 显示2天前提交</span></div><div class="line">git <span class="keyword">log</span> -<span class="number">1</span> HEAD~<span class="number">3</span>          <span class="comment"># 显示比HEAD早3个提交的那个提交</span></div><div class="line">git <span class="keyword">log</span> -<span class="number">1</span> HEAD^^^</div><div class="line">git reflog                 <span class="comment"># 查看操作记录</span></div></pre></td></tr></table></figure>

<p>添加、提交、删除、找回，重置修改文件</p>
<figure class="highlight git"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="input"><span class="prompt">git co  -- &lt;file&gt;</span>   <span class="comment"># 抛弃工作区修改</span></span></div><div class="line"><span class="input"><span class="prompt">git co  .           # 抛弃工作区修改</span></span></div><div class="line">git co HEAD &lt;file&gt;  <span class="comment"># 抛弃工作目录区中文件的修改</span></div></pre></td></tr></table></figure>



<figure class="highlight git"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="input"><span class="prompt">git add &lt;file&gt;</span>      <span class="comment"># 将工作文件修改提交到本地暂存区</span></span></div><div class="line">git add .           <span class="comment"># 将所有修改过的工作文件提交暂存区</span></div></pre></td></tr></table></figure>



<figure class="highlight git"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="input"><span class="prompt">git rm &lt;file&gt;</span>       <span class="comment"># 从版本库中删除文件</span></span></div><div class="line"><span class="input"><span class="prompt">git rm &lt;file&gt;</span> --cached  <span class="comment"># 从版本库中删除文件，但不删除文件</span></span></div></pre></td></tr></table></figure>



<figure class="highlight git"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="input"><span class="prompt">git reset &lt;file&gt;</span>    <span class="comment"># 从暂存区恢复到工作文件</span></span></div><div class="line"><span class="input"><span class="prompt">git reset -- .      # 从暂存区恢复到工作文件</span></span></div><div class="line">git reset --hard  HEAD^ # 恢复最近一次提交过的状态，即放弃上次提交后的所有本次修改</div><div class="line">git reset --hard &lt;commit id&gt;  <span class="comment"># 恢复到某一次提交的状态</span></div><div class="line"><span class="input"><span class="prompt">git reset HEAD &lt;file&gt;</span> <span class="comment"># 抛弃暂存区中文件的修改</span></span></div></pre></td></tr></table></figure>



<figure class="highlight git"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">git ci &lt;<span class="built_in">file</span>&gt;</div><div class="line">git ci .</div><div class="line">git ci -<span class="operator">a</span>           <span class="comment"># 将git add, git rm和git ci等操作都合并在一起做</span></div><div class="line">git ci -am <span class="string">"some comments"</span></div><div class="line">git ci <span class="comment">--amend      # 修改最后一次提交记录</span></div></pre></td></tr></table></figure>



<figure class="highlight git"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="input"><span class="prompt">git revert &lt;$id&gt;</span>    <span class="comment"># 恢复某次提交的状态，恢复动作本身也创建了一次提交对象</span></span></div><div class="line">git revert <span class="constant">HEAD</span>     <span class="comment"># 恢复最后一次提交的状态</span></div></pre></td></tr></table></figure>

<p>查看文件diff</p>
<figure class="highlight git"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="input"><span class="prompt">git diff &lt;file&gt;</span>     <span class="comment"># 比较当前文件和暂存区文件差异</span></span></div><div class="line"><span class="input"><span class="prompt">git diff</span></span></div><div class="line">git diff &lt;$id1&gt; &lt;<span class="variable">$id2</span>&gt;      <span class="comment"># 比较两次提交之间的差异</span></div><div class="line">git diff &lt;branch1&gt;..&lt;branch2&gt;   <span class="comment"># 在两个分支之间比较 </span></div><div class="line">git diff --staged   <span class="comment"># 比较暂存区和版本库差异</span></div><div class="line">git diff --cached   <span class="comment"># 比较暂存区和版本库差异</span></div><div class="line">git diff --stat     <span class="comment"># 仅仅比较统计信息</span></div></pre></td></tr></table></figure>

<h3 id="Git_本地分支管理">Git 本地分支管理</h3>
<p>查看、切换、创建和删除分支</p>
<figure class="highlight git"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="input"><span class="prompt">git br -r           # 查看远程分支</span></span></div><div class="line">git br -v           # 查看各个分支最后提交信息</div><div class="line">git br -a           # 列出所有分支</div><div class="line">git br --merged     # 查看已经被合并到当前分支的分支</div><div class="line">git br --no-merged  # 查看尚未被合并到当前分支的分支</div><div class="line">git br &lt;new_branch&gt; <span class="comment"># 基于当前分支创建新的分支</span></div><div class="line"><span class="input"><span class="prompt">git br &lt;new_branch&gt;</span>  &lt;start_point&gt;      <span class="comment"># 基于另一个起点（分支名称，提交名称或则标签名称），创建新的分支</span></span></div><div class="line"><span class="input"><span class="prompt">git br -f &lt;existing_branch&gt;</span>  &lt;start_point&gt;  <span class="comment"># 创建同名新分支，覆盖已有分支</span></span></div><div class="line"><span class="input"><span class="prompt">git br -d &lt;branch&gt;</span>  <span class="comment"># 删除某个分支</span></span></div><div class="line"><span class="input"><span class="prompt">git br -D &lt;branch&gt;</span>  <span class="comment"># 强制删除某个分支 (未被合并的分支被删除的时候需要强制)</span></span></div></pre></td></tr></table></figure>



<figure class="highlight git"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="input"><span class="prompt">git co &lt;branch&gt;</span>         <span class="comment"># 切换到某个分支</span></span></div><div class="line"><span class="input"><span class="prompt">git co -b &lt;new_branch&gt;</span>  <span class="comment"># 创建新的分支，并且切换过去</span></span></div><div class="line"><span class="input"><span class="prompt">git co -b &lt;new_branch&gt;</span> &lt;branch&gt;       <span class="comment"># 基于branch创建新的new_branch</span></span></div><div class="line"><span class="input"><span class="prompt">git co -m &lt;existing_branch&gt;</span> &lt;new_branch&gt;  <span class="comment"># 移动或重命名分支，当新分支不存在时</span></span></div><div class="line"><span class="input"><span class="prompt">git co -M &lt;existing_branch&gt;</span> &lt;new_branch&gt;  <span class="comment"># 移动或重命名分支，当新分支存在时就覆盖</span></span></div><div class="line"><span class="input"><span class="prompt"></span></span></div><div class="line">git co $id               # 把某次历史提交记录checkout出来，但无分支信息，切换到其他分支会自动删除</div><div class="line">git co $id -b &lt;new_branch&gt;       <span class="comment"># 把某次历史提交记录checkout出来，创建成一个分支</span></div></pre></td></tr></table></figure>

<p>分支合并和rebase</p>
<figure class="highlight git"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="input"><span class="prompt">git merge &lt;branch&gt;</span>                  <span class="comment"># 将branch分支合并到当前分支</span></span></div><div class="line"><span class="input"><span class="prompt">git merge origin/master --no-ff     # 不要Fast-Foward合并，这样可以生成merge提交</span></span></div><div class="line">git merge --no-commit &lt;branch&gt;      <span class="comment"># 合并但不提交</span></div><div class="line"><span class="input"><span class="prompt">git merge --squash &lt;branch&gt;</span>         <span class="comment"># 把一条分支上的内容合并到另一个分支上的一个提交</span></span></div><div class="line"><span class="input"><span class="prompt"></span></span></div><div class="line">git rebase master &lt;branch&gt;          <span class="comment"># 将master rebase到branch，相当于：</span></div><div class="line"><span class="input"><span class="prompt">git co &lt;branch&gt;</span> && git rebase master && git co master && git merge &lt;branch&gt;</span></div></pre></td></tr></table></figure>

<p>Git补丁管理</p>
<figure class="highlight git"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">git diff &gt; ../sync.<span class="keyword">patch</span>         <span class="preprocessor"># 生成补丁</span></div><div class="line">git apply ../sync.<span class="keyword">patch</span>          <span class="preprocessor"># 打补丁</span></div><div class="line">git apply --check ../sync.<span class="keyword">patch</span>  <span class="preprocessor"># 测试补丁能否成功</span></div><div class="line">git format-<span class="keyword">patch</span> -X              <span class="preprocessor"># 根据提交的log生成patch，X为数字，表示最近的几个日志</span></div></pre></td></tr></table></figure>

<p>Git暂存管理</p>
<figure class="highlight git"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">git stash                        <span class="comment"># 暂存</span></div><div class="line">git stash <span class="keyword">list</span>                   <span class="comment"># 列所有stash</span></div><div class="line">git stash apply                  <span class="comment"># 恢复暂存的内容</span></div><div class="line">git stash drop                   <span class="comment"># 删除暂存区</span></div></pre></td></tr></table></figure>

<p>Git远程分支管理</p>
<figure class="highlight git"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">git pull                         <span class="comment"># 抓取远程仓库所有分支更新并合并到本地</span></div><div class="line">git pull --no-ff                 <span class="comment"># 抓取远程仓库所有分支更新并合并到本地，不要快进合并</span></div><div class="line">git fetch origin                 <span class="comment"># 抓取远程仓库所有更新</span></div><div class="line">git fetch origin remote-branch:local-branch <span class="comment">#抓取remote-branch分支的更新</span></div><div class="line">git fetch origin --tags          <span class="comment"># 抓取远程上的所有分支</span></div><div class="line">git checkout -b <span class="variable">&lt;new-branch&gt;</span> <span class="variable">&lt;remote_tag&gt;</span> <span class="comment"># 抓取远程上的分支</span></div><div class="line">git merge origin/master          <span class="comment"># 将远程主分支合并到本地当前分支</span></div><div class="line">git co --track origin/branch     <span class="comment"># 跟踪某个远程分支创建相应的本地分支</span></div><div class="line">git co -b <span class="variable">&lt;local_branch&gt;</span> origin/<span class="variable">&lt;remote_branch&gt;</span>  <span class="comment"># 基于远程分支创建本地分支，功能同上</span></div></pre></td></tr></table></figure>



<figure class="highlight git"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="input"><span class="prompt">git push                         # push所有分支</span></span></div><div class="line">git push origin master           # 将本地主分支推到远程主分支</div><div class="line">git push -u origin master        # 将本地主分支推到远程(如无远程主分支则创建，用于初始化远程仓库)</div><div class="line">git push origin &lt;local_branch&gt;   <span class="comment"># 创建远程分支， origin是远程仓库名</span></div><div class="line">git push origin &lt;local_branch&gt;<span class="symbol">:&lt;remote_branch&gt;</span>  <span class="comment"># 创建远程分支</span></div><div class="line"><span class="input"><span class="prompt">git push origin :&lt;remote_branch&gt;</span>  <span class="comment">#先删除本地分支(git br -d &lt;branch&gt;)，然后再push删除远程分支</span></span></div></pre></td></tr></table></figure>

<p>Git远程仓库管理</p>
<figure class="highlight git"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">git remote -v                    <span class="comment"># 查看远程服务器地址和仓库名称</span></div><div class="line">git remote show origin           <span class="comment"># 查看远程服务器仓库状态</span></div><div class="line">git remote <span class="built_in">add</span> origin git@github:XXX/test.git         <span class="comment"># 添加远程仓库地址</span></div><div class="line">git remote <span class="built_in">set</span>-url origin git@github.com:XXX/test.git <span class="comment"># 设置远程仓库地址(用于修改远程仓库地址)</span></div><div class="line">git remote rm &lt;repository&gt;       <span class="comment"># 删除远程仓库</span></div><div class="line">git remote <span class="built_in">set</span>-head origin master   <span class="comment"># 设置远程仓库的HEAD指向master分支</span></div><div class="line"></div><div class="line">git branch <span class="comment">--set-upstream master origin/master</span></div><div class="line">git branch <span class="comment">--set-upstream develop origin/develop</span></div></pre></td></tr></table></figure>

<h3 id="实例">实例</h3>
<p>打patch过程</p>
<figure class="highlight git"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">git <span class="built_in">add</span> .</div><div class="line">git status</div><div class="line">git diff <span class="comment">--cached &gt;XXX.patch</span></div><div class="line">git ci -m <span class="string">'add patch'</span></div></pre></td></tr></table></figure>

<h3 id="分支策略">分支策略</h3>
<p>在实际开发中，我们应该按照几个基本原则进行分支管理：</p>
<p>首先，master分支应该是非常稳定的，也就是仅用来发布新版本，平时不能在上面干活；</p>
<p>那在哪干活呢？干活都在dev分支上，也就是说，dev分支是不稳定的，到某个时候，比如1.0版本发布时，再把dev分支合并到master上，在master分支发布1.0版本；</p>
<p>你和你的小伙伴们每个人都在dev分支上干活，每个人都有自己的分支，时不时地往dev分支上合并就可以了。</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>








<ul class="page-direction" id="page-direction">
    <li><a class="page-prev icon-chevron-sign-left" href="javascript:;" title="上一页"></a></li>
    <li><a class="page-next icon-chevron-sign-right" href="javascript:;" title="下一页"></a></li>
</ul>

    <nav id="page-list" class="page-list"><a class="extend prev" rel="prev" href="/page/5/">Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/7/">Next</a></nav>

<nav id="pagination">
  
    <a href="/page/5/" class="alignleft prev">上一页</a>
  
  
    <a href="/page/7/" class="alignright next">下一页</a>
  
  <div class="clearfix"></div>
</nav></div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="text" name="q" results="0" placeholder="搜一下">
    <i class="icon-search"></i>
    <input type="hidden" name="q" value="site:lawrence-zxc.github.io">
  </form>
</div>

  
<div class="widget tag">
  <h3 class="title">标签</h3>
  <ul class="entry">
  
    <li><a href="/tags/Git/">Git</a><small>2</small></li>
  
    <li><a href="/tags/Java/">Java</a><small>23</small></li>
  
    <li><a href="/tags/JavaScript/">JavaScript</a><small>4</small></li>
  
    <li><a href="/tags/LeetCode/">LeetCode</a><small>2</small></li>
  
    <li><a href="/tags/Linux/">Linux</a><small>18</small></li>
  
    <li><a href="/tags/Mac-Unix/">Mac/Unix</a><small>1</small></li>
  
    <li><a href="/tags/Maven/">Maven</a><small>1</small></li>
  
    <li><a href="/tags/Mysql/">Mysql</a><small>2</small></li>
  
    <li><a href="/tags/Nginx/">Nginx</a><small>5</small></li>
  
    <li><a href="/tags/Oracle/">Oracle</a><small>4</small></li>
  
    <li><a href="/tags/Python/">Python</a><small>3</small></li>
  
    <li><a href="/tags/XMPP/">XMPP</a><small>2</small></li>
  
    <li><a href="/tags/其他/">其他</a><small>0</small></li>
  
    <li><a href="/tags/开始/">开始</a><small>3</small></li>
  
    <li><a href="/tags/技术/">技术</a><small>1</small></li>
  
    <li><a href="/tags/旅行/">旅行</a><small>1</small></li>
  
    <li><a href="/tags/架构/">架构</a><small>3</small></li>
  
    <li><a href="/tags/生活/">生活</a><small>1</small></li>
  
    <li><a href="/tags/读书/">读书</a><small>0</small></li>
  
    <li><a href="/tags/随感/">随感</a><small>7</small></li>
  
  </ul>
</div>


  <div class="trace-invest">
    <span>
        <a href="https://github.com/Lawrence-zxc" target="_blank">欢迎光临我的技术Blog网站 </br>Fork me on Github</a>
    </span>
</div>


  
<div class="widget tag">
  <h3 class="title">最新文章</h3>
  <ul class="entry">
    
      <li>
        <a href="/2015/04/04/jishu-hehuoren/">技术合伙人为什么喜欢谈钱胜过情怀？</a>
      </li>
    
      <li>
        <a href="/2015/04/01/reverse-o2o/">分享一个用户自发需求的反向O2O设想</a>
      </li>
    
      <li>
        <a href="/2015/03/08/shujiawang/">面向企业和个人O2O图书租赁服务设想</a>
      </li>
    
      <li>
        <a href="/2015/03/05/pingjiaapp/">关于电商商品评价评论独立第三方平台构想</a>
      </li>
    
      <li>
        <a href="/2015/01/23/suishoupai/">关于随手拍图片人脸识别APP需求的想法</a>
      </li>
    
      <li>
        <a href="/2014/11/25/xushen/">徐神的诗</a>
      </li>
    
      <li>
        <a href="/2014/11/20/openfire/">Openfire服务端错误解决</a>
      </li>
    
      <li>
        <a href="/2014/11/16/xmpp/">xmpp通信过程分析</a>
      </li>
    
      <li>
        <a href="/2014/11/10/oracle-index/">Oracle大批量高效地更新大数据表索引字段</a>
      </li>
    
      <li>
        <a href="/2014/11/10/oracle-partition/">Oracle Partition Common Usage</a>
      </li>
    
      <li>
        <a href="/2014/10/28/jvm-strace/">jvm退出的原因,使用strace定位</a>
      </li>
    
      <li>
        <a href="/2014/10/28/load-balancing/">负载均衡和过载保护</a>
      </li>
    
  </ul>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <div id="go-pg-top"><i class="icon-arrow-up"></i></div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2015 Jeck Zhang
  
</div>
<div class="clearfix"></div></footer>
  <script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript" charset="utf-8" src="/js/page.js"></script>


<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?a5eb19e532c0b101d72226b1325e6a78";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

</body>

</html>